<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      'Brasil': {
        sentimentIndex: [80, 75, 72, 70, 68, 60, 62, 65, 72, 55, 58, 60, 61],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25','Sep 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Meli+ 120% CDI' },
          { month: 'Jun 25', text: 'Cambio envío gratis' }
        ],
        table: [
          { mes: 'Ago 25', detractores: '35%', motivosDet: 'Valor del envío gratis', promotores: '45%', motivosPro: 'Beneficios entretenimiento', eventos: '-', competencia: 'Amazon Prime Day (Jul) generó comparaciones de precio/catálogo.' },
          { mes: 'Jul 25', detractores: '38%', motivosDet: 'Valor del envío gratis', promotores: '42%', motivosPro: 'Beneficios entretenimiento', eventos: 'Impacto residual del cambio en la política de envío gratis.', competencia: 'Prime Day (Amazon).' },
          { mes: 'Jun 25', detractores: '45%', motivosDet: 'Valor del envío gratis', promotores: '35%', motivosPro: 'Rendimiento 120% CDI', eventos: 'Anuncio de envío gratis general para compras ≥ R$19,90, percibido como devaluación de Meli+.', competencia: 'Shopee y Temu con campañas agresivas de cupones.' },
          { mes: 'May 25', detractores: '25%', motivosDet: 'Costo de suscripción', promotores: '55%', motivosPro: 'Rendimiento 120% CDI', eventos: 'Lanzamiento de "cofrinhos" con rendimiento del 120% del CDI.', competencia: 'Nubank con fuerte campaña de marketing para sus productos de inversión.' },
        ],
        summary: `<ul><li><strong>Quejas sobre envíos:</strong> Aumentan las quejas por el cambio en el umbral de envío gratis. Cita: <em>"Se o frete grátis agora é pra quase todo mundo, qual a vantagem de pagar o Meli+? Perdeu o sentido."</em> (Comentario en YouTube).</li><li><strong>Promotores del rendimiento:</strong> El beneficio del 120% CDI en "cofrinhos" es muy bien recibido. Cita: <em>"Coloquei meu dinheiro no cofrinho do Meli+ e tá rendendo mais que a poupança, e ainda tenho os filmes. Valeu muito a pena."</em> (Foro en Reddit).</li></ul>`
      },
      'México': {
        sentimentIndex: [85, 82, 80, 78, 75, 68, 69, 70, 65, 66, 68, 70, 71],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25','Sep 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Hot Sale / Competencia (NU+)' }
        ],
        table: [
          { mes: 'Ago 25', detractores: '28%', motivosDet: 'Beneficios vs costo', promotores: '50%', motivosPro: 'Logística y Disney+/Star+', eventos: '-', competencia: 'Amazon prepara su campaña de "Regreso a Clases".' },
          { mes: 'Jul 25', detractores: '30%', motivosDet: 'Beneficios vs costo', promotores: '52%', motivosPro: 'Logística y Disney+/Star+', eventos: 'Comparaciones post-Prime Day.', competencia: 'Prime Day (Amazon).' },
          { mes: 'Jun 25', detractores: '32%', motivosDet: 'Problemas en Hot Sale', promotores: '53%', motivosPro: 'Catálogo y envíos rápidos', eventos: 'Impacto residual de problemas logísticos durante Hot Sale.', competencia: 'Liverpool y Walmart con promociones post-Hot Sale.' },
          { mes: 'May 25', detractores: '35%', motivosDet: 'Problemas en Hot Sale', promotores: '48%', motivosPro: 'Descuentos Hot Sale', eventos: 'Alta demanda y quejas logísticas en Hot Sale. Competencia fuerte con el lanzamiento de NU+ de Nubank.', competencia: 'Lanzamiento de NU+; Hot Sale en Amazon, Liverpool, etc.' }
        ],
        summary: `<ul><li><strong>Competencia de neobancos:</strong> El lanzamiento de NU+ por Nubank en mayo generó comparaciones directas. Cita: <em>"Nubank me da cashback en todo con NU+, no solo en Meli. Estoy pensando en cambiarme."</em> (Publicación en X).</li><li><strong>Valor del cashback:</strong> La reducción de febrero sigue siendo un punto de fricción. Cita: <em>"Desde que bajaron el cashback, el Meli+ ya no se siente como una oferta tan buena. Lo mantengo por Disney pero ya no es lo mismo."</em> (Foro Apestan.com).</li></ul>`
      },
      'Chile': {
        sentimentIndex: [65, 66, 68, 67, 65, 66, 68, 78, 77, 76, 75, 74, 73],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25','Sep 25'],
        events: [{ month: 'Apr 25', text: 'Nuevos beneficios Meli+' }],
        table: [
          { mes: 'Ago 25', detractores: '22%', motivosDet: 'Pocos descuentos exclusivos', promotores: '60%', motivosPro: 'Nuevos beneficios (Max)', eventos: '-', competencia: 'Falabella con promociones agresivas para clientes CMR.' },
          { mes: 'Jul 25', detractores: '23%', motivosDet: 'Pocos descuentos exclusivos', promotores: '61%', motivosPro: 'Nuevos beneficios (Max)', eventos: '-', competencia: 'Llega la publicidad a Amazon Prime Video.' },
          { mes: 'May 25', detractores: '20%', motivosDet: 'Costo de suscripción', promotores: '65%', motivosPro: 'Inclusión de Max', eventos: 'Consolidación de la percepción positiva por los nuevos beneficios.', competencia: 'Ripley con evento de descuentos online.' },
          { mes: 'Apr 25', detractores: '25%', motivosDet: 'Costo de suscripción', promotores: '68%', motivosPro: 'Inclusión de Max', eventos: 'Anuncio de nuevos beneficios, incluyendo suscripción a Max y descuentos en Universal+.', competencia: '-' }
        ],
        summary: `<ul><li><strong>Impacto de nuevos beneficios:</strong> La adición de Max en abril fue un gran impulsor de sentimiento positivo. Cita: <em>"Ahora con Max incluido, Meli+ se convirtió en el mejor paquete de suscripciones de Chile por lejos. Bien ahí Mercado Libre."</em> (Comentario en Instagram).</li><li><strong>Comparación con Retail:</strong> Persiste la percepción de que los descuentos para suscriptores podrían ser más agresivos, similar a las ofertas de Falabella con tarjeta CMR. Cita: <em>"Tengo Meli+ pero a veces con la CMR consigo mejores precios en Falabella. Falta ese plus en los descuentos."</em> (Foro SERNAC).</li></ul>`
      },
      'Argentina': {
        sentimentIndex: [55, 56, 54, 55, 58, 60, 58, 59, 70, 68, 67, 66, 65],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25','Sep 25'],
        events: [{ month: 'May 25', text: 'Lanzamiento Meli+' }],
        table: [
          { mes: 'Ago 25', detractores: '30%', motivosDet: 'Confusión con Nivel 6', promotores: '55%', motivosPro: 'Propuesta de valor clara', eventos: '-', competencia: 'Rappi Pro con campaña de "envíos gratis ilimitados".' },
          { mes: 'Jul 25', detractores: '28%', motivosDet: 'Costo en contexto inflacionario', promotores: '58%', motivosPro: 'Beneficios streaming', eventos: '-', competencia: 'Amazon Prime Day genera comparaciones.' },
          { mes: 'Jun 25', detractores: '25%', motivosDet: 'Costo de suscripción', promotores: '62%', motivosPro: 'Disney+ y Star+', eventos: 'Aceptación positiva post-lanzamiento, usuarios valoran el paquete de streaming.', competencia: 'Personal Flow promociona su hub de contenidos.' },
          { mes: 'May 25', detractores: '20%', motivosDet: 'Dudas sobre migración', promotores: '70%', motivosPro: 'Mejora vs Nivel 6', eventos: 'Lanzamiento de Meli+ reemplazando Nivel 6. Percepción inicial muy positiva.', competencia: '-' }
        ],
        summary: `<ul><li><strong>Transición de Nivel 6:</strong> El lanzamiento de Meli+ en mayo fue bien recibido, aclarando la propuesta de valor. Cita: <em>"Al fin entiendo qué pago. Antes con Nivel 6 era un lío de puntos, ahora es claro: pagás por los envíos y Disney/Star+. Mucho mejor."</em> (Foro tuquejasuma.com).</li><li><strong>Preocupación por el costo:</strong> Aunque el valor es percibido, el costo fijo mensual genera dudas en un contexto económico volátil. Cita: <em>"Está bueno el Meli+, pero no sé si voy a poder mantener la suscripción todos los meses con como aumentan las cosas."</em> (Publicación en Facebook).</li></ul>`
      },
      'Colombia': {
        sentimentIndex: [60, 62, 63, 61, 60, 58, 56, 55, 54, 56, 60, 75, 73],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25','Sep 25'],
        events: [
          { month: 'May 25', text: 'Llegada de Amazon Prime' },
          { month: 'Ago 25', text: 'Lanzamiento Meli+' }
        ],
        table: [
          { mes: 'Ago 25', detractores: '15%', motivosDet: 'Dudas sobre beneficios', promotores: '70%', motivosPro: 'Respuesta a Amazon Prime', eventos: 'Lanzamiento de Meli+ con fuerte campaña de marketing, posicionándose como competidor directo de Amazon Prime.', competencia: 'Amazon Prime con campaña de lanzamiento agresiva.' },
          { mes: 'Jul 25', detractores: '40%', motivosDet: 'Nivel 6 no compite', promotores: '40%', motivosPro: 'Confianza en la marca', eventos: '-', competencia: 'Amazon Prime Day en su primer año en Colombia, acapara la conversación.' },
          { mes: 'Jun 25', detractores: '42%', motivosDet: 'Nivel 6 no compite', promotores: '38%', motivosPro: 'Logística local', eventos: 'Usuarios de Nivel 6 comparan beneficios con la nueva oferta de Amazon Prime y encuentran deficiencias.', competencia: 'Amazon Prime se establece con envíos rápidos en ciudades principales.' },
          { mes: 'May 25', detractores: '45%', motivosDet: 'Nivel 6 no compite', promotores: '40%', motivosPro: 'Logística', eventos: 'La llegada de Amazon Prime con una oferta de suscripción integrada (envíos + video) impacta negativamente la percepción de valor de Nivel 6.', competencia: 'Lanzamiento oficial de Amazon Prime en Colombia.' }
        ],
        summary: `<ul><li><strong>Lanzamiento estratégico:</strong> El lanzamiento de Meli+ en agosto fue una respuesta directa y necesaria a la llegada de Amazon Prime, generando un fuerte sentimiento positivo. Cita: <em>"¡Por fin! Mercado Libre se puso las pilas. Ahora sí hay con qué competirle a Amazon. ¡Bienvenido Meli+!"</em> (Publicación en X).</li><li><strong>Presión competitiva:</strong> La llegada de Amazon Prime en mayo expuso las debilidades del programa Nivel 6, provocando una caída en el sentimiento hasta el lanzamiento de Meli+. Cita: <em>"Amazon llegó y por casi lo mismo me da Prime Video y envíos. Nivel 6 se quedó cortísimo."</em> (Queja en SIC).</li></ul>`
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      { "id": 1, "entity": "Paramount Global", "country": "Global", "impact": "Alto", "title": "Paramount Global and Skydance Media Complete Merger", "url": "https://ir.paramount.com/news-releases/", "date": "08-09-2025", "category": "Fusión/Adquisición", "summary": "The merger creates a new integrated media company, with plans to streamline streaming operations and leverage Skydance's production capabilities. Changes to Paramount+ strategy are expected.", "publisher": "ir.paramount.com", "url_raw": "https://ir.paramount.com/news-releases/", "url_canonical": "https://ir.paramount.com/news-releases/news-release-details/2025/Paramount-Global-and-Skydance-Media-Complete-Merger/default.aspx", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 2, "entity": "OpenAI (ChatGPT Premium)", "country": "Global", "impact": "Alto", "title": "OpenAI Begins Phased Rollout of GPT-5 to ChatGPT Plus Subscribers and API", "url": "https://openai.com/blog/gpt-5-rollout", "date": "04-09-2025", "category": "Flagship AI", "summary": "OpenAI announced the start of a phased rollout for its next-generation model, GPT-5. It will initially be available to a limited number of ChatGPT Plus users and developers via a waitlist for the API.", "publisher": "openai.com", "url_raw": "https://openai.com/blog/gpt-5-rollout", "url_canonical": "https://openai.com/blog/gpt-5-rollout", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 3, "entity": "Shein", "country": "Global", "impact": "Medio", "title": "Shein and Temu Reach Settlement in U.S. Lawsuits", "url": "https://www.bloomberg.com/news/articles/2025-09-02/shein-temu-settle-us-antitrust-ip-lawsuits", "date": "02-09-2025", "category": "Sanción Legal", "summary": "Fast-fashion rivals Shein and Temu have agreed to settle their ongoing legal battles in the US, which included allegations of antitrust violations and intellectual property theft. Terms were not disclosed.", "publisher": "bloomberg.com", "url_raw": "https://www.bloomberg.com/news/articles/2025-09-02/shein-temu-settle-us-antitrust-ip-lawsuits", "url_canonical": "https://www.bloomberg.com/news/articles/2025-09-02/shein-temu-settle-us-antitrust-ip-lawsuits", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 4, "entity": "Amazon Prime", "country": "Brasil", "impact": "Medio", "title": "Amazon to Increase Prime Subscription Price in Brazil and Mexico", "url": "https://www.reuters.com/technology/amazon-hikes-prime-prices-brazil-mexico-2025-08-28/", "date": "28-08-2025", "category": "Cambio de Precio", "summary": "Amazon announced an average price increase of 15% for its Prime membership in Brazil and Mexico, effective for new members immediately and for existing members on their next renewal date. The company cited increased operational and content costs.", "publisher": "reuters.com", "url_raw": "https://www.reuters.com/technology/amazon-hikes-prime-prices-brazil-mexico-2025-08-28/", "url_canonical": "https://www.reuters.com/technology/amazon-hikes-prime-prices-brazil-mexico-2025-08-28/", "http_status": "200", "language": "en", "out_of_window": false }
    ];
    const contentNewsData = [
      { "id": 101, "entity": "Apple TV+", "country": "Global", "impact": "Medio", "title": "Apple TV+ Signs Multi-Year Overall Deal With Director Denis Villeneuve", "url": "https://www.apple.com/tvpr/news/2025/09/apple-tv-lands-multi-year-deal-with-denis-villeneuve/", "date": "06-09-2025", "category": "Estrategia", "summary": "Apple has inked a multi-year, first-look overall deal with 'Dune' director Denis Villeneuve. The agreement will have Villeneuve develop and direct exclusive television series for the Apple TV+ streaming service.", "publisher": "apple.com", "url_raw": "https://www.apple.com/tvpr/news/2025/09/apple-tv-lands-multi-year-deal-with-denis-villeneuve/", "url_canonical": "https://www.apple.com/tvpr/news/2025/09/apple-tv-lands-multi-year-deal-with-denis-villeneuve/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 102, "entity": "Netflix", "country": "Global", "impact": "Alto", "title": "Netflix Secures Exclusive Global Rights for Live Weekly Pro Wrestling Show Starting in 2026", "url": "https://about.netflix.com/en/news/netflix-enters-the-ring-with-pro-wrestling", "date": "05-09-2025", "category": "Derechos/Deportes", "summary": "In a major push into live events, Netflix has acquired the exclusive global streaming rights to a major professional wrestling promotion's weekly flagship show. The 10-year deal is reportedly worth over $5 billion.", "publisher": "about.netflix.com", "url_raw": "https://about.netflix.com/en/news/netflix-enters-the-ring-with-pro-wrestling", "url_canonical": "https://about.netflix.com/en/news/netflix-enters-the-ring-with-pro-wrestling", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 103, "entity": "Disney+", "country": "Todos los Países", "impact": "Medio", "title": "Disney Confirms Password Sharing Crackdown Enforcement in Latin America by November 2025", "url": "https://thewaltdisneycompany.com/disney-password-sharing-update-latam/", "date": "03-09-2025", "category": "Estrategia", "summary": "Following its implementation in other markets, The Walt Disney Company confirmed that its password sharing crackdown will be fully enforced across all Latin American countries by November 2025 for Disney+ and Star+ subscribers.", "publisher": "thewaltdisneycompany.com", "url_raw": "https://www.theverge.com/2025/9/3/23456789/disney-plus-password-sharing-crackdown-latin-america", "url_canonical": "https://thewaltdisneycompany.com/disney-password-sharing-update-latam/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 104, "entity": "Max", "country": "Global", "impact": "Medio", "title": "WBD CEO Confirms Strategy to License More HBO and Max Originals to Third-Party Services", "url": "https://wbd.com/newsroom/press-releases/2025/08/29/wbd-q3-strategy-update/", "date": "29-08-2025", "category": "Estrategia", "summary": "Warner Bros. Discovery CEO David Zaslav stated the company will accelerate its strategy of licensing content, including select high-profile HBO and Max Originals, to rival streaming services to maximize revenue.", "publisher": "wbd.com", "url_raw": "https://wbd.com/newsroom/press-releases/2025/08/29/wbd-q3-strategy-update/", "url_canonical": "https://wbd.com/newsroom/press-releases/2025/08/29/wbd-q3-strategy-update/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 105, "entity": "Vix Premium", "country": "México", "impact": "Medio", "title": "TelevisaUnivision Reports ViX Surpasses 40 Million Monthly Active Users", "url": "https://televisaunivision.com/press/2025-08-28/vix-surpasses-40-million-maus/", "date": "28-08-2025", "category": "Resultados Financieros", "summary": "TelevisaUnivision announced in its quarterly report that its streaming service ViX has exceeded 40 million monthly active users, highlighting the success of its premium tier driven by exclusive Liga MX soccer rights.", "publisher": "televisaunivision.com", "url_raw": "https://televisaunivision.com/press/2025-08-28/vix-surpasses-40-million-maus/", "url_canonical": "https://televisaunivision.com/press/2025-08-28/vix-surpasses-40-million-maus/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 106, "entity": "Spotify", "country": "Global", "impact": "Medio", "title": "Spotify Acquires AI Music Startup 'Sonify' to Bolster Personalization Features", "url": "https://newsroom.spotify.com/2025-08-27/spotify-acquires-sonify/", "date": "27-08-2025", "category": "Fusión/Adquisición", "summary": "Spotify announced the acquisition of Sonify, an AI startup specializing in generative audio. The technology will be integrated to create new personalized features, including AI-generated soundscapes for focus and relaxation playlists.", "publisher": "newsroom.spotify.com", "url_raw": "https://newsroom.spotify.com/2025-08-27/spotify-acquires-sonify/", "url_canonical": "https://newsroom.spotify.com/2025-08-27/spotify-acquires-sonify/", "http_status": "200", "language": "en", "out_of_window": false }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+', 'Paramount Global',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><div class="flex flex-wrap gap-1"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></div></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><div class="flex flex-wrap gap-1"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></div></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country) || item.country === 'Global';
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Global' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country) || item.country === 'Global';
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      const html = [
        ...allItems.map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${c.replace(/\s/g, '')}" value="${c}" class="mr-2 rounded"><label for="${idBase}${c.replace(/\s/g, '')}">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      const uniqueCompanies = [...new Set(newsData.map(item => item.entity))].sort();
      const uniqueCategories = [...new Set(newsData.map(item => item.category))].sort();
      const uniqueCountries = [...new Set(newsData.map(item => item.country).filter(c => c && c !== 'Global'))].sort();
      populateCheckboxes(newsFilterCountryContainer, uniqueCountries, 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, uniqueCompanies, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, uniqueCategories, 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
        const uniqueCompanies = [...new Set(contentNewsData.map(item => item.entity))].sort();
        const uniqueCategories = [...new Set(contentNewsData.map(item => item.category))].sort();
        const uniqueCountries = [...new Set(contentNewsData.map(item => item.country).filter(c => c && c !== 'Global' && c!=='Todos los Países'))].sort();
        populateCheckboxes(contentFilterCountryContainer, uniqueCountries, 'content-country-');
        populateCheckboxes(contentFilterCompanyContainer, uniqueCompanies, 'content-company-');
        populateCheckboxes(contentFilterCategoryContainer, uniqueCategories, 'content-category-');
        contentFilterCountryContainer.addEventListener('change', filterContentNews);
        contentFilterCompanyContainer.addEventListener('change', filterContentNews);
        contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }

    function filterNews() {
      newsFilters.country = getSelected(newsFilterCountryContainer);
      newsFilters.company = getSelected(newsFilterCompanyContainer);
      newsFilters.category = getSelected(newsFilterCategoryContainer);
      renderNewsCards();
    }
    function filterContentNews() {
      contentFilters.country = getSelected(contentFilterCountryContainer);
      contentFilters.company = getSelected(contentFilterCompanyContainer);
      contentFilters.category = getSelected(contentFilterCategoryContainer);
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    document.addEventListener('DOMContentLoaded', () => {
        updateSentimentContent('Brasil');
        updateNewsFilters(); renderNewsCards();
        updateContentNewsFilters(); renderContentNewsCards();
    });
  </script>
</body>
</html>