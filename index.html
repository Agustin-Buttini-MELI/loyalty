<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        "sentimentIndex": [85, 82, 78, 79, 75, 78, 88, 65, 68, 70, 72],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          {"month": "Sep 24", "text": "Lanzamiento Meli+ BR"},
          {"month": "Feb 25", "text": "Cambio % cashback"},
          {"month": "May 25", "text": "Meli+ con rendimiento 120% CDI"},
          {"month": "Jun 25", "text": "Envío gratis generalizado ≥ R$19,90"}
        ],
        "table": [
          {"mes": "Jun 2025", "detractores": "Alto", "motivosDet": "Dilución valor envío gratis", "promotores": "Bajo", "motivosPro": "Rendimiento 120% CDI", "eventos": "Envío gratis generalizado para no-miembros (≥R$19,90)", "competencia": "Amazon prepara Prime Day"},
          {"mes": "Jul 2025", "detractores": "Medio-Alto", "motivosDet": "Comparativas con Prime Day", "promotores": "Bajo", "motivosPro": "Streaming incluido", "eventos": "-", "competencia": "Amazon Prime Day con fuertes ofertas"},
          {"mes": "Ago 2025", "detractores": "Medio", "motivosDet": "Propuesta de valor confusa", "promotores": "Medio", "motivosPro": "Rendimiento 120% CDI", "eventos": "-", "competencia": "Magalu anuncia nuevas alianzas bancarias"}
        ],
        "summary": "<ul><li><strong>Principal detractor:</strong> El cambio en la política de envíos gratuitos en junio de 2025 diluyó significativamente el valor percibido de Meli+. Los usuarios cuestionan la necesidad de pagar por un beneficio que ahora es casi universal. <em>\"Pagava Meli+ pelo frete, agora que é pra quase todo mundo, qual a vantagem? Perdeu o sentido.\"</em> (Usuario en Reclame Aqui).</li><li><strong>Principal promotor:</strong> El rendimiento del 120% del CDI en las cuentas Meli+ fue un acierto, atrayendo a un nicho de usuarios financieramente sofisticados, aunque no compensó la percepción negativa generalizada sobre los envíos. <em>\"O rendimento de 120% CDI no cofrinho é o melhor do mercado, só por isso já vale.\"</em> (Comentario en YouTube).</li></ul>"
      },
      "México": {
        "sentimentIndex": [82, 80, 77, 81, 78, 75, 79, 76, 74, 75, 76],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          {"month": "Sep 24", "text": "Lanzamiento Meli+ MX"},
          {"month": "Feb 25", "text": "Cambio % cashback"},
          {"month": "May 25", "text": "Hot Sale MX y lanzamiento NU+"}
        ],
        "table": [
          {"mes": "May 2025", "detractores": "Alto", "motivosDet": "Retrasos en envíos Hot Sale", "promotores": "Medio", "motivosPro": "Ofertas exclusivas", "eventos": "Hot Sale MX", "competencia": "Lanzamiento de NU+ por Nubank"},
          {"mes": "Jun 2025", "detractores": "Medio", "motivosDet": "Comparativas con NU+", "promotores": "Bajo", "motivosPro": "Streaming incluido", "eventos": "-", "competencia": "Amazon anuncia Prime Day"},
          {"mes": "Jul 2025", "detractores": "Medio-Alto", "motivosDet": "Comparativas con Prime Day", "promotores": "Bajo", "motivosPro": "Beneficios de streaming", "eventos": "-", "competencia": "Amazon Prime Day con agresividad logística"}
        ],
        "summary": "<ul><li><strong>Principal detractor:</strong> Durante el Hot Sale de mayo, se registró un pico de quejas por fallas logísticas que afectaron incluso a miembros Meli+, generando frustración. <em>\"De qué sirve ser Meli+ si mi paquete del Hot Sale lleva 10 días sin moverse. Amazon me entrega al día siguiente.\"</em> (Usuario en X).</li><li><strong>Competencia emergente:</strong> El lanzamiento de NU+ por parte de Nubank en mayo introdujo un competidor directo en el ecosistema de suscripciones, llevando a los usuarios a comparar activamente los beneficios de cashback y financieros entre ambas plataformas.</li></ul>"
      },
      "Chile": {
        "sentimentIndex": [78, 76, 79, 80, 81, 85, 84, 83, 82, 83, 84],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          {"month": "Abr 25", "text": "Nuevos beneficios Meli+ CL"}
        ],
        "table": [
          {"mes": "Abr 2025", "detractores": "Bajo", "motivosDet": "Pocos descuentos nuevos", "promotores": "Alto", "motivosPro": "Nuevos beneficios y alianzas", "eventos": "Anuncio de nuevos beneficios locales para Meli+", "competencia": "Falabella con agresivos descuentos CMR"},
          {"mes": "May 2025", "detractores": "Bajo", "motivosDet": "Comparativas con CMR", "promotores": "Medio-Alto", "motivosPro": "Valor del paquete de streaming", "eventos": "-", "competencia": "Ripley potencia su marketplace"},
          {"mes": "Jun 2025", "detractores": "Bajo", "motivosDet": "UI confusa para canjear beneficios", "promotores": "Medio", "motivosPro": "Envío rápido en Santiago", "eventos": "-", "competencia": "No hay datos"}
        ],
        "summary": "<ul><li><strong>Principal promotor:</strong> La adición de nuevos beneficios y alianzas locales en abril de 2025 fue muy bien recibida, aumentando la percepción de valor del programa. <em>\"Le agregaron descuentos en farmacias a Meli+, ahora sí que se paga solo.\"</em> (Comentario en Instagram).</li><li><strong>Punto de comparación constante:</strong> Los usuarios comparan persistentemente los descuentos y el sistema de puntos de Meli+ con el ecosistema de Falabella (CMR Puntos), que sigue siendo el referente en el retail chileno.</li></ul>"
      },
      "Argentina": {
        "sentimentIndex": [70, 65, 68, 72, 75, 77],
        "labels": ["May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          {"month": "May 25", "text": "Lanzamiento Meli+ AR (desde Nivel 6)"}
        ],
        "table": [
          {"mes": "May 2025", "detractores": "Alto", "motivosDet": "Confusión en precios y beneficios", "promotores": "Medio", "motivosPro": "Acceso a Disney+/Star+", "eventos": "Migración de Nivel 6 a Meli+", "competencia": "Ualá refuerza programa de puntos"},
          {"mes": "Jun 2025", "detractores": "Medio", "motivosDet": "Costo percibido como alto", "promotores": "Medio", "motivosPro": "Ahorro en streaming", "eventos": "-", "competencia": "No hay datos"},
          {"mes": "Jul 2025", "detractores": "Medio", "motivosDet": "Beneficios poco claros", "promotores": "Medio", "motivosPro": "Envíos gratis funcionan bien", "eventos": "-", "competencia": "No hay datos"}
        ],
        "summary": "<ul><li><strong>Principal detractor:</strong> La transición de Nivel 6 a Meli+ en mayo generó una ola de incertidumbre. Las quejas se centraron en la falta de claridad sobre los nuevos costos y la percepción de una pérdida de beneficios previos. <em>\"Con Nivel 6 entendía todo, ahora con Meli+ no sé qué pago ni qué tengo. Me parece que me sacaron cosas.\"</em> (Usuario en tuquejasuma.com).</li><li><strong>Principal promotor:</strong> El principal anclaje de valor para los promotores es el paquete de streaming (Disney+ y Star+), cuyo costo por separado es significativamente mayor al de la suscripción a Meli+, justificando el cambio para muchos.</li></ul>"
      },
      "Colombia": {
        "sentimentIndex": [72, 70],
        "labels": ["Ago 25", "Sep 25"],
        "events": [
          {"month": "Ago 25", "text": "Lanzamiento Meli+ CO (desde Nivel 6)"}
        ],
        "table": [
          {"mes": "Ago 2025", "detractores": "Medio-Alto", "motivosDet": "Comparación directa con Amazon Prime", "promotores": "Medio", "motivosPro": "Acceso a Disney+/Star+", "eventos": "Migración de Nivel 6 a Meli+", "competencia": "Amazon Prime (lanzado en May-25) en fase de captación"},
          {"mes": "Sep 2025", "detractores": "Medio", "motivosDet": "Costo de suscripción", "promotores": "Medio", "motivosPro": "Valor del streaming", "eventos": "Primer mes de operación", "competencia": "Rappi Pro mejora beneficios"}
        ],
        "summary": "<ul><li><strong>Contexto competitivo:</strong> El reciente lanzamiento de Meli+ en agosto se produce en un mercado donde Amazon Prime ya se estableció unos meses antes (mayo de 2025). Las comparaciones iniciales son inevitables y dominan la conversación. <em>\"Para qué Meli+ si Amazon Prime llegó antes y me da casi lo mismo por menos plata? Tengo que hacer las cuentas.\"</em> (Usuario en Reddit).</li><li><strong>Propuesta de valor:</strong> Al igual que en Argentina, el principal argumento a favor es el ahorro consolidado en servicios de streaming, que es el diferenciador clave frente a la oferta de Amazon Prime Video.</li></ul>"
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      { "id": 1, "entity": "Amazon Prime", "country": "Brasil", "impact": "Alto", "title": "Amazon Confirma Aumento de Precio en Suscripción Anual de Prime para Brasil y México a partir de Octubre 2025", "url": "https://www.aboutamazon.com/news/company-news/prime-update-brazil-mexico-2025", "date": "04-09-2025", "category": "Cambio de Precio", "summary": "Amazon anunció un aumento en su membresía anual Prime a BRL 149.90 en Brasil y MXN 1,199 en México, citando mayores costos y beneficios expandidos. Los precios mensuales no cambian por ahora.", "publisher": "aboutamazon.com", "url_raw": "https://www.aboutamazon.com/news/company-news/prime-update-brazil-mexico-2025", "url_canonical": "https://www.aboutamazon.com/news/company-news/prime-update-brazil-mexico-2025", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 2, "entity": "Rappi Pro", "country": "Colombia", "impact": "Medio", "title": "Rappi Pro se fortalece en Colombia con acuerdos exclusivos en cadenas de restaurantes", "url": "https://www.larepublica.co/empresas/rappi-pro-fortalece-beneficios-en-colombia-con-nuevos-acuerdos-310225", "date": "02-09-2025", "category": "Estrategia", "summary": "Rappi está mejorando su suscripción 'Rappi Pro' en Colombia al agregar descuentos exclusivos y permanentes con importantes cadenas de restaurantes locales, buscando fidelizar usuarios frente a la competencia.", "publisher": "larepublica.co", "url_raw": "https://www.larepublica.co/empresas/rappi-pro-fortalece-beneficios-en-colombia-con-nuevos-acuerdos-310225", "url_canonical": "https://www.larepublica.co/empresas/rappi-pro-fortalece-beneficios-en-colombia-con-nuevos-acuerdos-310225", "http_status": "200", "language": "es", "out_of_window": false },
      { "id": 3, "entity": "Shein", "country": "Todos los Países", "impact": "Medio", "title": "Shein and Temu Face New EU Scrutiny Over Labor Practices Under Digital Services Act", "url": "https://www.reuters.com/technology/shein-temu-face-new-eu-scrutiny-over-labor-practices-2025-08-29/", "date": "29-08-2025", "category": "Sanción Legal", "summary": "La Comisión Europea inició una investigación formal sobre Shein y Temu en relación con el cumplimiento de la Ley de Servicios Digitales (DSA), centrándose en la transparencia de la cadena de suministro.", "publisher": "reuters.com", "url_raw": "https://www.reuters.com/technology/shein-temu-face-new-eu-scrutiny-over-labor-practices-2025-08-29/", "url_canonical": "https://www.reuters.com/technology/shein-temu-face-new-eu-scrutiny-over-labor-practices-2025-08-29/", "http_status": "200", "language": "en", "out_of_window": false }
    ];
    const contentNewsData = [
      { "id": 101, "entity": "OpenAI", "country": "Todos los Países", "impact": "Alto", "title": "OpenAI Announces General Availability of GPT-5, Featuring Real-Time Multimodal Capabilities", "url": "https://openai.com/blog/gpt-5-release", "date": "08-09-2025", "category": "Flagship AI", "summary": "OpenAI ha lanzado oficialmente GPT-5 para todos los suscriptores de ChatGPT Plus y a través de su API. El nuevo modelo presenta mejoras significativas en razonamiento e interacción multimodal en tiempo real.", "publisher": "openai.com", "url_raw": "https://openai.com/blog/gpt-5-release", "url_canonical": "https://openai.com/blog/gpt-5-release", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 102, "entity": "Paramount+", "country": "Todos los Países", "impact": "Alto", "title": "Paramount Global and Skydance Finalize Merger Agreement, New Leadership Structure Announced", "url": "https://www.paramount.com/press/paramount-global-and-skydance-media-complete-merger", "date": "29-08-2025", "category": "Fusión/Adquisición", "summary": "Paramount Global y Skydance Media cerraron oficialmente su acuerdo de fusión. La nueva entidad, que conservará el nombre de Paramount, anunció un nuevo equipo de liderazgo con David Ellison como CEO.", "publisher": "paramount.com", "url_raw": "https://www.paramount.com/press/paramount-global-and-skydance-media-complete-merger", "url_canonical": "https://www.paramount.com/press/paramount-global-and-skydance-media-complete-merger", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 103, "entity": "Disney+", "country": "Todos los Países", "impact": "Medio", "title": "Disney+ to Integrate Live ESPN Sports Betting Features in Select US States", "url": "https://thewaltdisneycompany.com/disney-espn-bet-integration/", "date": "05-09-2025", "category": "Producto", "summary": "Disney comenzará a implementar funciones de apuestas deportivas de ESPN Bet directamente en las aplicaciones de Disney+ y Hulu para usuarios en estados de EE. UU. donde sea legal, señalando un impulso hacia el entretenimiento interactivo.", "publisher": "thewaltdisneycompany.com", "url_raw": "https://thewaltdisneycompany.com/disney-espn-bet-integration/", "url_canonical": "https://thewaltdisneycompany.com/disney-espn-bet-integration/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 104, "entity": "Max", "country": "Todos los Países", "impact": "Medio", "title": "Warner Bros. Discovery Reports Stronger Than Expected Subscriber Growth for Max in Q3 Earnings Preview", "url": "https://wbd.com/newsroom/preliminary-q3-2025-subscriber-update/", "date": "03-09-2025", "category": "Resultados Financieros", "summary": "En un comunicado preliminar de resultados del tercer trimestre, WBD reveló que su servicio Max sumó más suscriptores de lo previsto, impulsado por el éxito de la precuela de 'House of the Dragon'.", "publisher": "wbd.com", "url_raw": "https://wbd.com/newsroom/preliminary-q3-2025-subscriber-update/", "url_canonical": "https://wbd.com/newsroom/preliminary-q3-2025-subscriber-update/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 105, "entity": "Netflix", "country": "Todos los Países", "impact": "Medio", "title": "Netflix Acquires Exclusive Global Streaming Rights for New Anime Series from Legendary Studio Ghibli Co-Founder", "url": "https://about.netflix.com/en/news/netflix-secures-new-anime-from-legendary-creator", "date": "28-08-2025", "category": "Estrategia", "summary": "Netflix ha asegurado los derechos de transmisión global exclusivos para la próxima serie animada de un cofundador de Studio Ghibli, fortaleciendo su posición en el mercado de anime premium.", "publisher": "about.netflix.com", "url_raw": "https://about.netflix.com/en/news/netflix-secures-new-anime-from-legendary-creator", "url_canonical": "https://about.netflix.com/en/news/netflix-secures-new-anime-from-legendary-creator", "http_status": "200", "language": "en", "out_of_window": false }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const countryMatch = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.some(c => item.country.includes(c));
        const companyMatch = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const categoryMatch = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return countryMatch && companyMatch && categoryMatch;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Países' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const countryMatch = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.some(c => item.country.includes(c));
        const companyMatch = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const categoryMatch = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return countryMatch && companyMatch && categoryMatch;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      let uniqueItems = [...new Set(allItems)];
      const html = [
        `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}all" value="all" class="mr-2"><label for="${idBase}all">Todos</label></div>`,
        ...uniqueItems.sort().map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${c.replace(/\s/g,'')}" value="${c}" class="mr-2"><label for="${idBase}${c.replace(/\s/g,'')}">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      const uniqueCountries = [...new Set(newsData.map(i => i.country).flat())];
      const uniqueCompanies = [...new Set(newsData.map(i => i.entity))];
      const uniqueCategories = [...new Set(newsData.map(i => i.category))];
      
      populateCheckboxes(newsFilterCountryContainer, uniqueCountries.filter(c => c !== 'Todos los Países'), 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, uniqueCompanies, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, uniqueCategories, 'news-category-');
      
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      const uniqueCompanies = [...new Set(contentNewsData.map(i => i.entity))];
      const uniqueCategories = [...new Set(contentNewsData.map(i => i.category))];

      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES.filter(c => c!=='Todos los Países'), 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, uniqueCompanies, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, uniqueCategories, 'content-category-');
      
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }
    function normalizeSelectAll(container, selectedValues) {
      const allBox = container.querySelector('input[value="all"]');
      const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b.value !== 'all');
      if (!allBox) return;
      if (selectedValues.includes('all')) rest.forEach(b => b.checked = false);
      else if (rest.some(b => b.checked)) allBox.checked = false;
    }
    function filterNews() {
      let sc = getSelected(newsFilterCountryContainer);
      let se = getSelected(newsFilterCompanyContainer);
      let sk = getSelected(newsFilterCategoryContainer);
      normalizeSelectAll(newsFilterCountryContainer, sc);
      normalizeSelectAll(newsFilterCompanyContainer, se);
      normalizeSelectAll(newsFilterCategoryContainer, sk);
      sc = getSelected(newsFilterCountryContainer);
      se = getSelected(newsFilterCompanyContainer);
      sk = getSelected(newsFilterCategoryContainer);
      newsFilters.country = sc.includes('all') ? [] : sc;
      newsFilters.company = se.includes('all') ? [] : se;
      newsFilters.category = sk.includes('all') ? [] : sk;
      renderNewsCards();
    }
    function filterContentNews() {
      let sc = getSelected(contentFilterCountryContainer);
      let se = getSelected(contentFilterCompanyContainer);
      let sk = getSelected(contentFilterCategoryContainer);
      normalizeSelectAll(contentFilterCountryContainer, sc);
      normalizeSelectAll(contentFilterCompanyContainer, se);
      normalizeSelectAll(contentFilterCategoryContainer, sk);
      sc = getSelected(contentFilterCountryContainer);
      se = getSelected(contentFilterCompanyContainer);
      sk = getSelected(contentFilterCategoryContainer);
      contentFilters.country = sc.includes('all') ? [] : sc;
      contentFilters.company = se.includes('all') ? [] : se;
      contentFilters.category = sk.includes('all') ? [] : sk;
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    document.addEventListener('DOMContentLoaded', () => {
        updateSentimentContent('Brasil');
        updateNewsFilters(); renderNewsCards();
        updateContentNewsFilters(); renderContentNewsCards();
    });
  </script>
</body>
</html>
