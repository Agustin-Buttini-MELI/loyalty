<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
    details > summary { list-style: none; }
    details > summary::-webkit-details-marker { display: none; }
    details[open] summary svg { transform: rotate(180deg); }
  </style>
</head>
<body class="antialiased">
<header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <div class="flex items-center space-x-3">
        <div class="bg-main-accent p-2 rounded-lg">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
          </svg>
        </div>
        <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
      </div>
    </div>
  </div>
</header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">An√°lisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evoluci√≥n de la percepci√≥n de los clientes en funci√≥n de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">√çndice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section id="glosario" class="bg-white rounded-lg shadow-md border border-gray-200 mb-8">
      <details>
        <summary class="cursor-pointer w-full flex justify-between items-center px-4 py-3 text-left text-gray-800 font-semibold hover:bg-gray-50 focus:outline-none">
          <span>üìñ Glosario</span>
          <svg class="w-5 h-5 text-gray-500 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </summary>
        <div class="px-4 pb-4 text-sm text-gray-700 space-y-4 pt-2">
          <div>
            <p class="font-semibold mb-1">Niveles de sentimiento</p>
            <ul class="list-disc list-inside space-y-1">
              <li><span class="text-emerald-700 font-medium">Muy alto:</span> ‚â•55% menciones ponderadas o +10 p.p. vs. promedio 3m.</li>
              <li><span class="text-emerald-600 font-medium">Alto:</span> 50‚Äì54% o +5 a +9 p.p.</li>
              <li><span class="text-gray-700 font-medium">Estable:</span> cambio ‚â§¬±3 p.p. vs. mes previo.</li>
              <li><span class="text-rose-600 font-medium">Bajo:</span> 30‚Äì39% o ‚àí5 a ‚àí9 p.p.</li>
              <li><span class="text-rose-700 font-medium">Muy bajo:</span> ‚â§29% o ca√≠da ‚â•‚àí10 p.p.</li>
            </ul>
          </div>
          <div>
            <p class="font-semibold mb-1">Menci√≥n</p>
            <p>
              Comentario individual capturado en fuentes monitorizadas (Reclame Aqui, SERNAC, Apestan.com, tuquejasuma, SIC, redes, foros, comentarios en noticias).
              Tras limpieza y deduplicaci√≥n, cada menci√≥n se pondera por <em>engagement</em>, <em>recencia</em>, <em>credibilidad</em> y <em>severidad</em>.
              La suma ponderada genera el √≠ndice mensual (0‚Äì100).
            </p>
          </div>
        </div>
      </details>
    </section>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="M√©xico" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">M√©xico</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por Pa√≠s: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualizaci√≥n interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
  "Brasil": {
    "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
    "sentimentIndex": [78, 80, 79, 82, 80, 71, 73, 74, 75, 58, 62, 65, 70, 85, 83],
    "events": [
      { "month": "Sep 24", "text": "Lanzamiento Meli+ BR" },
      { "month": "Feb 25", "text": "Cambio % cashback" },
      { "month": "Jun 25", "text": "Cambio env√≠os gratis BR" },
      { "month": "Oct 25", "text": "Lanzamiento Meli+ Mega BR" }
    ],
    "table": [
      { "mes": "Nov 25", "detractores": "10%", "motivosDet": "Precio Meli+ Mega", "promotores": "78%", "motivosPro": "Valor del bundle de streaming", "eventos": "Consolidaci√≥n post-lanzamiento", "competencia": "Amazon Prime anuncia alza 2026" },
      { "mes": "Oct 25", "detractores": "12%", "motivosDet": "Confusi√≥n inicial con el nuevo tier", "promotores": "75%", "motivosPro": "Meli+ Mega Bundle", "eventos": "Lanzamiento Meli+ Mega (4 streamings)", "competencia": "Magalu anuncia 'Magalu Conecta'" },
      { "mes": "Jun 25", "detractores": "40%", "motivosDet": "Valor del env√≠o gratis diluido", "promotores": "35%", "motivosPro": "Beneficios de streaming (D+)", "eventos": "Env√≠o gratis general ‚â• R$19,90", "competencia": "Shopee agresivo en cupones" },
      { "mes": "Feb 25", "detractores": "25%", "motivosDet": "Reducci√≥n de cashback", "promotores": "55%", "motivosPro": "A√∫n valoran el env√≠o y D+", "eventos": "Cambio % cashback", "competencia": "Nubank Ultravioleta con m√°s beneficios" },
      { "mes": "Sep 24", "detractores": "15%", "motivosDet": "Ausencia de Star+", "promotores": "70%", "motivosPro": "Lanzamiento con Disney+ y env√≠o", "eventos": "Lanzamiento Meli+", "competencia": "Prime Day de Amazon" }
    ],
    "summary": "<ul><li class=\"mb-2\"><strong>Promotores (Oct-Nov 2025):</strong> Euforia por el nuevo plan <strong>Meli+ Mega</strong>, percibido como un valor excepcional. <em>\"Pagar R$39,90 por Netflix, Disney+, Max e AppleTV √© simplesmente a melhor oferta do mercado. Parab√©ns, Meli!\"</em> (Comentario en YouTube).</li><li><strong>Detractores (Jun-Jul 2025):</strong> Fuerte reacci√≥n negativa al cambio en la pol√≠tica de env√≠o gratis, que diluy√≥ la propuesta de valor de Meli+. <em>\"Se agora todo mundo tem frete gr√°tis, por que estou pagando pelo Meli+? N√£o faz sentido.\"</em> (Queja en Reclame Aqui).</li></ul>"
  },
  "M√©xico": {
    "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
    "sentimentIndex": [80, 82, 81, 83, 81, 74, 75, 76, 78, 77, 76, 77, 78, 79, 78],
    "events": [
      { "month": "Sep 24", "text": "Lanzamiento Meli+ MX" },
      { "month": "Feb 25", "text": "Cambio % cashback" },
      { "month": "May 25", "text": "Hot Sale MX" }
    ],
    "table": [
      { "mes": "Nov 25", "detractores": "18%", "motivosDet": "Tiempos de entrega", "promotores": "68%", "motivosPro": "Paquete de beneficios consolidados", "eventos": "Periodo estable pre-fin de a√±o", "competencia": "Amazon con ofertas pre-navide√±as" },
      { "mes": "May 25", "detractores": "18%", "motivosDet": "Saturaci√≥n de ofertas", "promotores": "70%", "motivosPro": "Descuentos exclusivos Meli+", "eventos": "Hot Sale MX", "competencia": "Nubank lanza NU+" },
      { "mes": "Feb 25", "detractores": "22%", "motivosDet": "Reducci√≥n de cashback", "promotores": "60%", "motivosPro": "Env√≠o gratis y Disney+", "eventos": "Cambio % cashback", "competencia": "Klar con rendimientos agresivos" },
      { "mes": "Sep 24", "detractores": "12%", "motivosDet": "Coste de suscripci√≥n", "promotores": "72%", "motivosPro": "Combo Disney+ y Max", "eventos": "Lanzamiento Meli+", "competencia": "Walmart Pass con nuevas promos" }
    ],
    "summary": "<ul><li class=\"mb-2\"><strong>Promotores (May-Jun 2025):</strong> El acceso anticipado y descuentos exclusivos durante el <strong>Hot Sale</strong> generaron un alto volumen de comentarios positivos. <em>\"Compr√© mi nueva tele en el Hot Sale con un descuento extra por ser Meli+, ¬°vali√≥ cada centavo la suscripci√≥n!\"</em> (Publicaci√≥n en Facebook).</li><li><strong>Detractores (Feb-Mar 2025):</strong> Confusi√≥n y quejas por la reducci√≥n del porcentaje de cashback, aunque el impacto fue menor que en otros mercados. <em>\"No avisan bien de los cambios, de repente mi cashback es menor.\"</em> (Queja en Apestan.com).</li></ul>"
  },
  "Chile": {
    "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
    "sentimentIndex": [null, null, null, null, null, 62, 65, 75, 72, 70, 68, 67, 68, 69, 68],
    "events": [
      { "month": "Abr 25", "text": "Nuevos beneficios Meli+ CL" }
    ],
    "table": [
      { "mes": "Nov 25", "detractores": "28%", "motivosDet": "Competencia Falabella", "promotores": "55%", "motivosPro": "Valor de D+ y env√≠os", "eventos": "Cyber Monday local", "competencia": "Falabella con fuertes descuentos CMR" },
      { "mes": "Abr 25", "detractores": "20%", "motivosDet": "Pocos comercios asociados", "promotores": "65%", "motivosPro": "Nuevos descuentos locales", "eventos": "Anuncio de nuevos beneficios", "competencia": "Ripley suma nuevas marcas a su marketplace" }
    ],
    "summary": "<ul><li class=\"mb-2\"><strong>Promotores (Abr-May 2025):</strong> El anuncio de nuevos beneficios locales (descuentos en comercios asociados) fue bien recibido. <em>\"Ahora Meli+ me da descuentos hasta en el cine, se est√° poniendo bueno.\"</em> (Tweet en X).</li><li><strong>Detractores (Constante):</strong> La competencia con el ecosistema de Falabella (CMR, Fpay) sigue siendo el principal punto de fricci√≥n. <em>\"Para qu√© quiero Meli+ si con los puntos CMR y los descuentos de Falabella me sale todo m√°s barato?\"</em> (Comentario en Reddit r/chile).</li></ul>"
  },
  "Argentina": {
    "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
    "sentimentIndex": [null, null, null, null, null, null, null, null, 60, 62, 63, 64, 65, 66, 65],
    "events": [
      { "month": "May 25", "text": "Lanzamiento Meli+ AR" }
    ],
    "table": [
      { "mes": "Nov 25", "detractores": "30%", "motivosDet": "Costo en contexto inflacionario", "promotores": "58%", "motivosPro": "Ahorro en servicios de streaming", "eventos": "Cyber Week local", "competencia": "NaranjaX y Ual√° con promociones agresivas" },
      { "mes": "May 25", "detractores": "35%", "motivosDet": "Confusi√≥n migraci√≥n Nivel 6", "promotores": "50%", "motivosPro": "Inclusi√≥n de Disney+", "eventos": "Lanzamiento / Migraci√≥n de Nivel 6", "competencia": "Modo (bancos) con descuentos en e-commerce" }
    ],
    "summary": "<ul><li class=\"mb-2\"><strong>Promotores (May-Jun 2025):</strong> Los usuarios m√°s j√≥venes y consumidores de streaming valoraron positivamente la inclusi√≥n de Disney+ y otros servicios. <em>\"Zaf√© de pagar Disney aparte, con la inflaci√≥n que hay, re sirve el Meli+.\"</em> (Tweet en X).</li><li><strong>Detractores (May-Jun 2025):</strong> Confusi√≥n durante la migraci√≥n de Nivel 6 a Meli+ y percepci√≥n de un aumento de costo sin un claro aumento de beneficios para quienes no usan streaming. <em>\"Me pasaron a Meli+ y ahora pago m√°s. Yo solo quer√≠a los env√≠os gratis.\"</em> (Queja en tuquejasuma.com).</li></ul>"
  },
  "Colombia": {
    "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
    "sentimentIndex": [null, null, null, null, null, null, null, null, null, null, 60, 58, 60, 61, 62],
    "events": [
      { "month": "May 25", "text": "Llegada de Amazon Prime" },
      { "month": "Ago 25", "text": "Lanzamiento Meli+ CO" }
    ],
    "table": [
      { "mes": "Nov 25", "detractores": "32%", "motivosDet": "Comparaci√≥n con Amazon Prime", "promotores": "55%", "motivosPro": "Competencia a Rappi/beneficios D+", "eventos": "D√≠a sin IVA", "competencia": "Rappi Pro Black se lanza en el pa√≠s" },
      { "mes": "Ago 25", "detractores": "38%", "motivosDet": "Lanzamiento tard√≠o vs Amazon", "promotores": "52%", "motivosPro": "Alternativa local fuerte", "eventos": "Lanzamiento Meli+", "competencia": "Amazon Prime con campa√±a de lanzamiento agresiva" }
    ],
    "summary": "<ul><li class=\"mb-2\"><strong>Promotores (Ago-Sep 2025):</strong> Aprecian tener una alternativa local fuerte que compita con Amazon Prime y Rappi Pro. <em>\"¬°Por fin Meli+ en Colombia! A ver si le hacen competencia a Rappi que est√° car√≠simo.\"</em> (Comentario en YouTube).</li><li><strong>Detractores (Ago-Sep 2025):</strong> El lanzamiento fue opacado por la reciente y agresiva llegada de Amazon Prime. <em>\"Llegan tarde, ya todos estamos probando Amazon Prime que tiene Prime Video y env√≠os r√°pidos.\"</em> (Comentario en foro de El Tiempo).</li></ul>"
  }
};

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
  {
    "id": 1,
    "entity": "Amazon Prime",
    "country": "Brasil",
    "impact": "Alto",
    "title": "Amazon to Increase Prime Subscription Price in Brazil by 15% Starting January 2026",
    "url": "https://www.aboutamazon.com/news/company-news/amazon-prime-brazil-price-update-2026",
    "date": "14-11-2025",
    "category": "Cambio de Precio",
    "summary": "Amazon has announced its first price increase for the Prime subscription in Brazil in over three years, citing increased operational costs and significant investments in Prime Video content and logistics infrastructure.",
    "publisher": "aboutamazon.com"
  },
  {
    "id": 2,
    "entity": "Shein",
    "country": "M√©xico",
    "impact": "Medio",
    "title": "Mexico's SAT Announces Stricter Audits for Cross-Border E-Commerce Shipments",
    "url": "https://www.reuters.com/world/americas/mexico-tightens-customs-enforcement-on-fast-fashion-imports-2025-11-08/",
    "date": "08-11-2025",
    "category": "Sanci√≥n Legal",
    "summary": "Mexico's tax authority (SAT) has issued new guidelines for stricter inspection of packages from cross-border e-commerce platforms like Shein and Temu, aiming to curb undervaluation and ensure correct payment of import duties.",
    "publisher": "reuters.com"
  },
  {
    "id": 3,
    "entity": "Rappi Pro",
    "country": "Colombia",
    "impact": "Medio",
    "title": "Rappi Expands 'Rappi Pro Black' Tier to Colombia with Exclusive Banking Perks",
    "url": "https://blog.rappi.com/comunicados/rappi-pro-black-llega-a-colombia",
    "date": "11-11-2025",
    "category": "Lanzamiento",
    "summary": "Following its success in Brazil and Mexico, Rappi is launching its premium 'Rappi Pro Black' subscription in Colombia. The new tier offers higher cashback on all purchases and a dedicated support line in partnership with Davivienda bank.",
    "publisher": "blog.rappi.com"
  },
  {
    "id": 4,
    "entity": "Uber One",
    "country": "Todos los Pa√≠ses",
    "impact": "Medio",
    "title": "Uber Integrates Grocery Delivery from Cencosud Stores into Uber Eats for Uber One Members",
    "url": "https://www.uber.com/newsroom/cencosud-partnership-latam/",
    "date": "05-11-2025",
    "category": "Estrategia",
    "summary": "Uber has announced a region-wide partnership with retail giant Cencosud. Uber One members in Chile, Argentina, Brazil, and Colombia will now have access to grocery delivery from Jumbo and Santa Isabel stores through the Uber Eats app, with no delivery fee.",
    "publisher": "uber.com"
  }
];
    const contentNewsData = [
  {
    "id": 101,
    "entity": "Netflix",
    "country": "Todos los Pa√≠ses",
    "impact": "Alto",
    "title": "Netflix in Final Talks to Secure Global Streaming Rights for Formula 1 Races Starting in 2027",
    "url": "https://variety.com/2025/tv/news/netflix-formula-1-streaming-rights-global-deal-1235810123/",
    "date": "16-11-2025",
    "category": "Derechos/Deportes",
    "summary": "In a landmark move into live sports, Netflix is reportedly in the final stages of a multi-billion dollar deal to acquire the global streaming rights for Formula 1, positioning it as a major sports broadcaster.",
    "publisher": "variety.com"
  },
  {
    "id": 102,
    "entity": "OpenAI",
    "country": "Todos los Pa√≠ses",
    "impact": "Alto",
    "title": "OpenAI Previews GPT-5, Highlighting 'Autonomous Agent' Capabilities and On-Device Processing for Flagship Partners",
    "url": "https://openai.com/blog/first-look-gpt-5",
    "date": "06-11-2025",
    "category": "Flagship AI",
    "summary": "OpenAI provided a first look at its next-generation model, GPT-5, during its developer conference, showcasing advanced reasoning and the ability to operate as an autonomous agent to complete complex tasks.",
    "publisher": "openai.com"
  },
  {
    "id": 103,
    "entity": "Spotify",
    "country": "Todos los Pa√≠ses",
    "impact": "Medio",
    "title": "Spotify Acquires AI Music Generation Startup 'Melodia' for $150 Million to Bolster Creator Tools",
    "url": "https://investors.spotify.com/press/press-release-details/2025/Spotify-Acquires-AI-Music-Startup-Melodia/",
    "date": "15-11-2025",
    "category": "Fusi√≥n/Adquisici√≥n",
    "summary": "Spotify has completed the acquisition of Melodia, a generative AI music startup. The technology will be integrated into Spotify for Artists, allowing creators to generate royalty-free loops and background tracks.",
    "publisher": "investors.spotify.com"
  },
  {
    "id": 104,
    "entity": "Disney+",
    "country": "Todos los Pa√≠ses",
    "impact": "Medio",
    "title": "The Walt Disney Company Confirms 'The Mandalorian & Grogu' Movie Will Premiere Simultaneously in Theaters and on Disney+ Premier Access",
    "url": "https://thewaltdisneycompany.com/mandalorian-grogu-movie-release-strategy/",
    "date": "13-11-2025",
    "category": "Estrategia",
    "summary": "Disney has confirmed a hybrid release strategy for the upcoming 'The Mandalorian & Grogu' feature film. It will debut in cinemas worldwide while also being available on Disney+ through its 'Premier Access' model.",
    "publisher": "thewaltdisneycompany.com"
  },
  {
    "id": 105,
    "entity": "Max",
    "country": "Todos los Pa√≠ses",
    "impact": "Medio",
    "title": "Warner Bros. Discovery to Bundle Max and Discovery+ at No Extra Cost for All Subscribers by Q2 2026",
    "url": "https://www.wbd.com/newsroom/press-releases/2025/11/09/wbd-to-fully-merge-max-and-discovery-plus-streaming-services/",
    "date": "09-11-2025",
    "category": "Producto",
    "summary": "Warner Bros. Discovery announced its long-awaited plan to fully merge its streaming services. Starting in Q2 2026, the entire Discovery+ content library will be integrated into Max, and the standalone app will be discontinued.",
    "publisher": "wbd.com"
  }
];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','M√©xico','Todos los Pa√≠ses'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ual√°','Cablevisi√≥n Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusi√≥n/Adquisici√≥n','Sanci√≥n Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','M√©xico','Todos los Pa√≠ses'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusi√≥n/Adquisici√≥n','Sanci√≥n Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gr√°fico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: '√çndice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: '√çndice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      if (!rows || rows.length === 0) {
        sentimentTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">No hay datos tabulares para este pa√≠s en el per√≠odo seleccionado.</td></tr>';
        return;
      }
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><div class="flex flex-wrap gap-1">${row.motivosDet.split(',').map(m => `<span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700 text-xs">${m.trim()}</span>`).join('')}</div></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><div class="flex flex-wrap gap-1">${row.motivosPro.split(',').map(m => `<span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700 text-xs">${m.trim()}</span>`).join('')}</div></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html || '<p class="text-gray-500">No hay un resumen disponible para este pa√≠s.</p>'; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categor√≠a ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanci√≥n Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusi√≥n/Adquisici√≥n': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) ‚Äî sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const countryMatch = newsFilters.country.length === 0 || newsFilters.country.includes('Todos los Pa√≠ses') || newsFilters.country.includes(item.country) || (item.country === 'Todos los Pa√≠ses' && newsFilters.country.some(c => ALL_NEWS_COUNTRIES.includes(c)));
        const companyMatch = newsFilters.company.length === 0 || newsFilters.company.includes(item.entity);
        const categoryMatch = newsFilters.category.length === 0 || newsFilters.category.includes(item.category);
        return countryMatch && companyMatch && categoryMatch;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      
      newsNoResults.classList.toggle('hidden', filtered.length > 0 || newsData.length === 0);
      if (newsData.length === 0) {
        alertsGrid.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-xl text-gray-500">No se encontraron alertas de mercado en los √∫ltimos 15 d√≠as.</p></div>';
      }

      filtered.forEach(row => {
        const host = sourceHost(row.url) || row.publisher || 'N/A';
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-lg transition-shadow duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2 flex-wrap gap-y-2">
              <h4 class="font-bold text-gray-800 text-lg pr-2">${row.entity}${row.country && row.country !== 'Todos los Pa√≠ses' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.summary}</p>
            <p class="text-xs text-gray-500 mt-2">T√≠tulo: <span class="italic">${row.title}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <span class="font-medium text-right">${host}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) ‚Äî sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const countryMatch = contentFilters.country.length === 0 || contentFilters.country.includes('Todos los Pa√≠ses') || contentFilters.country.includes(item.country) || item.country === 'Todos los Pa√≠ses';
        const companyMatch = contentFilters.company.length === 0 || contentFilters.company.includes(item.entity);
        const categoryMatch = contentFilters.category.length === 0 || contentFilters.category.includes(item.category);
        return countryMatch && companyMatch && categoryMatch;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length > 0 || contentNewsData.length === 0);
      if (contentNewsData.length === 0) {
        contentAlertsGrid.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-xl text-gray-500">No se encontraron noticias de plataformas en los √∫ltimos 15 d√≠as.</p></div>';
      }

      filtered.forEach(row => {
        const host = sourceHost(row.url) || row.publisher || 'N/A';
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-lg transition-shadow duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2 flex-wrap gap-y-2">
              <h4 class="font-bold text-gray-800 text-lg pr-2">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.summary}</p>
            <p class="text-xs text-gray-500 mt-2">T√≠tulo: <span class="italic">${row.title}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <span class="font-medium text-right">${host}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group) {
      const uniqueItems = [...new Set(allItems)].sort();
      const idBase = group + '-';
      let html = '';
      uniqueItems.forEach(c => {
        const safeId = `${idBase}${c.replace(/[^a-zA-Z0-9]/g, '-')}`;
        html += `<div class="filter-checkbox-item"><input type="checkbox" id="${safeId}" value="${c}" class="mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="${safeId}" class="text-sm text-gray-700">${c}</label></div>`;
      });
      container.innerHTML = html;
    }
    
    function setupFilterListeners(container, filterFunction) {
      container.addEventListener('change', filterFunction);
    }
    
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, [...new Set(newsData.map(n => n.country))], 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category-');
      setupFilterListeners(newsFilterCountryContainer, filterNews);
      setupFilterListeners(newsFilterCompanyContainer, filterNews);
      setupFilterListeners(newsFilterCategoryContainer, filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES, 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category-');
      setupFilterListeners(contentFilterCountryContainer, filterContentNews);
      setupFilterListeners(contentFilterCompanyContainer, filterContentNews);
      setupFilterListeners(contentFilterCategoryContainer, filterContentNews);
    }

    function filterNews() {
      newsFilters.country = getSelected(newsFilterCountryContainer);
      newsFilters.company = getSelected(newsFilterCompanyContainer);
      newsFilters.category = getSelected(newsFilterCategoryContainer);
      renderNewsCards();
    }
    function filterContentNews() {
      contentFilters.country = getSelected(contentFilterCountryContainer);
      contentFilters.company = getSelected(contentFilterCompanyContainer);
      contentFilters.category = getSelected(contentFilterCategoryContainer);
      renderContentNewsCards();
    }
    
    function resetFilters(containers, filterObj, renderFunc) {
      Object.keys(filterObj).forEach(k => filterObj[k] = []);
      containers.forEach(c => Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false));
      renderFunc();
    }

    /* ==== Tabs & Boot ==== */
    document.addEventListener('DOMContentLoaded', () => {
      tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
        tabButtons.forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        updateSentimentContent(e.target.dataset.country);
      }));
      
      document.getElementById('news-reset-filters').addEventListener('click', () => resetFilters([newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer], newsFilters, renderNewsCards));
      document.getElementById('content-reset-filters').addEventListener('click', () => resetFilters([contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer], contentFilters, renderContentNewsCards));

      updateSentimentContent('Brasil');
      updateNewsFilters(); renderNewsCards();
      updateContentNewsFilters(); renderContentNewsCards();
    });
  </script>
</body>
</html>