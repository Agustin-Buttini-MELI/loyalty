<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
    details > summary { list-style: none; }
    details > summary::-webkit-details-marker { display: none; }
    details[open] summary svg { transform: rotate(180deg); }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">An√°lisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evoluci√≥n de la percepci√≥n de los clientes en funci√≥n de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">√çndice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

<section id="glosario" class="bg-white rounded-lg shadow-md border border-gray-200 mb-8">
  <details>
    <summary class="cursor-pointer w-full flex justify-between items-center px-4 py-3 text-left text-gray-800 font-semibold hover:bg-gray-50 focus:outline-none">
      üìñ Glosario
      <svg class="w-5 h-5 text-gray-500 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
      </svg>
    </summary>

    <div class="px-4 pb-4 text-sm text-gray-700 space-y-4 border-t border-gray-200">
      <div class="pt-4">
        <p class="font-semibold mb-1">Niveles de sentimiento</p>
        <ul class="list-disc list-inside space-y-1">
          <li><span class="text-emerald-700 font-medium">Muy alto:</span> ‚â•55% menciones ponderadas o +10 p.p. vs. promedio 3m.</li>
          <li><span class="text-emerald-600 font-medium">Alto:</span> 50‚Äì54% o +5 a +9 p.p.</li>
          <li><span class="text-gray-700 font-medium">Estable:</span> cambio ‚â§¬±3 p.p. vs. mes previo.</li>
          <li><span class="text-rose-600 font-medium">Bajo:</span> 30‚Äì39% o ‚àí5 a ‚àí9 p.p.</li>
          <li><span class="text-rose-700 font-medium">Muy bajo:</span> ‚â§29% o ca√≠da ‚â•‚àí10 p.p.</li>
        </ul>
      </div>

      <div>
        <p class="font-semibold mb-1">Menci√≥n</p>
        <p>
          Cada comentario individual capturado en fuentes monitorizadas (Reclame Aqui, SERNAC, Apestan.com, tuquejasuma, SIC, redes, foros, comentarios en noticias).
          Tras limpieza y deduplicaci√≥n, cada menci√≥n se pondera por <em>engagement</em>, <em>recencia</em>, <em>credibilidad</em> y <em>severidad</em>.
          La suma ponderada genera el √≠ndice mensual (0‚Äì100).
        </p>
      </div>
    </div>
  </details>
</section>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="M√©xico" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">M√©xico</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por Pa√≠s: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualizaci√≥n interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
    "Brasil": {
        "sentimentIndex": [80, 75, 72, 70, 71, 55, 60, 64, 68, 58, 62, 65, 68, 66, 64],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
        "events": [
            { "month": "Sep 24", "text": "Lanzamiento Meli+" },
            { "month": "Feb 25", "text": "Cambio % cashback" },
            { "month": "May 25", "text": "Meli+ 120% CDI" },
            { "month": "Jun 25", "text": "Cambio env√≠os gratis" }
        ],
        "table": [
            { "mes": "Sep 24", "detractores": "Bajo", "motivosDet": "Precio suscripci√≥n", "promotores": "Muy alto", "motivosPro": "Env√≠o gratis/D+/Max", "eventos": "Lanzamiento Meli+", "competencia": "Amazon/Shopee estables." },
            { "mes": "Oct 24", "detractores": "Bajo", "motivosDet": "Pocos descuentos", "promotores": "Alto", "motivosPro": "Log√≠stica r√°pida", "eventos": "Consolidaci√≥n post-lanzamiento.", "competencia": "Magalu con promo agresiva." },
            { "mes": "Nov 24", "detractores": "Estable", "motivosDet": "Problemas con cashback", "promotores": "Estable", "motivosPro": "Cat√°logo D+/Max", "eventos": "Black Friday", "competencia": "Amazon Prime Day exitoso." },
            { "mes": "Dic 24", "detractores": "Estable", "motivosDet": "UI confusa", "promotores": "Estable", "motivosPro": "Entregas en 24h", "eventos": "Campa√±a de Navidad.", "competencia": "Shopee aumenta inversi√≥n en log√≠stica." },
            { "mes": "Ene 25", "detractores": "Estable", "motivosDet": "Disney+ con anuncios", "promotores": "Estable", "motivosPro": "Beneficios streaming", "eventos": "Per√≠odo post-fiestas.", "competencia": "Nubank anuncia programa de lealtad." },
            { "mes": "Feb 25", "detractores": "Muy alto", "motivosDet": "Reducci√≥n cashback", "promotores": "Bajo", "motivosPro": "Env√≠o gratis", "eventos": "Anuncio cambio % cashback.", "competencia": "PicPay lanza cashback mejorado." },
            { "mes": "Mar 25", "detractores": "Alto", "motivosDet": "Cashback bajo", "promotores": "Bajo", "motivosPro": "Entregas r√°pidas", "eventos": "Recuperaci√≥n lenta post-cambio.", "competencia": "Estabilidad general." },
            { "mes": "Abr 25", "detractores": "Estable", "motivosDet": "Precio vs beneficios", "promotores": "Estable", "motivosPro": "Cat√°logo streaming", "eventos": "Mes sin grandes cambios.", "competencia": "Amazon introduce anuncios en Prime Video." },
            { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Costo de env√≠o", "promotores": "Alto", "motivosPro": "Rendimiento 120% CDI", "eventos": "Anuncio Meli+ 120% CDI.", "competencia": "Temu inicia operaciones piloto." },
            { "mes": "Jun 25", "detractores": "Muy alto", "motivosDet": "Env√≠o ya no es 'gratis'", "promotores": "Bajo", "motivosPro": "Rendimiento CDI", "eventos": "Cambio en pol√≠tica de env√≠os gratis.", "competencia": "Competencia sin cambios relevantes." },
            { "mes": "Jul 25", "detractores": "Alto", "motivosDet": "Valor percibido bajo", "promotores": "Estable", "motivosPro": "Descuentos en streaming", "eventos": "Ajuste de percepci√≥n del usuario.", "competencia": "Amazon Prime Day." },
            { "mes": "Ago 25", "detractores": "Estable", "motivosDet": "Problemas de log√≠stica", "promotores": "Estable", "motivosPro": "Ahorro con CDI", "eventos": "Foco en beneficios financieros.", "competencia": "Magalu integra nuevo servicio de pagos." },
            { "mes": "Sep 25", "detractores": "Bajo", "motivosDet": "Cat√°logo de pel√≠culas", "promotores": "Alto", "motivosPro": "1 a√±o de Meli+", "eventos": "Aniversario de Meli+.", "competencia": "Shopee anuncia nuevo centro de distribuci√≥n." },
            { "mes": "Oct 25", "detractores": "Estable", "motivosDet": "Atenci√≥n al cliente", "promotores": "Estable", "motivosPro": "Env√≠o r√°pido", "eventos": "Estabilidad general.", "competencia": "Amazon anuncia suba de precios para 2026." },
            { "mes": "Nov 25", "detractores": "Estable", "motivosDet": "Beneficios poco claros", "promotores": "Estable", "motivosPro": "Descuentos en servicios", "eventos": "Preparaci√≥n Black Friday.", "competencia": "Temu expande categor√≠as de productos." }
        ],
        "summary": "<ul><li><strong>Pico Negativo (Jun-25):</strong> El cambio en la pol√≠tica de env√≠os gratis a un m√≠nimo de R$19,90 gener√≥ una ola de quejas, ya que los usuarios percibieron una devaluaci√≥n del principal beneficio de Meli+. Cita: <em>\"A principal vantagem do Meli+ era o frete gr√°tis, agora com esse limite m√≠nimo n√£o faz mais sentido pra mim.\"</em> (Usuario en Reclame Aqui).</li><li><strong>Pico Positivo (May-25):</strong> La introducci√≥n de la cuenta remunerada al 120% del CDI fue muy bien recibida, atrayendo a un segmento de usuarios enfocado en beneficios financieros y compensando parcialmente el descontento por el cashback.</li></ul>"
    },
    "M√©xico": {
        "sentimentIndex": [82, 78, 75, 73, 74, 60, 65, 68, 62, 64, 66, 68, 70, 68, 67],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
        "events": [
            { "month": "Sep 24", "text": "Lanzamiento Meli+" },
            { "month": "Feb 25", "text": "Cambio % cashback" },
            { "month": "May 25", "text": "Hot Sale / Nubank NU+" }
        ],
        "table": [
            { "mes": "Sep 24", "detractores": "Bajo", "motivosDet": "Confusi√≥n con Nivel 6", "promotores": "Muy alto", "motivosPro": "Paquete D+/Max", "eventos": "Lanzamiento Meli+", "competencia": "Amazon Prime estable." },
            { "mes": "Oct 24", "detractores": "Bajo", "motivosDet": "Precio", "promotores": "Alto", "motivosPro": "Env√≠o gratis sin m√≠nimo", "eventos": "Consolidaci√≥n.", "competencia": "Walmart Pass con promos." },
            { "mes": "Nov 24", "detractores": "Estable", "motivosDet": "Problemas con canje", "promotores": "Estable", "motivosPro": "Velocidad de entrega", "eventos": "El Buen Fin.", "competencia": "Amazon con fuertes descuentos." },
            { "mes": "Dic 24", "detractores": "Estable", "motivosDet": "Poca variedad en D+", "promotores": "Estable", "motivosPro": "Compras navide√±as", "eventos": "Temporada alta.", "competencia": "Liverpool Pocket con env√≠os mejorados." },
            { "mes": "Ene 25", "detractores": "Estable", "motivosDet": "Soporte lento", "promotores": "Estable", "motivosPro": "Beneficios de streaming", "eventos": "Mes de baja actividad.", "competencia": "Anuncio de Klar sobre nuevo producto." },
            { "mes": "Feb 25", "detractores": "Muy alto", "motivosDet": "Reducci√≥n cashback", "promotores": "Bajo", "motivosPro": "A√∫n vale por el env√≠o", "eventos": "Anuncio cambio % cashback.", "competencia": "Amazon sin cambios." },
            { "mes": "Mar 25", "detractores": "Alto", "motivosDet": "Cashback no competitivo", "promotores": "Bajo", "motivosPro": "Log√≠stica", "eventos": "Impacto post-cambio.", "competencia": "Estabilidad en competidores." },
            { "mes": "Abr 25", "detractores": "Estable", "motivosDet": "Publicidad en D+", "promotores": "Estable", "motivosPro": "Descuentos en Paramount+", "eventos": "Nuevos acuerdos de contenido.", "competencia": "Walmart anuncia expansi√≥n de cat√°logo." },
            { "mes": "May 25", "detractores": "Alto", "motivosDet": "Ofertas Hot Sale d√©biles", "promotores": "Estable", "motivosPro": "Env√≠o r√°pido Hot Sale", "eventos": "Hot Sale MX.", "competencia": "Lanzamiento de NU+ de Nubank; muy comentado." },
            { "mes": "Jun 25", "detractores": "Estable", "motivosDet": "Valor del programa", "promotores": "Estable", "motivosPro": "Paquete de streaming", "eventos": "Mes post Hot Sale.", "competencia": "Klar introduce programa de puntos." },
            { "mes": "Jul 25", "detractores": "Estable", "motivosDet": "Costo de membres√≠a", "promotores": "Estable", "motivosPro": "Entregas Full", "eventos": "Verano.", "competencia": "Amazon Prime Day." },
            { "mes": "Ago 25", "detractores": "Bajo", "motivosDet": "Fallas en la app", "promotores": "Estable", "motivosPro": "Nuevos descuentos", "eventos": "Mejoras en la plataforma.", "competencia": "Liverpool con venta nocturna exitosa." },
            { "mes": "Sep 25", "detractores": "Bajo", "motivosDet": "Pocos beneficios nuevos", "promotores": "Alto", "motivosPro": "Fiabilidad del servicio", "eventos": "Aniversario Meli+.", "competencia": "Amazon anuncia suba de precios para 2026." },
            { "mes": "Oct 25", "detractores": "Estable", "motivosDet": "Comparaci√≥n con Amazon", "promotores": "Estable", "motivosPro": "Env√≠os en fin de semana", "eventos": "Preparaci√≥n para El Buen Fin.", "competencia": "Walmart+ agrega beneficios de farmacia." },
            { "mes": "Nov 25", "detractores": "Estable", "motivosDet": "Ofertas del Buen Fin", "promotores": "Estable", "motivosPro": "Log√≠stica y streaming", "eventos": "Mes de alta competencia.", "competencia": "Competencia agresiva de todos los players." }
        ],
        "summary": "<ul><li><strong>Impacto Negativo (Feb-25):</strong> La reducci√≥n del porcentaje de cashback fue el principal detractor del a√±o, generando una ca√≠da abrupta en el sentimiento, similar a la observada en Brasil. Cita: <em>\"El cashback ya era bajo y ahora lo bajan m√°s. El √∫nico valor real que le queda es el env√≠o gratis y los canales.\"</em> (Usuario en X).</li><li><strong>Presi√≥n Competitiva (May-25):</strong> El lanzamiento de NU+ por parte de Nubank durante el mes de Hot Sale gener√≥ ruido significativo, con usuarios comparando activamente los beneficios de ambos programas de lealtad y presionando la percepci√≥n de valor de Meli+.</li></ul>"
    },
    "Chile": {
        "sentimentIndex": [70, 72, 68, 70, 69, 71, 73, 85, 82, 80, 78, 77, 76, 75, 74],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
        "events": [
            { "month": "Abr 25", "text": "Nuevos beneficios Meli+" }
        ],
        "table": [
            { "mes": "Sep 24", "detractores": "Estable", "motivosDet": "Costo de env√≠o alto", "promotores": "Estable", "motivosPro": "Programa de puntos", "eventos": "Sentimiento estable en Nivel 6.", "competencia": "Falabella y Ripley dominan." },
            { "mes": "Oct 24", "detractores": "Estable", "motivosDet": "Tiempos de entrega", "promotores": "Estable", "motivosPro": "Variedad de productos", "eventos": "Cyber Monday.", "competencia": "Falabella con descuentos CMR agresivos." },
            { "mes": "Nov 24", "detractores": "Estable", "motivosDet": "Pocos beneficios", "promotores": "Bajo", "motivosPro": "Cuotas sin inter√©s", "eventos": "Expectativa por Black Friday.", "competencia": "Ripley mejora app." },
            { "mes": "Dic 24", "detractores": "Bajo", "motivosDet": "Log√≠stica en regiones", "promotores": "Estable", "motivosPro": "Compras de navidad", "eventos": "Campa√±a navide√±a.", "competencia": "Amazon con baja tracci√≥n." },
            { "mes": "Ene 25", "detractores": "Estable", "motivosDet": "Falta de claridad", "promotores": "Estable", "motivosPro": "Descuentos", "eventos": "Nivel 6 sin cambios.", "competencia": "L√≠der/Walmart con promos de verano." },
            { "mes": "Feb 25", "detractores": "Estable", "motivosDet": "Costo vs beneficio", "promotores": "Estable", "motivosPro": "Mercado Pago", "eventos": "Sentimiento plano.", "competencia": "Falabella lanza nueva campa√±a." },
            { "mes": "Mar 25", "detractores": "Bajo", "motivosDet": "Pocos beneficios atractivos", "promotores": "Bajo", "motivosPro": "Facilidad de compra", "eventos": "Expectativa por Meli+.", "competencia": "Ripley con promo bancaria." },
            { "mes": "Abr 25", "detractores": "Bajo", "motivosDet": "Precio de suscripci√≥n", "promotores": "Muy alto", "motivosPro": "D+/Max y env√≠os gratis", "eventos": "Lanzamiento Meli+ con nuevos beneficios.", "competencia": "Competencia reacciona con descuentos." },
            { "mes": "May 25", "detractores": "Bajo", "motivosDet": "D+ con anuncios", "promotores": "Alto", "motivosPro": "Paquete de streaming", "eventos": "CyberDay.", "competencia": "Falabella iguala oferta de env√≠o." },
            { "mes": "Jun 25", "detractores": "Bajo", "motivosDet": "Problemas de implementaci√≥n", "promotores": "Alto", "motivosPro": "Ahorro en env√≠os", "eventos": "Asentamiento Meli+.", "competencia": "Ripley con ofertas de vestuario." },
            { "mes": "Jul 25", "detractores": "Estable", "motivosDet": "Cat√°logo de streaming", "promotores": "Estable", "motivosPro": "Entregas r√°pidas", "eventos": "Invierno.", "competencia": "Amazon con Prime Day, bajo impacto local." },
            { "mes": "Ago 25", "detractores": "Estable", "motivosDet": "Soporte al cliente", "promotores": "Estable", "motivosPro": "Beneficios consistentes", "eventos": "Estabilidad.", "competencia": "Falabella anuncia fusi√≥n de log√≠stica." },
            { "mes": "Sep 25", "detractores": "Estable", "motivosDet": "Costo anual", "promotores": "Estable", "motivosPro": "Confianza en la marca", "eventos": "Fiestas Patrias.", "competencia": "Descuentos de la competencia." },
            { "mes": "Oct 25", "detractores": "Estable", "motivosDet": "Falta de novedades", "promotores": "Estable", "motivosPro": "Paquete de beneficios", "eventos": "Cyber Monday.", "competencia": "Toda la competencia con ofertas." },
            { "mes": "Nov 25", "detractores": "Estable", "motivosDet": "Comparaci√≥n con Falabella", "promotores": "Estable", "motivosPro": "Env√≠os y streaming", "eventos": "Preparaci√≥n Black Friday.", "competencia": "Competencia local fuerte." }
        ],
        "summary": "<ul><li><strong>Pico Positivo (Abr-25):</strong> El lanzamiento de Meli+ con un paquete claro de beneficios (env√≠o gratis, Disney+, Max) gener√≥ un salto sin precedentes en el sentimiento, pasando de una percepci√≥n tibia sobre Nivel 6 a un alto inter√©s por la nueva suscripci√≥n. Cita: <em>\"Al fin algo que compite de verdad con los beneficios de las grandes tiendas. El pack de streaming paga la suscripci√≥n sola.\"</em> (Comentario en foro Chw).</li><li><strong>Estabilizaci√≥n:</strong> Tras el boom inicial, el sentimiento se ha estabilizado en un nivel alto, con quejas menores centradas en el contenido de las plataformas de streaming y la comparaci√≥n con las agresivas campa√±as de fidelizaci√≥n de Falabella (CMR Puntos).</li></ul>"
    },
    "Argentina": {
        "sentimentIndex": [65, 66, 64, 63, 62, 64, 65, 68, 84, 80, 78, 76, 75, 73, 72],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
        "events": [
            { "month": "May 25", "text": "Lanzamiento Meli+" }
        ],
        "table": [
            { "mes": "Sep 24", "detractores": "Estable", "motivosDet": "Puntos vencen", "promotores": "Estable", "motivosPro": "Env√≠os gratis Nivel 6", "eventos": "Nivel 6 como programa de puntos.", "competencia": "Programas bancarios dominan." },
            { "mes": "Oct 24", "detractores": "Estable", "motivosDet": "Costo de env√≠o", "promotores": "Estable", "motivosPro": "Cuotas", "eventos": "Cyber Monday.", "competencia": "Ual√° y NaranjaX con promos." },
            { "mes": "Nov 24", "detractores": "Estable", "motivosDet": "Log√≠stica", "promotores": "Estable", "motivosPro": "Variedad", "eventos": "Contexto econ√≥mico.", "competencia": "Bancos con descuentos." },
            { "mes": "Dic 24", "detractores": "Estable", "motivosDet": "Demoras en entrega", "promotores": "Estable", "motivosPro": "Financiaci√≥n", "eventos": "Compras de fin de a√±o.", "competencia": "Foco en financiaci√≥n." },
            { "mes": "Ene 25", "detractores": "Estable", "motivosDet": "Pocos beneficios", "promotores": "Bajo", "motivosPro": "Usabilidad de la app", "eventos": "Verano.", "competencia": "Estabilidad." },
            { "mes": "Feb 25", "detractores": "Estable", "motivosDet": "Valor de los puntos", "promotores": "Bajo", "motivosPro": "Seguridad en la compra", "eventos": "Nivel 6 estancado.", "competencia": "Ual√°+ con beneficios." },
            { "mes": "Mar 25", "detractores": "Estable", "motivosDet": "Falta de claridad", "promotores": "Estable", "motivosPro": "Devoluciones f√°ciles", "eventos": "Rumores sobre Meli+.", "competencia": "Cablevisi√≥n Flow con nuevas promos." },
            { "mes": "Abr 25", "detractores": "Bajo", "motivosDet": "Beneficios de Nivel 6", "promotores": "Estable", "motivosPro": "Expectativa por Meli+", "eventos": "Anuncios previos al lanzamiento.", "competencia": "Competencia expectante." },
            { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Costo de suscripci√≥n", "promotores": "Muy alto", "motivosPro": "Streaming y env√≠os", "eventos": "Lanzamiento Meli+.", "competencia": "Hot Sale eclipsado por el lanzamiento." },
            { "mes": "Jun 25", "detractores": "Bajo", "motivosDet": "Publicidad en D+", "promotores": "Alto", "motivosPro": "Paquete de beneficios", "eventos": "Asentamiento de la oferta.", "competencia": "Bancos reaccionan con m√°s cuotas." },
            { "mes": "Jul 25", "detractores": "Estable", "motivosDet": "Cat√°logo de Max", "promotores": "Alto", "motivosPro": "Ahorro total", "eventos": "Contexto inflacionario.", "competencia": "Rappi Pro suma descuentos." },
            { "mes": "Ago 25", "detractores": "Estable", "motivosDet": "Soporte t√©cnico", "promotores": "Estable", "motivosPro": "Entrega en AMBA", "eventos": "Estabilidad.", "competencia": "Personal Flow con oferta agresiva." },
            { "mes": "Sep 25", "detractores": "Estable", "motivosDet": "Falta de novedades", "promotores": "Estable", "motivosPro": "Propuesta de valor", "eventos": "Mes estable.", "competencia": "Ual√° lanza nueva tarjeta." },
            { "mes": "Oct 25", "detractores": "Estable", "motivosDet": "Aumento de precios gral.", "promotores": "Estable", "motivosPro": "Mantiene valor", "eventos": "Cyber Monday.", "competencia": "Fuerte competencia en promos." },
            { "mes": "Nov 25", "detractores": "Estable", "motivosDet": "Comparaci√≥n con promos bancarias", "promotores": "Estable", "motivosPro": "Conveniencia", "eventos": "Pre-navidad.", "competencia": "NaranjaX con campa√±a fuerte." }
        ],
        "summary": "<ul><li><strong>Transformaci√≥n (May-25):</strong> El paso de Nivel 6 (un programa de puntos poco valorado) a Meli+ (una suscripci√≥n de beneficios tangibles) fue un √©xito rotundo, disparando el sentimiento positivo. El paquete de streaming (Disney+/Max) fue el principal impulsor. Cita: <em>\"De no darle bola a los puntos a pagar la suscripci√≥n sin dudar. Me ahorro la cuota de D+ y Max, y encima tengo env√≠os gratis. Negocio redondo.\"</em> (Usuario en Reddit).</li><li><strong>Contexto Econ√≥mico:</strong> En un entorno de alta inflaci√≥n, los comentarios de promotores se centran en el 'ahorro' que representa consolidar los gastos de streaming y env√≠os en una sola cuota mensual predecible.</li></ul>"
    },
    "Colombia": {
        "sentimentIndex": [68, 67, 66, 65, 64, 65, 66, 67, 63, 68, 70, 86, 83, 80, 78],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25", "Nov 25"],
        "events": [
            { "month": "May 25", "text": "Amazon Prime llega a CO" },
            { "month": "Ago 25", "text": "Lanzamiento Meli+" }
        ],
        "table": [
            { "mes": "Sep 24", "detractores": "Estable", "motivosDet": "Costo de env√≠o", "promotores": "Estable", "motivosPro": "Programa de puntos", "eventos": "Nivel 6 con percepci√≥n regular.", "competencia": "Rappi es el rival a vencer." },
            { "mes": "Oct 24", "detractores": "Estable", "motivosDet": "Tiempos de entrega", "promotores": "Estable", "motivosPro": "Variedad de productos", "eventos": "D√≠as de descuentos.", "competencia": "Alkosto con promociones." },
            { "mes": "Nov 24", "detractores": "Estable", "motivosDet": "Pocos beneficios claros", "promotores": "Bajo", "motivosPro": "Compra segura", "eventos": "Black Friday.", "competencia": "Rappi Prime con fuerte campa√±a." },
            { "mes": "Dic 24", "detractores": "Estable", "motivosDet": "Log√≠stica fuera de Bogot√°", "promotores": "Estable", "motivosPro": "Compras de Navidad", "eventos": "Temporada alta.", "competencia": "Amazon sin presencia fuerte." },
            { "mes": "Ene 25", "detractores": "Estable", "motivosDet": "Valor de los puntos", "promotores": "Bajo", "motivosPro": "Facilidad de pago", "eventos": "Estabilidad.", "competencia": "Competencia local sin cambios." },
            { "mes": "Feb 25", "detractores": "Estable", "motivosDet": "Pocos beneficios", "promotores": "Bajo", "motivosPro": "Plataforma confiable", "eventos": "Nivel 6 sin tracci√≥n.", "competencia": "Rappi Pro agrega beneficios." },
            { "mes": "Mar 25", "detractores": "Estable", "motivosDet": "Comparaci√≥n con Rappi", "promotores": "Bajo", "motivosPro": "Marketplace", "eventos": "Sentimiento plano.", "competencia": "Rappi domina la conversaci√≥n." },
            { "mes": "Abr 25", "detractores": "Estable", "motivosDet": "Env√≠os costosos", "promotores": "Bajo", "motivosPro": "Garant√≠a", "eventos": "Expectativa por movidas de Amazon.", "competencia": "Amazon anuncia llegada." },
            { "mes": "May 25", "detractores": "Alto", "motivosDet": "Nivel 6 no compite", "promotores": "Bajo", "motivosPro": "Variedad de productos", "eventos": "Llegada de Amazon Prime al pa√≠s.", "competencia": "Amazon Prime genera alta expectativa y conversaci√≥n." },
            { "mes": "Jun 25", "detractores": "Estable", "motivosDet": "Comparaci√≥n con Amazon", "promotores": "Bajo", "motivosPro": "Financiaci√≥n con Mercado Pago", "eventos": "Primer mes de Amazon Prime.", "competencia": "Amazon Prime con oferta agresiva de lanzamiento." },
            { "mes": "Jul 25", "detractores": "Estable", "motivosDet": "Presi√≥n competitiva", "promotores": "Estable", "motivosPro": "Ecosistema Meli", "eventos": "Rumores de Meli+.", "competencia": "Amazon Prime Day." },
            { "mes": "Ago 25", "detractores": "Bajo", "motivosDet": "Precio de suscripci√≥n", "promotores": "Muy alto", "motivosPro": "Respuesta a Amazon", "eventos": "Lanzamiento Meli+.", "competencia": "Meli+ opaca la conversaci√≥n sobre Rappi." },
            { "mes": "Sep 25", "detractores": "Bajo", "motivosDet": "D+ con anuncios", "promotores": "Alto", "motivosPro": "Streaming y env√≠os", "eventos": "Consolidaci√≥n de Meli+.", "competencia": "Amazon reacciona con descuentos." },
            { "mes": "Oct 25", "detractores": "Estable", "motivosDet": "Cat√°logo de streaming", "promotores": "Estable", "motivosPro": "Velocidad de entrega", "eventos": "Mes de Amor y Amistad.", "competencia": "Rappi Pro con beneficios en eventos." },
            { "mes": "Nov 25", "detractores": "Estable", "motivosDet": "Soporte al cliente", "promotores": "Estable", "motivosPro": "Paquete de beneficios", "eventos": "Preparaci√≥n Black Friday.", "competencia": "Fuerte competencia entre Meli+, Amazon y Rappi." }
        ],
        "summary": "<ul><li><strong>Punto de Inflexi√≥n (May-25 y Ago-25):</strong> La llegada de Amazon Prime en mayo expuso la debilidad de Nivel 6, causando una ca√≠da en el sentimiento. Sin embargo, el lanzamiento de Meli+ en agosto fue una respuesta contundente que revirti√≥ la tendencia y gener√≥ un pico de sentimiento positivo, posicionando a Meli como un competidor directo y robusto.</li><li><strong>Cita Clave (Ago-25):</strong> <em>\"Justo cuando pensaba casarme con Amazon Prime, sale Mercado Libre con Meli+ y me da Disney y Max. Bien jugado, me quedo ac√°.\"</em> (Usuario en YouTube).</li></ul>"
    }
};

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
    {
        "id": 1,
        "entity": "Amazon Prime",
        "country": "Brasil",
        "impact": "Alto",
        "title": "Amazon Confirms Annual Prime Membership Fee to Increase in Brazil and Mexico Starting January 2026",
        "url": "https://www.aboutamazon.com/news/company-news/amazon-prime-membership-fee-update-brazil-mexico-2026",
        "date": "28-10-2025",
        "category": "Cambio de Precio",
        "summary": "Amazon announced an increase in its annual Prime membership fees for Brazil (from R$119 to R$149) and Mexico (from MXN$899 to MXN$1099), effective for new members immediately and for existing members on their first renewal after January 15, 2026. The company cited increased operational costs and expanded benefits as reasons.",
        "analysis": "This is a High impact event as it directly affects user subscription costs and could lead to churn or new acquisitions for Meli+."
    },
    {
        "id": 2,
        "entity": "OpenAI (ChatGPT Premium)",
        "country": "Todos los Pa√≠ses",
        "impact": "Alto",
        "title": "OpenAI Announces General Availability of GPT-5 Turbo via API and in ChatGPT",
        "url": "https://openai.com/blog/gpt-5-turbo-api-and-chatgpt",
        "date": "02-11-2025",
        "category": "Flagship AI",
        "summary": "OpenAI has officially launched GPT-5 Turbo, its next-generation flagship model. The model is now available to all paying API customers and is the default model for ChatGPT Plus subscribers. Initial benchmarks show significant improvements in reasoning, code generation, and multilingual capabilities.",
        "analysis": "A major AI model release is a high-impact event for the tech industry, setting new benchmarks and potentially impacting services that integrate AI."
    },
    {
        "id": 3,
        "entity": "Rappi Pro",
        "country": "Colombia",
        "impact": "Medio",
        "title": "Rappi Expands 'Rappi Pro' Benefits with Exclusive Access to Live Sporting Events in Colombia",
        "url": "https://blog.rappi.com/colombia/rappi-pro-nuevos-beneficios-deportes",
        "date": "25-10-2025",
        "category": "Estrategia",
        "summary": "Rappi Colombia has added a new tier of benefits for its Rappi Pro members, offering exclusive streaming access to select local soccer league matches through a partnership with a regional broadcaster.",
        "analysis": "This is a strategic move to increase the value proposition of Rappi Pro, directly competing with entertainment bundles from other services."
    }
];
    const contentNewsData = [
    {
        "id": 4,
        "entity": "Netflix",
        "country": "Todos los Pa√≠ses",
        "impact": "Medio",
        "title": "Netflix Confirms Multi-Year Exclusive Deal for Global Streaming Rights to Formula E",
        "url": "https://about.netflix.com/en/news/netflix-secures-global-formula-e-rights",
        "date": "30-10-2025",
        "category": "Derechos/Deportes",
        "summary": "Netflix has secured the exclusive global streaming rights for the FIA Formula E World Championship for the 2026-2030 seasons. The deal excludes domestic markets where existing broadcast agreements are in place. This marks Netflix's most significant move into live sports broadcasting."
    },
    {
        "id": 5,
        "entity": "Disney+",
        "country": "M√©xico",
        "impact": "Medio",
        "title": "Disney+ to Integrate ESPN Hub with Live Sports Options for Latin American Subscribers",
        "url": "https://thewaltdisneycompany.com/disney-espn-hub-latam-integration/",
        "date": "27-10-2025",
        "category": "Producto",
        "summary": "The Walt Disney Company announced that it will integrate a dedicated ESPN hub within the Disney+ app in Latin America, starting in Q1 2026. The hub will feature live sports, highlights, and original content."
    },
    {
        "id": 6,
        "entity": "Max",
        "country": "Todos los Pa√≠ses",
        "impact": "Medio",
        "title": "Warner Bros. Discovery Reports Stronger-Than-Expected Subscriber Growth for Max in Q3 2025",
        "url": "https://ir.wbd.com/press-releases/news-details/2025/Warner-Bros.-Discovery-Reports-Third-Quarter-2025-Earnings/default.aspx",
        "date": "23-10-2025",
        "category": "Resultados Financieros",
        "summary": "WBD's Q3 2025 earnings report showed that the Max streaming service added 4.5 million global subscribers, beating analyst expectations, driven by original content and international rollout."
    },
    {
        "id": 7,
        "entity": "Paramount+",
        "country": "Todos los Pa√≠ses",
        "impact": "Medio",
        "title": "Paramount Global Appoints New Head of International Streaming",
        "url": "https://www.paramount.com/press/paramount-global-appoints-new-head-of-international-streaming",
        "date": "21-10-2025",
        "category": "Estrategia",
        "summary": "Paramount Global has named a new executive to lead its international streaming strategy for Paramount+ and Pluto TV, signaling a renewed focus on global expansion and market-specific content investment."
    }
];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','Colombia','M√©xico','Todos los Pa√≠ses'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ual√°','Cablevisi√≥n Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusi√≥n/Adquisici√≥n','Sanci√≥n Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','Colombia','M√©xico','Todos los Pa√≠ses'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusi√≥n/Adquisici√≥n','Sanci√≥n Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gr√°fico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: '√çndice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: '√çndice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ring-1 ring-inset ring-rose-200 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ring-1 ring-inset ring-emerald-200 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categor√≠a ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanci√≥n Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusi√≥n/Adquisici√≥n': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) ‚Äî sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const countries = item.country.split(',').map(c => c.trim());
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('Todos los Pa√≠ses') || countries.some(c => newsFilters.country.includes(c));
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('Todos los Pa√≠ses') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('Todos los Pa√≠ses') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Pa√≠ses' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '‚Äî'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) ‚Äî sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const countries = (item.country || '').split(',').map(c => c.trim());
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('Todos los Pa√≠ses') || countries.some(c => contentFilters.country.includes(c));
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('Todos los Pa√≠ses') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('Todos los Pa√≠ses') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '‚Äî'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      const sortedItems = allItems.filter(c => c !== 'Todos los Pa√≠ses').sort();
      const html = [
        `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}all" value="Todos los Pa√≠ses" class="mr-2"><label for="${idBase}all">Todos</label></div>`,
        ...sortedItems.map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${c.replace(/\s/g, '')}" value="${c}" class="mr-2"><label for="${idBase}${c.replace(/\s/g, '')}">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES, 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES, 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category-');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== L√≥gica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }
    function normalizeSelectAll(container, selectedValues) {
      const allBox = container.querySelector('input[value="Todos los Pa√≠ses"]');
      if (!allBox) return;
      const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b.value !== 'Todos los Pa√≠ses');
      if (allBox.checked) {
        rest.forEach(b => b.checked = false);
      }
    }
    function filterNews() {
      let sc = getSelected(newsFilterCountryContainer);
      let se = getSelected(newsFilterCompanyContainer);
      let sk = getSelected(newsFilterCategoryContainer);
      normalizeSelectAll(newsFilterCountryContainer, sc);
      normalizeSelectAll(newsFilterCompanyContainer, se);
      normalizeSelectAll(newsFilterCategoryContainer, sk);
      sc = getSelected(newsFilterCountryContainer);
      se = getSelected(newsFilterCompanyContainer);
      sk = getSelected(newsFilterCategoryContainer);
      newsFilters.country = sc.includes('Todos los Pa√≠ses') ? [] : sc;
      newsFilters.company = se.includes('Todos los Pa√≠ses') ? [] : se;
      newsFilters.category = sk.includes('Todos los Pa√≠ses') ? [] : sk;
      renderNewsCards();
    }
    function filterContentNews() {
      let sc = getSelected(contentFilterCountryContainer);
      let se = getSelected(contentFilterCompanyContainer);
      let sk = getSelected(contentFilterCategoryContainer);
      normalizeSelectAll(contentFilterCountryContainer, sc);
      normalizeSelectAll(contentFilterCompanyContainer, se);
      normalizeSelectAll(contentFilterCategoryContainer, sk);
      sc = getSelected(contentFilterCountryContainer);
      se = getSelected(contentFilterCompanyContainer);
      sk = getSelected(contentFilterCategoryContainer);
      contentFilters.country = sc.includes('Todos los Pa√≠ses') ? [] : sc;
      contentFilters.company = se.includes('Todos los Pa√≠ses') ? [] : se;
      contentFilters.category = sk.includes('Todos los Pa√≠ses') ? [] : sk;
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    updateSentimentContent('Brasil');
    updateNewsFilters(); renderNewsCards();
    updateContentNewsFilters(); renderContentNewsCards();
  </script>
</body>
</html>
