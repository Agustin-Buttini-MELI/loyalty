<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        "sentimentIndex": [75, 78, 77, 79, 76, 68, 70, 72, 75, 69, 71, 72, 73],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "Sep 24", "text": "Lanzamiento Meli+" },
          { "month": "Feb 25", "text": "Cambio % cashback" },
          { "month": "May 25", "text": "Opción 120% CDI" },
          { "month": "Jun 25", "text": "Cambio política envío gratis" }
        ],
        "table": [
          { "mes": "Jun 25", "detractores": "Alto", "motivosDet": "Envío gratis generalizado", "promotores": "Medio", "motivosPro": "Beneficios streaming", "eventos": "Envío gratis ≥ R$19,90", "competencia": "Amazon Prime Day anunciado para julio" },
          { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Confusión con beneficios", "promotores": "Alto", "motivosPro": "Rendimiento 120% CDI", "eventos": "Lanzamiento cofrinhos 120% CDI", "competencia": "Nubank intensifica marketing Ultravioleta" },
          { "mes": "Feb 25", "detractores": "Muy Alto", "motivosDet": "Reducción cashback", "promotores": "Bajo", "motivosPro": "Aún vale la pena por envíos", "eventos": "Ajuste % de cashback en compras", "competencia": "Shopee con cupones agresivos" },
          { "mes": "Sep 24", "detractores": "Medio", "motivosDet": "Bugs en la migración", "promotores": "Muy Alto", "motivosPro": "Disney+ y envíos gratis", "eventos": "Lanzamiento oficial de Meli+", "competencia": "Magalu anuncia programa de lealtad" }
        ],
        "summary": `<ul><li><strong>Principal detractor reciente:</strong> La percepción de devaluación del beneficio de envío gratis en junio, al generalizarse para compras bajas. <em>"Se agora todo mundo tem frete grátis acima de 19,90, qual a vantagem real do Meli+? Só pelo streaming?"</em> (Comentario en YouTube).</li><li><strong>Principal promotor:</strong> El combo de beneficios de entretenimiento (Disney+, Max) y, en mayo, la opción de rendimiento del 120% del CDI, que fue muy bien recibida por el público bancarizado. <em>"Coloquei meu dinheiro no cofrinho do Meli+, rende mais que a poupança e ainda tenho os benefícios. Genial."</em> (Foro en Reddit).</li></ul>`
      },
      "México": {
        "sentimentIndex": [78, 80, 79, 81, 78, 70, 72, 74, 78, 76, 75, 77, 78],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "Sep 24", "text": "Lanzamiento Meli+" },
          { "month": "Feb 25", "text": "Cambio % cashback" },
          { "month": "May 25", "text": "Hot Sale / Lanzamiento NU+" }
        ],
        "table": [
          { "mes": "May 25", "detractores": "Medio", "motivosDet": "Beneficios de cashback confusos", "promotores": "Muy Alto", "motivosPro": "Descuentos Hot Sale", "eventos": "Hot Sale MX", "competencia": "Lanzamiento de NU+ por Nubank" },
          { "mes": "Feb 25", "detractores": "Muy Alto", "motivosDet": "Cashback reducido", "promotores": "Bajo", "motivosPro": "Streaming y envíos", "eventos": "Cambio % cashback", "competencia": "Amazon con promos en Prime" },
          { "mes": "Sep 24", "detractores": "Bajo", "motivosDet": "Pocos diferenciadores iniciales", "promotores": "Muy Alto", "motivosPro": "Paquete de streaming incluido", "eventos": "Lanzamiento Meli+", "competencia": "Walmart Pass con envíos ilimitados" }
        ],
        "summary": `<ul><li><strong>Principal detractor reciente:</strong> La competencia directa de nuevos programas de lealtad como NU+ de Nubank en mayo generó comparaciones directas, especialmente en el ámbito del cashback y beneficios financieros. <em>"Entre Meli+ y NU+, estoy viendo cuál me da más cashback real, el de Meli cambió y ya no sé."</em> (Grupo de Facebook).</li><li><strong>Principal promotor:</strong> La sinergia con eventos de alto tráfico como el Hot Sale, donde los beneficios de Meli+ (envíos gratis, descuentos extra) se perciben con mayor valor. <em>"En el Hot Sale desquité toda la anualidad de Meli+ con los puros envíos."</em> (Tweet en X).</li></ul>`
      },
      "Chile": {
        "sentimentIndex": [70, 71, 70, 72, 73, 74, 75, 82, 80, 79, 78, 79, 80],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "Abr 25", "text": "Nuevos beneficios Meli+" }
        ],
        "table": [
          { "mes": "Abr 25", "detractores": "Bajo", "motivosDet": "Poca comunicación", "promotores": "Muy Alto", "motivosPro": "Descuentos en supermercado", "eventos": "Nuevos beneficios (descuentos en Meli Places)", "competencia": "Falabella con descuentos CMR" },
          { "mes": "Ene 25", "detractores": "Medio", "motivosDet": "Costo de suscripción", "promotores": "Medio", "motivosPro": "Envíos gratis a todo Chile", "eventos": "Periodo post-navideño", "competencia": "Ripley con ofertas de verano" }
        ],
        "summary": `<ul><li><strong>Principal detractor:</strong> La constante comparación con los programas de lealtad del retail tradicional (Falabella, Ripley), especialmente en lo referente a descuentos directos con tarjetas de crédito. <em>"Me sale más a cuenta usar la CMR en Falabella que pagar la suscripción de Meli+."</em> (Foro en Chw.net).</li><li><strong>Principal promotor:</strong> La adición de beneficios tangibles y novedosos en abril, como descuentos en supermercados asociados a Meli Places, generó un pico de sentimiento positivo muy marcado. <em>"¡Buenísimo el descuento en el super con Meli+! No me lo esperaba y se agradece."</em> (Comentario en Instagram).</li></ul>`
      },
      "Argentina": {
        "sentimentIndex": [65, 66, 67, 65, 68, 69, 70, 71, 80, 78, 77, 76, 75],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "May 25", "text": "Lanzamiento Meli+" }
        ],
        "table": [
          { "mes": "May 25", "detractores": "Medio", "motivosDet": "Pocos beneficios nuevos vs Nivel 6", "promotores": "Muy Alto", "motivosPro": "Disney+/Max incluidos", "eventos": "Migración de Nivel 6 a Meli+", "competencia": "Ualá+ con programa de puntos" },
          { "mes": "Mar 25", "detractores": "Medio", "motivosDet": "Envíos demorados", "promotores": "Medio", "motivosPro": "Cuotas sin interés", "eventos": "Contexto inflacionario", "competencia": "Naranja X con promociones" }
        ],
        "summary": `<ul><li><strong>Principal detractor:</strong> Una parte de los usuarios que ya eran Nivel 6 no percibió un salto cualitativo tan grande con el cambio a Meli+, más allá del branding. <em>"Soy Nivel 6 hace años, ahora se llama Meli+ pero los beneficios son casi los mismos, puro marketing."</em> (Tweet en X).</li><li><strong>Principal promotor:</strong> La consolidación del paquete de streaming (Disney+ y Max) como parte central de la oferta fue el principal impulsor de la migración y la captación de nuevos suscriptores, valorado en un contexto económico complejo. <em>"Pagar por Meli+ me sale más barato que pagar los streamings por separado, y encima tengo envíos. Negocio redondo."</em> (Comentario en YouTube).</li></ul>`
      },
      "Colombia": {
        "sentimentIndex": [68, 67, 69, 70, 68, 67, 66, 64, 65, 68, 70, 81, 80],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "May 25", "text": "Llegada Amazon Prime" },
          { "month": "Ago 25", "text": "Lanzamiento Meli+" }
        ],
        "table": [
          { "mes": "Ago 25", "detractores": "Bajo", "motivosDet": "Confusión en la migración", "promotores": "Muy Alto", "motivosPro": "Oferta de streaming superior a Prime", "eventos": "Lanzamiento de Meli+", "competencia": "Amazon Prime en fase de captación" },
          { "mes": "May 25", "detractores": "Alto", "motivosDet": "Competencia directa en envíos", "promotores": "Bajo", "motivosPro": "Beneficios de Mercado Pago", "eventos": "Nivel 6 (pre-Meli+)", "competencia": "Lanzamiento de Amazon Prime en el país" }
        ],
        "summary": `<ul><li><strong>Principal detractor (contextual):</strong> La llegada de Amazon Prime en mayo generó una caída preventiva en el sentimiento hacia la oferta de Nivel 6, con usuarios comparando las propuestas de valor incluso antes del lanzamiento de Meli+. <em>"Llegó Amazon Prime, ahora sí Mercado Libre tiene que ponerse las pilas con el Nivel 6 o no va a competir."</em> (Foro en Laneros).</li><li><strong>Principal promotor:</strong> El lanzamiento de Meli+ en agosto fue una respuesta contundente y bien recibida, capitalizando su paquete de streaming (Disney+/Max) como un diferenciador clave frente a la oferta inicial de Amazon Prime Video. <em>"Meli+ le da mil vueltas a Prime. Solo con Disney+ y Max ya pagué la suscripción."</em> (Comentario en SIC).</li></ul>`
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      { "id": 1, "entity": "Shein", "country": "Global", "impact": "Medio", "title": "Shein to open 15 new logistic hubs in Europe and Latin America by mid-2026", "url": "https://www.sheingroup.com/press/shein-announces-logistics-expansion-emea-latam-2026", "date": "06-09-2025", "category": "Estrategia", "summary": "Shein announced a major logistics expansion plan to improve delivery times and efficiency, opening 15 new hubs across key markets in Europe and Latin America.", "publisher": "sheingroup.com" },
      { "id": 2, "entity": "Nubank", "country": "México", "impact": "Alto", "title": "Nubank México obtiene licencia bancaria y anuncia expansión de productos de ahorro", "url": "https://blog.nu.com.mx/nu-mexico-recibe-licencia-bancaria/", "date": "04-09-2025", "category": "Estrategia", "summary": "Tras recibir la aprobación final de la CNBV, Nubank operará como banco múltiple en México, permitiéndole ampliar su portafolio de productos de captación y ahorro.", "publisher": "blog.nu.com.mx" },
      { "id": 3, "entity": "Amazon Prime", "country": "Global", "impact": "Alto", "title": "Prime Video Locks in Exclusive Thursday Night Football International Rights Through 2033", "url": "https://www.aboutamazon.com/news/entertainment/prime-video-renews-tnf-international-rights-2033", "date": "02-09-2025", "category": "Derechos/Deportes", "summary": "Amazon renewed its multi-year deal to be the exclusive home of Thursday Night Football in several key international markets, solidifying its sports content strategy.", "publisher": "aboutamazon.com" },
      { "id": 4, "entity": "Rappi Pro", "country": "Brasil", "impact": "Medio", "title": "Rappi strengthens Rappi Pro with new exclusive restaurant partnerships in Bogota and São Paulo", "url": "https://press.rappi.com/news/rappi-pro-new-restaurant-alliances-bog-sp", "date": "29-08-2025", "category": "Producto", "summary": "Rappi Pro members in São Paulo and Bogota will get access to special deals and priority reservations at a new slate of high-end restaurants.", "publisher": "press.rappi.com" },
      { "id": 5, "entity": "OpenAI", "country": "Global", "impact": "Alto", "title": "OpenAI Begins Phased Rollout of GPT-5 API for Enterprise Partners", "url": "https://openai.com/blog/gpt-5-api-enterprise-rollout", "date": "28-08-2025", "category": "Flagship AI", "summary": "OpenAI announced that its next-generation model, GPT-5, is now available in a limited capacity via API for a select group of enterprise customers and developers.", "publisher": "openai.com" },
      { "id": 6, "entity": "Temu", "country": "Global", "impact": "Medio", "title": "Temu fined by EU regulators over Digital Services Act transparency breaches", "url": "https://www.reuters.com/technology/temu-fined-by-eu-over-digital-services-act-breaches-2025-08-27/", "date": "27-08-2025", "category": "Sanción Legal", "summary": "The European Commission has imposed a fine on Temu for failing to comply with transparency requirements regarding its seller verification processes under the DSA.", "publisher": "reuters.com" }
    ];
    const contentNewsData = [
      { "id": 1, "entity": "Apple TV+", "country": "Global", "impact": "Medio", "title": "Apple TV+ Announces Multi-Year Production Deal with Acclaimed Director Alfonso Cuarón", "url": "https://www.apple.com/tvpr/news/2025/09/apple-tv-inks-overall-deal-with-academy-award-winner-alfonso-cuaron/", "date": "08-09-2025", "category": "Estrategia", "summary": "Apple has signed an exclusive, multi-year overall deal with director Alfonso Cuarón to develop and produce television series exclusively for Apple TV+.", "publisher": "apple.com" },
      { "id": 2, "entity": "Disney+", "country": "Global", "impact": "Alto", "title": "Disney Sets New Global Prices for Integrated Disney+ and Hulu Experience", "url": "https://thewaltdisneycompany.com/disney-hulu-new-global-pricing-2025/", "date": "05-09-2025", "category": "Cambio de Precio", "summary": "The Walt Disney Company revealed a new pricing structure for its combined Disney+ and Hulu streaming service, which will roll out globally starting in Q4 2025.", "publisher": "thewaltdisneycompany.com" },
      { "id": 3, "entity": "Netflix", "country": "Global", "impact": "Medio", "title": "Netflix Acquires 'Moonstone Interactive' Gaming Studio to Expand Original IP", "url": "https://about.netflix.com/en/news/netflix-acquires-moonstone-interactive", "date": "03-09-2025", "category": "Fusión/Adquisición", "summary": "Netflix continues its push into gaming by acquiring Moonstone Interactive, a European studio known for its narrative-driven games, to create new interactive experiences.", "publisher": "about.netflix.com" },
      { "id": 4, "entity": "Paramount+", "country": "Global", "impact": "Alto", "title": "Paramount Global and Skydance Media Officially Complete Merger", "url": "https://www.paramount.com/news/press/paramount-skydance-merger-completion", "date": "29-08-2025", "category": "Fusión/Adquisición", "summary": "The merger between Paramount Global and Skydance Media has been finalized, with regulatory approvals complete. David Ellison will lead the newly combined company.", "publisher": "paramount.com" },
      { "id": 5, "entity": "Max", "country": "México", "impact": "Medio", "title": "WBD confirms Max will be exclusive streaming home for all Champions League matches in Mexico and Brazil starting 2026", "url": "https://wbd.com/press/max-secures-champions-league-latam-rights", "date": "27-08-2025", "category": "Derechos/Deportes", "summary": "Warner Bros. Discovery has secured the exclusive streaming rights for the UEFA Champions League in Mexico and Brazil for its Max platform for the 2026-2029 cycle.", "publisher": "wbd.com" },
      { "id": 6, "entity": "Spotify", "country": "Global", "impact": "Medio", "title": "Spotify's upcoming 'Supremium' HiFi tier to include AI playlist creation tools, sources say", "url": "https://www.bloomberg.com/news/articles/2025-08-26/spotify-supremium-hifi-tier-to-include-ai-tools", "date": "26-08-2025", "category": "Producto", "summary": "A new report suggests that Spotify's long-awaited 'Supremium' tier will not only feature lossless audio but also new AI-powered tools for playlist generation and music discovery.", "publisher": "bloomberg.com" }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI','Disney+',
      'Nubank','Smiles','Globoplay','Ualá','Cablevisión Flow','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const itemCountry = item.country === 'Global' ? 'Todos los Países' : item.country;
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('Todos los Países') || newsFilters.country.includes(itemCountry);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Global' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const itemCountry = item.country === 'Global' ? 'Todos los Países' : item.country;
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('Todos los Países') || contentFilters.country.includes(itemCountry);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      let itemsHtml = '';
      allItems.sort().forEach(item => {
        itemsHtml += `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${item.replace(/\s+/g, '-')}" value="${item}" class="mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="${idBase}${item.replace(/\s+/g, '-')}">${item}</label></div>`;
      });
      container.innerHTML = itemsHtml;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, [...new Set(newsData.map(i => i.country === 'Global' ? 'Todos los Países' : i.country))], 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, [...new Set(newsData.map(i => i.entity))], 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, [...new Set(newsData.map(i => i.category))], 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, [...new Set(contentNewsData.map(i => i.country === 'Global' ? 'Todos los Países' : i.country).filter(c => c))], 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, [...new Set(contentNewsData.map(i => i.entity))], 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, [...new Set(contentNewsData.map(i => i.category))], 'content-category-');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }

    function filterNews() {
      newsFilters.country = getSelected(newsFilterCountryContainer);
      newsFilters.company = getSelected(newsFilterCompanyContainer);
      newsFilters.category = getSelected(newsFilterCategoryContainer);
      renderNewsCards();
    }
    function filterContentNews() {
      contentFilters.country = getSelected(contentFilterCountryContainer);
      contentFilters.company = getSelected(contentFilterCompanyContainer);
      contentFilters.category = getSelected(contentFilterCategoryContainer);
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });
    
    document.addEventListener('DOMContentLoaded', () => {
      updateSentimentContent('Brasil');
      updateNewsFilters(); renderNewsCards();
      updateContentNewsFilters(); renderContentNewsCards();
    });
  </script>
</body>
</html>