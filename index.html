<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
        "Brasil": {
            "sentimentIndex": [85, 84, 82, 83, 82, 78, 80, 81, 85, 70, 68, 72],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
            "events": [
                { "month": "Sep 24", "text": "Lanzamiento Meli+" },
                { "month": "Feb 25", "text": "Cambio % cashback" },
                { "month": "May 25", "text": "Meli+ 120% CDI" },
                { "month": "Jun 25", "text": "Envío gratis generalizado" }
            ],
            "table": [
                { "mes": "Jun 25", "detractores": "Alto", "motivosDet": "Dilución de valor", "promotores": "Bajo", "motivosPro": "Ahorro general", "eventos": "Envío gratis general ≥ R$19,90", "competencia": "Presión de Shopee/Temu" },
                { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Complejidad del beneficio", "promotores": "Muy Alto", "motivosPro": "Rendimiento 120% CDI", "eventos": "Lanzamiento de 'cofrinho' 120% CDI", "competencia": "Nubank y PicPay ofrecen rendimientos" },
                { "mes": "Feb 25", "detractores": "Medio", "motivosDet": "Reducción cashback", "promotores": "Medio", "motivosPro": "Paquete de beneficios", "eventos": "Ajuste en el % de cashback con tarjeta Meli", "competencia": "Amazon mantiene su propuesta" },
                { "mes": "Sep 24", "detractores": "Bajo", "motivosDet": "Pocos productos FULL", "promotores": "Muy Alto", "motivosPro": "Streaming y envíos", "eventos": "Lanzamiento de Meli+", "competencia": "Competencia directa con Amazon Prime" }
            ],
            "summary": "<ul><li><b>Punto Crítico (Jun '25):</b> La introducción del envío gratuito para compras bajas (≥ R$19,90) diluyó la percepción de exclusividad de Meli+, generando un volumen significativo de quejas. Cita clave (Reclame Aqui): <i>'Estou pagando o Meli+ pra que agora? Se quase tudo tem frete grátis, o principal benefício sumiu.'</i></li><li><b>Pico de Aprecio (May '25):</b> El beneficio de rendimiento del 120% del CDI en los 'cofrinhos' fue muy bien recibido por usuarios con perfil de ahorro, posicionando a Meli+ como un producto financiero además de un programa de lealtad. Cita clave (YouTube): <i>'Finalmente meu dinheiro na conta Mercado Pago rende mais que a poupança, e ainda tenho Disney+ de graça. Genial!'</i></li></ul>"
        },
        "México": {
            "sentimentIndex": [88, 87, 86, 88, 87, 80, 82, 83, 85, 84, 83, 84],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
            "events": [
                { "month": "Sep 24", "text": "Lanzamiento Meli+" },
                { "month": "Feb 25", "text": "Cambio % cashback" },
                { "month": "May 25", "text": "Hot Sale / Lanza NU+" }
            ],
            "table": [
                { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Confusión en ofertas", "promotores": "Alto", "motivosPro": "Descuentos Hot Sale", "eventos": "Hot Sale con ofertas exclusivas Meli+", "competencia": "Lanzamiento de NU+ por Nubank" },
                { "mes": "Feb 25", "detractores": "Medio", "motivosDet": "Reducción cashback", "promotores": "Medio", "motivosPro": "Beneficios streaming", "eventos": "Ajuste en % de cashback", "competencia": "Amazon Prime agresivo en precios" },
                { "mes": "Sep 24", "detractores": "Bajo", "motivosDet": "Costos de suscripción", "promotores": "Muy Alto", "motivosPro": "Paquete Max/Deezer", "eventos": "Lanzamiento de Meli+", "competencia": "Amazon Prime es el rival principal" }
            ],
            "summary": "<ul><li><b>Impulso de Valor (Sep '24):</b> El paquete de lanzamiento incluyendo Max y Deezer fue el principal impulsor de la alta percepción inicial, diferenciándose claramente de la oferta de Amazon Prime. Cita clave (X): <i>'Pagar por Meli+ y que te den Max y Deezer es un negociazo, adiós a mis otras suscripciones.'</i></li><li><b>Reacción Negativa (Feb '25):</b> La reducción del porcentaje de cashback generó quejas sobre la falta de comunicación y la devaluación de uno de los beneficios tangibles. Cita clave (Apestan.com): <i>'De un día para otro me bajaron el cashback de la tarjeta. No avisan y te cambian las reglas.'</i></li></ul>"
        },
        "Chile": {
            "sentimentIndex": [65, 66, 68, 70, 68, 67, 68, 80, 82, 81, 79, 78],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
            "events": [
                { "month": "Abr 25", "text": "Nuevos beneficios Meli+" }
            ],
            "table": [
                { "mes": "Abr 25", "detractores": "Bajo", "motivosDet": "Aún no es Meli+", "promotores": "Muy Alto", "motivosPro": "Universal+ y descuentos", "eventos": "Nuevos beneficios de streaming y descuentos en Nivel 6", "competencia": "Falabella/Ripley con descuentos CMR" },
                { "mes": "Ene 25", "detractores": "Medio", "motivosDet": "Pocos beneficios", "promotores": "Bajo", "motivosPro": "Envíos gratis ocasionales", "eventos": "Período sin cambios en Nivel 6", "competencia": "Agresividad de Falabella y Ripley" }
            ],
            "summary": "<ul><li><b>Punto de Inflexión (Abr '25):</b> La adición de Universal+ y otros descuentos revitalizó la percepción del Nivel 6, que se percibía estancado. Fue visto como un preludio positivo a la llegada de Meli+. Cita clave (Reddit): <i>'Por fin metieron más cosas al Nivel 6, ahora con Universal+ se parece más a lo que tienen en México. Ya era hora.'</i></li><li><b>Crítica Recurrente (pre-Abril '25):</b> La principal queja se centraba en la falta de beneficios atractivos en comparación con los programas de lealtad de Falabella (CMR Puntos) y Ripley. Cita clave (SERNAC): <i>'Pago por el Nivel 6 pero los beneficios no se comparan a los descuentos que obtengo con mi tarjeta de multitienda.'</i></li></ul>"
        },
        "Argentina": {
            "sentimentIndex": [60, 58, 62, 65, 55, 60, 63, 65, 75, 78, 77, 76],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
            "events": [
                { "month": "May 25", "text": "Lanzamiento Meli+ AR" }
            ],
            "table": [
                { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Aumento de precio", "promotores": "Muy Alto", "motivosPro": "Streaming (D+/S+)", "eventos": "Lanzamiento de Meli+ reemplazando Nivel 6", "competencia": "Flow y DirecTV GO como competidores de contenido" },
                { "mes": "Ene 25", "detractores": "Alto", "motivosDet": "Costo vs. Beneficio", "promotores": "Bajo", "motivosPro": "Cuotas sin interés", "eventos": "Contexto inflacionario impacta costo de Nivel 6", "competencia": "Ualá y otros bancos digitales con beneficios" }
            ],
            "summary": "<ul><li><b>Éxito del Lanzamiento (May '25):</b> La llegada de Meli+ con el paquete de Disney+ y Star+ fue un éxito rotundo, ya que el valor percibido del streaming superó con creces el costo de la suscripción en el contexto local. Cita clave (tuquejasuma.com): <i>'Con lo que sale contratar Disney y Star+ por separado, Meli+ se paga solo y encima me dan envíos gratis. Excelente.'</i></li><li><b>Sentimiento Previo (Nivel 6):</b> Antes de Meli+, el sentimiento era bajo y volátil. El principal motivo de queja era el aumento constante del costo para mantener el nivel, sin una mejora proporcional en los beneficios. Cita clave (Facebook): <i>'Todos los meses me sube el precio para seguir siendo Nivel 6, y para qué? Para un par de descuentos que ni uso.'</i></li></ul>"
        },
        "Colombia": {
            "sentimentIndex": [65, 68, 66, 67, 62, 60, 58, 55, 58, 60, 62, 80],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
            "events": [
                { "month": "May 25", "text": "Amazon Prime llega a CO" },
                { "month": "Ago 25", "text": "Lanzamiento Meli+ CO" }
            ],
            "table": [
                { "mes": "Ago 25", "detractores": "Bajo", "motivosDet": "Llegada tardía", "promotores": "Muy Alto", "motivosPro": "Paquete Max/Deezer", "eventos": "Lanzamiento de Meli+ reemplazando Nivel 6", "competencia": "Respuesta directa a Amazon Prime y Rappi Pro" },
                { "mes": "May 25", "detractores": "Alto", "motivosDet": "Nivel 6 obsoleto", "promotores": "Bajo", "motivosPro": "Envíos gratis", "eventos": "Llegada de Amazon Prime al país", "competencia": "Fuerte competencia de Amazon Prime y Rappi Pro" }
            ],
            "summary": "<ul><li><b>Lanzamiento Transformador (Ago '25):</b> La llegada de Meli+ con Max y Deezer fue percibida como una respuesta contundente y necesaria a la creciente competencia, especialmente tras la llegada de Amazon Prime. Cita clave (TikTok): <i>'Se demoraron, pero Meli+ llegó con todo a Colombia. El combo con Max y Deezer le da mil vueltas a lo que teníamos antes.'</i></li><li><b>Impacto de la Competencia (May '25):</b> La llegada de Amazon Prime expuso las debilidades del Nivel 6, provocando una caída en el sentimiento y un aumento de las comparaciones negativas. Cita clave (SIC): <i>'Amazon Prime ofrece envíos rápidos y streaming por un precio fijo. Nivel 6 es confuso y sus beneficios palidecen en comparación.'</i></li></ul>"
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
        { "id": 1, "entity": "OpenAI (ChatGPT Premium)", "country": "Todos los Países", "impact": "Alto", "title": "OpenAI Announces General Availability of GPT-5 Turbo API for Enterprise Customers", "url": "https://openai.com/blog/gpt-5-turbo-api-ga", "date": "20-08-2025", "category": "Flagship AI", "summary": "OpenAI has officially launched GPT-5 Turbo, its next-generation flagship model, via API for all enterprise-tier customers, boasting significant improvements in reasoning, code generation, and multi-modal capabilities.", "publisher": "openai.com", "url_raw": "https://openai.com/blog/gpt-5-turbo-api-ga", "url_canonical": "https://openai.com/blog/gpt-5-turbo-api-ga", "http_status": "200", "archived_url": "", "language": "en", "out_of_window": false },
        { "id": 2, "entity": "Amazon Prime", "country": "Brasil", "impact": "Medio", "title": "Amazon Brasil Expands Same-Day Delivery to Three New State Capitals", "url": "https://www.aboutamazon.com.br/noticias/operacoes/amazon-expande-entrega-no-mesmo-dia-para-salvador-fortaleza-e-recife", "date": "19-08-2025", "category": "Estrategia", "summary": "Amazon announced the expansion of its same-day delivery service for Prime members to Salvador, Fortaleza, and Recife, intensifying logistics competition in the Northeast region.", "publisher": "aboutamazon.com.br", "url_raw": "https://www.aboutamazon.com.br/noticias/operacoes/amazon-expande-entrega-no-mesmo-dia-para-salvador-fortaleza-e-recife", "url_canonical": "https://www.aboutamazon.com.br/noticias/operacoes/amazon-expande-entrega-no-mesmo-dia-para-salvador-fortaleza-e-recife", "http_status": "200", "archived_url": "", "language": "pt", "out_of_window": false },
        { "id": 3, "entity": "Paramount+", "country": "Todos los Países", "impact": "Alto", "title": "Skydance and Paramount Global Finalize Merger Agreement After Shareholder Approval", "url": "https://www.reuters.com/markets/deals/skydance-paramount-finalize-merger-2025-08-15/", "date": "15-08-2025", "category": "Fusión/Adquisición", "summary": "The long-awaited merger between Skydance Media and Paramount Global has been finalized. The deal closure marks a new strategic direction for the media giant, with expected integration of assets and leadership changes.", "publisher": "reuters.com", "url_raw": "https://www.reuters.com/markets/deals/skydance-paramount-finalize-merger-2025-08-15/", "url_canonical": "https://www.reuters.com/markets/deals/skydance-paramount-finalize-merger-2025-08-15/", "http_status": "200", "archived_url": "", "language": "en", "out_of_window": false },
        { "id": 4, "entity": "Rappi Pro", "country": "México", "impact": "Medio", "title": "Rappi México integra nuevo seguro de viaje en su suscripción Pro en alianza con Chubb", "url": "https://expansion.mx/empresas/2025/08/14/rappi-pro-suma-seguro-viaje-chubb", "date": "14-08-2025", "category": "Producto", "summary": "Rappi Pro members in Mexico now have access to a new travel insurance benefit provided by Chubb, adding more value to the subscription and competing with benefits from financial super-apps.", "publisher": "expansion.mx", "url_raw": "https://expansion.mx/empresas/2025/08/14/rappi-pro-suma-seguro-viaje-chubb", "url_canonical": "https://expansion.mx/empresas/2025/08/14/rappi-pro-suma-seguro-viaje-chubb", "http_status": "200", "archived_url": "", "language": "es", "out_of_window": false },
        { "id": 5, "entity": "Shein", "country": "Brasil", "impact": "Medio", "title": "Shein Inaugura Centro de Distribuição em Minas Gerais para Acelerar Entregas no Sudeste", "url": "https://braziljournal.com/shein-inaugura-cd-em-minas-gerais-para-acelerar-entregas", "date": "12-08-2025", "category": "Estrategia", "summary": "Shein has opened a new distribution center in Minas Gerais, its third in Brazil, aiming to reduce delivery times for the populous Southeast region and consolidate its local logistics network.", "publisher": "braziljournal.com", "url_raw": "https://braziljournal.com/shein-inaugura-cd-em-minas-gerais-para-acelerar-entregas", "url_canonical": "https://braziljournal.com/shein-inaugura-cd-em-minas-gerais-para-acelerar-entregas", "http_status": "200", "archived_url": "", "language": "pt", "out_of_window": false }
    ];
    const contentNewsData = [
        { "id": 101, "entity": "Netflix", "country": "Todos los Países", "impact": "Alto", "title": "Netflix Acquires Exclusive Global Streaming Rights for Upcoming Formula 1 Docu-Series 'Rivalry'", "url": "https://www.hollywoodreporter.com/tv/tv-news/netflix-formula-1-rivalry-docuseries-exclusive-rights-1235899101/", "date": "21-08-2025", "category": "Derechos/Deportes", "summary": "Netflix has secured exclusive global rights for 'Rivalry', a new high-budget documentary series on F1, signaling a deeper push into premium sports content beyond 'Drive to Survive'.", "publisher": "hollywoodreporter.com", "url_raw": "https://www.hollywoodreporter.com/tv/tv-news/netflix-formula-1-rivalry-docuseries-exclusive-rights-1235899101/", "url_canonical": "https://www.hollywoodreporter.com/tv/tv-news/netflix-formula-1-rivalry-docuseries-exclusive-rights-1235899101/", "http_status": "200", "archived_url": "", "language": "en", "out_of_window": false },
        { "id": 102, "entity": "Disney+", "country": "Todos los Países", "impact": "Medio", "title": "Disney+ Confirms 'The Mandalorian & Grogu' Movie Will Skip Theaters for Exclusive Streaming Premiere in May 2026", "url": "https://variety.com/2025/film/news/mandalorian-grogu-movie-disney-plus-exclusive-premiere-1236112233/", "date": "20-08-2025", "category": "Estrategia", "summary": "In a strategic shift, Disney announced the 'The Mandalorian & Grogu' movie will debut exclusively on Disney+, bypassing a theatrical window to drive subscriber growth.", "publisher": "variety.com", "url_raw": "https://variety.com/2025/film/news/mandalorian-grogu-movie-disney-plus-exclusive-premiere-1236112233/", "url_canonical": "https://variety.com/2025/film/news/mandalorian-grogu-movie-disney-plus-exclusive-premiere-1236112233/", "http_status": "200", "archived_url": "", "language": "en", "out_of_window": false },
        { "id": 103, "entity": "Max", "country": "Todos los Países", "impact": "Medio", "title": "Warner Bros. Discovery to Bundle Max and Discovery+ at a Discounted Price in Latin America Starting Q4 2025", "url": "https://www.bloomberg.com/news/articles/2025-08-18/wbd-to-bundle-max-discovery-plus-in-latin-america", "date": "18-08-2025", "category": "Estrategia", "summary": "WBD plans to introduce a new bundled subscription in Latin America that combines Max and Discovery+ services, aiming to increase its user base and ARPU in the region.", "publisher": "bloomberg.com", "url_raw": "https://www.bloomberg.com/news/articles/2025-08-18/wbd-to-bundle-max-discovery-plus-in-latin-america", "url_canonical": "https://www.bloomberg.com/news/articles/2025-08-18/wbd-to-bundle-max-discovery-plus-in-latin-america", "http_status": "200", "archived_url": "", "language": "en", "out_of_window": false },
        { "id": 104, "entity": "Spotify", "country": "Todos los Países", "impact": "Medio", "title": "Spotify Rolls Out AI-Powered 'Podcast Summaries' Feature to All Premium Users Globally", "url": "https://www.theverge.com/2025/8/13/24857766/spotify-ai-podcast-summaries-premium", "date": "13-08-2025", "category": "Producto", "summary": "Spotify has launched 'Podcast Summaries', a new feature using generative AI to create concise summaries and key takeaways for podcast episodes, now available for all Premium subscribers.", "publisher": "theverge.com", "url_raw": "https://www.theverge.com/2025/8/13/24857766/spotify-ai-podcast-summaries-premium", "url_canonical": "https://www.theverge.com/2025/8/13/24857766/spotify-ai-podcast-summaries-premium", "http_status": "200", "archived_url": "", "language": "en", "out_of_window": false },
        { "id": 105, "entity": "Apple TV+", "country": "Todos los Países", "impact": "Medio", "title": "Apple TV+ Greenlights 'Foundation' for a Fourth and Final Season", "url": "https://deadline.com/2025/08/foundation-renewed-fourth-final-season-apple-tv-plus-1236055444/", "date": "11-08-2025", "category": "Estrategia", "summary": "Apple has renewed its flagship sci-fi series 'Foundation' for a fourth and final season, providing a clear content roadmap for one of its key original properties and assuring subscribers of a conclusion.", "publisher": "deadline.com", "url_raw": "https://deadline.com/2025/08/foundation-renewed-fourth-final-season-apple-tv-plus-1236055444/", "url_canonical": "https://deadline.com/2025/08/foundation-renewed-fourth-final-season-apple-tv-plus-1236055444/", "http_status": "200", "archived_url": "", "language": "en", "out_of_window": false }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach','Paramount+'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('Todos los Países') || newsFilters.country.includes(item.country);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country !== 'Todos los Países' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('Todos los Países') || contentFilters.country.includes(item.country);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group, type) {
      const allId = `${type}-${group}-all`;
      let allHtml = `<div class="filter-checkbox-item"><input type="checkbox" id="${allId}" value="Todos los Países" class="mr-2"><label for="${allId}">Todos</label></div>`;
      if (group === 'company' || group === 'category') {
          allHtml = `<div class="filter-checkbox-item"><input type="checkbox" id="${allId}" value="all" class="mr-2"><label for="${allId}">Todos</label></div>`;
      }
      
      const itemsHtml = allItems.sort().map(item => {
        const itemId = `${type}-${group}-${item.replace(/[^a-zA-Z0-9]/g, '')}`;
        return `<div class="filter-checkbox-item"><input type="checkbox" id="${itemId}" value="${item}" class="mr-2"><label for="${itemId}">${item}</label></div>`;
      }).join('');
      
      container.innerHTML = allHtml + itemsHtml;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, [...new Set(newsData.map(n => n.country))], 'country', 'news');
      populateCheckboxes(newsFilterCompanyContainer, [...new Set(newsData.map(n => n.entity))], 'company', 'news');
      populateCheckboxes(newsFilterCategoryContainer, [...new Set(newsData.map(n => n.category))], 'category', 'news');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
        populateCheckboxes(contentFilterCountryContainer, [...new Set(contentNewsData.map(n => n.country).filter(c => c !== "Todos los Países"))], 'country', 'content');
        populateCheckboxes(contentFilterCompanyContainer, [...new Set(contentNewsData.map(n => n.entity))], 'company', 'content');
        populateCheckboxes(contentFilterCategoryContainer, [...new Set(contentNewsData.map(n => n.category))], 'category', 'content');
        contentFilterCountryContainer.addEventListener('change', filterContentNews);
        contentFilterCompanyContainer.addEventListener('change', filterContentNews);
        contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }
    
    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }

    function normalizeSelectAll(container, selectedValues) {
        const allBox = container.querySelector('input[value="all"], input[value="Todos los Países"]');
        const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b !== allBox);
        if (!allBox) return;

        if (allBox.checked) {
            rest.forEach(b => b.checked = false);
        } else if (rest.every(b => b.checked)) {
            allBox.checked = true;
            rest.forEach(b => b.checked = false);
        } else if (rest.some(b => b.checked)) {
            allBox.checked = false;
        }
    }

    function filterNews(event) {
        normalizeSelectAll(event.currentTarget, getSelected(event.currentTarget));
        newsFilters.country = getSelected(newsFilterCountryContainer);
        newsFilters.company = getSelected(newsFilterCompanyContainer);
        newsFilters.category = getSelected(newsFilterCategoryContainer);
        renderNewsCards();
    }

    function filterContentNews(event) {
        normalizeSelectAll(event.currentTarget, getSelected(event.currentTarget));
        contentFilters.country = getSelected(contentFilterCountryContainer);
        contentFilters.company = getSelected(contentFilterCompanyContainer);
        contentFilters.category = getSelected(contentFilterCategoryContainer);
        renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    document.addEventListener('DOMContentLoaded', () => {
        updateSentimentContent('Brasil');
        updateNewsFilters(); renderNewsCards();
        updateContentNewsFilters(); renderContentNewsCards();
    });
  </script>
</body>
</html>