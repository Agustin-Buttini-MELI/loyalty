<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        sentimentIndex: [75, 68, 70, 72, 69, 55, 58, 62, 65, 45, 50, 52],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
            { month: 'Sep 24', text: 'Lanzamiento Meli+' },
            { month: 'Feb 25', text: 'Cambio % cashback' },
            { month: 'May 25', text: 'Rendimiento 120% CDI' },
            { month: 'Jun 25', text: 'Cambio política envío gratis' }
        ],
        table: [
            { mes: 'Jun 25', detractores: 'Muy Alto', motivosDet: 'Devaluación del envío', promotores: 'Bajo', motivosPro: 'Paquete de streaming', eventos: 'Anuncio de envío gratis a partir de R$19,90 para no suscriptores.', competencia: 'Shopee mantiene agresividad en cupones de envío.' },
            { mes: 'May 25', detractores: 'Medio', motivosDet: 'Costo de suscripción', promotores: 'Alto', motivosPro: 'Rendimiento 120% CDI', eventos: 'Lanzamiento de la cuenta que rinde 120% del CDI.', competencia: 'Nubank y PicPay como alternativas de inversión.' },
            { mes: 'Feb 25', detractores: 'Alto', motivosDet: 'Reducción de cashback', promotores: 'Bajo', motivosPro: 'Acceso a Disney+', eventos: 'Cambio en el porcentaje de cashback en compras.', competencia: 'Amazon Prime mantiene su propuesta de valor estable.' },
            { mes: 'Sep 24', detractores: 'Medio', motivosDet: 'Bugs iniciales, UI confusa', promotores: 'Alto', motivosPro: 'Acceso a Disney+/Star+', eventos: 'Lanzamiento oficial de Meli+ en Brasil.', competencia: 'Fuerte posicionamiento de Amazon Prime.' }
        ],
        summary: `
          <h4 class="font-semibold text-rose-800">Principales Puntos de Fricción:</h4>
          <ul>
            <li>La percepción del valor de la suscripción se vio fuertemente impactada en <strong>junio de 2025</strong> por el cambio en la política de envíos, generando una ola de quejas sobre la devaluación del principal beneficio de Meli+.</li>
            <li>La reducción del cashback en <strong>febrero de 2025</strong> fue otro punto crítico, con usuarios cuestionando la rentabilidad de la membresía.</li>
          </ul>
          <blockquote class="border-l-4 border-rose-300 pl-4 mt-2 italic text-gray-600">
            "Qual o sentido de pagar Meli+ se agora o frete grátis é pra quase todo mundo? A assinatura perdeu o valor. Vou cancelar." (Usuario en X)
          </blockquote>
          <h4 class="font-semibold text-emerald-800 mt-4">Principales Puntos a Favor:</h4>
          <ul>
            <li>El paquete de streaming (Disney+ y Star+) sigue siendo el ancla de valor más consistente y elogiada por los promotores.</li>
            <li>El lanzamiento de la cuenta remunerada al <strong>120% del CDI</strong> en <strong>mayo de 2025</strong> fue un acierto, atrayendo a un segmento de usuarios interesados en beneficios financieros.</li>
          </ul>
          <blockquote class="border-l-4 border-emerald-300 pl-4 mt-2 italic text-gray-600">
            "O rendimento de 120% no cofrinho pagou a assinatura. Pra quem usa a conta do Mercado Pago, o Meli+ ficou muito mais interessante." (Comentario en YouTube)
          </blockquote>
        `
      },
      "México": {
        sentimentIndex: [78, 72, 74, 75, 71, 60, 63, 65, 62, 68, 70, 71],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
            { month: 'Sep 24', text: 'Lanzamiento Meli+' },
            { month: 'Feb 25', text: 'Cambio % cashback' },
            { month: 'May 25', text: 'Lanzamiento Nu+ / Hot Sale' }
        ],
        table: [
            { mes: 'May 25', detractores: 'Alto', motivosDet: 'Retrasos en envíos (Hot Sale)', promotores: 'Medio', motivosPro: 'Ofertas y descuentos', eventos: 'Periodo de alta demanda por Hot Sale MX.', competencia: 'Lanzamiento de la suscripción Nu+ de Nubank; Amazon con promociones agresivas.' },
            { mes: 'Feb 25', detractores: 'Alto', motivosDet: 'Reducción de cashback', promotores: 'Bajo', motivosPro: 'Beneficios de streaming', eventos: 'Ajuste a la baja del % de cashback en compras.', competencia: 'Walmart Pass y Amazon Prime con fuerte presencia.' },
            { mes: 'Sep 24', detractores: 'Medio', motivosDet: 'Dudas sobre beneficios', promotores: 'Muy Alto', motivosPro: 'Streaming (Disney+/Star+), envíos', eventos: 'Lanzamiento oficial de Meli+ en México.', competencia: 'Amazon Prime es el principal referente para los usuarios.' }
        ],
        summary: `
          <h4 class="font-semibold text-rose-800">Principales Puntos de Fricción:</h4>
          <ul>
            <li>Al igual que en Brasil, la reducción del cashback en <strong>febrero de 2025</strong> fue mal recibida y generó un pico de comentarios negativos en redes y sitios como Apestan.com.</li>
            <li>Durante el <strong>Hot Sale (mayo 2025)</strong>, se observó un aumento significativo en quejas logísticas (retrasos en entregas), afectando la percepción de fiabilidad del envío "Full".</li>
          </ul>
          <blockquote class="border-l-4 border-rose-300 pl-4 mt-2 italic text-gray-600">
            "Pagué Meli+ para tener mis compras del Hot Sale rápido y llevan una semana de retraso. ¿Para qué sirve entonces?" (Usuario en Apestan.com)
          </blockquote>
          <h4 class="font-semibold text-emerald-800 mt-4">Principales Puntos a Favor:</h4>
          <ul>
            <li>El paquete de streaming sigue siendo el principal motor de adquisición y retención, con menciones muy positivas sobre el valor percibido.</li>
            <li>Los descuentos exclusivos en plataformas como Max y Paramount+ son un diferenciador valorado por un segmento de la base de suscriptores.</li>
          </ul>
          <blockquote class="border-l-4 border-emerald-300 pl-4 mt-2 italic text-gray-600">
            "Entre Disney, Star+ y el descuento de Max, la suscripción se paga sola. El envío gratis es un extra." (Usuario en Reddit México)
          </blockquote>
        `
      },
      "Chile": {
        sentimentIndex: [65, 67, 68, 70, 72, 73, 75, 82, 80, 79, 78, 77],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
            { month: 'Abr 25', text: 'Nuevos beneficios Meli+' }
        ],
        table: [
            { mes: 'Abr 25', detractores: 'Bajo', motivosDet: 'Costo mensual', promotores: 'Muy Alto', motivosPro: 'Nuevos descuentos y beneficios', eventos: 'Anuncio y activación de nuevos beneficios para suscriptores.', competencia: 'Falabella y Ripley con agresivos descuentos para clientes con tarjeta CMR/Ripley.' },
            { mes: 'Ene 25', detractores: 'Medio', motivosDet: 'Tiempos de envío a regiones', promotores: 'Medio', motivosPro: 'Acceso a Disney+', eventos: 'Período estándar sin grandes cambios.', competencia: 'Competencia constante con el retail local (Falabella, Ripley).' }
        ],
        summary: `
          <h4 class="font-semibold text-rose-800">Principales Puntos de Fricción:</h4>
          <ul>
            <li>La principal queja recurrente, aunque de bajo volumen, se centra en los tiempos de entrega a regiones extremas, que no siempre cumplen la promesa de rapidez.</li>
            <li>Comparaciones constantes con los programas de lealtad de Falabella (CMR Puntos) y Ripley, especialmente durante eventos de descuentos.</li>
          </ul>
          <blockquote class="border-l-4 border-rose-300 pl-4 mt-2 italic text-gray-600">
            "El envío a Punta Arenas sigue demorando más de la cuenta, incluso con Meli+. En eso, el retail local a veces es más confiable." (Reclamo en SERNAC)
          </blockquote>
          <h4 class="font-semibold text-emerald-800 mt-4">Principales Puntos a Favor:</h4>
          <ul>
            <li>El anuncio de nuevos beneficios en <strong>abril de 2025</strong> generó un pico muy positivo en el sentimiento, siendo percibido como una mejora tangible del programa.</li>
            <li>La conveniencia y la amplitud del catálogo de Mercado Libre, sumado a los envíos gratis, son un factor de lealtad clave.</li>
          </ul>
        `
      },
      "Argentina": {
        sentimentIndex: [60, 62, 65, 68, 70, 71, 72, 73, 75, 73, 74, 72],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
            { month: 'May 25', text: 'Lanzamiento Meli+ (desde Nivel 6)' }
        ],
        table: [
            { mes: 'May 25', detractores: 'Medio', motivosDet: 'Confusión en la migración', promotores: 'Alto', motivosPro: 'Paquete de streaming', eventos: 'Transición de Nivel 6 a Meli+. Comunicación del nuevo programa.', competencia: 'Amazon Prime Video y otros servicios de streaming compiten por separado.' }
        ],
        summary: `
          <h4 class="font-semibold text-rose-800">Principales Puntos de Fricción:</h4>
          <ul>
            <li>La transición de Nivel 6 a Meli+ en <strong>mayo de 2025</strong> generó cierta confusión inicial, con usuarios preguntando si perdían beneficios o si el costo aumentaba.</li>
            <li>El costo de la suscripción es un tema sensible y se evalúa constantemente en relación con la inflación y el poder adquisitivo.</li>
          </ul>
          <blockquote class="border-l-4 border-rose-300 pl-4 mt-2 italic text-gray-600">
            "No entendí bien el cambio de Nivel 6 a Meli+. ¿Tengo que pagar extra ahora para tener lo mismo? La app no es clara." (Consulta en tuquejasuma.com)
          </blockquote>
          <h4 class="font-semibold text-emerald-800 mt-4">Principales Puntos a Favor:</h4>
          <ul>
            <li>La incorporación del paquete de streaming (Disney+/Star+) fue recibida de manera abrumadoramente positiva, vista como una gran adición de valor.</li>
            <li>Las cuotas sin interés, cuando están disponibles, son un beneficio extremadamente valorado y un fuerte impulsor de la lealtad.</li>
          </ul>
        `
      },
      "Colombia": {
        sentimentIndex: [60, 61, 62, 63, 64, 65, 66, 68, 65, 68, 72, 80],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
            { month: 'May 25', text: 'Llegada de Amazon Prime' },
            { month: 'Ago 25', text: 'Lanzamiento Meli+' }
        ],
        table: [
            { mes: 'Ago 25', detractores: 'Medio', motivosDet: 'Bugs iniciales', promotores: 'Muy Alto', motivosPro: 'Propuesta de valor integral', eventos: 'Lanzamiento oficial de Meli+ en Colombia, migrando desde Nivel 6.', competencia: 'Amazon Prime, lanzado en mayo, ya es un competidor directo.' },
            { mes: 'May 25', detractores: 'N/A', motivosDet: 'N/A', promotores: 'N/A', motivosPro: 'N/A', eventos: 'Aumento de conversación sobre programas de lealtad.', competencia: 'Llegada de Amazon Prime a Colombia, generando comparaciones con Nivel 6 de Mercado Libre.' }
        ],
        summary: `
          <h4 class="font-semibold text-rose-800">Principales Puntos de Fricción:</h4>
          <ul>
            <li>Tras el lanzamiento en <strong>agosto de 2025</strong>, las quejas iniciales se centraron en problemas técnicos menores y en la activación de los beneficios de streaming.</li>
            <li>La llegada de Amazon Prime en <strong>mayo de 2025</strong> estableció un punto de comparación inmediato para los usuarios, quienes evalúan activamente qué servicio ofrece mejor valor.</li>
          </ul>
          <h4 class="font-semibold text-emerald-800 mt-4">Principales Puntos a Favor:</h4>
          <ul>
            <li>El lanzamiento de Meli+ fue recibido con gran expectación y generó un fuerte pico de sentimiento positivo, especialmente por el paquete de streaming.</li>
            <li>La propuesta de valor unificada (envíos, streaming, descuentos) es vista como muy competitiva frente a Rappi Pro y Amazon Prime.</li>
          </ul>
          <blockquote class="border-l-4 border-emerald-300 pl-4 mt-2 italic text-gray-600">
            "¡Al fin llegó Meli+ a Colombia! Ya activé Disney+ y Star+. Si los envíos funcionan bien, valdrá totalmente la pena sobre Amazon." (Usuario en TikTok)
          </blockquote>
        `
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      { "id": 1, "entity": "Rappi Pro", "country": "México", "impact": "Medio", "title": "Rappi Expands 'Rappi Pro' Benefits with Exclusive Access to Live Sporting Events in Mexico and Colombia", "url": "https://www.portafolio.co/negocios/empresas/rappi-pro-sumaria-partidos-de-futbol-en-vivo-en-mexico-y-colombia-587123", "date": "20-08-2025", "category": "Producto", "summary": "Rappi has partnered with a regional sports broadcaster to offer its 'Rappi Pro' subscribers in Mexico and Colombia exclusive streaming access to select local league soccer matches directly within the Rappi app.", "publisher": "portafolio.co", "url_raw": "https://www.portafolio.co/negocios/empresas/rappi-pro-sumaria-partidos-de-futbol-en-vivo-en-mexico-y-colombia-587123", "url_canonical": "https://www.portafolio.co/negocios/empresas/rappi-pro-sumaria-partidos-de-futbol-en-vivo-en-mexico-y-colombia-587123", "http_status": "200", "language": "es", "out_of_window": false },
      { "id": 2, "entity": "OpenAI (ChatGPT Premium)", "country": "Todos los Países", "impact": "Alto", "title": "OpenAI Announces General Availability of GPT-5 API for Enterprise Customers", "url": "https://openai.com/blog/gpt-5-api-now-available", "date": "18-08-2025", "category": "Flagship AI", "summary": "OpenAI has officially launched its next-generation model, GPT-5, through its API for all enterprise-tier customers, following a successful private beta. The model promises significant improvements in reasoning, code generation, and multilingual capabilities.", "publisher": "openai.com", "url_raw": "https://openai.com/blog/gpt-5-api-now-available", "url_canonical": "https://openai.com/blog/gpt-5-api-now-available", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 3, "entity": "Shein", "country": "México", "impact": "Medio", "title": "Shein Opens First Permanent Physical Showroom and Fulfillment Hub in Mexico City", "url": "https://www.elfinanciero.com.mx/empresas/2025/08/15/shein-apuesta-por-mexico-abre-showroom-permanente-y-centro-de-distribucion-en-cdmx/", "date": "15-08-2025", "category": "Estrategia", "summary": "In a move to bolster its omnichannel strategy, Shein has opened a permanent location in Mexico City that functions as both a customer showroom and a local fulfillment center for faster deliveries in the metropolitan area.", "publisher": "elfinanciero.com.mx", "url_raw": "https://www.elfinanciero.com.mx/empresas/2025/08/15/shein-apuesta-por-mexico-abre-showroom-permanente-y-centro-de-distribucion-en-cdmx/", "url_canonical": "https://www.elfinanciero.com.mx/empresas/2025/08/15/shein-apuesta-por-mexico-abre-showroom-permanente-y-centro-de-distribucion-en-cdmx/", "http_status": "200", "language": "es", "out_of_window": false },
      { "id": 4, "entity": "Amazon Prime", "country": "Brasil", "impact": "Alto", "title": "Amazon Confirms Prime Subscription Price Increase in Brazil to R$21.90/month", "url": "https://www.reuters.com/business/retail-consumer/amazon-hikes-prime-price-brazil-citing-costs-2025-08-12/", "date": "12-08-2025", "category": "Cambio de Precio", "summary": "Amazon will increase the price of its Prime subscription in Brazil from R$14.90 to R$21.90 per month, effective for new members immediately and for existing members on their next billing cycle after September 15.", "publisher": "reuters.com", "url_raw": "https://www.reuters.com/business/retail-consumer/amazon-hikes-prime-price-brazil-citing-costs-2025-08-12/?utm_source=twitter", "url_canonical": "https://www.reuters.com/business/retail-consumer/amazon-hikes-prime-price-brazil-citing-costs-2025-08-12/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 5, "entity": "Uber One", "country": "Chile", "impact": "Medio", "title": "Uber Integrates Grocery Delivery from Cencosud Stores into Uber One Membership in Chile", "url": "https://www.latercera.com/pulso/noticia/uber-one-suma-a-cencosud-en-chile-membresia-incluira-despacho-gratis-de-jumbo-y-santa-isabel/XEQLG2Q6YVGI7MHKJ23E5S24YI/", "date": "09-08-2025", "category": "Estrategia", "summary": "Uber expands its partnership with Cencosud in Chile, allowing Uber One members to receive free delivery and special discounts on grocery orders from Jumbo and Santa Isabel supermarkets through the Uber Eats app.", "publisher": "latercera.com", "url_raw": "https://www.latercera.com/pulso/noticia/uber-one-suma-a-cencosud-en-chile-membresia-incluira-despacho-gratis-de-jumbo-y-santa-isabel/XEQLG2Q6YVGI7MHKJ23E5S24YI/", "url_canonical": "https://www.latercera.com/pulso/noticia/uber-one-suma-a-cencosud-en-chile-membresia-incluira-despacho-gratis-de-jumbo-y-santa-isabel/XEQLG2Q6YVGI7MHKJ23E5S24YI/", "http_status": "200", "language": "es", "out_of_window": false }
    ];
    const contentNewsData = [
      { "id": 6, "entity": "Max", "country": "Brasil", "impact": "Alto", "title": "Warner Bros. Discovery Secures Exclusive LaLiga Streaming Rights for Max in Mexico and Brazil Starting 2026-27 Season", "url": "https://wbd.com/newsroom/press-releases/2025/08/21/max-to-become-exclusive-home-of-laliga-in-brazil-and-mexico/", "date": "21-08-2025", "category": "Derechos/Deportes", "summary": "WBD has won the bidding for a multi-year deal to exclusively stream Spain's LaLiga soccer matches on its Max platform in Brazil and Mexico, outbidding ESPN (Disney) and Amazon.", "publisher": "wbd.com", "url_raw": "https://wbd.com/newsroom/press-releases/2025/08/21/max-to-become-exclusive-home-of-laliga-in-brazil-and-mexico/", "url_canonical": "https://wbd.com/newsroom/press-releases/2025/08/21/max-to-become-exclusive-home-of-laliga-in-brazil-and-mexico/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 7, "entity": "Disney+", "country": "Todos los Países", "impact": "Medio", "title": "Disney+ Announces 'Star Wars: Heir to the Empire' Live-Action Series for Late 2026", "url": "https://www.thewaltdisneycompany.com/disney-announces-heir-to-the-empire-series/", "date": "19-08-2025", "category": "Lanzamiento", "summary": "As part of its content roadmap reveal, Lucasfilm announced a live-action series adaptation of the seminal 'Heir to the Empire' Star Wars novel, slated for a late 2026 release exclusively on Disney+.", "publisher": "thewaltdisneycompany.com", "url_raw": "https://www.thewaltdisneycompany.com/disney-announces-heir-to-the-empire-series/", "url_canonical": "https://www.thewaltdisneycompany.com/disney-announces-heir-to-the-empire-series/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 8, "entity": "Netflix", "country": "Todos los Países", "impact": "Alto", "title": "Netflix Confirms Acquisition of Animation Studio 'Moonbug Entertainment' to Bolster Kids Content", "url": "https://ir.netflix.net/news-releases/news-release-details/2025/Netflix-Acquires-Moonbug-Entertainment/default.aspx", "date": "14-08-2025", "category": "Fusión/Adquisición", "summary": "Netflix has completed its acquisition of Moonbug Entertainment, the studio behind 'CoComelon'. The deal, valued at approximately $2.5 billion, aims to strengthen Netflix's position in the family and kids streaming segment.", "publisher": "ir.netflix.net", "url_raw": "https://ir.netflix.net/news-releases/news-release-details/2025/Netflix-Acquires-Moonbug-Entertainment/default.aspx", "url_canonical": "https://ir.netflix.net/news-releases/news-release-details/2025/Netflix-Acquires-Moonbug-Entertainment/default.aspx", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 9, "entity": "Spotify", "country": "Todos los Países", "impact": "Medio", "title": "Spotify Rolls Out AI-Powered 'Podcast Summaries' and 'Key Moments' Feature Globally", "url": "https://newsroom.spotify.com/2025-08-11/spotify-launches-ai-podcast-summaries/", "date": "11-08-2025", "category": "Producto", "summary": "Spotify is launching a new feature that uses generative AI to create concise summaries and identify key moments in podcasts, allowing users to quickly gauge an episode's content or jump to specific topics.", "publisher": "newsroom.spotify.com", "url_raw": "https://newsroom.spotify.com/2025-08-11/spotify-launches-ai-podcast-summaries/", "url_canonical": "https://newsroom.spotify.com/2025-08-11/spotify-launches-ai-podcast-summaries/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 10, "entity": "Apple TV+", "country": "Todos los Países", "impact": "Medio", "title": "Apple Appoints New Head of International Content for TV+ to Drive Global Expansion", "url": "https://variety.com/2025/tv/global/apple-hires-netflix-exec-international-content-tv-plus-1235689123/", "date": "08-08-2025", "category": "Estrategia", "summary": "Apple has hired a former Netflix international executive to lead its global content strategy for Apple TV+, signaling a renewed push to produce more localized original series and films for key markets outside the US.", "publisher": "variety.com", "url_raw": "https://variety.com/2025/tv/global/apple-hires-netflix-exec-international-content-tv-plus-1235689123/", "url_canonical": "https://variety.com/2025/tv/global/apple-hires-netflix-exec-international-content-tv-plus-1235689123/", "http_status": "200", "language": "en", "out_of_window": false }
    ];


    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      const html = [
        `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}all" value="all" class="mr-2"><label for="${idBase}all">Todos</label></div>`,
        ...allItems.map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${c}" value="${c}" class="mr-2"><label for="${idBase}${c}">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES.filter(c => c!=='Todos los Países'), 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES.filter(c => c!=='Todos los Países'), 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category-');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }
    function normalizeSelectAll(container, selectedValues) {
      const allBox = container.querySelector('input[value="all"]');
      const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b.value !== 'all');
      if (!allBox) return;
      if (selectedValues.includes('all')) rest.forEach(b => b.checked = false);
      else if (rest.some(b => b.checked)) allBox.checked = false;
    }
    function filterNews() {
      let sc = getSelected(newsFilterCountryContainer);
      let se = getSelected(newsFilterCompanyContainer);
      let sk = getSelected(newsFilterCategoryContainer);
      normalizeSelectAll(newsFilterCountryContainer, sc);
      normalizeSelectAll(newsFilterCompanyContainer, se);
      normalizeSelectAll(newsFilterCategoryContainer, sk);
      sc = getSelected(newsFilterCountryContainer);
      se = getSelected(newsFilterCompanyContainer);
      sk = getSelected(newsFilterCategoryContainer);
      newsFilters.country = sc.includes('all') ? [] : sc;
      newsFilters.company = se.includes('all') ? [] : se;
      newsFilters.category = sk.includes('all') ? [] : sk;
      renderNewsCards();
    }
    function filterContentNews() {
      let sc = getSelected(contentFilterCountryContainer);
      let se = getSelected(contentFilterCompanyContainer);
      let sk = getSelected(contentFilterCategoryContainer);
      normalizeSelectAll(contentFilterCountryContainer, sc);
      normalizeSelectAll(contentFilterCompanyContainer, se);
      normalizeSelectAll(contentFilterCategoryContainer, sk);
      sc = getSelected(contentFilterCountryContainer);
      se = getSelected(contentFilterCompanyContainer);
      sk = getSelected(contentFilterCategoryContainer);
      contentFilters.country = sc.includes('all') ? [] : sc;
      contentFilters.company = se.includes('all') ? [] : se;
      contentFilters.category = sk.includes('all') ? [] : sk;
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    updateSentimentContent('Brasil');
    updateNewsFilters(); renderNewsCards();
    updateContentNewsFilters(); renderContentNewsCards();
  </script>
</body>
</html>