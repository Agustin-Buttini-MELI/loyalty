<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        "sentimentIndex": [85, 82, 80, 79, 78, 65, 68, 70, 75, 50, 52, 55, 54],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "Sep 24", "text": "Lanzamiento Meli+" },
          { "month": "Feb 25", "text": "Cambio % cashback" },
          { "month": "May 25", "text": "Cofrinhos 120% CDI" },
          { "month": "Jun 25", "text": "Cambio umbral envío gratis" }
        ],
        "table": [
          { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Beneficios", "promotores": "Alto", "motivosPro": "Cashback/Rendimiento", "eventos": "Lanzamiento Cofrinhos 120% CDI.", "competencia": "Nubank Ultravioleta sigue fuerte." },
          { "mes": "Jun 25", "detractores": "Muy Alto", "motivosDet": "Envío Gratis", "promotores": "Bajo", "motivosPro": "Contenido (D+/Max)", "eventos": "Envío gratis generalizado para compras ≥R$19,90.", "competencia": "Shopee mantiene su estrategia agresiva de envíos." },
          { "mes": "Jul 25", "detractores": "Alto", "motivosDet": "Envío Gratis", "promotores": "Bajo", "motivosPro": "Contenido (D+/Max)", "eventos": "Resaca del cambio de política de envíos.", "competencia": "Prime Day de Amazon genera comparaciones." },
          { "mes": "Ago 25", "detractores": "Alto", "motivosDet": "Envío Gratis", "promotores": "Bajo", "motivosPro": "Contenido (D+/Max)", "eventos": "Sentimiento devaluado se mantiene estable.", "competencia": "Magalu anuncia nuevas alianzas logísticas." }
        ],
        "summary": "<h4>Análisis Cualitativo (Brasil)</h4><p>El sentimiento en Brasil se desplomó en junio y no se ha recuperado. El cambio en la política de envíos gratis fue percibido como una devaluación total del programa Meli+, un tema que domina las quejas.</p><ul><li><b>Detractor Clave:</b> \"Pagar Meli+ para que? Agora qualquer compra de 20 reais tem frete grátis. Perdeu totalmente o sentido. Vou cancelar.\" (Fuente: Reclame Aqui)</li><li><b>Detractor Clave:</b> \"O benefício do frete era o principal. Agora é só uma assinatura de streaming cara. O do Amazon Prime ainda compensa mais.\" (Fuente: X/Twitter)</li><li><b>Promotor Aislado:</b> \"Ainda vale a pena pelo rendimento de 120% do CDI no cofrinho e os descontos em Max e Disney+.\" (Fuente: Comentario YouTube)</li></ul>"
      },
      "México": {
        "sentimentIndex": [88, 85, 84, 83, 82, 70, 72, 73, 68, 70, 72, 74, 75],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "Sep 24", "text": "Lanzamiento Meli+" },
          { "month": "Feb 25", "text": "Cambio % cashback" },
          { "month": "May 25", "text": "Hot Sale / Lanzamiento NU+" }
        ],
        "table": [
          { "mes": "May 25", "detractores": "Medio-Alto", "motivosDet": "Logística/Envíos", "promotores": "Medio", "motivosPro": "Contenido (D+/Max)", "eventos": "Hot Sale genera quejas por demoras en entregas.", "competencia": "Nubank lanza su programa de lealtad NU+." },
          { "mes": "Jun 25", "detractores": "Medio", "motivosDet": "Cashback", "promotores": "Medio", "motivosPro": "Envío Gratis", "eventos": "Se normalizan operaciones post-Hot Sale.", "competencia": "Amazon Prime con fuerte publicidad." },
          { "mes": "Jul 25", "detractores": "Bajo", "motivosDet": "Beneficios", "promotores": "Medio-Alto", "motivosPro": "Contenido (D+/Max)", "eventos": "Percepción estable.", "competencia": "Prime Day de Amazon genera comparaciones directas." },
          { "mes": "Ago 25", "detractores": "Bajo", "motivosDet": "UI/Transparencia", "promotores": "Alto", "motivosPro": "Envío Gratis", "eventos": "Consolidación del valor percibido del paquete de streaming.", "competencia": "Walmart Connect expande su oferta publicitaria." }
        ],
        "summary": "<h4>Análisis Cualitativo (México)</h4><p>El sentimiento en México, aunque impactado por el cambio de cashback y el ruido del Hot Sale, se mantiene resiliente. El paquete de streaming (Disney+ y Max) es el ancla principal del valor percibido.</p><ul><li><b>Detractor Clave:</b> \"Durante el Hot Sale mi envío Full tardó una semana. ¿De qué sirve Meli+ si no cumplen en la temporada más importante?\" (Fuente: apestan.com)</li><li><b>Promotor Clave:</b> \"Pago Meli+ y ya no pago ni Disney ni Max. Solo con eso ya se pagó. Los envíos gratis son un extra. Súper conviene.\" (Fuente: TikTok)</li><li><b>Voz Competencia:</b> \"Voy a probar el NU+ de Nubank, dicen que el cashback es directo y sin tantas vueltas como acá.\" (Fuente: Reddit r/MexicoFinanciero)</li></ul>"
      },
      "Chile": {
        "sentimentIndex": [75, 76, 78, 77, 78, 79, 80, 85, 84, 83, 82, 83, 84],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "Abr 25", "text": "Nuevos beneficios Meli+" }
        ],
        "table": [
          { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Logística/Envíos", "promotores": "Alto", "motivosPro": "Descuentos", "eventos": "Consolidación de nuevos beneficios.", "competencia": "Falabella potencia descuentos con tarjeta CMR." },
          { "mes": "Jun 25", "detractores": "Bajo", "motivosDet": "Logística/Envíos", "promotores": "Alto", "motivosPro": "Contenido (D+/Max)", "eventos": "Creciente apreciación del paquete de streaming.", "competencia": "Ripley lanza campaña de envíos rápidos." },
          { "mes": "Jul 25", "detractores": "Bajo", "motivosDet": "UI/Transparencia", "promotores": "Alto", "motivosPro": "Descuentos", "eventos": "Percepción estable.", "competencia": "Amazon sigue con penetración lenta." },
          { "mes": "Ago 25", "detractores": "Muy Bajo", "motivosDet": "Beneficios", "promotores": "Muy Alto", "motivosPro": "Contenido (D+/Max)", "eventos": "Meli+ es visto como el programa de lealtad líder.", "competencia": "Dato no disponible." }
        ],
        "summary": "<h4>Análisis Cualitativo (Chile)</h4><p>Chile presenta el sentimiento más alto y estable. La actualización de beneficios en abril fue un éxito rotundo y el programa es percibido como muy superior a la competencia local.</p><ul><li><b>Promotor Clave:</b> \"Con los descuentos en Universal+ y el Max que ya tenía, Meli+ se paga solo. El Falabella Go ya no compite.\" (Fuente: Reddit r/chile)</li><li><b>Promotor Clave:</b> \"Impecable el servicio. Compro en la noche y llega en la mañana. Los beneficios extra son la guinda de la torta.\" (Fuente: X/Twitter)</li><li><b>Detractor Menor:</b> \"Me gustaría que aclararan mejor las condiciones de algunos descuentos, a veces es confuso.\" (Fuente: SERNAC)</li></ul>"
      },
      "Argentina": {
        "sentimentIndex": [70, 72, 68, 75, 72, 74, 73, 75, 80, 78, 76, 77, 76],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "May 25", "text": "Lanzamiento Meli+" }
        ],
        "table": [
          { "mes": "May 25", "detractores": "Bajo", "motivosDet": "UI/Transparencia", "promotores": "Muy Alto", "motivosPro": "Contenido (D+/Max)", "eventos": "Lanzamiento de Meli+ reemplazando Nivel 6. Migración mayormente positiva.", "competencia": "Ualá y NaranjaX compiten en el frente financiero." },
          { "mes": "Jun 25", "detractores": "Bajo", "motivosDet": "Logística/Envíos", "promotores": "Alto", "motivosPro": "Cuotas sin interés", "eventos": "El valor de las cuotas se mantiene como un pilar.", "competencia": "Dato no disponible." },
          { "mes": "Jul 25", "detractores": "Bajo", "motivosDet": "Precios", "promotores": "Alto", "motivosPro": "Contenido (D+/Max)", "eventos": "Contexto inflacionario es la principal queja, no el servicio Meli+.", "competencia": "Cablevisión Flow promociona su paquete de TV y streaming." },
          { "mes": "Ago 25", "detractores": "Bajo", "motivosDet": "Precios", "promotores": "Alto", "motivosPro": "Contenido (D+/Max)", "eventos": "La propuesta de valor de Meli+ se percibe muy sólida.", "competencia": "Dato no disponible." }
        ],
        "summary": "<h4>Análisis Cualitativo (Argentina)</h4><p>En Argentina, el lanzamiento de Meli+ fue muy bien recibido. En un contexto de alta inflación, el paquete de suscripciones de streaming es visto como un ahorro significativo y el principal motor de valor del programa.</p><ul><li><b>Promotor Clave:</b> \"Me pasaron de Nivel 6 a Meli+ y de la nada tengo Max y Disney+. Con lo que sale hoy pagar eso, es un golazo de media cancha.\" (Fuente: tuquejasuma.com)</li><li><b>Promotor Clave:</b> \"Entre las cuotas y que me ahorro las plataformas de streaming, Mercado Libre me soluciona todo. Imposible quejarme.\" (Fuente: Facebook)</li><li><b>Detractor Menor:</b> \"No me quedó claro cómo era el cambio de Nivel 6 a Meli+, tuve que contactar a soporte para que me activen Max.\" (Fuente: X/Twitter)</li></ul>"
      },
      "Colombia": {
        "sentimentIndex": [72, 70, 71, 70, 68, 66, 65, 64, 65, 66, 68, 82, 80],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "May 25", "text": "Amazon Prime llega a CO" },
          { "month": "Ago 25", "text": "Lanzamiento Meli+" }
        ],
        "table": [
          { "mes": "May 25", "detractores": "Medio-Alto", "motivosDet": "Logística/Envíos", "promotores": "Bajo", "motivosPro": "Beneficios", "eventos": "El mercado reacciona a la llegada de Amazon Prime.", "competencia": "Amazon Prime lanza con oferta agresiva de envíos en Bogotá." },
          { "mes": "Jun 25", "detractores": "Medio", "motivosDet": "Competencia", "promotores": "Bajo", "motivosPro": "Beneficios", "eventos": "Usuarios comparan Nivel 6 con la oferta de Prime.", "competencia": "Rappi Pro/Turbo como principal competidor en entrega inmediata." },
          { "mes": "Jul 25", "detractores": "Medio", "motivosDet": "Competencia", "promotores": "Bajo", "motivosPro": "Beneficios", "eventos": "Expectativa por una respuesta de Mercado Libre.", "competencia": "Dato no disponible." },
          { "mes": "Ago 25", "detractores": "Bajo", "motivosDet": "UI/Transparencia", "promotores": "Muy Alto", "motivosPro": "Contenido (D+/Max)", "eventos": "Lanzamiento de Meli+ es una fuerte respuesta a Prime.", "competencia": "Alkosto mantiene su fuerza en electrodomésticos." }
        ],
        "summary": "<h4>Análisis Cualitativo (Colombia)</h4><p>La llegada de Amazon Prime en mayo golpeó el sentimiento de Nivel 6. Sin embargo, el lanzamiento de Meli+ en agosto revirtió completamente la tendencia, con una recepción muy positiva del paquete de beneficios, especialmente el streaming, visto como un diferenciador clave frente a Prime.</p><ul><li><b>Promotor Clave:</b> \"¡Por fin una respuesta a Amazon! Con Meli+ tengo Disney y Max, Prime no ofrece nada de eso. Bien jugado, Mercado Libre.\" (Fuente: X/Twitter)</li><li><b>Promotor Clave:</b> \"Me cambiaron a Meli+ y la verdad la oferta de entretenimiento es mucho mejor que la de la competencia. Los envíos siguen siendo rápidos.\" (Fuente: Comentario en noticia de prensa)</li><li><b>Detractor Menor:</b> \"La migración de Nivel 6 a Meli+ no fue automática para los beneficios de streaming, tuve que activarlos manualmente y fue algo confuso.\" (Fuente: SIC)</li></ul>"
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      {
        "id": 1,
        "entity": "OpenAI (ChatGPT Premium)",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "OpenAI Announces GPT-5 API Access for Enterprise Customers, Public Rollout to Follow",
        "url": "https://openai.com/blog/gpt-5-api-announcement",
        "date": "02-09-2025",
        "category": "Flagship AI",
        "summary": "OpenAI has officially launched its next-generation model, GPT-5, making it available via API to select enterprise partners, with a public release for ChatGPT Plus users expected soon. This promises significant improvements in reasoning and multimodal capabilities.",
        "publisher": "openai.com"
      },
      {
        "id": 2,
        "entity": "Shein",
        "country": "Colombia",
        "impact": "Medio",
        "title": "Shein Expands Marketplace Model to Colombia, Challenging Mercado Libre and Rappi",
        "url": "https://www.reuters.com/business/retail-consumer/shein-expands-marketplace-colombia-2025-08-22/",
        "date": "22-08-2025",
        "category": "Lanzamiento",
        "summary": "Shein has officially launched its third-party marketplace in Colombia, allowing local sellers to list products. This move intensifies competition with established players like Mercado Libre and is part of Shein's strategy to diversify beyond fast fashion.",
        "publisher": "reuters.com"
      },
      {
        "id": 3,
        "entity": "Amazon Prime",
        "country": "Brasil",
        "impact": "Medio",
        "title": "Amazon estuda reajuste no preço da assinatura Prime no Brasil para 2026, aponta jornal",
        "url": "https://www1.folha.uol.com.br/mercado/2025/08/amazon-estuda-reajuste-prime-brasil-2026.shtml",
        "date": "26-08-2025",
        "category": "Cambio de Precio",
        "summary": "A report from Folha de S.Paulo, citing internal sources, suggests Amazon is planning to increase the price of its Prime subscription in Brazil in early 2026. This follows price hikes in other global markets.",
        "publisher": "folha.uol.com.br"
      }
    ];
    const contentNewsData = [
      {
        "id": 101,
        "entity": "Paramount+",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "Paramount and Skydance Finalize Merger Following Unanimous Board Approval and Regulatory Clearance",
        "url": "https://variety.com/2025/biz/news/paramount-skydance-merger-finalized-123612845/",
        "date": "28-08-2025",
        "category": "Fusión/Adquisición",
        "summary": "The long-awaited merger between Paramount Global and Skydance Media has officially closed. The deal's completion will have significant implications for Paramount+'s content strategy and competitive positioning.",
        "publisher": "variety.com"
      },
      {
        "id": 102,
        "entity": "OpenAI",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "OpenAI Announces GPT-5 API Access for Enterprise Customers, Public Rollout to Follow",
        "url": "https://openai.com/blog/gpt-5-api-announcement",
        "date": "02-09-2025",
        "category": "Flagship AI",
        "summary": "The launch of GPT-5 via API redefines the state of the art in AI, putting pressure on all tech players to innovate. It directly impacts the premium AI offering landscape.",
        "publisher": "openai.com"
      },
      {
        "id": 103,
        "entity": "Netflix",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Netflix Signs Exclusive Multi-Year Animation Deal with 'Arcane' Studio Fortiche Production",
        "url": "https://deadline.com/2025/08/netflix-fortiche-production-arcane-animation-deal-123567890/",
        "date": "29-08-2025",
        "category": "Producto",
        "summary": "Netflix has secured an exclusive, multi-year partnership with French animation studio Fortiche Production, creators of 'Arcane', to ensure a pipeline of new animated series and films exclusively for the service.",
        "publisher": "deadline.com"
      },
      {
        "id": 104,
        "entity": "Max",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Warner Bros. Discovery Touts Max Subscriber Stability and Ad-Tier Growth at Tech Conference",
        "url": "https://www.hollywoodreporter.com/business/business-news/wbd-max-subscriber-stability-ad-tier-growth-123567891/",
        "date": "23-08-2025",
        "category": "Resultados Financieros",
        "summary": "At an investor conference, WBD's CFO provided an update indicating that subscriber churn for Max has stabilized and the ad-supported tier is seeing strong growth, signaling a path to profitability.",
        "publisher": "hollywoodreporter.com"
      }
    ];

    /* ===== LISTAS MAESTRAS PARA MOSTRAR TODOS LOS FILTROS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de URL (sanitizar/host) ==== */
    function sanitizeUrl(u) {
      if (!u) return '#';
      const raw = String(u).trim();
      const withProto = /^https?:\/\//i.test(raw) ? raw : `https://${raw.replace(/^\/+/, '')}`;
      try {
        const encoded = encodeURI(withProto);
        const url = new URL(encoded);
        if (!/^https?:$/.test(url.protocol)) return '#';
        return url.href;
      } catch { return '#'; }
    }
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin mostrar impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
               class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin mostrar impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
               class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros desde listas maestras ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      const html = [
        `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}all" value="all" class="mr-2"><label for="${idBase}all">Todos</label></div>`,
        ...allItems.map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${c}" value="${c}" class="mr-2"><label for="${idBase}${c}">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES.filter(c => c!=='Todos los Países'), 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES.filter(c => c!=='Todos los Países'), 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category-');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }
    function normalizeSelectAll(container, selectedValues) {
      const allBox = container.querySelector('input[value="all"]');
      const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b.value !== 'all');
      if (!allBox) return;
      if (selectedValues.includes('all')) rest.forEach(b => b.checked = false);
      else if (rest.some(b => b.checked)) allBox.checked = false;
    }
    function filterNews() {
      let sc = getSelected(newsFilterCountryContainer);
      let se = getSelected(newsFilterCompanyContainer);
      let sk = getSelected(newsFilterCategoryContainer);
      normalizeSelectAll(newsFilterCountryContainer, sc);
      normalizeSelectAll(newsFilterCompanyContainer, se);
      normalizeSelectAll(newsFilterCategoryContainer, sk);
      sc = getSelected(newsFilterCountryContainer);
      se = getSelected(newsFilterCompanyContainer);
      sk = getSelected(newsFilterCategoryContainer);
      newsFilters.country = sc.includes('all') ? [] : sc;
      newsFilters.company = se.includes('all') ? [] : se;
      newsFilters.category = sk.includes('all') ? [] : sk;
      renderNewsCards();
    }
    function filterContentNews() {
      let sc = getSelected(contentFilterCountryContainer);
      let se = getSelected(contentFilterCompanyContainer);
      let sk = getSelected(contentFilterCategoryContainer);
      normalizeSelectAll(contentFilterCountryContainer, sc);
      normalizeSelectAll(contentFilterCompanyContainer, se);
      normalizeSelectAll(contentFilterCategoryContainer, sk);
      sc = getSelected(contentFilterCountryContainer);
      se = getSelected(contentFilterCompanyContainer);
      sk = getSelected(contentFilterCategoryContainer);
      contentFilters.country = sc.includes('all') ? [] : sc;
      contentFilters.company = se.includes('all') ? [] : se;
      contentFilters.category = sk.includes('all') ? [] : sk;
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    updateSentimentContent('Brasil');
    updateNewsFilters(); renderNewsCards();
    updateContentNewsFilters(); renderContentNewsCards();
  </script>
</body>
</html>