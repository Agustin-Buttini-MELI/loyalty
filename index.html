<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      'Brasil': {
        sentimentIndex: [85, 82, 80, 78, 83, 88, 70, 72, 85, 86, 84, 80],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+ BR' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Meli+ BR 120% CDI' },
          { month: 'Jun 25', text: 'Envío gratis general ≥ R$19,90' }
        ],
        table: [
          { mes: 'Ago 25', detractores: '15%', motivosDet: 'Confusión envío gratis', promotores: '75%', motivosPro: 'Rendimiento 120% CDI', eventos: 'Mes post cambio de política de envío gratis', competencia: 'Amazon Prime Day (Jul 25) generó comparativas' },
          { mes: 'Jul 25', detractores: '22%', motivosDet: 'Devaluación beneficio envío', promotores: '68%', motivosPro: 'Rendimiento 120% CDI', eventos: 'Impacto pleno de la nueva política de envío', competencia: 'Publicidad agresiva de Shopee en logística' },
          { mes: 'Jun 25', detractores: '18%', motivosDet: 'Ya no es exclusivo de Meli+', promotores: '72%', motivosPro: 'Rendimiento 120% CDI', eventos: 'Anuncio de envío gratis para todos ≥ R$19,90', competencia: 'Magalu con ofertas de frete grátis' },
          { mes: 'May 25', detractores: '10%', motivosDet: 'Límite bajo en cashback', promotores: '80%', motivosPro: 'Rendimiento 120% CDI', eventos: 'Lanzamiento de "cofrinhos" con 120% CDI', competencia: 'Nubank Ultravioleta sigue siendo aspiracional' },
        ],
        summary: `
          <ul>
            <li><strong>Resumen General:</strong> La introducción del rendimiento del 120% del CDI en mayo generó un fuerte sentimiento positivo, posicionando a Meli+ como un producto financiero atractivo. Sin embargo, el cambio en la política de envío gratis en junio diluyó la percepción de exclusividad logística, causando un pico de comentarios negativos que se moderó en agosto.</li>
            <li><strong class="text-emerald-700">Cita Promotor:</strong> "Deixei meu dinheiro no cofrinho do Meli+ e está rendendo mais que a poupança e outros CDBs por aí. Fora o Disney+ que já usava. Vale muito a pena." (YouTube)</li>
            <li><strong class="text-rose-700">Cita Detractor:</strong> "Qual a vantagem de pagar o Meli+ agora se qualquer um tem frete grátis acima de 20 reais? O benefício principal virou fumaça." (Reclame Aqui)</li>
          </ul>
        `
      },
      'México': {
        sentimentIndex: [88, 85, 86, 84, 80, 81, 83, 85, 78, 80, 82, 84],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+ MX' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Hot Sale MX' }
        ],
        table: [
          { mes: 'Ago 25', detractores: '12%', motivosDet: 'Disney+ con anuncios', promotores: '78%', motivosPro: 'Velocidad de entrega FULL', eventos: 'Estabilización post-Hot Sale', competencia: 'Walmart Pass compite en entregas de súper' },
          { mes: 'Jul 25', detractores: '14%', motivosDet: 'Poca variedad en descuentos', promotores: '76%', motivosPro: 'Catálogo de Max incluido', eventos: 'Mes tranquilo, foco en beneficios de streaming', competencia: 'Klar anuncia nuevo programa de lealtad' },
          { mes: 'Jun 25', detractores: '15%', motivosDet: 'Problemas de stock/logística', promotores: '75%', motivosPro: 'Buenas ofertas Hot Sale', eventos: 'Resaca del Hot Sale', competencia: 'Amazon Prime Day anunciado para julio' },
          { mes: 'May 25', detractores: '18%', motivosDet: 'Cancelaciones / demoras', promotores: '72%', motivosPro: 'Ofertas exclusivas Meli+', eventos: 'Hot Sale MX', competencia: 'Nubank lanza su programa de lealtad NU+' },
        ],
        summary: `
          <ul>
            <li><strong>Resumen General:</strong> El sentimiento en México se mantiene robusto, anclado en la propuesta de valor de envíos rápidos y el paquete de streaming. El Hot Sale de mayo generó un aumento de quejas operativas (logística, stock), como es habitual, pero el valor percibido de las ofertas fue alto. La competencia de nuevos programas de lealtad (NU+) y la consolidación de Amazon Prime son el principal factor a monitorear.</li>
            <li><strong class="text-emerald-700">Cita Promotor:</strong> "Pedí 4 cosas diferentes en el Hot Sale, todas con Meli+, y 3 me llegaron al día siguiente. La velocidad es increíble, por eso lo pago." (X)</li>
            <li><strong class="text-rose-700">Cita Detractor:</strong> "Me metí a Meli+ por Disney+ y ahora me van a meter anuncios. ¿Cuál es el chiste? Es como pagar por ver comerciales." (Apestan.com)</li>
          </ul>
        `
      },
      'Chile': {
        sentimentIndex: [75, 77, 78, 80, 82, 84, 88, 86, 85, 84, 83, 82],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'Abr 25', text: 'Nuevos beneficios Meli+ CL' }
        ],
        table: [
          { mes: 'Ago 25', detractores: '13%', motivosDet: 'Pocas cuotas sin interés', promotores: '79%', motivosPro: 'Descuentos en supermercado', eventos: 'Periodo de maduración de nuevos beneficios', competencia: 'Ripley y Falabella con fuertes campañas de sus tarjetas' },
          { mes: 'Jul 25', detractores: '12%', motivosDet: 'Falta de claridad en beneficios', promotores: '80%', motivosPro: 'Descuentos en comercios', eventos: 'Comunicación de beneficios', competencia: 'Amazon Prime con envíos desde USA más rápidos' },
          { mes: 'Jun 25', detractores: '11%', motivosDet: 'Costos de envío variables', promotores: '81%', motivosPro: 'Beneficios de streaming (Max)', eventos: 'Asentamiento de la nueva oferta', competencia: 'Descuentos agresivos con tarjeta CMR Falabella' },
          { mes: 'May 25', detractores: '10%', motivosDet: 'Confusión con Nivel 6', promotores: '82%', motivosPro: 'Envío gratis y rápido', eventos: 'Mes post-lanzamiento de nuevos beneficios', competencia: 'Falabella.com unifica su marca' },
        ],
        summary: `
          <ul>
            <li><strong>Resumen General:</strong> La introducción de nuevos beneficios en abril, incluyendo descuentos fuera del ecosistema de Meli, generó un impulso significativo en el sentimiento. La percepción de valor es alta, aunque persisten quejas menores sobre la consistencia de los costos de envío y la competencia de los programas de fidelidad bancarios tradicionales (Falabella, Ripley).</li>
            <li><strong class="text-emerald-700">Cita Promotor:</strong> "Con Meli+ ahora tengo descuento en el super y bencina. Se paga solo con eso, el resto (Disney, Max) es de yapa." (Reddit r/chile)</li>
            <li><strong class="text-rose-700">Cita Detractor:</strong> "No entiendo, a veces el envío me sale gratis y otras veces para un producto similar me cobran. El sistema de Meli+ debería ser más claro." (SERNAC)</li>
          </ul>
        `
      },
      'Argentina': {
        sentimentIndex: [68, 70, 72, 74, 75, 76, 78, 79, 85, 83, 81, 80],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'May 25', text: 'Lanzamiento Meli+ AR (reemplaza Nivel 6)' }
        ],
        table: [
          { mes: 'Ago 25', detractores: '15%', motivosDet: 'Costo de la suscripción', promotores: '75%', motivosPro: 'Acceso a Disney+ y Max', eventos: 'Contexto inflacionario presiona el valor percibido', competencia: 'Personal Flow como principal competidor en bundling' },
          { mes: 'Jul 25', detractores: '14%', motivosDet: 'Poca diferencia con Nivel 6', promotores: '77%', motivosPro: 'Paquete de streaming', eventos: 'Usuarios evalúan si mantener la suscripción', competencia: 'Ualá ofrece ecosistema financiero competitivo' },
          { mes: 'Jun 25', detractores: '12%', motivosDet: 'Confusión en la migración', promotores: '79%', motivosPro: 'Beneficios claros vs Nivel 6', eventos: 'Aclaraciones sobre el cambio a Meli+', competencia: 'NaranjaX con promociones de descuentos' },
          { mes: 'May 25', detractores: '10%', motivosDet: 'Problemas para activar D+', promotores: '82%', motivosPro: 'Acceso a Disney+ y Max', eventos: 'Lanzamiento de Meli+ en reemplazo de Nivel 6', competencia: 'Lanzamiento sin competencia directa de un bundle similar' },
        ],
        summary: `
          <ul>
            <li><strong>Resumen General:</strong> El cambio de Nivel 6 a Meli+ en mayo fue mayoritariamente positivo, impulsado por la inclusión del paquete de streaming (Disney+, Max), un valor muy apreciado en el mercado. Las quejas iniciales se centraron en problemas técnicos de la migración y en el costo mensual en un entorno de alta inflación. El principal desafío es demostrar el valor continuo frente a alternativas como Personal Flow.</li>
            <li><strong class="text-emerald-700">Cita Promotor:</strong> "Pago Meli+ y me sale más barato que contratar Disney y Max por separado. Encima tengo envíos gratis y descuentos. Negocio redondo." (X)</li>
            <li><strong class="text-rose-700">Cita Detractor:</strong> "Me pasaron de Nivel 6 a Meli+ y me empezaron a cobrar sin que me diera cuenta. La comunicación fue malísima y ahora me cuesta justificar el gasto." (tuquejasuma.com)</li>
          </ul>
        `
      },
      'Colombia': {
        sentimentIndex: [70, 72, 73, 75, 76, 78, 80, 81, 82, 83, 84, 88],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'May 25', text: 'Amazon Prime llega a CO' },
          { month: 'Ago 25', text: 'Lanzamiento Meli+ CO (reemplaza Nivel 6)' }
        ],
        table: [
          { mes: 'Ago 25', detractores: '8%', motivosDet: 'Problemas técnicos activación', promotores: '84%', motivosPro: 'Streaming y envíos gratis', eventos: 'Lanzamiento de Meli+ en reemplazo de Nivel 6', competencia: 'Rappi Pro (Rappi Prime) y Amazon Prime' },
          { mes: 'Jul 25', detractores: '12%', motivosDet: 'Envíos de Amazon más rápidos', promotores: '78%', motivosPro: 'Variedad de productos MELI', eventos: 'Expectativa por el cambio a Meli+', competencia: 'Amazon Prime consolida su oferta de lanzamiento' },
          { mes: 'Jun 25', detractores: '13%', motivosDet: 'Nivel 6 poco competitivo', promotores: '75%', motivosPro: 'Confianza en marca MELI', eventos: 'Comparativas con la oferta de Amazon Prime', competencia: 'Fuerte campaña de lanzamiento de Amazon Prime' },
          { mes: 'May 25', detractores: '14%', motivosDet: 'Nivel 6 no incluye streaming', promotores: '74%', motivosPro: 'Logística establecida', eventos: 'Llegada de Amazon Prime a Colombia', competencia: 'Lanzamiento de Amazon Prime con Prime Video' },
        ],
        summary: `
          <ul>
            <li><strong>Resumen General:</strong> El sentimiento muestra un claro punto de inflexión con el lanzamiento de Meli+ en agosto. La llegada de Amazon Prime en mayo había puesto en evidencia las debilidades de la oferta de Nivel 6. Meli+ llega como una respuesta competitiva directa y robusta, siendo muy bien recibida por incluir el paquete de streaming, lo que neutraliza una de las principales ventajas de Prime.</li>
            <li><strong class="text-emerald-700">Cita Promotor:</strong> "¡Por fin! Ahora sí vale la pena. Con Meli+ tengo Disney y Max, y los envíos de siempre. Amazon llegó tarde, me quedo con Meli." (Facebook)</li>
            <li><strong class="text-rose-700">Cita Detractor:</strong> "Me llegó el correo para pasar a Meli+ pero el link no funciona, llevo dos días intentando activar Disney+ y nada. Mal comienzo." (SIC - radicado en línea)</li>
          </ul>
        `
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      {
        "id": 1,
        "entity": "Paramount Global",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "Skydance Merger with Paramount Global Officially Closes, National Amusements Cedes Control",
        "url": "https://variety.com/2025/biz/news/skydance-paramount-global-merger-closes-123612325/",
        "date": "29-08-2025",
        "category": "Fusión/Adquisición",
        "summary": "La fusión de Skydance con Paramount Global se ha completado, marcando el fin del control de National Amusements. Se espera una revisión estratégica del portafolio de activos, incluyendo Paramount+ y los estudios.",
        "publisher": "variety.com",
        "language": "en"
      },
      {
        "id": 2,
        "entity": "OpenAI (ChatGPT Premium)",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "OpenAI Announces General Availability of GPT-5, Setting New Benchmark in Multimodal AI Capabilities",
        "url": "https://openai.com/blog/announcing-gpt-5",
        "date": "27-08-2025",
        "category": "Flagship AI",
        "summary": "OpenAI ha lanzado oficialmente GPT-5 para todos los usuarios de ChatGPT Premium y a través de su API. El nuevo modelo presenta capacidades multimodales avanzadas y un razonamiento significativamente mejorado, impactando directamente el panorama competitivo de la IA.",
        "publisher": "openai.com",
        "language": "en"
      },
      {
        "id": 3,
        "entity": "Temu",
        "country": "México",
        "impact": "Medio",
        "title": "Temu Pilots 'Temu Express' Paid Subscription for Expedited Shipping in Mexico and Brazil",
        "url": "https://www.reuters.com/technology/temu-pilots-express-paid-shipping-latin-america-2025-08-25/",
        "date": "25-08-2025",
        "category": "Producto",
        "summary": "Temu ha iniciado un programa piloto en México y Brasil para una suscripción paga, 'Temu Express', que ofrece envíos más rápidos y otros beneficios, compitiendo directamente con los modelos de lealtad de Amazon Prime y Meli+.",
        "publisher": "reuters.com",
        "language": "en"
      },
      {
        "id": 4,
        "entity": "Nubank Ultravioleta",
        "country": "Brasil",
        "impact": "Medio",
        "title": "Nubank Expands Ultravioleta Benefits with Global Travel Insurance and Airport Lounge Access",
        "url": "https://blog.nubank.com.br/ultravioleta-novos-beneficios-viagem-2025/",
        "date": "22-08-2025",
        "category": "Producto",
        "summary": "Nubank ha fortalecido su oferta premium, Ultravioleta, añadiendo seguro de viaje global y acceso a salas VIP en aeropuertos, aumentando su atractivo para el segmento de alta renta y compitiendo con beneficios de tarjetas de crédito tradicionales y programas como Meli+.",
        "publisher": "blog.nubank.com.br",
        "language": "pt"
      }
    ];
    const contentNewsData = [
      {
        "id": 101,
        "entity": "Paramount+",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "Post-Merger Strategy: New Leadership at Paramount+ to Focus on 'Franchise Hubs' and Profitability",
        "url": "https://www.hollywoodreporter.com/business/business-news/paramount-plus-new-strategy-franchise-hubs-1235110101/",
        "date": "01-09-2025",
        "category": "Estrategia",
        "summary": "Tras la fusión con Skydance, la nueva dirección de Paramount+ planea reorganizar la plataforma en torno a 'hubs' de franquicias clave (como Star Trek, Mission: Impossible) y priorizar la rentabilidad sobre el crecimiento de suscriptores a toda costa.",
        "publisher": "hollywoodreporter.com",
        "language": "en"
      },
      {
        "id": 102,
        "entity": "Netflix",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Netflix Expands Live Sports Offering with Multi-Year Global Deal for Formula E Racing",
        "url": "https://about.netflix.com/en/news/formula-e-races-to-netflix",
        "date": "28-08-2025",
        "category": "Derechos/Deportes",
        "summary": "Netflix aseguró los derechos de transmisión global para el campeonato de Fórmula E, continuando su incursión en deportes en vivo y buscando atraer a una nueva demografía de suscriptores interesados en el automovilismo.",
        "publisher": "about.netflix.com",
        "language": "en"
      },
      {
        "id": 103,
        "entity": "OpenAI",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "OpenAI Announces General Availability of GPT-5, Setting New Benchmark in Multimodal AI Capabilities",
        "url": "https://openai.com/blog/announcing-gpt-5",
        "date": "27-08-2025",
        "category": "Flagship AI",
        "summary": "OpenAI ha lanzado oficialmente GPT-5, accesible para suscriptores de ChatGPT Premium y vía API. El modelo introduce un rendimiento superior en tareas de razonamiento complejo y capacidades nativas de video y audio, redefiniendo las expectativas para las aplicaciones de IA.",
        "publisher": "openai.com",
        "language": "en"
      },
      {
        "id": 104,
        "entity": "Max",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Warner Bros. Discovery CEO Signals Further Content Library Consolidation for Max in 2026",
        "url": "https://www.wsj.com/articles/wbd-ceo-on-max-strategy-and-content-consolidation-in-2026-a1b2c3d4",
        "date": "26-08-2025",
        "category": "Estrategia",
        "summary": "En una conferencia de inversores, el CEO de WBD indicó que la compañía continuará optimizando su biblioteca de contenido en Max, licenciando más títulos a terceros para generar ingresos y reducir costos, una estrategia que podría afectar la percepción de valor del catálogo.",
        "publisher": "wsj.com",
        "language": "en"
      },
      {
        "id": 105,
        "entity": "Spotify",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Spotify Introduces AI-Powered 'Podcast Studio' Feature Allowing Creators to Generate Audio from Text",
        "url": "https://newsroom.spotify.com/2025/08/21/introducing-podcast-studio-ai-feature/",
        "date": "21-08-2025",
        "category": "Producto",
        "summary": "Spotify ha lanzado una nueva herramienta en beta, 'Podcast Studio', que utiliza IA para convertir guiones de texto en audio con voces sintéticas de alta calidad, buscando democratizar la creación de podcasts en su plataforma.",
        "publisher": "newsroom.spotify.com",
        "language": "en"
      }
    ];

    /* ===== LISTAS MAESTRAS PARA MOSTRAR TODOS LOS FILTROS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta', 'Paramount Global', 'Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ].sort();
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ].sort();

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ].sort();
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ].sort();

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de URL (sanitizar/host) ==== */
    function sanitizeUrl(u) {
      if (!u) return '#';
      const raw = String(u).trim();
      const withProto = /^https?:\/\//i.test(raw) ? raw : `https://${raw.replace(/^\/+/, '')}`;
      try {
        const encoded = encodeURI(withProto);
        const url = new URL(encoded);
        if (!/^https?:$/.test(url.protocol)) return '#';
        return url.href;
      } catch { return '#'; }
    }
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin mostrar impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Países' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
               class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin mostrar impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
               class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros desde listas maestras ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      const html = [
        `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}all" value="all" class="mr-2"><label for="${idBase}all">Todos</label></div>`,
        ...allItems.map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${c.replace(/\s/g, '')}" value="${c}" class="mr-2"><label for="${idBase}${c.replace(/\s/g, '')}">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES.filter(c => c!=='Todos los Países'), 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES.filter(c => c!=='Todos los Países'), 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category-');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }
    function normalizeSelectAll(container, selectedValues) {
      const allBox = container.querySelector('input[value="all"]');
      const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b.value !== 'all');
      if (!allBox) return;
      if (selectedValues.includes('all')) rest.forEach(b => b.checked = false);
      else if (rest.some(b => b.checked)) allBox.checked = false;
    }
    function filterNews() {
      let sc = getSelected(newsFilterCountryContainer);
      let se = getSelected(newsFilterCompanyContainer);
      let sk = getSelected(newsFilterCategoryContainer);
      normalizeSelectAll(newsFilterCountryContainer, sc);
      normalizeSelectAll(newsFilterCompanyContainer, se);
      normalizeSelectAll(newsFilterCategoryContainer, sk);
      sc = getSelected(newsFilterCountryContainer);
      se = getSelected(newsFilterCompanyContainer);
      sk = getSelected(newsFilterCategoryContainer);
      newsFilters.country = sc.includes('all') ? [] : sc;
      newsFilters.company = se.includes('all') ? [] : se;
      newsFilters.category = sk.includes('all') ? [] : sk;
      renderNewsCards();
    }
    function filterContentNews() {
      let sc = getSelected(contentFilterCountryContainer);
      let se = getSelected(contentFilterCompanyContainer);
      let sk = getSelected(contentFilterCategoryContainer);
      normalizeSelectAll(contentFilterCountryContainer, sc);
      normalizeSelectAll(contentFilterCompanyContainer, se);
      normalizeSelectAll(contentFilterCategoryContainer, sk);
      sc = getSelected(contentFilterCountryContainer);
      se = getSelected(contentFilterCompanyContainer);
      sk = getSelected(contentFilterCategoryContainer);
      contentFilters.country = sc.includes('all') ? [] : sc;
      contentFilters.company = se.includes('all') ? [] : se;
      contentFilters.category = sk.includes('all') ? [] : sk;
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    updateSentimentContent('Brasil');
    updateNewsFilters(); renderNewsCards();
    updateContentNewsFilters(); renderContentNewsCards();
  </script>
</body>
</html>