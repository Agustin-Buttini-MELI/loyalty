<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
    details summary { list-style: none; }
    details summary::-webkit-details-marker { display: none; }
    details summary > svg { transition: transform 0.2s; }
    details[open] summary > svg { transform: rotate(180deg); }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">An√°lisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evoluci√≥n de la percepci√≥n de los clientes en funci√≥n de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">√çndice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section id="glosario" class="bg-white rounded-lg shadow-md border border-gray-200 mb-8">
        <details>
            <summary class="cursor-pointer w-full flex items-center justify-between px-4 py-3 text-left text-gray-800 font-semibold hover:bg-gray-50">
                <span>üìñ Glosario</span>
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
            </summary>
            <div class="px-4 pb-4 text-sm text-gray-700 space-y-4 border-t border-gray-200 pt-3">
                <div>
                  <p class="font-semibold mb-1">Niveles de sentimiento</p>
                  <ul class="list-disc list-inside space-y-1">
                    <li><span class="text-emerald-700 font-medium">Muy alto:</span> ‚â•55% menciones ponderadas o +10 p.p. vs. promedio 3m.</li>
                    <li><span class="text-emerald-600 font-medium">Alto:</span> 50‚Äì54% o +5 a +9 p.p.</li>
                    <li><span class="text-gray-700 font-medium">Estable:</span> cambio ‚â§¬±3 p.p. vs. mes previo.</li>
                    <li><span class="text-rose-600 font-medium">Bajo:</span> 30‚Äì39% o ‚àí5 a ‚àí9 p.p.</li>
                    <li><span class="text-rose-700 font-medium">Muy bajo:</span> ‚â§29% o ca√≠da ‚â•‚àí10 p.p.</li>
                  </ul>
                </div>
                <div>
                  <p class="font-semibold mb-1">Menci√≥n</p>
                  <p>
                    Comentario individual capturado en fuentes monitorizadas (Reclame Aqui, SERNAC, Apestan.com, tuquejasuma, SIC, redes, foros, comentarios en noticias).
                    Tras limpieza/deduplicaci√≥n, cada menci√≥n se pondera por <em>engagement</em>, <em>recencia</em>, <em>credibilidad</em> y <em>severidad</em>.
                    La suma ponderada genera el √≠ndice mensual (0‚Äì100).
                  </p>
                </div>
            </div>
        </details>
    </section>

    <section class="mb-8">
      <div class="flex flex-wrap justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-4 md:px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="M√©xico" class="tab-btn px-4 md:px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">M√©xico</button>
        <button data-country="Chile" class="tab-btn px-4 md:px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-4 md:px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-4 md:px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por Pa√≠s: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualizaci√≥n interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        sentimentIndex: [75, 72, 73, 74, 68, 55, 60, 61, 70, 50, 48, 52, 54, 55],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Meli+ 120% CDI' },
          { month: 'Jun 25', text: 'Cambio env√≠o gratis' }
        ],
        table: [
          { mes: 'Oct 25', detractores: 'Bajo', motivosDet: 'Costo de env√≠o', promotores: 'Alto', motivosPro: 'Rendimiento CDI', eventos: 'Estabilizaci√≥n post-cambios', competencia: 'Amazon refuerza log√≠stica' },
          { mes: 'Sep 25', detractores: 'Bajo', motivosDet: 'Costo de env√≠o', promotores: 'Alto', motivosPro: 'Rendimiento CDI', eventos: 'Recuperaci√≥n gradual', competencia: 'Shopee con cupones agresivos' },
          { mes: 'Ago 25', detractores: 'Bajo', motivosDet: 'Costo de env√≠o', promotores: 'Alto', motivosPro: 'Rendimiento CDI', eventos: 'Recuperaci√≥n post-Prime Day', competencia: 'Magalu anuncia nueva tarjeta' },
          { mes: 'Jul 25', detractores: 'Muy bajo', motivosDet: 'Cambio env√≠o gratis', promotores: 'Estable', motivosPro: 'Rendimiento CDI', eventos: 'Impacto post-cambio env√≠o', competencia: 'Amazon Prime Day' },
          { mes: 'Jun 25', detractores: 'Muy bajo', motivosDet: 'Cambio env√≠o gratis', promotores: 'Estable', motivosPro: 'Rendimiento CDI', eventos: 'Env√≠o gratis general ‚â• R$19,90', competencia: 'Lanzamiento de nuevas funciones en PicPay' },
          { mes: 'May 25', detractores: 'Estable', motivosDet: 'Cashback', promotores: 'Muy alto', motivosPro: 'Rendimiento 120% CDI', eventos: 'Meli+ ofrece 120% CDI', competencia: 'Nubank Ultravioleta con nuevos beneficios' }
        ],
        summary: `<ul><li><strong>Punto clave detractor:</strong> La modificaci√≥n en la pol√≠tica de env√≠os gratis en junio gener√≥ una ca√≠da abrupta y sostenida del sentimiento, siendo el principal detractor hasta la fecha.</li><li><strong>Punto clave promotor:</strong> El beneficio de rendimiento al 120% del CDI en mayo fue un gran acierto, creando una base de promotores s√≥lida que contrarresta parcialmente las quejas log√≠sticas.</li></ul><blockquote class="mt-4 p-4 bg-gray-50 border-l-4 border-gray-300"><p class="italic text-gray-700">"O Meli+ s√≥ valia a pena pelo frete gr√°tis em qualquer coisa. Agora com esse limite de R$19,90 virou um Prime piorado. Sorte que o rendimento da conta ainda salva."</p><footer class="text-sm text-gray-500 mt-2">‚Äî Usuario en Reclame Aqui (Brasil)</footer></blockquote><blockquote class="mt-4 p-4 bg-gray-50 border-l-4 border-gray-300"><p class="italic text-gray-700">"Coloquei meu dinheiro no cofrinho do Meli+ rendendo 120% do CDI, isso nenhum outro faz. S√≥ por isso j√° pago a assinatura com gosto."</p><footer class="text-sm text-gray-500 mt-2">‚Äî Usuario en YouTube (Brasil)</footer></blockquote>`
      },
      "M√©xico": {
        sentimentIndex: [78, 75, 76, 77, 70, 58, 62, 64, 72, 65, 63, 66, 68, 70],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Hot Sale / Lanza NU+' }
        ],
        table: [
          { mes: 'Oct 25', detractores: 'Estable', motivosDet: 'Disney+ con anuncios', promotores: 'Muy alto', motivosPro: 'Velocidad env√≠o', eventos: 'Recuperaci√≥n de confianza', competencia: 'Amazon con ofertas agresivas' },
          { mes: 'Sep 25', detractores: 'Estable', motivosDet: 'Cashback', promotores: 'Alto', motivosPro: 'Velocidad env√≠o', eventos: 'Mes de estabilizaci√≥n', competencia: 'Walmart Connect expande publicidad' },
          { mes: 'Jun 25', detractores: 'Bajo', motivosDet: 'Post-Hot Sale', promotores: 'Alto', motivosPro: 'Ofertas y env√≠os', eventos: 'Ca√≠da post-evento comercial', competencia: 'Liverpool con ventas nocturnas' },
          { mes: 'May 25', detractores: 'Bajo', motivosDet: 'Competencia (NU+)', promotores: 'Muy alto', motivosPro: 'Descuentos Hot Sale', eventos: 'Hot Sale MX', competencia: 'Nubank lanza su programa de lealtad NU+' },
          { mes: 'Feb 25', detractores: 'Muy bajo', motivosDet: 'Reducci√≥n cashback', promotores: 'Estable', motivosPro: 'Beneficios streaming', eventos: 'Cambio % de cashback en tarjeta', competencia: 'Klar anuncia nueva ronda de inversi√≥n' }
        ],
        summary: `<ul><li><strong>Punto clave detractor:</strong> La reducci√≥n del cashback en febrero fue el golpe m√°s duro al sentimiento, seguido por la percepci√≥n de menor valor en el combo de streaming tras la inclusi√≥n de anuncios en Disney+.</li><li><strong>Punto clave promotor:</strong> La log√≠stica (velocidad y confiabilidad del env√≠o) sigue siendo el pilar de la propuesta de valor, especialmente reforzado durante eventos como el Hot Sale.</li></ul><blockquote class="mt-4 p-4 bg-gray-50 border-l-4 border-gray-300"><p class="italic text-gray-700">"Le bajaron al cashback de la tarjeta y ahora el Disney+ que te dan viene con anuncios. ¬øCu√°l es el chiste de pagar Meli+ entonces? Solo por los env√≠os ya no me convence tanto."</p><footer class="text-sm text-gray-500 mt-2">‚Äî Usuario en apestan.com (M√©xico)</footer></blockquote><blockquote class="mt-4 p-4 bg-gray-50 border-l-4 border-gray-300"><p class="italic text-gray-700">"En Hot Sale aprovech√© como nunca, todo me lleg√≥ al d√≠a siguiente. La neta, para compras grandes, Meli+ sigue siendo el rey."</p><footer class="text-sm text-gray-500 mt-2">‚Äî Usuario en X/Twitter (M√©xico)</footer></blockquote>`
      },
      "Chile": {
        sentimentIndex: [65, 66, 67, 68, 62, 63, 64, 80, 77, 76, 74, 75, 76, 77],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25'],
        events: [
          { month: 'Abr 25', text: 'Nuevos beneficios' }
        ],
        table: [
          { mes: 'Oct 25', detractores: 'Estable', motivosDet: 'Pocas cuotas sin inter√©s', promotores: 'Muy alto', motivosPro: 'Nuevos beneficios', eventos: 'Sentimiento positivo consolidado', competencia: 'Falabella con descuentos CMR agresivos' },
          { mes: 'May 25', detractores: 'Estable', motivosDet: 'UI confusa', promotores: 'Muy alto', motivosPro: 'Descuentos y env√≠os', eventos: 'Normalizaci√≥n post-lanzamiento', competencia: 'Ripley GO acelera entregas' },
          { mes: 'Abr 25', detractores: 'Estable', motivosDet: 'Costo suscripci√≥n', promotores: 'Muy alto', motivosPro: 'Nuevos beneficios (Universal+)', eventos: 'Lanzamiento de nuevos beneficios Meli+ Chile', competencia: 'Amazon anuncia expansi√≥n de cat√°logo' }
        ],
        summary: `<ul><li><strong>Punto clave detractor:</strong> Las quejas son minoritarias y se centran en la falta de m√°s opciones de cuotas sin inter√©s, un diferenciador clave de la competencia local (Falabella, Ripley).</li><li><strong>Punto clave promotor:</strong> La renovaci√≥n de beneficios en abril, incluyendo nuevos servicios de streaming y descuentos, fue un √©xito rotundo que elev√≥ el sentimiento a niveles r√©cord para el pa√≠s.</li></ul><blockquote class="mt-4 p-4 bg-gray-50 border-l-4 border-gray-300"><p class="italic text-gray-700">"Ahora que Meli+ trae Universal+ y mejores descuentos en el supermercado, de verdad que se paga solo. Lo mejor que han hecho en mucho tiempo."</p><footer class="text-sm text-gray-500 mt-2">‚Äî Usuario en Instagram (Chile)</footer></blockquote>`
      },
      "Argentina": {
        sentimentIndex: [55, 56, 54, 52, 48, 49, 50, 51, 65, 62, 60, 59, 60, 61],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25'],
        events: [
          { month: 'May 25', text: 'Lanzamiento Meli+' }
        ],
        table: [
          { mes: 'Jun 25', detractores: 'Bajo', motivosDet: 'Precio y devaluaci√≥n', promotores: 'Alto', motivosPro: 'Combo streaming', eventos: 'Normalizaci√≥n del sentimiento', competencia: 'Ual√° expande programa de puntos' },
          { mes: 'May 25', detractores: 'Bajo', motivosDet: 'Confusi√≥n migraci√≥n N6', promotores: 'Alto', motivosPro: 'Propuesta de valor', eventos: 'Lanzamiento de Meli+ (reemplaza Nivel 6)', competencia: 'Movimientos en billeteras virtuales' }
        ],
        summary: `<ul><li><strong>Punto clave detractor:</strong> El principal detractor es el costo de la suscripci√≥n en un contexto inflacionario, donde los usuarios cuestionan cada gasto fijo.</li><li><strong>Punto clave promotor:</strong> El lanzamiento de Meli+ fue bien recibido al unificar y clarificar los beneficios, especialmente el paquete de streaming (Disney+/Star+), percibido como un gran ahorro.</li></ul><blockquote class="mt-4 p-4 bg-gray-50 border-l-4 border-gray-300"><p class="italic text-gray-700">"Me pasaron de Nivel 6 a Meli+ y al principio no entend√≠a, pero ahora veo que por lo que pago tengo Disney y Star+, que por separado me saldr√≠an el triple. Con la inflaci√≥n que hay, re vale la pena."</p><footer class="text-sm text-gray-500 mt-2">‚Äî Usuario en tuquejasuma.com (Argentina)</footer></blockquote>`
      },
      "Colombia": {
        sentimentIndex: [68, 69, 70, 71, 65, 66, 67, 60, 62, 63, 75, 72, 73, 74],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25'],
        events: [
          { month: 'May 25', text: 'Amazon Prime llega a CO' },
          { month: 'Ago 25', text: 'Lanzamiento Meli+' }
        ],
        table: [
          { mes: 'Sep 25', detractores: 'Estable', motivosDet: 'Costo vs. Prime', promotores: 'Muy alto', motivosPro: 'Beneficios y env√≠os', eventos: 'Sentimiento positivo post-lanzamiento', competencia: 'Rappi Pro con nuevas alianzas' },
          { mes: 'Ago 25', detractores: 'Estable', motivosDet: 'Confusi√≥n migraci√≥n', promotores: 'Muy alto', motivosPro: 'Propuesta de valor', eventos: 'Lanzamiento de Meli+ (reemplaza Nivel 6)', competencia: 'Alkosto con promociones agresivas' },
          { mes: 'May 25', detractores: 'Bajo', motivosDet: 'Comparativas con Prime', promotores: 'Alto', motivosPro: 'Env√≠os r√°pidos', eventos: 'Contexto de alta competencia', competencia: 'Amazon Prime llega a Colombia' }
        ],
        summary: `<ul><li><strong>Punto clave detractor:</strong> La llegada de Amazon Prime en mayo gener√≥ una ola de comparaciones de precios y beneficios que afect√≥ temporalmente el sentimiento.</li><li><strong>Punto clave promotor:</strong> El lanzamiento de Meli+ en agosto fue una respuesta contundente, con una propuesta de valor percibida como superior (especialmente por el combo de streaming), generando un pico de sentimiento muy positivo.</li></ul><blockquote class="mt-4 p-4 bg-gray-50 border-l-4 border-gray-300"><p class="italic text-gray-700">"Cuando lleg√≥ Amazon Prime pens√© en cambiarme, pero Meli acaba de lanzar Meli+ y me da Disney y Star Plus. Por esa plata, no hay competencia."</p><footer class="text-sm text-gray-500 mt-2">‚Äî Usuario en SIC (Colombia)</footer></blockquote>`
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      { "id": 1, "entity": "Amazon Prime", "country": "Brasil", "impact": "Alto", "title": "Amazon completa la adquisici√≥n de Loggi para fortalecer su red log√≠stica en Brasil", "url": "https://www.aboutamazon.com/news/company-news/amazon-completes-loggi-acquisition-brazil", "date": "25-10-2025", "category": "Fusi√≥n/Adquisici√≥n", "summary": "Impacto directo en la promesa de entrega de Amazon Prime, aumentando la presi√≥n competitiva sobre los tiempos de env√≠o de Meli+ en un mercado clave." },
      { "id": 4, "entity": "Shein", "country": "Todos los Pa√≠ses", "impact": "Medio", "title": "Shein anuncia inversi√≥n de $500M para expandir su red de proveedores en Am√©rica Latina", "url": "https://www.sheingroup.com/press/shein-announces-500m-investment-to-expand-latin-america-supplier-network", "date": "23-10-2025", "category": "Estrategia", "summary": "Movimiento estrat√©gico para reducir tiempos de entrega y dependencia de China, compitiendo m√°s directamente con el marketplace de Meli." },
      { "id": 2, "entity": "Temu", "country": "M√©xico", "impact": "Medio", "title": "Temu enfrenta nuevo escrutinio regulatorio en M√©xico por pr√°cticas de privacidad de datos", "url": "https://www.reuters.com/technology/temu-faces-new-regulatory-scrutiny-mexico-over-data-privacy-2025-10-20/", "date": "20-10-2025", "category": "Sanci√≥n Legal", "summary": "Riesgo reputacional para Temu que podr√≠a beneficiar a Meli si los usuarios buscan plataformas m√°s confiables. Monitorear posible sanci√≥n." },
      { "id": 3, "entity": "Rappi Pro", "country": "Colombia", "impact": "Medio", "title": "Rappi ampl√≠a los beneficios de Rappi Pro en Colombia con un nuevo socio bancario", "url": "https://blog.rappi.com/noticias/rappi-pro-alianza-bancolombia-nuevos-beneficios", "date": "18-10-2025", "category": "Producto", "summary": "Mejora la propuesta de valor de la competencia directa en el segmento de suscripciones. Analizar los nuevos beneficios vs. Meli+." }
    ];
    const contentNewsData = [
      { "id": 103, "entity": "OpenAI", "country": "Todos los Pa√≠ses", "impact": "Alto", "title": "OpenAI anuncia disponibilidad general de la API GPT-5 Turbo para clientes empresariales", "url": "https://openai.com/blog/gpt-5-turbo-api-now-generally-available", "date": "26-10-2025", "category": "Flagship AI", "summary": "Nuevo modelo insignia establece un est√°ndar en IA, relevante para la estrategia de Meli en asistentes de compra, b√∫squeda y atenci√≥n al cliente." },
      { "id": 102, "entity": "Disney+", "country": "Todos los Pa√≠ses", "impact": "Alto", "title": "Disney obtiene derechos exclusivos de transmisi√≥n de la Premier League para Am√©rica Latina", "url": "https://thewaltdisneycompany.com/disney-secures-exclusive-premier-league-rights-latam/", "date": "24-10-2025", "category": "Derechos/Deportes", "summary": "Fortalece significativamente el paquete de contenido de Disney+/Star+, aumentando su atractivo y el valor percibido del combo incluido en Meli+." },
      { "id": 104, "entity": "Max", "country": "Todos los Pa√≠ses", "impact": "Medio", "title": "Warner Bros. Discovery reporta resultados del Q3, no alcanza las estimaciones de suscriptores de streaming", "url": "https://wbd.com/newsroom/press-releases/2025/10/23/warner-bros-discovery-reports-third-quarter-2025-results/", "date": "23-10-2025", "category": "Resultados Financieros", "summary": "Se√±ales de desaceleraci√≥n en un competidor de contenido clave, lo que puede indicar saturaci√≥n del mercado o debilidades en su cat√°logo." },
      { "id": 101, "entity": "Netflix", "country": "Todos los Pa√≠ses", "impact": "Alto", "title": "Netflix confirma aumento de precios global para planes sin publicidad a partir de noviembre", "url": "https://about.netflix.com/en/news/updating-our-prices-in-select-countries-2025", "date": "22-10-2025", "category": "Cambio de Precio", "summary": "Abre una ventana de oportunidad para Meli+ al encarecer un servicio competidor por el gasto discrecional del consumidor." },
      { "id": 105, "entity": "Spotify", "country": "Todos los Pa√≠ses", "impact": "Medio", "title": "Spotify lanza nueva funci√≥n de descubrimiento de \"Eventos en Vivo\" integrada con plataformas de venta de entradas", "url": "https://newsroom.spotify.com/2025-10-19/discover-live-events-near-you-with-our-newest-feature/", "date": "19-10-2025", "category": "Producto", "summary": "Spotify se expande m√°s all√° de la m√∫sica grabada hacia la experiencia en vivo, diversificando su propuesta de valor." }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','M√©xico','Todos los Pa√≠ses'];
    const ALL_NEWS_COMPANIES = ['Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+','Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ual√°','Cablevisi√≥n Flow','Amazon Prime Video','DGO','Mach'];
    const ALL_NEWS_CATEGORIES = ['Cambio de Precio','Lanzamiento','Fusi√≥n/Adquisici√≥n','Sanci√≥n Legal','Estrategia','Producto','Resultados Financieros','Derechos/Deportes','Flagship AI'];
    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','M√©xico','Todos los Pa√≠ses'];
    const ALL_CONTENT_COMPANIES = ['Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'];
    const ALL_CONTENT_CATEGORIES = ['Cambio de Precio','Lanzamiento','Fusi√≥n/Adquisici√≥n','Sanci√≥n Legal','Estrategia','Producto','Resultados Financieros','Derechos/Deportes','Flagship AI'];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gr√°fico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: '√çndice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: '√çndice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      if (!rows || rows.length === 0) {
        sentimentTableBody.innerHTML = `<tr><td colspan="7" class="text-center py-8 text-gray-500">No hay datos tabulares para este pa√≠s.</td></tr>`;
        return;
      }
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-rose-50 text-rose-700 ring-1 ring-inset ring-rose-600/10">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-emerald-50 text-emerald-700 ring-1 ring-inset ring-emerald-600/10">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    function getCategoryTag(category) {
        const categories = {
            'Sanci√≥n Legal': 'bg-red-100 text-red-800',
            'Cambio de Precio': 'bg-yellow-100 text-yellow-800',
            'Lanzamiento': 'bg-blue-100 text-blue-800',
            'Fusi√≥n/Adquisici√≥n': 'bg-green-100 text-green-800',
            'Estrategia': 'bg-purple-100 text-purple-800',
            'Producto': 'bg-orange-100 text-orange-800',
            'Resultados Financieros': 'bg-teal-100 text-teal-800',
            'Derechos/Deportes': 'bg-indigo-100 text-indigo-800',
            'Flagship AI': 'bg-pink-100 text-pink-800'
        };
        const colors = categories[category] || 'bg-gray-100 text-gray-800';
        return `<span class="${colors} text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
    }

    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    function renderNewsCards(data, grid, noResults) {
      grid.innerHTML = '';
      const filtered = data.filter(item => {
        const filters = grid.id.includes('content') ? contentFilters : newsFilters;
        const cm = filters.country.length === 0 || filters.country.includes('all') || filters.country.includes(item.country);
        const em = filters.company.length === 0 || filters.company.includes('all') || filters.company.includes(item.entity);
        const km = filters.category.length === 0 || filters.category.includes('all') || filters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      
      noResults.classList.toggle('hidden', filtered.length > 0);
      grid.classList.toggle('hidden', filtered.length === 0);

      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-lg transition-shadow duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg pr-2">${row.entity}${row.country && row.country !== 'Todos los Pa√≠ses' ? ` (${row.country})` : ''}</h4>
              <div class="flex-shrink-0">${getCategoryTag(row.category)}</div>
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '‚Äî'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        grid.appendChild(card);
      });
    }

    function populateCheckboxes(container, allItems, group) {
      const uniqueItems = [...new Set(allItems)].sort();
      const html = [
        `<div class="filter-checkbox-item"><input type="checkbox" id="${group}all" value="all" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="${group}all" class="ml-2 text-sm text-gray-700">Todos</label></div>`,
        ...uniqueItems.map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${group}${c.replace(/\s/g, '')}" value="${c}" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="${group}${c.replace(/\s/g, '')}" class="ml-2 text-sm text-gray-700">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function getSelected(container) { return Array.from(container.querySelectorAll('input:checked')).map(i => i.value); }
    function normalizeSelectAll(container) {
      const allBox = container.querySelector('input[value="all"]');
      if (!allBox) return;
      const restBoxes = Array.from(container.querySelectorAll('input:not([value="all"])'));
      if (allBox.checked) {
        restBoxes.forEach(box => box.checked = false);
      } else if (restBoxes.every(box => !box.checked)) {
        allBox.checked = true;
      }
    }

    function setupFilters(container, data, renderFn, filterState) {
      const countries = ['Todos los Pa√≠ses', ...new Set(data.map(d => d.country).filter(Boolean))];
      const companies = [...new Set(data.map(d => d.entity))];
      const categories = [...new Set(data.map(d => d.category))];

      populateCheckboxes(container.country, countries, `${container.idPrefix}-country-`);
      populateCheckboxes(container.company, companies, `${container.idPrefix}-company-`);
      populateCheckboxes(container.category, categories, `${container.idPrefix}-category-`);

      const filterHandler = () => {
        normalizeSelectAll(container.country);
        normalizeSelectAll(container.company);
        normalizeSelectAll(container.category);

        filterState.country = getSelected(container.country).filter(v => v !== 'all');
        filterState.company = getSelected(container.company).filter(v => v !== 'all');
        filterState.category = getSelected(container.category).filter(v => v !== 'all');
        
        if (getSelected(container.country).includes('all') || filterState.country.length === 0) filterState.country = [];
        if (getSelected(container.company).includes('all') || filterState.company.length === 0) filterState.company = [];
        if (getSelected(container.category).includes('all') || filterState.category.length === 0) filterState.category = [];

        renderFn();
      };

      [container.country, container.company, container.category].forEach(c => c.addEventListener('change', filterHandler));
      
      container.resetBtn.addEventListener('click', () => {
          [container.country, container.company, container.category].forEach(c => {
              c.querySelectorAll('input').forEach(i => i.checked = false);
          });
          filterHandler();
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
        tabButtons.forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        updateSentimentContent(e.target.dataset.country);
      }));
      updateSentimentContent('Brasil');

      setupFilters({
        country: newsFilterCountryContainer,
        company: newsFilterCompanyContainer,
        category: newsFilterCategoryContainer,
        resetBtn: document.getElementById('news-reset-filters'),
        idPrefix: 'news'
      }, newsData, () => renderNewsCards(newsData, alertsGrid, newsNoResults), newsFilters);

      setupFilters({
        country: contentFilterCountryContainer,
        company: contentFilterCompanyContainer,
        category: contentFilterCategoryContainer,
        resetBtn: document.getElementById('content-reset-filters'),
        idPrefix: 'content'
      }, contentNewsData, () => renderNewsCards(contentNewsData, contentAlertsGrid, contentNewsNoResults), contentFilters);

      renderNewsCards(newsData, alertsGrid, newsNoResults);
      renderNewsCards(contentNewsData, contentAlertsGrid, contentNewsNoResults);
    });
  </script>
</body>
</html>