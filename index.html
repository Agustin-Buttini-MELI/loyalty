<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
    /* flecha del summary */
    details summary { list-style: none; }
    details summary::-webkit-details-marker { display: none; }
    details[open] summary svg { transform: rotate(180deg); }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">An√°lisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evoluci√≥n de la percepci√≥n de los clientes en funci√≥n de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">√çndice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <!-- GLOSARIO (nativo con <details>, sin JS) -->
    <details id="glosario" class="bg-white rounded-lg shadow-md border border-gray-200 mb-8">
      <summary class="cursor-pointer w-full flex items-center justify-between px-4 py-3 text-left text-gray-800 font-semibold hover:bg-gray-50">
        <span>üìñ Glosario</span>
        <svg class="w-5 h-5 text-gray-500 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </summary>
      <div class="px-4 pb-4 text-sm text-gray-700" id="glosario-content">
        <div class="pt-2 space-y-4">
          <div>
            <p class="font-semibold mb-1">Niveles de sentimiento</p>
            <ul class="list-disc list-inside space-y-1">
              <li><span class="text-emerald-700 font-medium">Muy alto:</span> ‚â•55% menciones ponderadas o +10 p.p. vs. promedio 3m.</li>
              <li><span class="text-emerald-600 font-medium">Alto:</span> 50‚Äì54% o +5 a +9 p.p.</li>
              <li><span class="text-gray-700 font-medium">Estable:</span> cambio ‚â§¬±3 p.p. vs. mes previo.</li>
              <li><span class="text-rose-600 font-medium">Bajo:</span> 30‚Äì39% o ‚àí5 a ‚àí9 p.p.</li>
              <li><span class="text-rose-700 font-medium">Muy bajo:</span> ‚â§29% o ca√≠da ‚â•‚àí10 p.p.</li>
            </ul>
          </div>
          <div>
            <p class="font-semibold mb-1">Menci√≥n</p>
            <p>
              Comentario individual capturado en fuentes monitorizadas (Reclame Aqui, SERNAC, Apestan.com, tuquejasuma, SIC, redes, foros, comentarios en noticias).
              Tras limpieza/deduplicaci√≥n, cada menci√≥n se pondera por <em>engagement</em>, <em>recencia</em>, <em>credibilidad</em> y <em>severidad</em>.
              La suma ponderada genera el √≠ndice mensual (0‚Äì100).
            </p>
          </div>
          <p class="text-xs text-gray-500">Glosario est√°tico: no cambia entre corridas.</p>
        </div>
      </div>
    </details>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="M√©xico" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">M√©xico</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por Pa√≠s: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualizaci√≥n interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
        "sentimentIndex": [75, 68, 65, 72, 70, 55, 58, 62, 65, 45, 48, 52, 55, 53],
        "events": [{ "month": "Sep 24", "text": "Lanzamiento Meli+" }, { "month": "Feb 25", "text": "Cambio % cashback" }, { "month": "May 25", "text": "Meli+ con 120% CDI" }, { "month": "Jun 25", "text": "Env√≠o gratis general >= R$19,90" }],
        "table": [
          { "mes": "Oct 25", "detractores": "Estable/Bajo", "motivosDet": "Devaluaci√≥n del programa", "promotores": "Estable/Alto", "motivosPro": "Beneficios streaming", "eventos": "Discusi√≥n sobre el valor de la suscripci√≥n post-cambio de env√≠os.", "competencia": "Amazon anuncia subida de precio de Prime para Nov-25." },
          { "mes": "Sep 25", "detractores": "Bajo", "motivosDet": "Propuesta de valor", "promotores": "Alto", "motivosPro": "Ahorro en streaming", "eventos": "Recuperaci√≥n leve post-cambio de env√≠os. Se estabilizan las quejas.", "competencia": "Nubank Ultravioleta anuncia nuevo seguro de viaje." },
          { "mes": "Jun 25", "detractores": "Muy alto", "motivosDet": "Devaluaci√≥n del programa", "promotores": "Bajo", "motivosPro": "Rendimiento 120% CDI", "eventos": "Ca√≠da abrupta del sentimiento por pol√≠tica de env√≠o gratis >= R$19,90. Usuarios cuestionan el valor de Meli+.", "competencia": "Magalu anuncia 'SuperApp+' con beneficios." },
          { "mes": "May 25", "detractores": "Estable", "motivosDet": "Disney+ con anuncios", "promotores": "Alto", "motivosPro": "Rendimiento 120% CDI", "eventos": "Lanzamiento de Meli+ con rendimiento del 120% CDI genera conversaci√≥n positiva en el nicho financiero.", "competencia": "PicPay expande su programa de cashback." },
          { "mes": "Feb 25", "detractores": "Alto", "motivosDet": "Reducci√≥n de cashback", "promotores": "Estable", "motivosPro": "Env√≠os gratis", "eventos": "Cambio en el porcentaje de cashback genera quejas sobre 'nerfeo' de beneficios.", "competencia": "Shopee intensifica cupones de env√≠o gratis." }
        ],
        "summary": "<h4>Resumen Brasil</h4><p>El sentimiento en Brasil muestra una <strong>tendencia a la baja significativa desde junio de 2025</strong>, directamente correlacionada con la percepci√≥n de devaluaci√≥n del programa tras la implementaci√≥n del env√≠o gratuito general para compras bajas. Aunque el rendimiento del 120% CDI fue un punto positivo, no compens√≥ el impacto negativo en la propuesta de valor de los env√≠os.</p><ul><li>üí¨ <strong>Detractores:</strong> <em>\"Pra que assinar Meli+ agora se quase tudo tem frete gr√°tis? A vantagem era essa, agora acabou.\"</em> (Reclame Aqui)</li><li>üí¨ <strong>Promotores:</strong> <em>\"S√≥ pelo combo Disney+ e Max j√° vale a pena, o resto √© b√¥nus. O rendimento de 120% tamb√©m √© √≥timo.\"</em> (Comentario YouTube)</li></ul>"
      },
      "M√©xico": {
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
        "sentimentIndex": [78, 70, 68, 75, 72, 60, 64, 66, 62, 65, 68, 70, 71, 69],
        "events": [{ "month": "Sep 24", "text": "Lanzamiento Meli+" }, { "month": "Feb 25", "text": "Cambio % cashback" }, { "month": "May 25", "text": "Hot Sale / Lanza Nu+" }],
        "table": [
          { "mes": "Oct 25", "detractores": "Estable", "motivosDet": "Beneficios vs. competencia", "promotores": "Estable", "motivosPro": "Paquete de streaming", "eventos": "Estabilizaci√≥n del sentimiento. Usuarios comparan con Amazon Prime y Nu+.", "competencia": "Amazon anuncia subida de precio de Prime para Nov-25." },
          { "mes": "May 25", "detractores": "Alto", "motivosDet": "Log√≠stica en Hot Sale", "promotores": "Bajo", "motivosPro": "Ofertas exclusivas", "eventos": "Hot Sale genera picos de quejas por demoras en env√≠os. Lanzamiento de Nu+ por Nubank introduce fuerte competencia directa.", "competencia": "Lanzamiento de Nu+ (Nubank)." },
          { "mes": "Feb 25", "detractores": "Alto", "motivosDet": "Reducci√≥n de cashback", "promotores": "Estable", "motivosPro": "Env√≠os r√°pidos", "eventos": "Ca√≠da del sentimiento por ajuste de cashback. Quejas sobre 'menos beneficios por el mismo precio'.", "competencia": "Walmart Pass con nuevas promociones." }
        ],
        "summary": "<h4>Resumen M√©xico</h4><p>El sentimiento en M√©xico, tras una ca√≠da en febrero por el ajuste de cashback, se vio afectado en mayo por la <strong>presi√≥n competitiva de Nu+ y problemas log√≠sticos durante Hot Sale</strong>. Desde entonces, ha mostrado una lenta recuperaci√≥n, estabiliz√°ndose en un nivel moderado. El reciente anuncio de aumento de precio de Amazon Prime podr√≠a ser una oportunidad.</p><ul><li>üí¨ <strong>Detractores:</strong> <em>\"Entre que bajaron el cashback y lo que ofrece Nu+, ya no s√© si me conviene seguir con Meli+.\"</em> (Apestan.com)</li><li>üí¨ <strong>Promotores:</strong> <em>\"Tener Max y Disney+ en un solo pago y con env√≠os gratis es lo que me mantiene aqu√≠. Es muy c√≥modo.\"</em> (Reddit)</li></ul>"
      },
      "Chile": {
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
        "sentimentIndex": [65, 68, 70, 72, 74, 75, 78, 85, 82, 80, 78, 77, 76, 75],
        "events": [{ "month": "Abr 25", "text": "Nuevos beneficios Meli+" }],
        "table": [
          { "mes": "Sep 25", "detractores": "Bajo", "motivosDet": "Claridad de beneficios", "promotores": "Muy Alto", "motivosPro": "Descuentos y streaming", "eventos": "El sentimiento se mantiene alto pero con ligera tendencia a la baja a medida que se normalizan los nuevos beneficios.", "competencia": "Falabella.com con campa√±a agresiva de descuentos con tarjeta CMR." },
          { "mes": "Abr 25", "detractores": "Muy Bajo", "motivosDet": "Pocos detractores", "promotores": "Muy Alto", "motivosPro": "Nuevos descuentos", "eventos": "Pico de sentimiento positivo gracias a la adici√≥n de nuevos descuentos en comercios asociados y beneficios de streaming.", "competencia": "Ripley lanza programa de lealtad 'Ripley GO'." }
        ],
        "summary": "<h4>Resumen Chile</h4><p>El sentimiento en Chile alcanz√≥ un <strong>pico muy positivo en abril de 2025</strong> con la introducci√≥n de nuevos beneficios, posicionando a Meli+ como una oferta de valor muy s√≥lida. Desde entonces, el sentimiento se ha mantenido en niveles altos, aunque con una ligera y natural moderaci√≥n. La competencia de Falabella y Ripley es constante pero no ha logrado impactar negativamente de forma significativa.</p><ul><li>üí¨ <strong>Promotores:</strong> <em>\"Los nuevos descuentos que metieron en abril hicieron que la suscripci√≥n se pagara sola. Muy buena jugada.\"</em> (SERNAC, comentario positivo)</li></ul>"
      },
      "Argentina": {
        "labels": ["May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
        "sentimentIndex": [75, 68, 65, 67, 70, 72],
        "events": [{ "month": "May 25", "text": "Lanzamiento Meli+" }],
        "table": [
          { "mes": "Oct 25", "detractores": "Estable", "motivosDet": "Confusi√≥n con Nivel 6", "promotores": "Alto", "motivosPro": "Acceso a streaming", "eventos": "El sentimiento muestra una recuperaci√≥n y consolidaci√≥n. Usuarios valoran el paquete de streaming en un contexto de alta inflaci√≥n.", "competencia": "Ual√° lanza programa de puntos 'Ual√°+'." },
          { "mes": "May 25", "detractores": "Bajo", "motivosDet": "UI/Comunicaci√≥n", "promotores": "Muy Alto", "motivosPro": "Mejora sobre Nivel 6", "eventos": "Lanzamiento exitoso con alto sentimiento inicial. Se percibe como una mejora clara sobre el antiguo Nivel 6. Algunas quejas iniciales por la comunicaci√≥n del cambio.", "competencia": "Cablevisi√≥n Flow promociona combos con streaming." }
        ],
        "summary": "<h4>Resumen Argentina</h4><p>El lanzamiento de Meli+ en mayo de 2025 fue recibido muy positivamente, reemplazando al Nivel 6. Tras una leve ca√≠da inicial mientras los usuarios se adaptaban, el sentimiento ha mostrado una <strong>tendencia de recuperaci√≥n sostenida</strong>. El principal driver de valor es el acceso a plataformas de streaming, considerado un ahorro importante por los usuarios.</p><ul><li>üí¨ <strong>Detractores:</strong> <em>\"No entiendo bien qu√© cambi√≥ de Nivel 6 a Meli+, me parece lo mismo pero m√°s caro.\"</em> (tuquejasuma.com)</li><li>üí¨ <strong>Promotores:</strong> <em>\"Pagar por Meli+ me sale m√°s barato que pagar Disney y Max por separado. Negocio redondo.\"</em> (X/Twitter)</li></ul>"
      },
      "Colombia": {
        "labels": ["May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
        "sentimentIndex": [60, 58, 55, 70, 65, 64],
        "events": [{ "month": "May 25", "text": "Amazon Prime llega a CO" }, { "month": "Aug 25", "text": "Lanzamiento Meli+" }],
        "table": [
          { "mes": "Sep 25", "detractores": "Alto", "motivosDet": "Comparaci√≥n con Prime", "promotores": "Alto", "motivosPro": "Oferta de streaming", "eventos": "El sentimiento se modera tras el pico del lanzamiento, con muchas comparaciones directas con la oferta de Amazon Prime.", "competencia": "Rappi Pro y Amazon Prime compiten agresivamente." },
          { "mes": "Ago 25", "detractores": "Bajo", "motivosDet": "Bugs iniciales", "promotores": "Muy Alto", "motivosPro": "Mejora vs. Nivel 6", "eventos": "Lanzamiento de Meli+ genera un pico de sentimiento positivo, visto como una respuesta necesaria a la llegada de Amazon Prime.", "competencia": "Campa√±a de lanzamiento de Amazon Prime." },
          { "mes": "May 25", "detractores": "Alto (contextual)", "motivosDet": "Nivel 6 es inferior", "promotores": "Bajo (contextual)", "motivosPro": "Env√≠os gratis", "eventos": "La llegada de Amazon Prime genera conversaci√≥n negativa sobre la oferta de Mercado Libre (Nivel 6), presionando por una mejora.", "competencia": "Lanzamiento de Amazon Prime." }
        ],
        "summary": "<h4>Resumen Colombia</h4><p>El contexto en Colombia est√° marcado por la <strong>llegada de Amazon Prime en mayo de 2025</strong>, lo que gener√≥ una expectativa negativa hacia la oferta de Mercado Libre. El lanzamiento de Meli+ en agosto fue una respuesta directa y bien recibida, causando un pico de sentimiento. Actualmente, la conversaci√≥n se centra en la comparaci√≥n de beneficios directos entre Meli+ y Prime.</p><ul><li>üí¨ <strong>Detractores:</strong> <em>\"Prime lleg√≥ con env√≠os desde USA y Prime Video, Meli+ tiene que ponerse las pilas con los beneficios m√°s all√° de Disney.\"</em> (Comentario en noticia)</li><li>üí¨ <strong>Promotores:</strong> <em>\"Menos mal lanzaron Meli+, el Nivel 6 se estaba quedando cort√≠simo. Ahora s√≠ vale la pena por el combo con Max.\"</em> (Facebook)</li></ul>"
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      { "id": 1, "entity": "Amazon Prime", "country": "Brasil", "impact": "Alto", "title": "Amazon to increase Prime subscription price in Brazil and Mexico", "url": "https://www.aboutamazon.com/news/company-news/prime-price-update-brazil-mexico-2025", "date": "15-10-2025", "category": "Cambio de Precio", "summary": "Amazon announced a price adjustment for its Prime membership in Brazil and Mexico, effective for new members on October 20 and for current members on their first renewal after November 15, 2025. The company cites increased operational costs and the addition of new benefits as reasons.", "publisher": "aboutamazon.com" },
      { "id": 2, "entity": "Rappi Pro", "country": "Colombia", "impact": "Medio", "title": "Rappi Pro and Cine Colombia Announce Exclusive Partnership for Members", "url": "https://blog.rappi.com/colombia/news/rappi-pro-cine-colombia-alliance", "date": "10-10-2025", "category": "Producto", "summary": "Rappi Pro members in Colombia will now receive exclusive benefits at Cine Colombia, including 2-for-1 tickets on Tuesdays and a 15% discount on concessions. This move aims to strengthen the value proposition of the Rappi Pro subscription.", "publisher": "blog.rappi.com" },
      { "id": 3, "entity": "Shein", "country": "M√©xico", "impact": "Medio", "title": "Shein opens its largest pop-up store to date in Mexico City", "url": "https://news.yahoo.com/shein-opens-largest-pop-up-mexico-city-140000512.html", "date": "19-10-2025", "category": "Estrategia", "summary": "Shein has launched a temporary physical store in the Santa Fe shopping center, its largest pop-up in Latin America. The initiative is part of its strategy to combine its online dominance with physical retail experiences.", "publisher": "news.yahoo.com" }
    ];
    const contentNewsData = [
      { "id": 101, "entity": "Netflix", "country": "Argentina", "impact": "Alto", "title": "Netflix Secures Exclusive Streaming Rights for Argentine Primera Divisi√≥n for 2026-2030 Seasons", "url": "https://about.netflix.com/en/news/netflix-wins-argentine-primera-division-rights", "date": "18-10-2025", "category": "Derechos/Deportes", "summary": "Netflix has acquired the exclusive global streaming rights for Argentina's top football league for five seasons, starting in 2026. This marks Netflix's most significant investment in live sports in Latin America.", "publisher": "about.netflix.com" },
      { "id": 102, "entity": "OpenAI", "country": "Todos los Pa√≠ses", "impact": "Alto", "title": "OpenAI Announces GPT-4.5-Turbo, A Faster and More Efficient Model Now in Public API Beta", "url": "https://openai.com/blog/introducing-gpt-4-5-turbo", "date": "14-10-2025", "category": "Flagship AI", "summary": "OpenAI has released GPT-4.5-Turbo, an intermediate model that is reportedly 20% faster and 15% cheaper than GPT-4-Turbo. It is now available for all developers via API and will be rolled out to ChatGPT Plus users next week.", "publisher": "openai.com" },
      { "id": 103, "entity": "Disney+", "country": "Todos los Pa√≠ses", "impact": "Medio", "title": "Disney+ Sets February 2026 for Full Hulu Content Hub Integration in Latin America", "url": "https://thewaltdisneycompany.com/disney-plus-hulu-latam-integration-date/", "date": "16-10-2025", "category": "Estrategia", "summary": "The Walt Disney Company has confirmed that the full integration of the Hulu content hub into Disney+ across Latin America will be completed by February 2026. This will bring titles like 'The Handmaid's Tale' and 'Only Murders in the Building' directly into the Disney+ app.", "publisher": "thewaltdisneycompany.com" },
      { "id": 104, "entity": "Max", "country": "Brasil", "impact": "Medio", "title": "Warner Bros. Discovery names new Head of Streaming for Brazil, consolidating Max and Discovery+ leadership", "url": "https://variety.com/2025/digital/global/wbd-names-new-brazil-streaming-head-1235456789/", "date": "11-10-2025", "category": "Estrategia", "summary": "WBD has appointed a new executive to oversee its direct-to-consumer business in Brazil, unifying the strategic direction for both Max and Discovery+ under a single leader to improve efficiency and content strategy.", "publisher": "variety.com" },
      { "id": 105, "entity": "Spotify", "country": "Todos los Pa√≠ses", "impact": "Medio", "title": "Spotify Expands 'Video Podcasts' Feature to All Creators Globally", "url": "https://newsroom.spotify.com/2025-10-09/video-podcasts-for-all-creators/", "date": "09-10-2025", "category": "Producto", "summary": "Spotify announced that its Video Podcasts feature, previously in limited beta, is now available to all creators in markets where podcasts are supported. The move aims to better compete with YouTube for podcast creator talent.", "publisher": "newsroom.spotify.com" }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','M√©xico','Colombia','Todos los Pa√≠ses'];
    const ALL_NEWS_COMPANIES = Array.from(new Set(newsData.map(i => i.entity))).sort();
    const ALL_NEWS_CATEGORIES = Array.from(new Set(newsData.map(i => i.category))).sort();

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','M√©xico','Colombia','Todos los Pa√≠ses'];
    const ALL_CONTENT_COMPANIES = Array.from(new Set(contentNewsData.map(i => i.entity))).sort();
    const ALL_CONTENT_CATEGORIES = Array.from(new Set(contentNewsData.map(i => i.category))).sort();

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gr√°fico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: '√çndice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: '√çndice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      if (!rows || rows.length === 0) return;
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><div class="flex flex-wrap gap-1">${row.motivosDet.split(',').map(m => `<span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700 text-xs">${m.trim()}</span>`).join('')}</div></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><div class="flex flex-wrap gap-1">${row.motivosPro.split(',').map(m => `<span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700 text-xs">${m.trim()}</span>`).join('')}</div></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }

    function renderSummary(html) { sentimentSummary.innerHTML = html || ''; }
    
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; 
      renderChart(data); 
      renderSentimentTable(data.table); 
      renderSummary(data.summary);
    }

    /* ==== Etiquetas de categor√≠a ==== */
    function getCategoryTag(category) {
      const categoryMap = {
        'Sanci√≥n Legal': 'bg-red-100 text-red-800', 'Cambio de Precio': 'bg-yellow-100 text-yellow-800',
        'Lanzamiento': 'bg-blue-100 text-blue-800', 'Fusi√≥n/Adquisici√≥n': 'bg-green-100 text-green-800',
        'Estrategia': 'bg-purple-100 text-purple-800', 'Producto': 'bg-orange-100 text-orange-800',
        'Resultados Financieros': 'bg-teal-100 text-teal-800', 'Derechos/Deportes': 'bg-indigo-100 text-indigo-800',
        'Flagship AI': 'bg-pink-100 text-pink-800'
      };
      const classes = categoryMap[category] || 'bg-gray-100 text-gray-800';
      return `<span class="${classes} text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return 'N/A'; }
    }

    /* ==== Render tarjetas (Vertiente 2) ‚Äî sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const countryMatch = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country) || (newsFilters.country.includes('Todos los Pa√≠ses') && !item.country);
        const entityMatch = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const categoryMatch = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return countryMatch && entityMatch && categoryMatch;
      }).sort((a, b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto': 1, 'Medio': 2, 'Bajo': 3 };
        return (order[a.impact] || 9) - (order[b.impact] || 9);
      });
      
      newsNoResults.classList.toggle('hidden', filtered.length > 0 || newsData.length === 0);
      alertsGrid.classList.toggle('hidden', filtered.length === 0);

      if (newsData.length > 0 && filtered.length === 0) {
        newsNoResults.querySelector('p').textContent = 'No se encontraron noticias con los filtros seleccionados.';
      } else if (newsData.length === 0) {
        newsNoResults.querySelector('p').textContent = 'No hay alertas de mercado en el per√≠odo seleccionado.';
        newsNoResults.classList.remove('hidden');
      }

      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-slate-50 p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Pa√≠ses' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '‚Äî'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) ‚Äî sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const countryMatch = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country) || (contentFilters.country.includes('Todos los Pa√≠ses'));
        const entityMatch = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const categoryMatch = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return countryMatch && entityMatch && categoryMatch;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      
      contentNewsNoResults.classList.toggle('hidden', filtered.length > 0 || contentNewsData.length === 0);
      contentAlertsGrid.classList.toggle('hidden', filtered.length === 0);
      
      if (contentNewsData.length > 0 && filtered.length === 0) {
        contentNewsNoResults.querySelector('p').textContent = 'No se encontraron noticias de contenido con los filtros seleccionados.';
      } else if (contentNewsData.length === 0) {
        contentNewsNoResults.querySelector('p').textContent = 'No hay noticias de contenido en el per√≠odo seleccionado.';
        contentNewsNoResults.classList.remove('hidden');
      }

      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-slate-50 p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '‚Äî'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group, type) {
      if(!container) return;
      const uniqueItems = Array.from(new Set(allItems.map(i => type === 'country' ? (i.country || 'Todos los Pa√≠ses') : (type === 'company' ? i.entity : i.category)))).sort();
      
      let html = `<div class="filter-checkbox-item"><input type="checkbox" id="${group}all" value="all" class="filter-checkbox mr-2"><label for="${group}all" class="text-sm">Todos</label></div>`;
      html += uniqueItems.map(item => `
        <div class="filter-checkbox-item">
          <input type="checkbox" id="${group}${item.replace(/\s+/g, '-')}" value="${item}" class="filter-checkbox mr-2">
          <label for="${group}${item.replace(/\s+/g, '-')}" class="text-sm">${item}</label>
        </div>`).join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, newsData, 'news-country-', 'country');
      populateCheckboxes(newsFilterCompanyContainer, newsData, 'news-company-', 'company');
      populateCheckboxes(newsFilterCategoryContainer, newsData, 'news-category-', 'category');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, contentNewsData, 'content-country-', 'country');
      populateCheckboxes(contentFilterCompanyContainer, contentNewsData, 'content-company-', 'company');
      populateCheckboxes(contentFilterCategoryContainer, contentNewsData, 'content-category-', 'category');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== L√≥gica de filtros ==== */
    function getSelected(container) {
      if(!container) return [];
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }

    function handleFilterChange(container, filters, key, renderFn) {
        const selected = getSelected(container);
        const allCheckbox = container.querySelector('input[value="all"]');
        const itemCheckboxes = container.querySelectorAll('input:not([value="all"])');
        
        if (event.target.value === 'all' && event.target.checked) {
            itemCheckboxes.forEach(cb => cb.checked = false);
            filters[key] = [];
        } else if (event.target.value !== 'all' && event.target.checked) {
            if(allCheckbox) allCheckbox.checked = false;
            filters[key] = getSelected(container);
        } else {
            filters[key] = getSelected(container);
        }

        renderFn();
    }
    
    function filterNews(event) {
        const container = event.currentTarget;
        if (container.id.includes('country')) handleFilterChange(newsFilterCountryContainer, newsFilters, 'country', renderNewsCards);
        if (container.id.includes('company')) handleFilterChange(newsFilterCompanyContainer, newsFilters, 'company', renderNewsCards);
        if (container.id.includes('category')) handleFilterChange(newsFilterCategoryContainer, newsFilters, 'category', renderNewsCards);
    }

    function filterContentNews(event) {
        const container = event.currentTarget;
        if (container.id.includes('country')) handleFilterChange(contentFilterCountryContainer, contentFilters, 'country', renderContentNewsCards);
        if (container.id.includes('company')) handleFilterChange(contentFilterCompanyContainer, contentFilters, 'company', renderContentNewsCards);
        if (container.id.includes('category')) handleFilterChange(contentFilterCategoryContainer, contentFilters, 'category', renderContentNewsCards);
    }
    
    function resetFilters(containers, filters, renderFn) {
      filters.country = [];
      filters.company = [];
      filters.category = [];
      containers.forEach(c => {
        if(c) Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderFn();
    }


    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));

    document.getElementById('news-reset-filters').addEventListener('click', () => resetFilters([newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer], newsFilters, renderNewsCards));
    document.getElementById('content-reset-filters').addEventListener('click', () => resetFilters([contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer], contentFilters, renderContentNewsCards));

    document.addEventListener('DOMContentLoaded', () => {
      updateSentimentContent('Brasil');
      updateNewsFilters(); renderNewsCards();
      updateContentNewsFilters(); renderContentNewsCards();
    });
  </script>
</body>
</html>
