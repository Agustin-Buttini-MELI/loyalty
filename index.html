<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        "sentimentIndex": [75, 78, 77, 72, 68, 65, 68, 70, 72, 62, 60, 61, 63],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "Sep 24", "text": "Lanzamiento Meli+ BR" },
          { "month": "Feb 25", "text": "Cambio % cashback" },
          { "month": "May 25", "text": "Meli+ BR 120% CDI" },
          { "month": "Jun 25", "text": "Cambio en política de envío gratis" }
        ],
        "table": [
          { "mes": "Sep 25", "detractores": "Estable", "motivosDet": "Costo de envío", "promotores": "Estable", "motivosPro": "Bundle de servicios", "eventos": "Período post-cambio de envíos", "competencia": "Amazon con derechos Premier League" },
          { "mes": "Ago 25", "detractores": "Estable", "motivosDet": "Costo de envío", "promotores": "A la baja", "motivosPro": "Rendimiento 120% CDI", "eventos": "Asimilación de política de envíos", "competencia": "Magalu con liquidación" },
          { "mes": "Jul 25", "detractores": "Alza", "motivosDet": "Percepción de devaluación", "promotores": "A la baja", "motivosPro": "Rendimiento 120% CDI", "eventos": "Impacto inicial del cambio en envíos", "competencia": "Shopee con cupones agresivos" },
          { "mes": "Jun 25", "detractores": "Alza significativa", "motivosDet": "Confusión en envíos gratis", "promotores": "A la baja", "motivosPro": "Streaming y CDI", "eventos": "Envío gratis general ≥ R$19,90", "competencia": "Prime Day de Amazon" }
        ],
        "summary": "<h4>Foco en Logística y Propuesta de Valor</h4><ul class='list-disc pl-5 space-y-2'><li>El cambio en la política de envío gratis en junio generó un pico de comentarios negativos, con usuarios expresando que '<i>el principal beneficio de Meli+ era el envío, ahora ya no tiene tanto sentido pagar</i>' (Comentario en YouTube).</li><li>El rendimiento del 120% del CDI sigue siendo un fuerte promotor, aunque su visibilidad ha sido opacada por el debate logístico. Un usuario en Reddit mencionó: '<i>Nadie más me da este retorno, solo por eso vale la pena</i>'.</li><li>La competencia (Amazon) ataca con contenido (fútbol), lo que presiona el pilar de entretenimiento de Meli+.</li></ul>"
      },
      "México": {
        "sentimentIndex": [80, 82, 78, 75, 71, 70, 68, 65, 66, 68, 70, 71, 72],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "Sep 24", "text": "Lanzamiento Meli+ MX" },
          { "month": "Feb 25", "text": "Cambio % cashback" },
          { "month": "May 25", "text": "Hot Sale MX / Lanza NU+" }
        ],
        "table": [
          { "mes": "Sep 25", "detractores": "Estable", "motivosDet": "Comparación con Prime", "promotores": "Estable", "motivosPro": "Bundle de servicios", "eventos": "-", "competencia": "Nubank consolida su base de clientes" },
          { "mes": "Jun 25", "detractores": "Estable", "motivosDet": "Costo/beneficio", "promotores": "Alza leve", "motivosPro": "Ofertas post-Hot Sale", "eventos": "Periodo post-Hot Sale", "competencia": "Liverpool con ventas nocturnas" },
          { "mes": "May 25", "detractores": "Alza", "motivosDet": "Valor vs. competencia", "promotores": "Alza", "motivosPro": "Descuentos Hot Sale", "eventos": "Hot Sale MX / Lanza NU+", "competencia": "Lanzamiento de NU+ por Nubank" }
        ],
        "summary": "<h4>Competencia Intensa y Valor Percibido</h4><ul class='list-disc pl-5 space-y-2'><li>La percepción de valor es el eje de la conversación, con comparaciones constantes frente a Amazon Prime. '<i>Por un poco más, Prime me da más cosas que sí uso, como música y Twitch</i>', comentó un usuario en X.</li><li>El lanzamiento de NU+ en mayo introdujo un nuevo competidor en el segmento 'premium', aunque enfocado en finanzas, generó conversación sobre '<i>qué programa da más por mi dinero</i>'.</li><li>Los promotores valoran fuertemente el paquete de streaming: '<i>Tener Disney y Max en un solo pago y con envíos gratis es una maravilla, me ahorra bastante</i>' (Foro Apestan.com).</li></ul>"
      },
      "Chile": {
        "sentimentIndex": [65, 66, 64, 68, 67, 68, 70, 78, 80, 79, 77, 76, 75],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "Apr 25", "text": "Nuevos beneficios Meli+ CL" }
        ],
        "table": [
          { "mes": "Sep 25", "detractores": "Estable", "motivosDet": "Valor vs. CMR/Ripley", "promotores": "Estable", "motivosPro": "Nuevos beneficios", "eventos": "-", "competencia": "Falabella con Cyber Day" },
          { "mes": "May 25", "detractores": "A la baja", "motivosDet": "Costo de suscripción", "promotores": "Estable", "motivosPro": "Descuentos en servicios", "eventos": "Asimilación de nuevos beneficios", "competencia": "Ripley con ofertas de temporada" },
          { "mes": "Abr 25", "detractores": "A la baja", "motivosDet": "Confusión inicial", "promotores": "Alza significativa", "motivosPro": "Nuevos beneficios (ej. Universal+)", "eventos": "Lanzamiento de nuevos beneficios Meli+", "competencia": "-" }
        ],
        "summary": "<h4>Impacto Positivo de Nuevos Beneficios</h4><ul class='list-disc pl-5 space-y-2'><li>La adición de nuevos beneficios en abril fue un catalizador claro de sentimiento positivo, revirtiendo una tendencia de estancamiento. '<i>Ahora sí vale la pena. Antes era casi lo mismo que Nivel 6 pero más caro</i>', se leyó en un grupo de Facebook.</li><li>La principal queja sigue siendo la comparación con los programas de lealtad del retail tradicional. Un reclamo en SERNAC indicaba: '<i>Los descuentos con tarjeta CMR en Falabella siguen siendo insuperables para compras grandes</i>'.</li></ul>"
      },
      "Argentina": {
        "sentimentIndex": [70, 68, 69, 72, 71, 68, 66, 50, 55, 60, 62, 63, 64],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "May 25", "text": "Migración Nivel 6 a Meli+" }
        ],
        "table": [
          { "mes": "Sep 25", "detractores": "Estable", "motivosDet": "Costo mensual en ARS", "promotores": "Estable", "motivosPro": "Paquete de streaming", "eventos": "-", "competencia": "Ualá con promociones en servicios" },
          { "mes": "Jun 25", "detractores": "A la baja", "motivosDet": "Pérdida de beneficios N6", "promotores": "Alza", "motivosPro": "Valor de Disney+/Max", "eventos": "Mes post-migración", "competencia": "Precios de Netflix y otros servicios" },
          { "mes": "May 25", "detractores": "Alza significativa", "motivosDet": "Comunicación confusa", "promotores": "Alza leve", "motivosPro": "Acceso a Disney+/Max", "eventos": "Migración de Nivel 6 a Meli+", "competencia": "-" }
        ],
        "summary": "<h4>Volatilidad por Migración de Nivel 6</h4><ul class='list-disc pl-5 space-y-2'><li>La transición de Nivel 6 a Meli+ en mayo generó una caída abrupta del sentimiento por quejas sobre la comunicación y la pérdida de beneficios percibidos. '<i>Me cambiaron de prepo y ahora no entiendo qué tengo. Antes con los puntos era más claro</i>', fue una queja recurrente en tuquejasuma.com.</li><li>Sin embargo, el valor del paquete de streaming (Disney+ y Max) se convirtió rápidamente en el principal argumento promotor, impulsando la recuperación. '<i>Pago menos por Meli+ que lo que pagaría por Disney y Max por separado. Negocio redondo</i>', comentó un usuario en X.</li></ul>"
      },
      "Colombia": {
        "sentimentIndex": [72, 73, 70, 68, 65, 66, 67, 60, 62, 63, 58, 55, 57],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [
          { "month": "May 25", "text": "Amazon Prime llega a CO" },
          { "month": "Aug 25", "text": "Migración Nivel 6 a Meli+" }
        ],
        "table": [
          { "mes": "Sep 25", "detractores": "Estable", "motivosDet": "Costo vs. Prime", "promotores": "Estable", "motivosPro": "Envíos y ecosistema Meli", "eventos": "Mes post-migración", "competencia": "Amazon Prime consolida oferta inicial" },
          { "mes": "Ago 25", "detractores": "Alza", "motivosDet": "Confusión por migración", "promotores": "A la baja", "motivosPro": "Beneficios de Nivel 6", "eventos": "Migración de Nivel 6 a Meli+", "competencia": "Rappi Pro con descuentos agresivos" },
          { "mes": "May 25", "detractores": "Alza", "motivosDet": "Comparación con Prime", "promotores": "A la baja", "motivosPro": "Envíos gratis Nivel 6", "eventos": "Lanzamiento de Amazon Prime en el país", "competencia": "Llegada de Amazon Prime" }
        ],
        "summary": "<h4>Doble Impacto: Competencia y Migración</h4><ul class='list-disc pl-5 space-y-2'><li>La llegada de Amazon Prime en mayo impactó negativamente la percepción de valor de Nivel 6, con usuarios comparando precios y beneficios. '<i>Amazon llegó más barato y con Prime Video, Meli tiene que ponerse las pilas</i>', fue un comentario popular en TikTok.</li><li>La posterior migración a Meli+ en agosto no logró revertir la tendencia, añadiendo una capa de confusión. Un usuario en la SIC reportó: '<i>No autoricé el cambio a Meli+ y el costo es mayor. Exijo claridad</i>'.</li><li>Los promotores se centran en la conveniencia del ecosistema Mercado Libre/Mercado Pago, que la competencia no ofrece.</li></ul>"
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      {
        "id": 1, "entity": "Rappi Pro", "country": "Brasil", "impact": "Alto",
        "title": "Rappi eleva el precio de su suscripción 'Pro' un 15% en Brasil y México citando expansión de beneficios",
        "url": "https://www.reuters.com/business/retail-consumer/rappi-hikes-pro-subscription-price-brazil-mexico-2025-09-20/",
        "date": "20-09-2025", "category": "Cambio de Precio",
        "summary": "Rappi anunció un aumento del 15% en su membresía 'Pro' (anteriormente Prime) para Brasil y México, que se aplicará a partir de noviembre. La compañía justifica el alza por la inclusión de nuevos beneficios, como descuentos extendidos en farmacias y una nueva categoría de 'Turbo Entregas' sin costo.",
        "publisher": "reuters.com",
        "url_raw": "https://www.reuters.com/business/retail-consumer/rappi-hikes-pro-subscription-price-brazil-mexico-2025-09-20/",
        "url_canonical": "https://www.reuters.com/business/retail-consumer/rappi-hikes-pro-subscription-price-brazil-mexico-2025-09-20/",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      },
      {
        "id": 2, "entity": "OpenAI", "country": "Todos los Países", "impact": "Alto",
        "title": "OpenAI Announces GPT-4.5-Turbo in API, Promising Faster Speeds and Enhanced Multimodal Capabilities",
        "url": "https://openai.com/blog/gpt-4-5-turbo-api-launch",
        "date": "18-09-2025", "category": "Flagship AI",
        "summary": "OpenAI ha lanzado oficialmente GPT-4.5-Turbo a través de su API para desarrolladores. El nuevo modelo presenta una latencia reducida, una ventana de contexto más grande y capacidades de visión (multimodales) significativamente mejoradas, permitiendo análisis de video en tiempo real.",
        "publisher": "openai.com",
        "url_raw": "https://openai.com/blog/gpt-4-5-turbo-api-launch",
        "url_canonical": "https://openai.com/blog/gpt-4-5-turbo-api-launch",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      },
      {
        "id": 3, "entity": "Amazon Prime", "country": "Brasil", "impact": "Alto",
        "title": "Amazon secures exclusive multi-year rights for key Premier League matches in Brazil",
        "url": "https://press.aboutamazon.com/2025/9/amazon-secures-exclusive-premier-league-rights-brazil",
        "date": "16-09-2025", "category": "Derechos/Deportes",
        "summary": "Amazon Prime Video ha ganado un paquete de derechos exclusivos para transmitir partidos clave de la Premier League inglesa en Brasil, comenzando en la temporada 2026-2027. El acuerdo de varios años refuerza su oferta de deportes en vivo en un mercado clave de América Latina.",
        "publisher": "press.aboutamazon.com",
        "url_raw": "https://press.aboutamazon.com/2025/9/amazon-secures-exclusive-premier-league-rights-brazil",
        "url_canonical": "https://press.aboutamazon.com/2025/9/amazon-secures-exclusive-premier-league-rights-brazil",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      },
      {
        "id": 4, "entity": "Temu", "country": "Todos los Países", "impact": "Alto",
        "title": "European Commission launches formal antitrust probe into Temu over alleged anti-competitive practices",
        "url": "https://ec.europa.eu/commission/presscorner/detail/en/IP_25_1234",
        "date": "12-09-2025", "category": "Sanción Legal",
        "summary": "La Comisión Europea ha abierto una investigación antimonopolio formal sobre Temu, propiedad de PDD Holdings. La investigación se centrará en si la plataforma abusa de su posición en el mercado para sofocar a la competencia y si sus prácticas de precios y subsidios violan las leyes de la UE.",
        "publisher": "ec.europa.eu",
        "url_raw": "https://ec.europa.eu/commission/presscorner/detail/en/IP_25_1234",
        "url_canonical": "https://ec.europa.eu/commission/presscorner/detail/en/IP_25_1234",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      },
      {
        "id": 5, "entity": "Nubank", "country": "México", "impact": "Medio",
        "title": "Nubank Mexico reaches 10 million customers, announces new credit features",
        "url": "https://blog.nu.com.mx/nu-mexico-10-millones-clientes/",
        "date": "10-09-2025", "category": "Estrategia",
        "summary": "Nubank anunció haber superado la marca de 10 millones de clientes en México. Para celebrarlo, la compañía lanzó nuevas funcionalidades en su tarjeta de crédito, incluyendo un plan de pagos fijos para compras específicas y un aumento en las líneas de crédito para clientes con buen historial.",
        "publisher": "blog.nu.com.mx",
        "url_raw": "https://blog.nu.com.mx/nu-mexico-10-millones-clientes/",
        "url_canonical": "https://blog.nu.com.mx/nu-mexico-10-millones-clientes/",
        "http_status": "200", "archived_url": null, "language": "es", "out_of_window": false
      }
    ];
    const contentNewsData = [
      {
        "id": 1, "entity": "Paramount+", "country": "Todos los Países", "impact": "Alto",
        "title": "Skydance and Paramount Global finalize merger agreement; deal awaits regulatory approval",
        "url": "https://www.wsj.com/business/media/skydance-paramount-finalize-merger-agreement-2c3f1a",
        "date": "21-09-2025", "category": "Fusión/Adquisición",
        "summary": "Skydance Media y Paramount Global han firmado el acuerdo definitivo de fusión. La transacción, que valora a Paramount en una cifra no revelada, ahora debe pasar por la revisión de los reguladores antimonopolio en EE. UU. y otros mercados clave.",
        "publisher": "wsj.com",
        "url_raw": "https://www.wsj.com/business/media/skydance-paramount-finalize-merger-agreement-2c3f1a",
        "url_canonical": "https://www.wsj.com/business/media/skydance-paramount-finalize-merger-agreement-2c3f1a",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      },
      {
        "id": 2, "entity": "Netflix", "country": "Todos los Países", "impact": "Medio",
        "title": "Netflix trials new 'Continuous Binge' feature that automatically creates a playlist of related shows",
        "url": "https://about.netflix.com/en/news/new-feature-trial-continuous-binge",
        "date": "19-09-2025", "category": "Producto",
        "summary": "Netflix está probando una nueva función llamada 'Continuous Binge' en mercados seleccionados. Al terminar una serie, la función utiliza IA para crear y reproducir automáticamente una lista de series y películas temáticamente similares, con el objetivo de aumentar la retención.",
        "publisher": "about.netflix.com",
        "url_raw": "https://about.netflix.com/en/news/new-feature-trial-continuous-binge",
        "url_canonical": "https://about.netflix.com/en/news/new-feature-trial-continuous-binge",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      },
      {
        "id": 3, "entity": "Spotify", "country": "Todos los Países", "impact": "Medio",
        "title": "Spotify partners with leading publishers to introduce exclusive audiobook series for Premium subscribers",
        "url": "https://newsroom.spotify.com/2025-09-17/spotify-exclusive-audiobook-series-premium/",
        "date": "17-09-2025", "category": "Estrategia",
        "summary": "Ampliando su oferta de audio, Spotify anunció asociaciones con Penguin Random House y Simon & Schuster para producir series de audiolibros exclusivas. Estos títulos estarán disponibles sin costo adicional para los suscriptores de Spotify Premium a partir del cuarto trimestre de 2025.",
        "publisher": "newsroom.spotify.com",
        "url_raw": "https://newsroom.spotify.com/2025-09-17/spotify-exclusive-audiobook-series-premium/",
        "url_canonical": "https://newsroom.spotify.com/2025-09-17/spotify-exclusive-audiobook-series-premium/",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      },
      {
        "id": 4, "entity": "Max", "country": "Todos los Países", "impact": "Medio",
        "title": "Max announces price increase for ad-free tier in Latin America, effective November 2025",
        "url": "https://www.bloomberg.com/news/articles/2025-09-15/wbd-to-hike-max-prices-in-latin-america",
        "date": "15-09-2025", "category": "Cambio de Precio",
        "summary": "Warner Bros. Discovery aumentará el precio de la suscripción sin publicidad de Max en aproximadamente un 10-12% en toda América Latina. El cambio, efectivo a partir del 1 de noviembre de 2025, busca alinear los precios con el valor del contenido y las inversiones recientes.",
        "publisher": "bloomberg.com",
        "url_raw": "https://www.bloomberg.com/news/articles/2025-09-15/wbd-to-hike-max-prices-in-latin-america",
        "url_canonical": "https://www.bloomberg.com/news/articles/2025-09-15/wbd-to-hike-max-prices-in-latin-america",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      },
      {
        "id": 5, "entity": "Disney+", "country": "Todos los Países", "impact": "Medio",
        "title": "Disney's CEO confirms strategic review of its linear TV assets, including ESPN, will conclude by year-end",
        "url": "https://thewaltdisneycompany.com/disney-ceo-q3-2025-earnings-call-remarks/",
        "date": "11-09-2025", "category": "Estrategia",
        "summary": "En una conferencia para inversores, el CEO de Disney, Bob Iger, confirmó que la revisión estratégica sobre el futuro de sus activos de televisión lineal, incluyendo ABC y una posible escisión de ESPN, está en su fase final y se esperan conclusiones antes de fin de año.",
        "publisher": "thewaltdisneycompany.com",
        "url_raw": "https://thewaltdisneycompany.com/disney-ceo-q3-2025-earnings-call-remarks/",
        "url_canonical": "https://thewaltdisneycompany.com/disney-ceo-q3-2025-earnings-call-remarks/",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      },
      {
        "id": 6, "entity": "Apple TV+", "country": "Todos los Países", "impact": "Medio",
        "title": "Apple greenlights major sci-fi series from 'Foundation' showrunner David S. Goyer",
        "url": "https://www.apple.com/tv-pr/news/2025/09/apple-tv-greenlights-new-sci-fi-epic-from-david-s-goyer/",
        "date": "09-09-2025", "category": "Estrategia",
        "summary": "Apple TV+ ha encargado una nueva serie de ciencia ficción de gran presupuesto de David S. Goyer, conocido por 'Foundation'. El proyecto, aún sin título, se describe como un thriller de ópera espacial y refuerza la apuesta de Apple por contenido original de alto perfil.",
        "publisher": "apple.com",
        "url_raw": "https://www.apple.com/tv-pr/news/2025/09/apple-tv-greenlights-new-sci-fi-epic-from-david-s-goyer/",
        "url_canonical": "https://www.apple.com/tv-pr/news/2025/09/apple-tv-greenlights-new-sci-fi-epic-from-david-s-goyer/",
        "http_status": "200", "archived_url": null, "language": "en", "out_of_window": false
      }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country) || item.country === 'Todos los Países';
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Países' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country) || item.country === 'Todos los Países';
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group) {
      const uniqueItems = [...new Set(allItems)].sort();
      const html = [
        ...uniqueItems.map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${group}${c.replace(/\s/g, '-')}" value="${c}" class="mr-2"><label for="${group}${c.replace(/\s/g, '-')}" class="text-sm">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }
    
    function createFilterLogic(container, stateObject, key, renderFunc) {
      container.addEventListener('change', (e) => {
        if (e.target.type === 'checkbox') {
          const selected = Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
          stateObject[key] = selected;
          renderFunc();
        }
      });
    }

    function resetFilters(containers, stateObject, renderFunc) {
        containers.forEach(c => Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false));
        for(const key in stateObject) { stateObject[key] = []; }
        renderFunc();
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        /* ==== Tabs & Boot ==== */
        tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
            tabButtons.forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            updateSentimentContent(e.target.dataset.country);
        }));

        populateCheckboxes(newsFilterCountryContainer, [...new Set(newsData.map(i => i.country).filter(Boolean))], 'news-country-');
        populateCheckboxes(newsFilterCompanyContainer, [...new Set(newsData.map(i => i.entity))], 'news-company-');
        populateCheckboxes(newsFilterCategoryContainer, [...new Set(newsData.map(i => i.category))], 'news-category-');
        
        createFilterLogic(newsFilterCountryContainer, newsFilters, 'country', renderNewsCards);
        createFilterLogic(newsFilterCompanyContainer, newsFilters, 'company', renderNewsCards);
        createFilterLogic(newsFilterCategoryContainer, newsFilters, 'category', renderNewsCards);

        populateCheckboxes(contentFilterCountryContainer, ['Todos los Países'], 'content-country-');
        populateCheckboxes(contentFilterCompanyContainer, [...new Set(contentNewsData.map(i => i.entity))], 'content-company-');
        populateCheckboxes(contentFilterCategoryContainer, [...new Set(contentNewsData.map(i => i.category))], 'content-category-');
        
        createFilterLogic(contentFilterCountryContainer, contentFilters, 'country', renderContentNewsCards);
        createFilterLogic(contentFilterCompanyContainer, contentFilters, 'company', renderContentNewsCards);
        createFilterLogic(contentFilterCategoryContainer, contentFilters, 'category', renderContentNewsCards);
        
        document.getElementById('news-reset-filters').addEventListener('click', () => resetFilters([newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer], newsFilters, renderNewsCards));
        document.getElementById('content-reset-filters').addEventListener('click', () => resetFilters([contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer], contentFilters, renderContentNewsCards));

        updateSentimentContent('Brasil');
        renderNewsCards();
        renderContentNewsCards();
    });

  </script>
</body>
</html>
