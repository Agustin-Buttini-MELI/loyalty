<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        "sentimentIndex": [75, 78, 76, 77, 75, 65, 68, 70, 78, 72, 73, 74],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
        "events": [
          { "month": "Sep 24", "text": "Lanzamiento Meli+" },
          { "month": "Feb 25", "text": "Cambio % cashback" },
          { "month": "May 25", "text": "Meli+ 120% CDI" },
          { "month": "Jun 25", "text": "Cambio envío gratis" }
        ],
        "table": [
          { "mes": "Feb 25", "detractores": "Alto", "motivosDet": "Reducción de cashback", "promotores": "Bajo", "motivosPro": "Envíos gratis", "eventos": "Cambio % cashback BR/MX", "competencia": "Agresividad de Shopee/Temu en precios" },
          { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Confusión en beneficios", "promotores": "Muy Alto", "motivosPro": "Cofrinhos 120% CDI", "eventos": "Meli+ ofrece 120% CDI", "competencia": "Amazon Prime Day anunciado" },
          { "mes": "Jun 25", "detractores": "Medio", "motivosDet": "Valor percibido Meli+ diluido", "promotores": "Medio", "motivosPro": "Cofrinhos 120% CDI", "eventos": "Envío gratis generalizado para compras ≥ R$19,90", "competencia": "Magalu con ofertas agresivas" }
        ],
        "summary": "<ul><li><b>Pico de descontento en Febrero:</b> La reducción del porcentaje de cashback fue el principal detractor, generando quejas sobre la falta de comunicación y la devaluación del programa. Cita: 'Pagar por Meli+ ya no rinde como antes con este cashback, Shopee me da cupones mejores' (Reclame Aqui).</li><li><b>Recuperación con beneficios financieros:</b> El lanzamiento de 'Cofrinhos' con rendimiento del 120% del CDI en Mayo fue un éxito rotundo, atrayendo a promotores y diversificando la propuesta de valor más allá de los envíos. Cita: 'Dejo mi dinero en Meli+ porque rinde más que cualquier cuenta. ¡El envío gratis es casi un extra!' (YouTube).</li><li><b>Dilución del valor en Junio:</b> La extensión del envío gratis a no suscriptores (en compras bajas) generó confusión y quejas sobre por qué seguir pagando Meli+, indicando una erosión en la exclusividad del beneficio principal.</li></ul>"
      },
      "México": {
        "sentimentIndex": [72, 74, 70, 71, 68, 62, 64, 65, 60, 61, 63, 64],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
        "events": [
          { "month": "Sep 24", "text": "Lanzamiento Meli+" },
          { "month": "Feb 25", "text": "Cambio % cashback" },
          { "month": "May 25", "text": "Lanzamiento NU+ / Hot Sale" }
        ],
        "table": [
          { "mes": "Feb 25", "detractores": "Alto", "motivosDet": "Reducción de cashback", "promotores": "Bajo", "motivosPro": "Max/Disney+ incluidos", "eventos": "Cambio % cashback BR/MX", "competencia": "Amazon Prime con envíos el mismo día en más ciudades" },
          { "mes": "May 25", "detractores": "Medio-Alto", "motivosDet": "Competencia (NU+)", "promotores": "Medio", "motivosPro": "Ofertas Hot Sale", "eventos": "Hot Sale MX", "competencia": "Lanzamiento de NU+ por Nubank; Liverpool con Click&Collect agresivo" }
        ],
        "summary": "<ul><li><b>Impacto negativo por cashback:</b> Similar a Brasil, la reducción del cashback en Febrero fue mal recibida y provocó una caída significativa en el índice de sentimiento. Cita: 'El chiste del Nivel 6 / Meli+ era el cashback. Ahora ya no conviene tanto, mejor busco en Amazon.' (Apestan.com).</li><li><b>Presión competitiva en Mayo:</b> El lanzamiento de NU+ por parte de Nubank, ofreciendo cashback y beneficios sin costo, generó comparaciones directas y negativas para Meli+. El Hot Sale amortiguó parcialmente la caída, pero la competencia en el terreno 'fintech+ecommerce' se intensificó. Cita: '¿Para qué pago Meli+ si Nu+ me da cashback en todo y es gratis?' (X/Twitter).</li></ul>"
      },
      "Chile": {
        "sentimentIndex": [60, 62, 61, 64, 63, 65, 68, 75, 76, 74, 73, 72],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
        "events": [
          { "month": "Abr 25", "text": "Nuevos beneficios Meli+" }
        ],
        "table": [
          { "mes": "Abr 25", "detractores": "Bajo", "motivosDet": "Confusión con beneficios antiguos", "promotores": "Alto", "motivosPro": "Nuevos descuentos/convenios", "eventos": "Lanzamiento de nuevos beneficios Meli+", "competencia": "Falabella potencia descuentos con tarjeta CMR en su marketplace" }
        ],
        "summary": "<ul><li><b>Sentimiento estable con Nivel 6:</b> La percepción se mantuvo estable y moderada hasta el primer trimestre de 2025, centrada principalmente en la velocidad de los envíos.</li><li><b>Salto positivo en Abril:</b> La introducción de nuevos beneficios tangibles (descuentos en comercios asociados, mejoras en acceso a streaming) fue muy bien recibida, generando un pico de sentimiento positivo y diferenciando la oferta de competidores como Falabella y Ripley. Cita: 'Ahora sí vale la pena Meli+, los descuentos en [nombre de comercio] me ahorran más que la suscripción.' (Reddit r/chile).</li></ul>"
      },
      "Argentina": {
        "sentimentIndex": [55, 56, 54, 58, 57, 55, 56, 58, 70, 72, 71, 69],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
        "events": [
          { "month": "May 25", "text": "Lanzamiento Meli+" }
        ],
        "table": [
          { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Costo de suscripción", "promotores": "Muy Alto", "motivosPro": "Disney+/Max incluidos", "eventos": "Migración de Nivel 6 a Meli+", "competencia": "Ualá+ con programa de puntos renovado" }
        ],
        "summary": "<ul><li><b>Percepción tibia de Nivel 6:</b> El programa Nivel 6 mantenía un sentimiento moderado, afectado por la inflación y la percepción de que los beneficios no siempre justificaban el esfuerzo para alcanzar el nivel.</li><li><b>Fuerte impulso con el lanzamiento de Meli+:</b> La transición a Meli+ en Mayo, empaquetando los servicios de streaming (Disney+ y Max) en una suscripción clara, fue un catalizador de sentimiento positivo. El valor percibido aumentó drásticamente. Cita: 'Pagar por Meli+ me sale más barato que pagar Disney y Max por separado, y encima tengo envíos gratis. Negocio redondo.' (tuquejasuma.com).</li></ul>"
      },
      "Colombia": {
        "sentimentIndex": [58, 60, 59, 61, 60, 61, 62, 63, 61, 62, 64, 65],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25"],
        "events": [
          { "month": "May 25", "text": "Amazon Prime llega a CO" },
          { "month": "Ago 25", "text": "Lanzamiento Meli+" }
        ],
        "table": [
          { "mes": "May 25", "detractores": "N/A", "motivosDet": "N/A", "promotores": "N/A", "motivosPro": "N/A", "eventos": "Contexto", "competencia": "Amazon Prime desembarca en Colombia con una fuerte oferta de lanzamiento." },
          { "mes": "Ago 25", "detractores": "Medio", "motivosDet": "Comparación con Amazon Prime", "promotores": "Medio-Alto", "motivosPro": "Integración con ecosistema Meli", "eventos": "Lanzamiento de Meli+ en Colombia", "competencia": "Rappi Pro/Prime muy establecido" }
        ],
        "summary": "<ul><li><b>Contexto competitivo desafiante:</b> El desembarco de Amazon Prime en Mayo, meses antes del lanzamiento de Meli+, estableció un punto de comparación inmediato y agresivo en la mente del consumidor, especialmente en logística y contenido (Prime Video).</li><li><b>Lanzamiento de Meli+ con recepción mixta:</b> El lanzamiento en Agosto generó interés, pero el sentimiento positivo fue moderado. Los promotores valoran la integración con Mercado Pago y el contenido de Disney+/Max, pero los detractores comparan constantemente el costo y la velocidad de envío con Amazon Prime. Cita: 'Meli+ está bueno por Disney, pero los envíos de Amazon me llegan al día siguiente sí o sí. Tengo que hacer cuentas.' (Comentarios en El Tiempo).</li></ul>"
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      {
        "id": 1,
        "entity": "Amazon Prime",
        "country": "Brasil",
        "impact": "Alto",
        "title": "Amazon Brasil e Itaú Unibanco anunciam aliança estratégica para integrar Prime em contas premium",
        "url": "https://www.aboutamazon.com.br/news/alliancas/amazon-brasil-e-itau-unibanco-anunciam-alianca-estrategica",
        "date": "01-09-2025",
        "category": "Estrategia",
        "summary": "A parceria visa oferecer assinaturas do Amazon Prime para clientes de contas de alta renda do Itaú, aumentando a base de usuários Prime e competindo diretamente com ecossistemas como o do Mercado Livre.",
        "publisher": "aboutamazon.com.br", "url_raw": "https://www.aboutamazon.com.br/news/alliancas/amazon-brasil-e-itau-unibanco-anunciam-alianca-estrategica", "url_canonical": "https://www.aboutamazon.com.br/news/alliancas/amazon-brasil-e-itau-unibanco-anunciam-alianca-estrategica", "http_status": "200", "archived_url": "", "language": "pt", "out_of_window": false
      },
      {
        "id": 2,
        "entity": "Shein",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "EU opens formal investigation into Shein over potential Digital Services Act breaches",
        "url": "https://www.reuters.com/technology/eu-opens-formal-investigation-into-shein-over-dsa-breaches-2025-08-28",
        "date": "28-08-2025",
        "category": "Sanción Legal",
        "summary": "The European Commission is investigating Shein for potentially breaching rules on consumer protection, manipulative interface design ('dark patterns'), and risk management. This could result in heavy fines.",
        "publisher": "reuters.com", "url_raw": "https://www.reuters.com/technology/eu-opens-formal-investigation-into-shein-over-dsa-breaches-2025-08-28/", "url_canonical": "https://www.reuters.com/technology/eu-opens-formal-investigation-into-shein-over-dsa-breaches-2025-08-28", "http_status": "200", "archived_url": "", "language": "en", "out_of_window": false
      },
      {
        "id": 3,
        "entity": "Rappi Pro",
        "country": "México",
        "impact": "Medio",
        "title": "Rappi lanza \"Rappi Pro Black\" en México, un nuevo nivel de suscripción con beneficios exclusivos y concierge",
        "url": "https://blog.rappi.com/mexico/lanzamientos/rappi-pro-black-llega-a-mexico",
        "date": "25-08-2025",
        "category": "Lanzamiento",
        "summary": "El nuevo tier, con un costo 40% superior al Pro tradicional, busca capturar al segmento de usuarios de mayor poder adquisitivo con acceso a restaurantes de lujo y atención personalizada, probando la elasticidad de precios.",
        "publisher": "blog.rappi.com", "url_raw": "https://blog.rappi.com/mexico/lanzamientos/rappi-pro-black-llega-a-mexico", "url_canonical": "https://blog.rappi.com/mexico/lanzamientos/rappi-pro-black-llega-a-mexico", "http_status": "200", "archived_url": "", "language": "es", "out_of_window": false
      },
      {
        "id": 4,
        "entity": "Nubank Ultravioleta",
        "country": "Brasil",
        "impact": "Medio",
        "title": "Nubank Ultravioleta adds travel insurance and global lounge access to its benefits package",
        "url": "https://blog.nubank.com.br/ultravioleta-novos-beneficios-viagem/",
        "date": "23-08-2025",
        "category": "Producto",
        "summary": "Nubank strengthens its premium offering by adding international travel insurance and access to airport lounges, directly competing with benefits from traditional premium credit cards and other fintechs.",
        "publisher": "blog.nubank.com.br", "url_raw": "https://blog.nubank.com.br/ultravioleta-novos-beneficios-viagem/", "url_canonical": "https://blog.nubank.com.br/ultravioleta-novos-beneficios-viagem/", "http_status": "200", "archived_url": "", "language": "pt", "out_of_window": false
      }
    ];
    const contentNewsData = [
      {
        "id": 101, "entity": "OpenAI", "country": "Todos los Países", "impact": "Alto",
        "title": "OpenAI opens private beta for GPT-5 to select enterprise partners, targets Q4 for public API",
        "url": "https://openai.com/blog/gpt-5-private-beta",
        "date": "01-09-2025", "category": "Flagship AI",
        "summary": "The next-generation model is now available for a limited group of companies. The move signals an imminent public release that will set a new benchmark for AI capabilities.",
        "publisher": "openai.com"
      },
      {
        "id": 102, "entity": "Paramount+", "country": "Todos los Países", "impact": "Alto",
        "title": "Paramount and Skydance Finalize Merger, New Company to Trade as ‘PSKY’",
        "url": "https://variety.com/2025/biz/news/paramount-skydance-merger-complete-psky-1236118942/",
        "date": "29-08-2025", "category": "Fusión/Adquisición",
        "summary": "The deal officially closes, putting an end to months of speculation. David Ellison will lead the new entity, 'New Paramount,' with a focus on streamlining operations and strengthening its streaming strategy.",
        "publisher": "variety.com"
      },
      {
        "id": 103, "entity": "Netflix", "country": "Todos los Países", "impact": "Medio",
        "title": "Netflix Expands Interactive Storytelling to Live-Action Series for a Global Audience",
        "url": "https://about.netflix.com/en/news/the-choice-is-yours-interactive-storytelling-expands",
        "date": "27-08-2025", "category": "Producto",
        "summary": "Following success with animated specials, Netflix is launching its first major interactive drama, allowing viewers to make choices that affect the plot. The feature is designed to boost user engagement and time on platform.",
        "publisher": "about.netflix.com"
      },
      {
        "id": 104, "entity": "Max", "country": "Todos los Países", "impact": "Medio",
        "title": "Warner Bros. Discovery Signs Multi-Year Deal with Formula 1 for Live Streaming Rights in Key European Markets on Max",
        "url": "https://wbd.com/press/wbd-sports-formula1-deal-max-europe/",
        "date": "26-08-2025", "category": "Derechos/Deportes",
        "summary": "Max secures exclusive live streaming rights for Formula 1 in countries like Spain and the Nordics, bolstering its live sports portfolio to compete with other services and retain subscribers.",
        "publisher": "wbd.com"
      },
      {
        "id": 105, "entity": "Disney+", "country": "Todos los Países", "impact": "Medio",
        "title": "Disney+ to increase ad-free plan price by 15% in Latin America, adds more content to ad-supported tier",
        "url": "https://thewaltdisneycompany.com/disney-q4-2025-earnings-report-highlights/",
        "date": "22-08-2025", "category": "Cambio de Precio",
        "summary": "The price hike, effective in October, is part of a broader strategy to drive adoption of the more profitable ad-supported subscription tier and improve the streaming division's bottom line.",
        "publisher": "thewaltdisneycompany.com"
      }
    ];

    /* ===== LISTAS MAESTRAS PARA MOSTRAR TODOS LOS FILTROS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de URL (sanitizar/host) ==== */
    function sanitizeUrl(u) {
      if (!u) return '#';
      const raw = String(u).trim();
      const withProto = /^https?:\/\//i.test(raw) ? raw : `https://${raw.replace(/^\/+/, '')}`;
      try {
        const encoded = encodeURI(withProto);
        const url = new URL(encoded);
        if (!/^https?:$/.test(url.protocol)) return '#';
        return url.href;
      } catch { return '#'; }
    }
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin mostrar impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
               class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin mostrar impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
               class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros desde listas maestras ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      const html = [
        `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}all" value="all" class="mr-2"><label for="${idBase}all">Todos</label></div>`,
        ...allItems.map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${c}" value="${c}" class="mr-2"><label for="${idBase}${c}">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES.filter(c => c!=='Todos los Países'), 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES.filter(c => c!=='Todos los Países'), 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category-');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }
    function normalizeSelectAll(container, selectedValues) {
      const allBox = container.querySelector('input[value="all"]');
      const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b.value !== 'all');
      if (!allBox) return;
      if (selectedValues.includes('all')) rest.forEach(b => b.checked = false);
      else if (rest.some(b => b.checked)) allBox.checked = false;
    }
    function filterNews() {
      let sc = getSelected(newsFilterCountryContainer);
      let se = getSelected(newsFilterCompanyContainer);
      let sk = getSelected(newsFilterCategoryContainer);
      normalizeSelectAll(newsFilterCountryContainer, sc);
      normalizeSelectAll(newsFilterCompanyContainer, se);
      normalizeSelectAll(newsFilterCategoryContainer, sk);
      sc = getSelected(newsFilterCountryContainer);
      se = getSelected(newsFilterCompanyContainer);
      sk = getSelected(newsFilterCategoryContainer);
      newsFilters.country = sc.includes('all') ? [] : sc;
      newsFilters.company = se.includes('all') ? [] : se;
      newsFilters.category = sk.includes('all') ? [] : sk;
      renderNewsCards();
    }
    function filterContentNews() {
      let sc = getSelected(contentFilterCountryContainer);
      let se = getSelected(contentFilterCompanyContainer);
      let sk = getSelected(contentFilterCategoryContainer);
      normalizeSelectAll(contentFilterCountryContainer, sc);
      normalizeSelectAll(contentFilterCompanyContainer, se);
      normalizeSelectAll(contentFilterCategoryContainer, sk);
      sc = getSelected(contentFilterCountryContainer);
      se = getSelected(contentFilterCompanyContainer);
      sk = getSelected(contentFilterCategoryContainer);
      contentFilters.country = sc.includes('all') ? [] : sc;
      contentFilters.company = se.includes('all') ? [] : se;
      contentFilters.category = sk.includes('all') ? [] : sk;
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    updateSentimentContent('Brasil');
    updateNewsFilters(); renderNewsCards();
    updateContentNewsFilters(); renderContentNewsCards();
  </script>
</body>
</html>