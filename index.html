<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        "sentimentIndex": [80, 78, 77, 78, 76, 68, 70, 72, 78, 71, 72, 73, 74],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [{ "month": "Sep 24", "text": "Lanzamiento Meli+" }, { "month": "Feb 25", "text": "Cambio % cashback" }, { "month": "May 25", "text": "Meli+ 120% CDI" }, { "month": "Jun 25", "text": "Cambio envío gratis" }],
        "table": [
          { "mes": "Sep 24", "detractores": "10%", "motivosDet": "Confusión inicial", "promotores": "45%", "motivosPro": "Paquete de beneficios", "eventos": "Lanzamiento Meli+", "competencia": "Amazon Prime Day" },
          { "mes": "Feb 25", "detractores": "25%", "motivosDet": "Reducción de cashback", "promotores": "30%", "motivosPro": "Aún valoran envíos", "eventos": "Cambio en % de cashback", "competencia": "Shopee agresivo en cupones" },
          { "mes": "May 25", "detractores": "15%", "motivosDet": "Anuncios en Disney+", "promotores": "48%", "motivosPro": "Rendimiento 120% CDI", "eventos": "Nuevo beneficio Cofrinhos 120% CDI", "competencia": "Magalu con ofertas" },
          { "mes": "Jun 25", "detractores": "22%", "motivosDet": "Cambio en política de envío", "promotores": "35%", "motivosPro": "Rendimiento 120% CDI", "eventos": "Envío gratis general ≥ R$19,90", "competencia": "Amazon refuerza Prime" }
        ],
        "summary": "<ul><li><strong>Detractores:</strong> El principal pico de descontento ocurrió en <strong>Febrero 2025</strong> con la reducción del porcentaje de cashback, generando quejas sobre la falta de comunicación. \"De un día para el otro me bajaron el cashback a la mitad, Meli+ ya no vale la pena\" (Reclame Aqui). Otro punto de fricción fue en <strong>Junio 2025</strong>, cuando se percibió que el beneficio de envío gratis se diluía.</li><li><strong>Promotores:</strong> El lanzamiento del rendimiento del 120% CDI en <strong>Mayo 2025</strong> fue un éxito rotundo, atrayendo a usuarios que valoran los beneficios financieros. \"Puse mi dinero en el 'cofrinho' y rinde más que mi cuenta del banco, increíble\" (Comentario en YouTube). El paquete de streaming (Disney+/Max) sigue siendo un pilar fundamental del valor percibido.</li></ul>"
      },
      "México": {
        "sentimentIndex": [79, 77, 76, 77, 75, 69, 71, 72, 68, 70, 71, 72, 73],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [{ "month": "Sep 24", "text": "Lanzamiento Meli+" }, { "month": "Feb 25", "text": "Cambio % cashback" }, { "month": "May 25", "text": "Hot Sale / Lanza NU+" }],
        "table": [
          { "mes": "Sep 24", "detractores": "11%", "motivosDet": "UI confusa", "promotores": "42%", "motivosPro": "Acceso a Disney+/Max", "eventos": "Lanzamiento Meli+", "competencia": "Amazon con promociones" },
          { "mes": "Feb 25", "detractores": "24%", "motivosDet": "Reducción de cashback", "promotores": "33%", "motivosPro": "Envíos gratis Full", "eventos": "Cambio en % de cashback", "competencia": "Walmart Pass con nuevos beneficios" },
          { "mes": "May 25", "detractores": "28%", "motivosDet": "Retrasos en Hot Sale", "promotores": "31%", "motivosPro": "Descuentos agresivos", "eventos": "Hot Sale MX", "competencia": "Nubank lanza NU+, Klar con cashback" }
        ],
        "summary": "<ul><li><strong>Detractores:</strong> Al igual que en Brasil, el cambio en el cashback de <strong>Febrero 2025</strong> fue el mayor detractor. A esto se sumaron problemas logísticos durante el <strong>Hot Sale de Mayo 2025</strong>, con múltiples quejas por retrasos. \"Compré en Hot Sale y mi paquete lleva 10 días sin moverse. ¿De qué sirve Meli+?\" (Apestan.com).</li><li><strong>Promotores:</strong> El acceso al paquete de streaming sigue siendo el principal argumento de valor para los promotores. A pesar de los problemas, los descuentos durante eventos como Hot Sale son muy valorados. \"Conseguí la consola a un precio que no vi en ningún otro lado, valió la pena la espera\" (Usuario en Reddit).</li></ul>"
      },
      "Chile": {
        "sentimentIndex": [75, 76, 75, 76, 77, 78, 79, 85, 84, 83, 82, 82, 81],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [{ "month": "Apr 25", "text": "Nuevos beneficios Meli+" }],
        "table": [
          { "mes": "Ene 25", "detractores": "15%", "motivosDet": "Pocos beneficios vs N6", "promotores": "35%", "motivosPro": "Envíos y streaming", "eventos": "Periodo estable", "competencia": "Falabella con dctos CMR" },
          { "mes": "Abr 25", "detractores": "8%", "motivosDet": "Costo de suscripción", "promotores": "55%", "motivosPro": "Nuevos descuentos y Universal+", "eventos": "Lanzamiento de nuevos beneficios", "competencia": "Ripley con ofertas online" }
        ],
        "summary": "<ul><li><strong>Detractores:</strong> Las quejas son minoritarias y se centran en el costo de la suscripción, especialmente antes de la actualización de beneficios. \"Pago Meli+ pero los descuentos de Falabella con la CMR a veces son mejores\" (Reclamo en SERNAC).</li><li><strong>Promotores:</strong> El sentimiento se disparó en <strong>Abril 2025</strong> con la introducción de nuevos beneficios, incluyendo descuentos en marcas asociadas y la adición de Universal+. \"Ahora sí que se siente como un programa premium, los descuentos en farmacias y el nuevo canal lo valen\" (Usuario en X).</li></ul>"
      },
      "Argentina": {
        "sentimentIndex": [72, 73, 72, 74, 73, 74, 75, 76, 82, 80, 79, 78, 78],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [{ "month": "May 25", "text": "Lanzamiento Meli+" }],
        "table": [
          { "mes": "Abr 25", "detractores": "18%", "motivosDet": "Confusión con Nivel 6", "promotores": "38%", "motivosPro": "Beneficios de Nivel 6", "eventos": "Pre-lanzamiento Meli+", "competencia": "Promociones bancarias" },
          { "mes": "May 25", "detractores": "10%", "motivosDet": "Costo mensual", "promotores": "52%", "motivosPro": "Mejora de beneficios vs N6", "eventos": "Lanzamiento Meli+ (reemplaza N6)", "competencia": "Ualá con programa de puntos" }
        ],
        "summary": "<ul><li><strong>Detractores:</strong> El principal punto de fricción es el costo de la suscripción en un contexto económico complejo, aunque la percepción de valor es mayoritariamente positiva. \"Me cambiaron de Nivel 6 a Meli+ y me subieron el precio, no estoy seguro si lo vale\" (tuquejasuma.com).</li><li><strong>Promotores:</strong> La transición a Meli+ en <strong>Mayo 2025</strong> fue bien recibida, ya que se percibió como una mejora tangible sobre Nivel 6, especialmente con la inclusión de más servicios de streaming. \"Pasar a Meli+ fue automático y ahora tengo Max además de Disney. Un golazo.\" (Comentario en Instagram).</li></ul>"
      },
      "Colombia": {
        "sentimentIndex": [70, 71, 70, 71, 72, 72, 71, 70, 68, 69, 70, 78, 77],
        "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25"],
        "events": [{ "month": "May 25", "text": "Amazon Prime llega a CO" }, { "month": "Ago 25", "text": "Lanzamiento Meli+" }],
        "table": [
          { "mes": "May 25", "detractores": "20%", "motivosDet": "Comparación con Amazon", "promotores": "35%", "motivosPro": "Beneficios Nivel 6", "eventos": "Contexto competitivo", "competencia": "Lanzamiento de Amazon Prime en CO" },
          { "mes": "Ago 25", "detractores": "12%", "motivosDet": "Costo de suscripción", "promotores": "50%", "motivosPro": "Paquete de streaming superior", "eventos": "Lanzamiento Meli+", "competencia": "Rappi Pro con nuevas ofertas" }
        ],
        "summary": "<ul><li><strong>Detractores:</strong> La llegada de Amazon Prime a Colombia en <strong>Mayo 2025</strong> generó comparaciones directas con la oferta de Nivel 6, provocando una ligera caída en el sentimiento. Las quejas se centraban en la velocidad de entrega de Amazon en Bogotá. \"Pedí por Amazon y me llegó en un día, Mercado Libre a veces tarda más\" (Usuario en X).</li><li><strong>Promotores:</strong> El lanzamiento de Meli+ en <strong>Agosto 2025</strong> fue una respuesta contundente y muy bien recibida, disparando el sentimiento positivo. El argumento clave fue el paquete de entretenimiento. \"Amazon tiene su video, pero Meli+ me da Disney y Max. No hay comparación.\" (Queja resuelta en SIC).</li></ul>"
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      { "id": 1, "entity": "Amazon Prime", "country": "Brasil", "impact": "Alto", "title": "Amazon anuncia aquisição da Loggi para fortalecer entregas no Brasil e competir com Mercado Livre", "url": "https://www.aboutamazon.com/news/amazon-acquires-loggi-to-strengthen-brazil-operations", "date": "12-09-2025", "category": "Fusión/Adquisición", "summary": "Amazon confirma a compra da startup de logística Loggi em um movimento estratégico para expandir sua capacidade de entrega de última milha no Brasil.", "publisher": "aboutamazon.com", "url_raw": "https://www.aboutamazon.com/news/amazon-acquires-loggi-to-strengthen-brazil-operations", "url_canonical": "https://www.aboutamazon.com/news/amazon-acquires-loggi-to-strengthen-brazil-operations", "http_status": "200", "language": "pt", "out_of_window": false },
      { "id": 2, "entity": "Shopee", "country": "México", "impact": "Medio", "title": "Shopee y OXXO expanden alianza para pagos en efectivo y recolección de paquetes a nivel nacional", "url": "https://shopee.com.mx/press/oxxo-alliance-expansion", "date": "10-09-2025", "category": "Estrategia", "summary": "La alianza permitirá a usuarios sin tarjeta de crédito comprar y recoger sus pedidos en más de 20,000 tiendas OXXO, ampliando la base de clientes potenciales de Shopee.", "publisher": "shopee.com.mx", "url_raw": "https://shopee.com.mx/press/oxxo-alliance-expansion", "url_canonical": "https://shopee.com.mx/press/oxxo-alliance-expansion", "http_status": "200", "language": "es", "out_of_window": false },
      { "id": 3, "entity": "Rappi Pro", "country": "Colombia", "impact": "Medio", "title": "Rappi lanza nueva categoría 'Rappi Viajes' con descuentos exclusivos para miembros Pro", "url": "https://blog.rappi.com/colombia/rappi-viajes-pro", "date": "09-09-2025", "category": "Lanzamiento", "summary": "Miembros de Rappi Pro ahora tienen acceso a descuentos en vuelos, hoteles y paquetes turísticos, añadiendo un nuevo pilar de valor a su suscripción.", "publisher": "blog.rappi.com", "url_raw": "https://blog.rappi.com/colombia/rappi-viajes-pro", "url_canonical": "https://blog.rappi.com/colombia/rappi-viajes-pro", "http_status": "200", "language": "es", "out_of_window": false },
      { "id": 4, "entity": "Nubank", "country": "México", "impact": "Alto", "title": "Nu México recibe aprobación final para operar como Institución de Banca Múltiple y anuncia lanzamiento de cuenta de débito de alto rendimiento", "url": "https://blog.nu.com.mx/nu-banca-multiple-aprobacion-final/", "date": "05-09-2025", "category": "Sanción Legal", "summary": "La CNBV otorgó la licencia final a Nu México para operar como banco. La compañía planea lanzar una cuenta de débito con rendimientos competitivos, intensificando la competencia con Mercado Pago.", "publisher": "blog.nu.com.mx", "url_raw": "https://blog.nu.com.mx/nu-banca-multiple-aprobacion-final/", "url_canonical": "https://blog.nu.com.mx/nu-banca-multiple-aprobacion-final/", "http_status": "200", "language": "es", "out_of_window": false },
      { "id": 5, "entity": "Temu", "country": "Brasil", "impact": "Medio", "title": "Receita Federal notifica Temu sobre novas regras de conformidade para importações no programa Remessa Conforme", "url": "https://www.reuters.com/world/americas/brazil-notifies-temu-new-import-compliance-rules-2025-09-04/", "date": "04-09-2025", "category": "Sanción Legal", "summary": "Las nuevas directrices buscan asegurar la correcta declaración de valores y el pago de impuestos, lo que podría impactar la estrategia de precios de la plataforma asiática en Brasil.", "publisher": "reuters.com", "url_raw": "https://www.reuters.com/world/americas/brazil-notifies-temu-new-import-compliance-rules-2025-09-04/", "url_canonical": "https://www.reuters.com/world/americas/brazil-notifies-temu-new-import-compliance-rules-2025-09-04/", "http_status": "200", "language": "en", "out_of_window": false }
    ];
    const contentNewsData = [
      { "id": 101, "entity": "OpenAI", "country": "Todos los Países", "impact": "Alto", "title": "OpenAI launches GPT-5, making it available to ChatGPT Plus subscribers and via API", "url": "https://openai.com/blog/gpt-5", "date": "15-09-2025", "category": "Flagship AI", "summary": "The new flagship model boasts significant improvements in reasoning, speed, and multimodality, setting a new benchmark for the industry.", "publisher": "openai.com", "url_raw": "https://openai.com/blog/gpt-5", "url_canonical": "https://openai.com/blog/gpt-5", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 102, "entity": "Apple TV+", "country": "Todos los Países", "impact": "Medio", "title": "Apple greenlights 'Foundation' for a fourth season after strong viewership for season 3", "url": "https://www.apple.com/tv-pr/news/2025/09/apple-tv-renews-foundation-for-fourth-season/", "date": "13-09-2025", "category": "Estrategia", "summary": "Apple TV+ has officially renewed its flagship sci-fi series, signaling continued investment in high-budget, prestige content.", "publisher": "apple.com", "url_raw": "https://www.apple.com/tv-pr/news/2025/09/apple-tv-renews-foundation-for-fourth-season/", "url_canonical": "https://www.apple.com/tv-pr/news/2025/09/apple-tv-renews-foundation-for-fourth-season/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 103, "entity": "Max", "country": "Todos los Países", "impact": "Alto", "title": "Warner Bros. Discovery secures exclusive LaLiga streaming rights for Latin America on Max starting 2026-27 season", "url": "https://pressroom.wbd.com/wbd-secures-laliga-rights-latam", "date": "11-09-2025", "category": "Derechos/Deportes", "summary": "El acuerdo multianual cubre todos los países de habla hispana en la región e incluye todos los partidos, fortaleciendo la oferta deportiva de Max frente a sus competidores.", "publisher": "pressroom.wbd.com", "url_raw": "https://pressroom.wbd.com/wbd-secures-laliga-rights-latam", "url_canonical": "https://pressroom.wbd.com/wbd-secures-laliga-rights-latam", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 104, "entity": "Disney+", "country": "Todos los Países", "impact": "Medio", "title": "Disney+ announces global price increase for ad-free tier effective November 2025", "url": "https://thewaltdisneycompany.com/disney-plus-price-increase-q4-2025/", "date": "09-09-2025", "category": "Cambio de Precio", "summary": "El precio del plan premium aumentará en promedio un 15% en los principales mercados, mientras que el plan con anuncios mantendrá su precio actual para impulsar su adopción.", "publisher": "thewaltdisneycompany.com", "url_raw": "https://thewaltdisneycompany.com/disney-plus-price-increase-q4-2025/", "url_canonical": "https://thewaltdisneycompany.com/disney-plus-price-increase-q4-2025/", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 105, "entity": "Netflix", "country": "Todos los Países", "impact": "Medio", "title": "Netflix Confirms 'Stranger Things' Final Season to Premiere in Two Parts in Summer 2026", "url": "https://about.netflix.com/en/news/stranger-things-final-season-premiere-date", "date": "06-09-2025", "category": "Lanzamiento", "summary": "La compañía confirmó que la muy esperada temporada final de su exitosa serie se dividirá en dos volúmenes, una estrategia para maximizar el engagement y la retención de suscriptores.", "publisher": "about.netflix.com", "url_raw": "https://about.netflix.com/en/news/stranger-things-final-season-premiere-date", "url_canonical": "https://about.netflix.com/en/news/stranger-things-final-season-premiere-date", "http_status": "200", "language": "en", "out_of_window": false },
      { "id": 106, "entity": "Spotify", "country": "Todos los Países", "impact": "Medio", "title": "Spotify rolls out new 'AI Concerts' feature that recommends live shows based on listening history", "url": "https://newsroom.spotify.com/2025-09-04/introducing-ai-concerts-recommendations/", "date": "04-09-2025", "category": "Producto", "summary": "La nueva función utiliza IA para analizar los hábitos de escucha y la ubicación del usuario para recomendar y facilitar la compra de boletos para conciertos, integrándose con las principales boleteras.", "publisher": "newsroom.spotify.com", "url_raw": "https://newsroom.spotify.com/2025-09-04/introducing-ai-concerts-recommendations/", "url_canonical": "https://newsroom.spotify.com/2025-09-04/introducing-ai-concerts-recommendations/", "http_status": "200", "language": "en", "out_of_window": false }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      const html = [
        `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}all" value="all" class="mr-2"><label for="${idBase}all">Todos</label></div>`,
        ...allItems.map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${c}" value="${c}" class="mr-2"><label for="${idBase}${c}">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES.filter(c => c!=='Todos los Países'), 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES.filter(c => c!=='Todos los Países'), 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category-');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }
    function normalizeSelectAll(container, selectedValues) {
      const allBox = container.querySelector('input[value="all"]');
      const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b.value !== 'all');
      if (!allBox) return;
      if (selectedValues.includes('all')) rest.forEach(b => b.checked = false);
      else if (rest.some(b => b.checked)) allBox.checked = false;
    }
    function filterNews() {
      let sc = getSelected(newsFilterCountryContainer);
      let se = getSelected(newsFilterCompanyContainer);
      let sk = getSelected(newsFilterCategoryContainer);
      normalizeSelectAll(newsFilterCountryContainer, sc);
      normalizeSelectAll(newsFilterCompanyContainer, se);
      normalizeSelectAll(newsFilterCategoryContainer, sk);
      sc = getSelected(newsFilterCountryContainer);
      se = getSelected(newsFilterCompanyContainer);
      sk = getSelected(newsFilterCategoryContainer);
      newsFilters.country = sc.includes('all') ? [] : sc;
      newsFilters.company = se.includes('all') ? [] : se;
      newsFilters.category = sk.includes('all') ? [] : sk;
      renderNewsCards();
    }
    function filterContentNews() {
      let sc = getSelected(contentFilterCountryContainer);
      let se = getSelected(contentFilterCompanyContainer);
      let sk = getSelected(contentFilterCategoryContainer);
      normalizeSelectAll(contentFilterCountryContainer, sc);
      normalizeSelectAll(contentFilterCompanyContainer, se);
      normalizeSelectAll(contentFilterCategoryContainer, sk);
      sc = getSelected(contentFilterCountryContainer);
      se = getSelected(contentFilterCompanyContainer);
      sk = getSelected(contentFilterCategoryContainer);
      contentFilters.country = sc.includes('all') ? [] : sc;
      contentFilters.company = se.includes('all') ? [] : se;
      contentFilters.category = sk.includes('all') ? [] : sk;
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    updateSentimentContent('Brasil');
    updateNewsFilters(); renderNewsCards();
    updateContentNewsFilters(); renderContentNewsCards();
  </script>
</body>
</html>