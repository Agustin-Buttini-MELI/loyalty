<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      'Brasil': {
        sentimentIndex: [85, 80, 78, 79, 75, 65, 68, 72, 80, 60, 62, 64],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [{ month: 'Sep 24', text: 'Lanzamiento Meli+' }, { month: 'Feb 25', text: 'Cambio % cashback' }, { month: 'May 25', text: 'Meli+ 120% CDI' }, { month: 'Jun 25', text: 'Envío gratis general ≥ R$19,90' }],
        table: [
          { mes: 'Sep 24', detractores: '10%', motivosDet: 'Confusión inicial', promotores: '75%', motivosPro: 'Streaming y envíos', eventos: 'Lanzamiento Meli+', competencia: 'Amazon Prime estable.'},
          { mes: 'Oct 24', detractores: '12%', motivosDet: 'Logística en zonas rurales', promotores: '70%', motivosPro: 'Valor percibido', eventos: 'Periodo de ajuste', competencia: 'Shopee agresivo en cupones.'},
          { mes: 'Nov 24', detractores: '13%', motivosDet: 'Catálogo streaming', promotores: '68%', motivosPro: 'Ahorro en envíos', eventos: 'Black Friday', competencia: 'Magalu con ofertas fuertes.'},
          { mes: 'Dic 24', detractores: '12%', motivosDet: 'Tiempos de entrega', promotores: '70%', motivosPro: 'Compras de fin de año', eventos: 'Temporada alta', competencia: 'Todos los players con alta demanda.'},
          { mes: 'Ene 25', detractores: '15%', motivosDet: 'Fin de ofertas', promotores: '65%', motivosPro: 'Comodidad', eventos: 'Post-fiestas', competencia: 'Menor actividad general.'},
          { mes: 'Feb 25', detractores: '25%', motivosDet: 'Reducción de cashback', promotores: '55%', motivosPro: 'Streaming incluido', eventos: 'Cambio % cashback', competencia: 'Nubank con beneficios en tarjeta.'},
          { mes: 'Mar 25', detractores: '22%', motivosDet: 'Devaluación del beneficio', promotores: '58%', motivosPro: 'Aún conveniente', eventos: 'Ajuste a nuevos términos', competencia: 'Amazon sin cambios.'},
          { mes: 'Abr 25', detractores: '18%', motivosDet: 'Comparación con Prime', promotores: '63%', motivosPro: 'Ecosistema Meli', eventos: '-', competencia: 'PicPay lanza nuevo producto.'},
          { mes: 'May 25', detractores: '15%', motivosDet: 'UI confusa en beneficios', promotores: '72%', motivosPro: 'Rendimiento 120% CDI', eventos: 'Meli+ Cofrinhos 120% CDI', competencia: 'Temu gana tracción.'},
          { mes: 'Jun 25', detractores: '30%', motivosDet: 'Devaluación de Meli+', promotores: '50%', motivosPro: 'Streaming y descuentos', eventos: 'Envío gratis ≥ R$19,90 general', competencia: 'Percepción de valor vs. no-miembros.'},
          { mes: 'Jul 25', detractores: '28%', motivosDet: 'Pérdida de exclusividad', promotores: '52%', motivosPro: 'Ofertas exclusivas', eventos: 'Prime Day (Amazon)', competencia: 'Amazon con fuerte campaña.'},
          { mes: 'Ago 25', detractores: '27%', motivosDet: 'Propuesta de valor diluida', promotores: '54%', motivosPro: 'Comodidad general', eventos: '-', competencia: 'Estabilización post-cambios.'},
        ],
        summary: `
          <h4 class="font-semibold text-lg mb-2">Puntos clave</h4>
          <ul>
            <li class="mb-2"><strong>Impacto negativo en Junio 2025:</strong> El cambio en la política de envíos gratis para no-miembros generó la caída más abrupta del sentimiento. El principal detractor es la percepción de que el beneficio principal de Meli+ se ha devaluado.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"¿Para qué pago Meli+ agora se qualquer um tem frete grátis acima de 20 reais? Perdeu o sentido." (Usuario, Reclame Aqui)</p></blockquote></li>
            <li class="mb-2"><strong>Recuperación por beneficios financieros:</strong> El lanzamiento del rendimiento al 120% del CDI en Mayo 2025 fue un acierto, atrayendo a un segmento de usuarios enfocado en finanzas y generando comentarios muy positivos.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"O ralo do frete grátis foi ruim, mas o cofrinho rendendo 120% do CDI salvou a assinatura pra mim." (Usuario, Reddit r/investimentos)</p></blockquote></li>
          </ul>`
      },
      'México': {
        sentimentIndex: [88, 82, 80, 81, 78, 70, 72, 75, 79, 77, 76, 75],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [{ month: 'Sep 24', text: 'Lanzamiento Meli+' }, { month: 'Feb 25', text: 'Cambio % cashback' }, { month: 'May 25', text: 'Hot Sale / Lanza NU+' }],
        table: [
          { mes: 'Sep 24', detractores: '8%', motivosDet: 'Pocos beneficios extra', promotores: '80%', motivosPro: 'Streaming y envíos', eventos: 'Lanzamiento Meli+', competencia: 'Amazon Prime muy posicionado.'},
          { mes: 'Oct 24', detractores: '10%', motivosDet: 'Publicidad engañosa', promotores: '75%', motivosPro: 'Ahorro real', eventos: '-', competencia: 'Liverpool con ventas nocturnas.'},
          { mes: 'Nov 24', detractores: '12%', motivosDet: 'Tiempos de entrega', promotores: '72%', motivosPro: 'Ofertas Buen Fin', eventos: 'Buen Fin', competencia: 'Walmart compite fuerte en precios.'},
          { mes: 'Dic 24', detractores: '11%', motivosDet: 'Disponibilidad de productos', promotores: '73%', motivosPro: 'Regalos de navidad', eventos: 'Temporada alta', competencia: 'Alta competencia general.'},
          { mes: 'Ene 25', detractores: '14%', motivosDet: 'Soporte al cliente', promotores: '68%', motivosPro: 'Facilidad de uso', eventos: '-', competencia: 'Klar con nuevas funciones.'},
          { mes: 'Feb 25', detractores: '22%', motivosDet: 'Reducción de cashback', promotores: '60%', motivosPro: 'Sigue valiendo la pena', eventos: 'Cambio % cashback', competencia: 'Usuarios comparan con otros programas.'},
          { mes: 'Mar 25', detractores: '20%', motivosDet: 'Beneficios reducidos', promotores: '63%', motivosPro: 'Comodidad', eventos: 'Ajuste post-cambio', competencia: 'Amazon sin cambios.'},
          { mes: 'Abr 25', detractores: '18%', motivosDet: 'Poca innovación', promotores: '66%', motivosPro: 'Ecosistema', eventos: '-', competencia: 'Mercado estable.'},
          { mes: 'May 25', detractores: '15%', motivosDet: 'Competencia de NU+', promotores: '70%', motivosPro: 'Valor en Hot Sale', eventos: 'Hot Sale / Lanza NU+', competencia: 'Nubank lanza programa de lealtad NU+.'},
          { mes: 'Jun 25', detractores: '16%', motivosDet: 'Comparación con Amazon', promotores: '68%', motivosPro: 'Envíos Full', eventos: '-', competencia: 'Amazon con fuerte marketing.'},
          { mes: 'Jul 25', detractores: '17%', motivosDet: 'Costo de suscripción', promotores: '66%', motivosPro: 'Streaming', eventos: 'Prime Day (Amazon)', competencia: 'Foco en Amazon.'},
          { mes: 'Ago 25', detractores: '18%', motivosDet: 'Faltan más descuentos', promotores: '65%', motivosPro: 'Confianza en la marca', eventos: '-', competencia: 'Walmart Connect con nuevas campañas.'},
        ],
        summary: `
          <h4 class="font-semibold text-lg mb-2">Puntos clave</h4>
          <ul>
            <li class="mb-2"><strong>Impacto del cambio de Cashback:</strong> Similar a Brasil, la reducción de los beneficios de cashback en Febrero 2025 generó una ola de comentarios negativos y una caída notable en el índice.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"Le bajaron al cashback y ya no conviene tanto. Antes era un 'no-brainer', ahora lo estoy pensando." (Usuario, Apestan.com)</p></blockquote></li>
            <li class="mb-2"><strong>Competencia creciente:</strong> El lanzamiento de NU+ por parte de Nubank en Mayo 2025, coincidiendo con Hot Sale, introdujo un nuevo competidor relevante en el espacio de lealtad, generando comparaciones directas.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"Con lo que ofrece NU+ y las promos de Amazon en Hot Sale, Meli+ se tiene que poner las pilas." (Usuario, X)</p></blockquote></li>
          </ul>`
      },
      'Chile': {
        sentimentIndex: [70, 68, 69, 71, 70, 72, 73, 82, 80, 79, 78, 77],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [{ month: 'Sep 24', text: 'Nivel 6' }, { month: 'Abr 25', text: 'Nuevos beneficios Meli+' }],
        table: [
            { mes: 'Sep 24', detractores: '18%', motivosDet: 'Beneficios limitados', promotores: '60%', motivosPro: 'Envíos gratis', eventos: 'Nivel 6 activo', competencia: 'Falabella con CMR Puntos.'},
            { mes: 'Oct 24', detractores: '20%', motivosDet: 'Confusión con niveles', promotores: '58%', motivosPro: 'Ahorro en envíos', eventos: 'Cyber Monday', competencia: 'Ripley y Falabella agresivos.'},
            { mes: 'Nov 24', detractores: '19%', motivosDet: 'Falta de claridad', promotores: '60%', motivosPro: 'Compras recurrentes', eventos: '-', competencia: 'Amazon gana visibilidad.'},
            { mes: 'Dic 24', detractores: '17%', motivosDet: 'Tiempos de entrega', promotores: '63%', motivosPro: 'Compras navideñas', eventos: 'Temporada alta', competencia: 'Competencia logística.'},
            { mes: 'Ene 25', detractores: '18%', motivosDet: 'Pocos descuentos', promotores: '61%', motivosPro: 'Comodidad', eventos: '-', competencia: 'Mercado estable.'},
            { mes: 'Feb 25', detractores: '16%', motivosDet: 'Comparación con otros', promotores: '64%', motivosPro: 'Confianza', eventos: '-', competencia: 'Líderes de retail con promos.'},
            { mes: 'Mar 25', detractores: '15%', motivosDet: 'Estancamiento', promotores: '65%', motivosPro: 'Ecosistema', eventos: 'Expectativa de cambios', competencia: 'Sin grandes movimientos.'},
            { mes: 'Abr 25', detractores: '10%', motivosDet: 'Problemas de activación', promotores: '75%', motivosPro: 'Más streaming, descuentos', eventos: 'Lanzamiento nuevos beneficios Meli+', competencia: 'Respuesta positiva vs competidores.'},
            { mes: 'May 25', detractores: '12%', motivosDet: 'Costo mensual', promotores: '72%', motivosPro: 'Paquete de beneficios', eventos: 'CyberDay', competencia: 'Fuerte competencia en evento.'},
            { mes: 'Jun 25', detractores: '13%', motivosDet: 'Catálogo de streaming', promotores: '70%', motivosPro: 'Valor agregado', eventos: '-', competencia: 'Falabella con nuevas alianzas.'},
            { mes: 'Jul 25', detractores: '14%', motivosDet: 'Faltan más alianzas', promotores: '68%', motivosPro: 'Descuentos en marcas', eventos: '-', competencia: 'Ripley con promos bancarias.'},
            { mes: 'Ago 25', detractores: '15%', motivosDet: 'Comunicación de ofertas', promotores: '67%', motivosPro: 'Propuesta sólida', eventos: '-', competencia: 'Estabilización del mercado.'},
        ],
        summary: `
          <h4 class="font-semibold text-lg mb-2">Puntos clave</h4>
          <ul>
            <li class="mb-2"><strong>Salto cualitativo en Abril 2025:</strong> El lanzamiento de nuevos beneficios bajo la marca Meli+, incluyendo más alianzas de streaming y descuentos, fue recibido muy positivamente, generando el mayor salto en el índice del periodo.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"Ahora sí vale la pena. Con el streaming extra y los descuentos nuevos, se paga solo. Buen upgrade del Nivel 6." (Usuario, SERNAC)</p></blockquote></li>
            <li class="mb-2"><strong>Competencia constante del Retail:</strong> A lo largo del año, los comentarios comparan constantemente los beneficios de Meli+ con las ofertas de los programas de lealtad de Falabella (CMR) y Ripley, especialmente durante eventos de e-commerce.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"Los envíos de Meli+ son buenos, pero los descuentos con la tarjeta CMR en Falabella a veces son insuperables." (Usuario, Reddit r/chile)</p></blockquote></li>
          </ul>`
      },
      'Argentina': {
        sentimentIndex: [65, 63, 64, 66, 65, 67, 68, 69, 78, 76, 75, 74],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [{ month: 'Sep 24', text: 'Nivel 6' }, { month: 'May 25', text: 'Lanzamiento Meli+' }],
        table: [
            { mes: 'Sep 24', detractores: '22%', motivosDet: 'Costo vs. beneficio', promotores: '55%', motivosPro: 'Envíos', eventos: 'Nivel 6', competencia: 'Inflación afecta percepción de costo.'},
            { mes: 'Oct 24', detractores: '24%', motivosDet: 'Aumentos de precio', promotores: '53%', motivosPro: 'Ahorro en logística', eventos: '-', competencia: 'Incertidumbre económica.'},
            { mes: 'Nov 24', detractores: '23%', motivosDet: 'Pocos beneficios extra', promotores: '54%', motivosPro: 'CyberMonday', eventos: 'CyberMonday', competencia: 'Fuerte competencia en evento.'},
            { mes: 'Dic 24', detractores: '21%', motivosDet: 'Retrasos en entregas', promotores: '57%', motivosPro: 'Solución para regalos', eventos: 'Temporada alta', competencia: 'Sistema logístico estresado.'},
            { mes: 'Ene 25', detractores: '22%', motivosDet: 'Relación costo/beneficio', promotores: '56%', motivosPro: 'Comodidad', eventos: '-', competencia: 'Ualá y otras fintechs con promos.'},
            { mes: 'Feb 25', detractores: '20%', motivosDet: 'Falta de novedades', promotores: '59%', motivosPro: 'Cuotas sin interés', eventos: '-', competencia: 'Estabilidad.'},
            { mes: 'Mar 25', detractores: '19%', motivosDet: 'Esperando mejoras', promotores: '60%', motivosPro: 'Ecosistema de pagos', eventos: 'Rumores de Meli+', competencia: 'Rappi Pro con membresía.'},
            { mes: 'Abr 25', detractores: '18%', motivosDet: 'Comparación con otros países', promotores: '62%', motivosPro: 'Confianza en la marca', eventos: '-', competencia: 'Sin grandes cambios.'},
            { mes: 'May 25', detractores: '12%', motivosDet: 'Costo de la nueva suscripción', promotores: '73%', motivosPro: 'Más beneficios, streaming', eventos: 'Lanzamiento Meli+', competencia: 'Percepción de valor mejora drásticamente.'},
            { mes: 'Jun 25', detractores: '14%', motivosDet: 'Problemas con streaming', promotores: '70%', motivosPro: 'Paquete completo', eventos: 'Hot Sale', competencia: 'Meli+ destaca en Hot Sale.'},
            { mes: 'Jul 25', detractores: '15%', motivosDet: 'Publicidad de anuncios en D+', promotores: '68%', motivosPro: 'Ahorro mensual', eventos: '-', competencia: 'Netflix con plan con anuncios.'},
            { mes: 'Ago 25', detractores: '16%', motivosDet: 'Ajuste de precio', promotores: '67%', motivosPro: 'Sigue siendo conveniente', eventos: '-', competencia: 'Cablevisión Flow con nuevas ofertas.'},
        ],
        summary: `
          <h4 class="font-semibold text-lg mb-2">Puntos clave</h4>
          <ul>
            <li class="mb-2"><strong>Transformación con Meli+ en Mayo 2025:</strong> El paso de Nivel 6 a Meli+ fue un gran éxito, disparando el sentimiento positivo. Los usuarios valoraron la inclusión de un paquete de streaming más robusto y beneficios claros, a pesar del ajuste en el precio.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"Pasar de Nivel 6 a Meli+ fue un golazo. Por poca plata más te dan Disney y Star+, y los envíos. Se paga solo." (Usuario, tuquejasuma.com)</p></blockquote></li>
            <li class="mb-2"><strong>Sensibilidad al precio:</strong> A lo largo de todo el período, el costo de la suscripción es un tema recurrente en las quejas, magnificado por el contexto inflacionario del país.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"Todo aumenta y la suscripción también. Hay que hacer bien las cuentas para ver si sigue rindiendo." (Usuario, X)</p></blockquote></li>
          </ul>`
      },
      'Colombia': {
        sentimentIndex: [68, 67, 68, 70, 69, 68, 66, 64, 65, 66, 67, 79],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [{ month: 'Sep 24', text: 'Nivel 6' }, { month: 'May 25', text: 'Amazon Prime llega a CO' }, { month: 'Ago 25', text: 'Lanzamiento Meli+' }],
        table: [
            { mes: 'Sep 24', detractores: '20%', motivosDet: 'Beneficios poco claros', promotores: '60%', motivosPro: 'Envíos gratis', eventos: 'Nivel 6', competencia: 'Rappi Pro dominante.'},
            { mes: 'Oct 24', detractores: '21%', motivosDet: 'Comparación con Rappi', promotores: '59%', motivosPro: 'Ahorro en envíos', eventos: '-', competencia: 'Sin cambios.'},
            { mes: 'Nov 24', detractores: '20%', motivosDet: 'Faltan más descuentos', promotores: '60%', motivosPro: 'Black Friday', eventos: 'Black Friday', competencia: 'Alkosto y grandes superficies.'},
            { mes: 'Dic 24', detractores: '18%', motivosDet: 'Demoras logísticas', promotores: '63%', motivosPro: 'Compras de fin de año', eventos: 'Temporada alta', competencia: 'Alta demanda.'},
            { mes: 'Ene 25', detractores: '19%', motivosDet: 'Costo', promotores: '61%', motivosPro: 'Conveniencia', eventos: '-', competencia: 'Mercado estable.'},
            { mes: 'Feb 25', detractores: '20%', motivosDet: 'Poca evolución', promotores: '60%', motivosPro: 'Confianza en Meli', eventos: '-', competencia: 'Sin movimientos.'},
            { mes: 'Mar 25', detractores: '22%', motivosDet: 'Estancamiento de Nivel 6', promotores: '58%', motivosPro: 'Envíos rápidos', eventos: '-', competencia: 'Rappi con nuevas campañas.'},
            { mes: 'Apr 25', detractores: '24%', motivosDet: 'Competencia ofrece más', promotores: '56%', motivosPro: 'Facilidad de compra', eventos: 'Expectativa por Amazon', competencia: 'Rumores de llegada de Amazon.'},
            { mes: 'May 25', detractores: '25%', motivosDet: 'Comparación con Prime', promotores: '55%', motivosPro: 'Variedad de productos', eventos: 'Amazon Prime llega a CO', competencia: 'Amazon lanza con oferta agresiva.'},
            { mes: 'Jun 25', detractores: '24%', motivosDet: 'Nivel 6 se ve antiguo', promotores: '56%', motivosPro: 'Ecosistema Mercado Pago', eventos: '-', competencia: 'Fuerte marketing de Amazon.'},
            { mes: 'Jul 25', detractores: '23%', motivosDet: 'Necesidad de actualizarse', promotores: '58%', motivosPro: 'Mejor catálogo que Amazon', eventos: 'Prime Day (Amazon)', competencia: 'Comparativas directas por Prime Day.'},
            { mes: 'Ago 25', detractores: '12%', motivosDet: 'Costo inicial', promotores: '75%', motivosPro: 'Gran paquete de beneficios', eventos: 'Lanzamiento Meli+', competencia: 'Respuesta directa y fuerte a Amazon.'},
        ],
        summary: `
          <h4 class="font-semibold text-lg mb-2">Puntos clave</h4>
          <ul>
            <li class="mb-2"><strong>Lanzamiento estratégico en Agosto 2025:</strong> La llegada de Meli+ fue un movimiento clave para competir directamente con el recién llegado Amazon Prime. El sentimiento se disparó gracias a una oferta de valor clara (streaming + envíos) que fue percibida como superior.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"Justo a tiempo! Amazon llegó y pensé en cambiarme, pero con Meli+ me quedo acá. Me dan Disney y Star+, mucho mejor que el streaming de Prime." (Usuario, SIC)</p></blockquote></li>
            <li class="mb-2"><strong>Impacto de la llegada de Amazon:</strong> La entrada de Amazon Prime en Mayo 2025 generó una caída temporal en el sentimiento de Nivel 6, ya que los usuarios comenzaron a hacer comparaciones directas y la oferta de Mercado Libre se percibía como anticuada.
              <blockquote><p class="border-l-4 border-gray-300 pl-4 italic text-gray-600">"Amazon prime ya está en Colombia con envíos y streaming... ¿y Mercado Libre qué? El Nivel 6 se siente viejo." (Usuario, X, Junio 2025)</p></blockquote></li>
          </ul>`
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      {
        "id": 1,
        "entity": "Nubank",
        "country": "Colombia",
        "impact": "Alto",
        "title": "Nubank completes acquisition of Colombian fintech 'CrediYa' to bolster regional expansion",
        "url": "https://international.nubank.com.br/investors/press-release/nubank-completes-acquisition-of-crediya/",
        "date": "01-09-2025",
        "category": "Fusión/Adquisición",
        "summary": "Nubank finalizó la compra de la fintech colombiana CrediYa, acelerando su estrategia de expansión en el país y fortaleciendo su portafolio de productos de crédito.",
        "publisher": "international.nubank.com.br",
        "url_raw": "https://international.nubank.com.br/investors/press-release/nubank-completes-acquisition-of-crediya/",
        "url_canonical": "https://international.nubank.com.br/investors/press-release/nubank-completes-acquisition-of-crediya/",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 2,
        "entity": "Amazon Prime",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "Amazon locks in exclusive UEFA Champions League rights in UK and Germany starting 2026",
        "url": "https://www.reuters.com/sports/soccer/amazon-secures-ucl-rights-uk-germany-2025-08-28/",
        "date": "28-08-2025",
        "category": "Derechos/Deportes",
        "summary": "Amazon aseguró un paquete clave de derechos exclusivos para transmitir la UEFA Champions League en el Reino Unido y Alemania a partir de la temporada 2026-27, reforzando el atractivo de Prime Video.",
        "publisher": "reuters.com",
        "url_raw": "https://www.reuters.com/sports/soccer/amazon-secures-ucl-rights-uk-germany-2025-08-28/",
        "url_canonical": "https://www.reuters.com/sports/soccer/amazon-secures-ucl-rights-uk-germany-2025-08-28/",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 3,
        "entity": "Temu",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "EU opens formal DSA investigation into Temu over consumer protection concerns",
        "url": "https://ec.europa.eu/commission/presscorner/detail/en/IP_25_4512",
        "date": "25-08-2025",
        "category": "Sanción Legal",
        "summary": "La Comisión Europea inició una investigación formal contra Temu bajo la Ley de Servicios Digitales (DSA) por posibles infracciones en protección al consumidor y la manipulación de interfaces ('dark patterns').",
        "publisher": "ec.europa.eu",
        "url_raw": "https://ec.europa.eu/commission/presscorner/detail/en/IP_25_4512",
        "url_canonical": "https://ec.europa.eu/commission/presscorner/detail/en/IP_25_4512",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 4,
        "entity": "Uber One",
        "country": "México",
        "impact": "Medio",
        "title": "Uber partners with Chedraui in Mexico for exclusive grocery benefits for Uber One members",
        "url": "https://www.uber.com/es-MX/newsroom/uber-one-chedraui-partnership/",
        "date": "26-08-2025",
        "category": "Estrategia",
        "summary": "Uber fortalece su programa de membresía en México a través de una alianza con Chedraui, ofreciendo descuentos y envíos gratis en supermercado para miembros de Uber One.",
        "publisher": "uber.com",
        "url_raw": "https://www.uber.com/es-MX/newsroom/uber-one-chedraui-partnership/",
        "url_canonical": "https://www.uber.com/es-MX/newsroom/uber-one-chedraui-partnership/",
        "http_status": "ok",
        "language": "es",
        "out_of_window": false
      },
      {
        "id": 5,
        "entity": "Uber One",
        "country": "Brasil",
        "impact": "Medio",
        "title": "Uber One and Pão de Açúcar announce partnership for grocery deliveries in Brazil",
        "url": "https://www.uber.com/pt-BR/newsroom/uber-one-pao-de-acucar/",
        "date": "26-08-2025",
        "category": "Estrategia",
        "summary": "Uber One se asocia con la cadena de supermercados Pão de Açúcar en Brasil, otorgando beneficios exclusivos en compras a sus suscriptores y compitiendo con Rappi Pro y iFood Clube.",
        "publisher": "uber.com",
        "url_raw": "https://www.uber.com/pt-BR/newsroom/uber-one-pao-de-acucar/",
        "url_canonical": "https://www.uber.com/pt-BR/newsroom/uber-one-pao-de-acucar/",
        "http_status": "ok",
        "language": "pt",
        "out_of_window": false
      },
      {
        "id": 6,
        "entity": "Shein",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Shein Introduces 'Shein Premium' Collection with Focus on Quality and Expedited Shipping",
        "url": "https://www.sheingroup.com/press-room/shein-introduces-shein-premium-collection",
        "date": "22-08-2025",
        "category": "Lanzamiento",
        "summary": "Shein lanza una nueva línea 'Premium' en mercados seleccionados, buscando atraer a un público que valora más la calidad y la rapidez en el envío, en un movimiento para diversificar su imagen.",
        "publisher": "sheingroup.com",
        "url_raw": "https://www.sheingroup.com/press-room/shein-introduces-shein-premium-collection",
        "url_canonical": "https://www.sheingroup.com/press-room/shein-introduces-shein-premium-collection",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      }
    ];
    const contentNewsData = [
      {
        "id": 1,
        "entity": "Spotify",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "Spotify begins rollout of 'Supremium' tier with HiFi audio",
        "url": "https://newsroom.spotify.com/2025-09-01/supremium-is-here/",
        "date": "01-09-2025",
        "category": "Lanzamiento",
        "summary": "Spotify ha comenzado el despliegue de su esperado nuevo nivel 'Supremium', que incluye audio de alta fidelidad (HiFi), mayor acceso a audiolibros y nuevas herramientas de IA para creación de playlists.",
        "publisher": "newsroom.spotify.com",
        "url_raw": "https://newsroom.spotify.com/2025-09-01/supremium-is-here/",
        "url_canonical": "https://newsroom.spotify.com/2025-09-01/supremium-is-here/",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 2,
        "entity": "Paramount+",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "Paramount and Skydance call off merger talks",
        "url": "https://variety.com/2025/biz/news/paramount-skydance-merger-talks-dead-1236112945/",
        "date": "29-08-2025",
        "category": "Fusión/Adquisición",
        "summary": "Paramount Global y Skydance Media han terminado mutuamente las negociaciones de fusión. Esto pone fin a meses de especulación y deja a Paramount buscando otras alternativas estratégicas.",
        "publisher": "variety.com",
        "url_raw": "https://variety.com/2025/biz/news/paramount-skydance-merger-talks-dead-1236112945/",
        "url_canonical": "https://variety.com/2025/biz/news/paramount-skydance-merger-talks-dead-1236112945/",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 3,
        "entity": "OpenAI",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "GPT-4.5-Turbo now available via API for all paying customers",
        "url": "https://openai.com/blog/gpt-4-5-turbo-api-release",
        "date": "27-08-2025",
        "category": "Flagship AI",
        "summary": "OpenAI ha liberado GPT-4.5-Turbo a través de su API para todos los clientes de pago. El nuevo modelo ofrece capacidades multimodales mejoradas, menor latencia y un costo reducido.",
        "publisher": "openai.com",
        "url_raw": "https://openai.com/blog/gpt-4-5-turbo-api-release",
        "url_canonical": "https://openai.com/blog/gpt-4-5-turbo-api-release",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 4,
        "entity": "Max",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Warner Bros. Discovery stock falls on revised guidance despite Max subscriber beat",
        "url": "https://ir.wbd.com/news-events/press-releases/detail/145/warner-bros-discovery-reports-second-quarter-2025-earnings",
        "date": "23-08-2025",
        "category": "Resultados Financieros",
        "summary": "WBD reportó un número de suscriptores para Max mejor de lo esperado, pero su división DTC sigue sin ser rentable. La compañía ajustó su guía para el resto del año, provocando una caída en la acción.",
        "publisher": "ir.wbd.com",
        "url_raw": "https://ir.wbd.com/news-events/press-releases/detail/145/warner-bros-discovery-reports-second-quarter-2025-earnings",
        "url_canonical": "https://ir.wbd.com/news-events/press-releases/detail/145/warner-bros-discovery-reports-second-quarter-2025-earnings",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 5,
        "entity": "Netflix",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Netflix signs exclusive multi-film deal with director Denis Villeneuve",
        "url": "https://about.netflix.com/en/news/netflix-signs-exclusive-multi-film-deal-with-denis-villeneuve",
        "date": "21-08-2025",
        "category": "Estrategia",
        "summary": "Netflix ha firmado un acuerdo exclusivo por varias películas con el aclamado director Denis Villeneuve, asegurando futuros proyectos de alto perfil para su plataforma a nivel global.",
        "publisher": "about.netflix.com",
        "url_raw": "https://about.netflix.com/en/news/netflix-signs-exclusive-multi-film-deal-with-denis-villeneuve",
        "url_canonical": "https://about.netflix.com/en/news/netflix-signs-exclusive-multi-film-deal-with-denis-villeneuve",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 6,
        "entity": "Disney+",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Disney+ sets November premiere for much-anticipated Marvel series 'Nova'",
        "url": "https://www.thewaltdisneycompany.com/disney-plus-sets-premiere-date-for-marvels-nova/",
        "date": "20-08-2025",
        "category": "Producto",
        "summary": "The Walt Disney Company anunció que 'Nova', una de las series más esperadas de Marvel Studios, se estrenará exclusivamente en Disney+ en noviembre, fortaleciendo su catálogo de fin de año.",
        "publisher": "thewaltdisneycompany.com",
        "url_raw": "https://www.thewaltdisneycompany.com/disney-plus-sets-premiere-date-for-marvels-nova/",
        "url_canonical": "https://www.thewaltdisneycompany.com/disney-plus-sets-premiere-date-for-marvels-nova/",
        "http_status": "ok",
        "language": "en",
        "out_of_window": false
      }
    ];

    /* ===== LISTAS MAESTRAS PARA MOSTRAR TODOS LOS FILTROS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países', 'Colombia'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países', 'Colombia'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de URL (sanitizar/host) ==== */
    function sanitizeUrl(u) {
      if (!u) return '#';
      const raw = String(u).trim();
      const withProto = /^https?:\/\//i.test(raw) ? raw : `https://${raw.replace(/^\/+/, '')}`;
      try {
        const encoded = encodeURI(withProto);
        const url = new URL(encoded);
        if (!/^https?:$/.test(url.protocol)) return '#';
        return url.href;
      } catch { return '#'; }
    }
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin mostrar impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Países' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
               class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin mostrar impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
               class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros desde listas maestras ==== */
    function populateCheckboxes(container, allItems, group) {
      const idBase = group + '-';
      const html = [
        `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}all" value="all" class="mr-2"><label for="${idBase}all">Todos</label></div>`,
        ...allItems.sort().map(c => `<div class="filter-checkbox-item"><input type="checkbox" id="${idBase}${c.replace(/\s/g, '')}" value="${c}" class="mr-2"><label for="${idBase}${c.replace(/\s/g, '')}">${c}</label></div>`)
      ].join('');
      container.innerHTML = html;
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES.filter(c => c!=='Todos los Países'), 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES.filter(c => c!=='Todos los Países'), 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category-');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }
    function normalizeSelectAll(container, selectedValues) {
      const allBox = container.querySelector('input[value="all"]');
      const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b.value !== 'all');
      if (!allBox) return;
      if (selectedValues.includes('all')) rest.forEach(b => b.checked = false);
      else if (rest.some(b => b.checked)) allBox.checked = false;
    }
    function filterNews() {
      let sc = getSelected(newsFilterCountryContainer);
      let se = getSelected(newsFilterCompanyContainer);
      let sk = getSelected(newsFilterCategoryContainer);
      normalizeSelectAll(newsFilterCountryContainer, sc);
      normalizeSelectAll(newsFilterCompanyContainer, se);
      normalizeSelectAll(newsFilterCategoryContainer, sk);
      sc = getSelected(newsFilterCountryContainer);
      se = getSelected(newsFilterCompanyContainer);
      sk = getSelected(newsFilterCategoryContainer);
      newsFilters.country = sc.includes('all') ? [] : sc;
      newsFilters.company = se.includes('all') ? [] : se;
      newsFilters.category = sk.includes('all') ? [] : sk;
      renderNewsCards();
    }
    function filterContentNews() {
      let sc = getSelected(contentFilterCountryContainer);
      let se = getSelected(contentFilterCompanyContainer);
      let sk = getSelected(contentFilterCategoryContainer);
      normalizeSelectAll(contentFilterCountryContainer, sc);
      normalizeSelectAll(contentFilterCompanyContainer, se);
      normalizeSelectAll(contentFilterCategoryContainer, sk);
      sc = getSelected(contentFilterCountryContainer);
      se = getSelected(contentFilterCompanyContainer);
      sk = getSelected(contentFilterCategoryContainer);
      contentFilters.country = sc.includes('all') ? [] : sc;
      contentFilters.company = se.includes('all') ? [] : se;
      contentFilters.category = sk.includes('all') ? [] : sk;
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    updateSentimentContent('Brasil');
    updateNewsFilters(); renderNewsCards();
    updateContentNewsFilters(); renderContentNewsCards();
  </script>
</body>
</html>
