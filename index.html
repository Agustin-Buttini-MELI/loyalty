<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
    /* flecha del summary */
    details summary { list-style: none; }
    details summary::-webkit-details-marker { display: none; }
    details > summary svg {
        transition: transform 0.2s;
    }
    details[open] > summary svg {
        transform: rotate(-180deg);
    }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">An√°lisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evoluci√≥n de la percepci√≥n de los clientes en funci√≥n de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">√çndice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <!-- GLOSARIO (nativo con <details>, sin JS) -->
    <section id="glosario" class="bg-white rounded-lg shadow-md border border-gray-200 mb-8">
        <details>
            <summary class="cursor-pointer w-full flex items-center justify-between px-4 py-3 text-left text-gray-800 font-semibold hover:bg-gray-50">
                <span>üìñ Glosario</span>
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
            </summary>
            <div class="px-4 pb-4 text-sm text-gray-700" id="glosario-content">
                <div class="pt-2 space-y-4 border-t">
                    <div>
                        <p class="font-semibold mb-1">Niveles de sentimiento</p>
                        <ul class="list-disc list-inside space-y-1">
                        <li><span class="text-emerald-700 font-medium">Muy alto:</span> ‚â•55% menciones ponderadas o +10 p.p. vs. promedio 3m.</li>
                        <li><span class="text-emerald-600 font-medium">Alto:</span> 50‚Äì54% o +5 a +9 p.p.</li>
                        <li><span class="text-gray-700 font-medium">Estable:</span> cambio ‚â§¬±3 p.p. vs. mes previo.</li>
                        <li><span class="text-rose-600 font-medium">Bajo:</span> 30‚Äì39% o ‚àí5 a ‚àí9 p.p.</li>
                        <li><span class="text-rose-700 font-medium">Muy bajo:</span> ‚â§29% o ca√≠da ‚â•‚àí10 p.p.</li>
                        </ul>
                    </div>
                    <div>
                        <p class="font-semibold mb-1">Menci√≥n</p>
                        <p>
                        Comentario individual capturado en fuentes monitorizadas (Reclame Aqui, SERNAC, Apestan.com, tuquejasuma, SIC, redes, foros, comentarios en noticias).
                        Tras limpieza/deduplicaci√≥n, cada menci√≥n se pondera por <em>engagement</em>, <em>recencia</em>, <em>credibilidad</em> y <em>severidad</em>.
                        La suma ponderada genera el √≠ndice mensual (0‚Äì100).
                        </p>
                    </div>
                    <p class="text-xs text-gray-500">Glosario est√°tico: no cambia entre corridas.</p>
                </div>
            </div>
        </details>
    </section>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="M√©xico" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">M√©xico</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por Pa√≠s: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualizaci√≥n interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
        "Brasil": {
            "sentimentIndex": [75, 78, 65, 68, 70, 45, 48, 60, 62, 55, 78, 70, 65, 68],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
            "events": [
                { "month": "Sep 24", "text": "Lanzamiento Meli+" },
                { "month": "Feb 25", "text": "Cambio % cashback" },
                { "month": "May 25", "text": "Meli+ 120% CDI" },
                { "month": "Jun 25", "text": "Cambio env√≠o gratis" }
            ],
            "table": [
                { "mes": "Oct 25", "detractores": "Bajo", "motivosDet": "Precio D+/Max", "promotores": "Estable", "motivosPro": "Rendimiento CDI", "eventos": "Estabilizaci√≥n post-cambios", "competencia": "Amazon con nuevos beneficios Prime" },
                { "mes": "Sep 25", "detractores": "Bajo", "motivosDet": "Publicidad en D+", "promotores": "Alto", "motivosPro": "Env√≠os r√°pidos", "eventos": "Campa√±a de marketing Meli+", "competencia": "Shopee agresivo en precios" },
                { "mes": "Ago 25", "detractores": "Bajo", "motivosDet": "Confusi√≥n beneficios", "promotores": "Alto", "motivosPro": "Rendimiento CDI", "eventos": "-", "competencia": "Magalu con liquidaci√≥n" },
                { "mes": "Jul 25", "detractores": "Bajo", "motivosDet": "L√≠mite env√≠o gratis", "promotores": "Muy alto", "motivosPro": "Rendimiento 120% CDI", "eventos": "Recuperaci√≥n post-cambio", "competencia": "Amazon Prime Day" },
                { "mes": "Jun 25", "detractores": "Muy bajo", "motivosDet": "Cambio env√≠o gratis", "promotores": "Estable", "motivosPro": "Rendimiento 120% CDI", "eventos": "Env√≠o gratis general ‚â• R$19,90", "competencia": "Nubank Ultravioleta con nuevos partners" },
                { "mes": "May 25", "detractores": "Estable", "motivosDet": "Pocos descuentos", "promotores": "Muy alto", "motivosPro": "Rendimiento 120% CDI", "eventos": "Lanzamiento Meli+ con 120% CDI", "competencia": "Temu con fuerte inversi√≥n en ads" },
                { "mes": "Feb 25", "detractores": "Muy bajo", "motivosDet": "Reducci√≥n cashback", "promotores": "Estable", "motivosPro": "Env√≠os r√°pidos", "eventos": "Cambio % cashback", "competencia": "PicPay con cashback promocional" },
                { "mes": "Sep 24", "detractores": "Estable", "motivosDet": "Bugs en la app", "promotores": "Muy alto", "motivosPro": "Beneficios D+/Max", "eventos": "Lanzamiento Meli+", "competencia": "Amazon Prime estable" }
            ],
            "summary": "<ul><li class='mb-2'><b>Punto detractor principal (hist√≥rico):</b> El cambio en la pol√≠tica de env√≠os gratis en junio 2025 gener√≥ una ola de quejas significativa, percibido como una devaluaci√≥n del programa. <i>\"Pagar Meli+ para que ahora me cobren env√≠o en compras chicas no tiene sentido. Era el mayor diferencial.\"</i> (Fuente: Reclame Aqui)</li><li class='mb-2'><b>Punto promotor clave:</b> El beneficio de rendimiento del 120% del CDI en 'cofrinhos' (mayo 2025) fue muy bien recibido, atrayendo a un segmento de usuarios enfocado en los beneficios financieros. <i>\"El rendimiento de la cuenta ya paga la suscripci√≥n, y encima tengo los env√≠os y Disney+. Excelente jugada.\"</i> (Fuente: YouTube)</li></ul>"
        },
        "M√©xico": {
            "sentimentIndex": [72, 75, 68, 70, 71, 55, 58, 65, 78, 74, 72, 70, 68, 66],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
            "events": [
                { "month": "Sep 24", "text": "Lanzamiento Meli+" },
                { "month": "Feb 25", "text": "Cambio % cashback" },
                { "month": "May 25", "text": "Hot Sale / Lanza NU+" }
            ],
            "table": [
                { "mes": "Oct 25", "detractores": "Bajo", "motivosDet": "Cat√°logo D+ limitado", "promotores": "Estable", "motivosPro": "Env√≠os FULL", "eventos": "-", "competencia": "Klar con nuevas funciones" },
                { "mes": "May 25", "detractores": "Estable", "motivosDet": "Retrasos en Hot Sale", "promotores": "Muy alto", "motivosPro": "Ofertas agresivas", "eventos": "Hot Sale MX", "competencia": "Nubank lanza NU+, Amazon con ofertas" },
                { "mes": "Feb 25", "detractores": "Bajo", "motivosDet": "Reducci√≥n cashback", "promotores": "Estable", "motivosPro": "Acceso a D+/Max", "eventos": "Cambio % cashback", "competencia": "Amazon sin cambios en Prime" },
                { "mes": "Sep 24", "detractores": "Estable", "motivosDet": "Dificultad para canjear", "promotores": "Alto", "motivosPro": "Paquete de streaming", "eventos": "Lanzamiento Meli+", "competencia": "Walmart Pass con env√≠os" }
            ],
            "summary": "<ul><li class='mb-2'><b>Punto detractor principal:</b> Similar a Brasil, la reducci√≥n del cashback en febrero 2025 fue el principal detractor. <i>\"Primero te enganchan con un buen cashback y a los pocos meses lo bajan. Se siente como un enga√±o.\"</i> (Fuente: Apestan.com)</li><li class='mb-2'><b>Punto promotor clave:</b> El valor percibido del paquete de streaming (Disney+ y Max) sigue siendo el ancla principal para los promotores. <i>\"Solo por lo que me ahorro en Disney y Max ya se paga solo. Los env√≠os son un extra.\"</i> (Fuente: X)</li></ul>"
        },
        "Chile": {
            "sentimentIndex": [55, 58, 56, 59, 60, 62, 64, 80, 78, 75, 74, 72, 70, 71],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
            "events": [{ "month": "Abr 25", "text": "Nuevos beneficios Meli+" }],
            "table": [
                { "mes": "Oct 25", "detractores": "Estable", "motivosDet": "Pocas cuotas sin inter√©s", "promotores": "Alto", "motivosPro": "Descuentos en comercios", "eventos": "-", "competencia": "Ripley con promo Tarjeta" },
                { "mes": "Abr 25", "detractores": "Estable", "motivosDet": "Confusi√≥n con Nivel 6", "promotores": "Muy alto", "motivosPro": "Nuevos descuentos", "eventos": "Nuevos beneficios Meli+", "competencia": "Falabella con descuentos CMR" }
            ],
            "summary": "<ul><li class='mb-2'><b>Punto detractor principal:</b> Los usuarios reportan que los beneficios de cuotas sin inter√©s no son tan amplios o claros como en la competencia directa (Falabella/Ripley). <i>\"Pens√© que con Meli+ tendr√≠a m√°s opciones de cuotas, pero para cosas grandes sigo usando la tarjeta del retail.\"</i> (Fuente: Reddit)</li><li class='mb-2'><b>Punto promotor clave:</b> La introducci√≥n de nuevos beneficios y descuentos en abril 2025 gener√≥ un pico de sentimiento muy positivo, especialmente los descuentos en farmacias y bencineras. <i>\"El descuento en la Copec es un golazo, no me lo esperaba.\"</i> (Fuente: SERNAC)</li></ul>"
        },
        "Argentina": {
            "sentimentIndex": [50, 52, 51, 54, 53, 55, 56, 58, 70, 65, 63, 61, 60, 59],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
            "events": [{ "month": "May 25", "text": "Lanzamiento Meli+" }],
            "table": [
                { "mes": "Oct 25", "detractores": "Bajo", "motivosDet": "Costo mensual elevado", "promotores": "Estable", "motivosPro": "Env√≠os gratis", "eventos": "Contexto inflacionario", "competencia": "Ual√° con programa de puntos" },
                { "mes": "May 25", "detractores": "Estable", "motivosDet": "Pocos cambios vs Nivel 6", "promotores": "Alto", "motivosPro": "Max incluido", "eventos": "Lanzamiento Meli+ (reemplaza Nivel 6)", "competencia": "NaranjaX con promos" }
            ],
            "summary": "<ul><li class='mb-2'><b>Punto detractor principal:</b> La percepci√≥n de que Meli+ es solo un 'rebranding' de Nivel 6 con un costo mayor es una queja recurrente. <i>\"Es lo mismo que Nivel 6 pero m√°s caro. El cambio de nombre no justifica el aumento.\"</i> (Fuente: tuquejasuma.com)</li><li class='mb-2'><b>Punto promotor clave:</b> La inclusi√≥n de Max como beneficio adicional al ya existente Disney+ fue el principal argumento de valor para los usuarios que defendieron el cambio. <i>\"Tener D+ y Max por este precio es imbatible, no hay forma de conseguirlo m√°s barato.\"</i> (Fuente: Instagram)</li></ul>"
        },
        "Colombia": {
            "sentimentIndex": [58, 60, 59, 61, 62, 63, 60, 55, 56, 58, 60, 75, 72, 70],
            "labels": ["Sep 24", "Oct 24", "Nov 24", "Dic 24", "Ene 25", "Feb 25", "Mar 25", "Abr 25", "May 25", "Jun 25", "Jul 25", "Ago 25", "Sep 25", "Oct 25"],
            "events": [
                { "month": "May 25", "text": "Amazon Prime llega a CO" },
                { "month": "Ago 25", "text": "Lanzamiento Meli+" }
            ],
            "table": [
                { "mes": "Ago 25", "detractores": "Estable", "motivosDet": "Costo de suscripci√≥n", "promotores": "Muy alto", "motivosPro": "Streaming y env√≠os", "eventos": "Lanzamiento Meli+", "competencia": "Rappi Pro con ofertas" },
                { "mes": "May 25", "detractores": "Bajo", "motivosDet": "Comparativas con Prime", "promotores": "Estable", "motivosPro": "Confianza en MELI", "eventos": "Competencia directa", "competencia": "Amazon Prime llega a CO" }
            ],
            "summary": "<ul><li class='mb-2'><b>Punto detractor principal:</b> Tras la llegada de Amazon Prime, las comparativas son constantes, y los usuarios se√±alan la falta de beneficios adicionales como Prime Music o Reading. <i>\"Amazon Prime por casi lo mismo te da m√°s cositas. A Meli+ le falta para competir de verdad.\"</i> (Fuente: SIC)</li><li class='mb-2'><b>Punto promotor clave:</b> El lanzamiento de Meli+ en agosto fue bien recibido, consolidando la oferta de valor (env√≠os + streaming) frente a la nueva competencia, apalancado en la log√≠stica local de Mercado Libre. <i>\"Puede que Prime tenga m√°s cosas, pero la entrega de Mercado Libre ac√° no tiene rival. Prefiero Meli+.\"</i> (Fuente: Facebook)</li></ul>"
        }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      { "id": 1, "entity": "Amazon Prime", "country": "Brasil", "impact": "Alto", "title": "Amazon to Increase Prime Subscription Price in Brazil by 20%", "url": "https://press.aboutamazon.com/news/all-news/2025/10/amazon-prime-price-update-brazil", "date": "24-10-2025", "category": "Cambio de Precio", "summary": "Amazon anunci√≥ un aumento del 20% en el precio de su suscripci√≥n Prime en Brasil, que entrar√° en vigor el 1 de diciembre de 2025. La compa√±√≠a cita mayores costos operativos y de contenido como la raz√≥n del ajuste." },
      { "id": 2, "entity": "Temu", "country": "M√©xico", "impact": "Alto", "title": "Mexico's COFECE Opens Formal Antitrust Investigation into Temu's Marketplace Practices", "url": "https://www.reuters.com/technology/mexico-antitrust-regulator-probes-e-commerce-giant-temu-2025-10-21/", "date": "21-10-2025", "category": "Sanci√≥n Legal", "summary": "La Comisi√≥n Federal de Competencia Econ√≥mica (COFECE) de M√©xico ha iniciado una investigaci√≥n formal sobre Temu por presuntas pr√°cticas monop√≥licas, incluyendo la venta por debajo del costo y la presi√≥n sobre los proveedores log√≠sticos." },
      { "id": 3, "entity": "Shein", "country": "Todos los Pa√≠ses", "impact": "Medio", "title": "Shein Announces Integration with Klarna for 'Pay in 4' in Latin America", "url": "https://www.sheingroup.com/news/shein-partners-with-klarna-latam-2025-10-18", "date": "18-10-2025", "category": "Estrategia", "summary": "Shein ha anunciado una asociaci√≥n estrat√©gica con Klarna para ofrecer la opci√≥n de 'Paga en 4' a sus clientes en M√©xico, Brasil y Chile, buscando aumentar la conversi√≥n y el tama√±o promedio del ticket." },
      { "id": 4, "entity": "Rappi Pro", "country": "Colombia", "impact": "Medio", "title": "Rappi Pro Adds Exclusive Discounts at Farmatodo for Subscribers", "url": "https://blog.rappi.com/colombia/rappi-pro-farmatodo-partnership", "date": "15-10-2025", "category": "Producto", "summary": "Los suscriptores de Rappi Pro en Colombia ahora tienen acceso a un 15% de descuento permanente en productos seleccionados de las farmacias Farmatodo, fortaleciendo la propuesta de valor de la membres√≠a." }
    ];
    const contentNewsData = [
      { "id": 101, "entity": "Netflix", "country": "Todos los Pa√≠ses", "impact": "Alto", "title": "Netflix Confirms Acquisition of Global Streaming Rights for Formula 1 Starting in 2027", "url": "https://about.netflix.com/en/news/netflix-secures-formula-1-rights", "date": "25-10-2025", "category": "Derechos/Deportes", "summary": "Netflix confirm√≥ la adquisici√≥n de los derechos de transmisi√≥n global para la F√≥rmula 1 por cinco temporadas, a partir de 2027. El acuerdo, valorado en miles de millones, marca su movimiento m√°s agresivo hacia los deportes en vivo." },
      { "id": 102, "entity": "OpenAI", "country": "Todos los Pa√≠ses", "impact": "Alto", "title": "OpenAI Announces General Availability of GPT-5 Turbo via API and in ChatGPT", "url": "https://openai.com/blog/gpt-5-turbo-api", "date": "23-10-2025", "category": "Flagship AI", "summary": "OpenAI anunci√≥ la disponibilidad general de GPT-5 Turbo, su modelo de lenguaje de pr√≥xima generaci√≥n. Est√° disponible para todos los clientes de API y se ha implementado para los suscriptores de ChatGPT Plus, con mejoras significativas en razonamiento y velocidad." },
      { "id": 103, "entity": "Disney+", "country": "Todos los Pa√≠ses", "impact": "Medio", "title": "Disney+ and Max Begin Offering Joint Discounted Bundle in Europe", "url": "https://thewaltdisneycompany.com/disney-max-bundle-europe/", "date": "22-10-2025", "category": "Estrategia", "summary": "The Walt Disney Company y Warner Bros. Discovery han lanzado un paquete con descuento que incluye Disney+ y Max en mercados europeos seleccionados, una estrategia para reducir la rotaci√≥n de suscriptores." },
      { "id": 104, "entity": "Spotify", "country": "Todos los Pa√≠ses", "impact": "Medio", "title": "Spotify Appoints New Chief Financial Officer as Paul Vogel Steps Down", "url": "https://investors.spotify.com/press/press-release-details/2025/Spotify-Announces-CFO-Transition/default.aspx", "date": "20-10-2025", "category": "Movimientos Ejecutivos Clave", "summary": "Spotify ha nombrado a Christian Luiga como su nuevo Director Financiero, en reemplazo de Paul Vogel. Luiga se une desde la empresa de defensa Saab y se espera que impulse la eficiencia operativa." },
      { "id": 105, "entity": "Max", "country": "Am√©rica Latina", "impact": "Medio", "title": "WBD to Shutter Standalone HBO Max App in Remaining LatAm Markets by Year-End", "url": "https://www.wbd.com/newsroom/press-releases/2025/10/16/hbo-max-app-sunsetting-latam/", "date": "16-10-2025", "category": "Producto", "summary": "Warner Bros. Discovery anunci√≥ que la aplicaci√≥n independiente de HBO Max dejar√° de funcionar en los mercados restantes de Am√©rica Latina antes de fin de a√±o, obligando a todos los usuarios a migrar a la aplicaci√≥n Max." },
      { "id": 106, "entity": "Apple TV+", "country": "Todos los Pa√≠ses", "impact": "Medio", "title": "Apple TV+ Renews 'Severance' for a Third and Fourth Season", "url": "https://www.apple.com/tv-pr/news/2025/10/apple-tv-renews-critically-acclaimed-hit-severance-for-two-more-seasons/", "date": "14-10-2025", "category": "Producto", "summary": "Apple ha realizado una renovaci√≥n de dos temporadas para su aclamada serie 'Severance', asegurando la continuidad de una de sus propiedades intelectuales m√°s fuertes en medio de una creciente competencia de contenido." }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','M√©xico','Colombia','Todos los Pa√≠ses'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ual√°','Cablevisi√≥n Flow','Amazon Prime Video','DGO','Mach'
    ].sort();
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusi√≥n/Adquisici√≥n','Sanci√≥n Legal','Estrategia','Producto',
      'Resultados Financieros','Movimientos Ejecutivos Clave','Derechos/Deportes','Flagship AI'
    ].sort();

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','M√©xico','Colombia','Am√©rica Latina','Todos los Pa√≠ses'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ].sort();
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusi√≥n/Adquisici√≥n','Sanci√≥n Legal','Estrategia','Producto',
      'Resultados Financieros','Movimientos Ejecutivos Clave','Derechos/Deportes','Flagship AI'
    ].sort();

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gr√°fico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: '√çndice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: '√çndice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { legend: { display: false }, tooltip: { 
            displayColors: false,
            callbacks: { 
              title: (items) => { return `Sentimiento: ${items[0].formattedValue}`; },
              label: (item) => {
                const month = item.label;
                const event = data.events.find(e => e.month === month);
                return event ? `[${month}] Evento: ${event.text}` : month;
              }
            }
          }}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      if (!rows || rows.length === 0) {
        sentimentTableBody.innerHTML = `<tr><td colspan="7" class="text-center py-8 text-gray-500">No hay datos mensuales disponibles para este pa√≠s.</td></tr>`;
        return;
      }
      // Show most recent first
      [...rows].reverse().forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes || '-'}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores || '-'}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet || '-'}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores || '-'}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro || '-'}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos || '-'}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia || '-'}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html || '<p class="text-gray-500">No hay un resumen disponible.</p>'; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categor√≠a ==== */
    function getCategoryTag(category) {
      const categoryMap = {
        'Sanci√≥n Legal': 'bg-red-100 text-red-800',
        'Cambio de Precio': 'bg-yellow-100 text-yellow-800',
        'Lanzamiento': 'bg-blue-100 text-blue-800',
        'Fusi√≥n/Adquisici√≥n': 'bg-green-100 text-green-800',
        'Estrategia': 'bg-purple-100 text-purple-800',
        'Producto': 'bg-orange-100 text-orange-800',
        'Resultados Financieros': 'bg-teal-100 text-teal-800',
        'Derechos/Deportes': 'bg-indigo-100 text-indigo-800',
        'Flagship AI': 'bg-pink-100 text-pink-800',
        'Movimientos Ejecutivos Clave': 'bg-gray-100 text-gray-800'
      };
      const classes = categoryMap[category] || 'bg-gray-100 text-gray-800';
      return `<span class="${classes} text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) ‚Äî sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const countryMatch = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country) || (item.country === 'Todos los Pa√≠ses' && newsFilters.country.length === 0);
        const entityMatch = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const categoryMatch = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return countryMatch && entityMatch && categoryMatch;
      }).sort((a,b) => {
        const impactOrder = { 'Alto': 1, 'Medio': 2, 'Bajo': 3 };
        const impactDiff = (impactOrder[a.impact] || 9) - (impactOrder[b.impact] || 9);
        if (impactDiff !== 0) return impactDiff;
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        return db - da; // most recent first
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Pa√≠ses' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3 font-medium leading-snug">${row.title}</p>
            <p class="text-sm text-gray-600">${row.summary}</p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <span class="font-medium text-xs truncate" title="${host}">${host || '‚Äî'}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) ‚Äî sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const countryMatch = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country) || (item.country === 'Todos los Pa√≠ses' && contentFilters.country.length === 0);
        const entityMatch = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const categoryMatch = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return countryMatch && entityMatch && categoryMatch;
      }).sort((a,b) => {
        const impactOrder = { 'Alto': 1, 'Medio': 2, 'Bajo': 3 };
        const impactDiff = (impactOrder[a.impact] || 9) - (impactOrder[b.impact] || 9);
        if (impactDiff !== 0) return impactDiff;
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        return db - da; // most recent first
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Pa√≠ses' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3 font-medium leading-snug">${row.title}</p>
            <p class="text-sm text-gray-600">${row.summary}</p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
            <span class="font-medium text-xs truncate" title="${host}">${host || '‚Äî'}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, groupName, handler) {
        container.innerHTML = ''; // Clear previous
        const createCheckbox = (value, label) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'filter-checkbox-item';
            const input = document.createElement('input');
            input.type = 'checkbox';
            input.id = `${groupName}-${value}`;
            input.value = value;
            input.className = 'h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500';
            const labelEl = document.createElement('label');
            labelEl.htmlFor = input.id;
            labelEl.textContent = label;
            labelEl.className = 'text-sm text-gray-700';
            wrapper.append(input, labelEl);
            return wrapper;
        };

        const allOption = createCheckbox('all', 'Todos');
        container.appendChild(allOption);

        allItems.forEach(item => {
            const option = createCheckbox(item.toLowerCase().replace(/ /g, '-'), item);
            container.appendChild(option);
        });

        container.addEventListener('change', handler);
    }
    
    function getSelected(container) {
      const selected = Array.from(container.querySelectorAll('input:checked')).map(i => i.labels[0].textContent);
      const allBox = container.querySelector('input[value="all"]');
      if (allBox.checked) return []; // Empty array means "all"
      return selected;
    }

    function createFilterHandler(filterState, renderFunc, containerCountry, containerCompany, containerCategory) {
        return (event) => {
            if (event.target.value === 'all' && event.target.checked) {
                const parent = event.target.closest('.filter-checkbox-group');
                parent.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    if (cb !== event.target) cb.checked = false;
                });
            } else if (event.target.value !== 'all' && event.target.checked) {
                const parent = event.target.closest('.filter-checkbox-group');
                const allBox = parent.querySelector('input[value="all"]');
                if (allBox) allBox.checked = false;
            }
            
            filterState.country = getSelected(containerCountry);
            filterState.company = getSelected(containerCompany);
            filterState.category = getSelected(containerCategory);
            renderFunc();
        };
    }

    const newsFilterHandler = createFilterHandler(newsFilters, renderNewsCards, newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer);
    const contentFilterHandler = createFilterHandler(contentFilters, renderContentNewsCards, contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer);

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));

    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    // Initial Population
    document.addEventListener('DOMContentLoaded', () => {
        updateSentimentContent('Brasil');
        
        populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES.filter(c => c !== 'Todos los Pa√≠ses'), 'news-country', newsFilterHandler);
        populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company', newsFilterHandler);
        populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category', newsFilterHandler);
        renderNewsCards();

        populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES.filter(c => c !== 'Todos los Pa√≠ses'), 'content-country', contentFilterHandler);
        populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company', contentFilterHandler);
        populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category', contentFilterHandler);
        renderContentNewsCards();
    });
  </script>
</body>
</html>
