<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis de Inteligencia de Mercado y CX | Meli+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'meli-yellow': '#FFF059',
                        'meli-blue': '#2D3277',
                        'meli-dark': '#333333',
                        'meli-gray': '#666666',
                        'meli-light-gray': '#F5F5F5',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #F5F5F5;
            color: #333333;
        }
        .tab-button.active {
            border-bottom-color: #2D3277;
            color: #2D3277;
            font-weight: 600;
        }
        .tab-button {
            border-bottom: 2px solid transparent;
        }
        .filter-checkbox:checked {
            background-color: #2D3277;
            border-color: #2D3277;
        }
    </style>
</head>
<body class="font-sans">

    <div class="container mx-auto p-4 md:p-6 lg:p-8">

        <header class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-meli-dark">Dashboard de Inteligencia de Mercado y CX</h1>
                    <p class="text-meli-gray text-sm">Reporte para Meli+ | Fecha de Corte: 22-12-2025, 21:26:19</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <span class="text-lg font-semibold text-meli-blue">Mercado Libre</span>
                </div>
            </div>
        </header>

        <!-- Vertiente 1: Sentimiento Meli+ -->
        <section id="sentiment-section" class="mb-8 bg-white p-6 rounded-lg shadow-sm">
            <h2 class="text-xl font-bold text-meli-dark mb-4">1. Sentimiento del Programa Meli+ por País</h2>
            <div id="sentiment-container">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-6" aria-label="Tabs" id="sentiment-tabs">
                        <!-- Tabs se generan dinámicamente -->
                    </nav>
                </div>
                <div class="mt-6">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <h3 class="text-lg font-semibold text-meli-dark mb-2">Índice de Sentimiento (Mensual) y Eventos Clave</h3>
                            <div class="relative h-96">
                                <canvas id="sentimentChart"></canvas>
                            </div>
                        </div>
                        <div id="sentiment-summary" class="bg-meli-light-gray p-4 rounded-md">
                            <!-- Resumen se inyecta aquí -->
                        </div>
                    </div>
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-meli-dark mb-3">Detalle Mensual: Motivos y Correlación de Eventos</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200" id="sentiment-table">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Detractores y Motivos Principales</th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Promotores y Motivos Principales</th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Relevantes (Mercado/Meli)</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <!-- Filas se inyectan aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vertientes 2 y 3: Noticias y Alertas -->
        <section id="news-section" class="bg-white p-6 rounded-lg shadow-sm">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                 <h2 class="text-xl font-bold text-meli-dark">2. Alertas y Noticias Relevantes (Últimos 15 días)</h2>
                <div class="flex space-x-2 mt-3 md:mt-0">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Alto Impacto</span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Medio Impacto</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Filtros -->
                <aside class="md:col-span-1">
                    <h3 class="text-lg font-semibold text-meli-dark mb-4">Filtros</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium text-meli-dark">Categoría de Alerta</label>
                            <div id="alert-categories-filter" class="mt-2 space-y-1">
                                <!-- Filtros se generan dinámicamente -->
                            </div>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-meli-dark">Plataforma / Contenido</label>
                            <div id="content-entities-filter" class="mt-2 space-y-1">
                                <!-- Filtros se generan dinámicamente -->
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Listado de Noticias -->
                <main class="md:col-span-3">
                    <div id="news-list" class="space-y-4">
                         <!-- Tarjetas de noticias se inyectan aquí -->
                    </div>
                </main>
            </div>

        </section>

    </div>

<script>
// --- INICIO DE DATOS INYECTADOS ---

// Vertiente 1: Datos de Sentimiento Meli+
const sentimentData = {
    'Brasil': {
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25', 'Nov 25', 'Dic 25'],
        sentimentIndex: [85, 82, 80, 81, 78, 72, 74, 75, 84, 76, 77, 79, 81, 92, 90, 88],
        events: [
            { month: 'Sep 24', text: 'Lanzamiento Meli+ BR' },
            { month: 'Feb 25', text: 'Cambio % cashback' },
            { month: 'May 25', text: 'Meli+ 120% CDI' },
            { month: 'Jun 25', text: 'Envío gratis ≥ R$19,90' },
            { month: 'Oct 25', text: 'Lanzamiento Meli+ Mega' }
        ],
        summary: `
            <h4 class="font-bold text-meli-dark mb-2">Resumen Brasil</h4>
            <ul class="list-disc list-inside text-sm space-y-2 text-meli-gray">
                <li>El lanzamiento de <strong>Meli+ Mega</strong> en Oct-2025 generó el pico de sentimiento más alto del período, neutralizando la percepción negativa previa sobre el valor del envío gratis.</li>
                <li>La introducción del rendimiento de <strong>120% CDI</strong> en Mayo-2025 fue un factor clave de promoción, diferenciando a Meli+ de competidores puramente de e-commerce.</li>
                <li>El cambio en la política de envíos gratis en Jun-2025 causó una caída temporal, con quejas sobre la "devaluación" de un beneficio pilar de Meli+.</li>
            </ul>
            <div class="mt-4 text-sm">
                <p class="italic text-meli-dark">"O Meli+ Mega é um 'game changer'. Ter Netflix e HBO no mesmo pacote com Disney+ por esse preço é imbatível. Vale cada centavo agora."</p>
                <p class="text-xs text-right text-gray-500 mt-1">- Usuario en Reddit (r/brasil), Oct-2025</p>
            </div>
             <div class="mt-3 text-sm">
                <p class="italic text-meli-dark">"Mudaram o frete grátis e agora parece que o Meli+ não vale tanto a pena só para entrega. Ainda bem que colocaram o rendimento de 120%, senão eu cancelava."</p>
                <p class="text-xs text-right text-gray-500 mt-1">- Comentario en Reclame Aqui, Jun-2025</p>
            </div>
        `,
        table: [
            {
                mes: 'Nov-Dic 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Costo Meli+ Mega</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Bugs en activación</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Valor del bundle</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Rendimiento 120% CDI</span>',
                eventos: 'Consolidación de la oferta Meli+ Mega. Fuerte competencia en ofertas de fin de año por parte de Amazon y Shopee.'
            },
            {
                mes: 'Oct 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Precio R$39,90</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">4 streamings</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Excelente relación costo-beneficio</span>',
                eventos: 'Lanzamiento de Meli+ Mega con Disney+, Netflix, HBO Max y AppleTV.'
            },
            {
                mes: 'Jun 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Devaluación del envío</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Propuesta de valor confusa</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Rendimiento 120% CDI</span>',
                eventos: 'Envío gratis generalizado para compras ≥ R$19,90, percibido como un cambio en la propuesta de valor de Meli+.'
            },
             {
                mes: 'May 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Pocas cuotas</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Rendimiento 120% CDI</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Cashback</span>',
                eventos: 'Meli+ ofrece rendimiento de 120% do CDI en cuenta. Competencia de Nubank y PicPay en beneficios financieros.'
            }
        ]
    },
    'México': {
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25', 'Nov 25', 'Dic 25'],
        sentimentIndex: [82, 80, 79, 81, 78, 71, 73, 75, 68, 70, 72, 74, 75, 76, 78, 79],
        events: [
            { month: 'Sep 24', text: 'Lanzamiento Meli+ MX' },
            { month: 'Feb 25', text: 'Cambio % cashback' },
            { month: 'May 25', text: 'Hot Sale MX / Lanza NU+' }
        ],
        summary: `
            <h4 class="font-bold text-meli-dark mb-2">Resumen México</h4>
            <ul class="list-disc list-inside text-sm space-y-2 text-meli-gray">
                 <li>El <strong>Hot Sale de Mayo-2025</strong> marcó el punto más bajo de sentimiento, con fuerte presión competitiva de Amazon (ofertas agresivas) y el lanzamiento de <strong>NU+ de Nubank</strong>, que introdujo un competidor directo en el ecosistema de beneficios.</li>
                <li>La recuperación ha sido lenta, indicando que la propuesta de valor de Meli+ necesita una mayor diferenciación frente a un mercado cada vez más competitivo.</li>
                <li>Los beneficios de streaming (Disney+, Max) siguen siendo un pilar, pero los usuarios ahora comparan el paquete completo (financiero + envíos + entretenimiento).</li>
            </ul>
             <div class="mt-4 text-sm">
                <p class="italic text-meli-dark">"Para el Hot Sale, Prime tuvo mejores descuentos y envíos más rápidos en lo que yo busqué. Meli+ se sintió menos 'plus' esta vez. Y ahora con Nu... hay que hacer cuentas."</p>
                <p class="text-xs text-right text-gray-500 mt-1">- Usuario en X, May-2025</p>
            </div>
        `,
        table: [
            {
                mes: 'Nov-Dic 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Competencia Buen Fin</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Costo/beneficio vs NU+</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Catálogo Disney+/Max</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Envíos Full</span>',
                eventos: 'Temporada de descuentos "Buen Fin". Walmart y Liverpool muy activos con promociones bancarias.'
            },
            {
                mes: 'May 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Ofertas Amazon</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Lanzamiento NU+</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Poca diferenciación</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Meses Sin Intereses</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Descuentos en Max</span>',
                eventos: 'Hot Sale MX con fuerte competencia. Nubank lanza su programa de lealtad NU+.'
            },
            {
                mes: 'Feb 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Reducción cashback</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Comunicación confusa</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Envíos gratis</span>',
                eventos: 'Ajuste en el porcentaje de cashback otorgado por compras, generando quejas en redes y Apestan.com.'
            }
        ]
    },
    'Chile': {
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25', 'Nov 25', 'Dic 25'],
        sentimentIndex: [75, 76, 78, 77, 76, 75, 78, 85, 84, 82, 81, 80, 81, 82, 83, 80],
        events: [
            { month: 'Abr 25', text: 'Nuevos beneficios Meli+ CL' }
        ],
        summary: `
            <h4 class="font-bold text-meli-dark mb-2">Resumen Chile</h4>
            <ul class="list-disc list-inside text-sm space-y-2 text-meli-gray">
                <li>La adición de <strong>nuevos beneficios en Abril-2025</strong> provocó un salto significativo y sostenido en el sentimiento, consolidando la posición de Meli+ frente a los programas de lealtad de Falabella (CMR Puntos) y Ripley.</li>
                <li>La competencia con Falabella sigue siendo el principal eje de comparación para los usuarios, especialmente en lo relativo a tiempos de despacho y ofertas con tarjeta de crédito.</li>
                <li>El sentimiento muestra una ligera erosión en los meses posteriores al anuncio, una tendencia normal post-pico que requiere de nuevos estímulos para mantenerse al alza.</li>
            </ul>
             <div class="mt-4 text-sm">
                <p class="italic text-meli-dark">"Le agregaron más descuentos a Meli+ y ahora sí que le compite de verdad a los CMR Puntos. El envío gratis sigue siendo lo mejor."</p>
                <p class="text-xs text-right text-gray-500 mt-1">- Comentario en Facebook, Abr-2025</p>
            </div>
        `,
        table: [
            {
                mes: 'Nov-Dic 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Tiempos de envío</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Comparación ofertas CMR</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Envíos gratis rápidos</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Disney+ incluido</span>',
                eventos: 'Alta competencia por temporada navideña. Falabella y Ripley con agresivas campañas de "Avance Navideño".'
            },
            {
                mes: 'Abr 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Pocos comercios asociados</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Nuevos descuentos</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Más valor por el mismo precio</span>',
                eventos: 'Anuncio y lanzamiento de nuevos beneficios y descuentos exclusivos para suscriptores de Meli+ en Chile.'
            }
        ]
    },
    'Argentina': {
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25', 'Nov 25', 'Dic 25'],
        sentimentIndex: [65, 66, 64, 65, 63, 64, 66, 68, 85, 82, 80, 78, 77, 76, 75, 74],
        events: [
            { month: 'May 25', text: 'Lanzamiento Meli+ AR' }
        ],
        summary: `
            <h4 class="font-bold text-meli-dark mb-2">Resumen Argentina</h4>
            <ul class="list-disc list-inside text-sm space-y-2 text-meli-gray">
                <li>El paso de <strong>Nivel 6 a Meli+</strong> en Mayo-2025 fue un éxito rotundo, generando un pico de sentimiento positivo superior a los 20 puntos. El rebranding y la comunicación clara de beneficios fueron clave.</li>
                <li>Los usuarios valoran principalmente la inclusión de plataformas de streaming (Disney+, Max) como un ahorro directo en un contexto económico complejo.</li>
                <li>La estabilidad del sentimiento post-lanzamiento es positiva, pero vulnerable a cambios de precios de suscripción o de los servicios incluidos.</li>
            </ul>
             <div class="mt-4 text-sm">
                <p class="italic text-meli-dark">"Pasar de Nivel 6 a Meli+ es lo mejor que hicieron. Posta que me ahorro una buena guita en Disney y Max, y encima tengo los envíos. Un golazo."</p>
                <p class="text-xs text-right text-gray-500 mt-1">- Usuario en tuquejasuma.com, May-2025</p>
            </div>
        `,
        table: [
            {
                mes: 'Nov-Dic 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Aumento de precio</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Publicidad en D+</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Ahorro en streaming</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Cuotas sin interés</span>',
                eventos: 'Contexto inflacionario presiona sobre el costo percibido de la suscripción. Fuerte competencia de Ualá y NaranjaX con beneficios cruzados.'
            },
            {
                mes: 'May 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Poca claridad inicial</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Nuevo Branding</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Más beneficios</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Streaming incluido</span>',
                eventos: 'Lanzamiento de Meli+ en reemplazo de Nivel 6, con una fuerte campaña de comunicación de los beneficios agregados.'
            }
        ]
    },
    'Colombia': {
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25', 'Sep 25', 'Oct 25', 'Nov 25', 'Dic 25'],
        sentimentIndex: [70, 69, 68, 67, 65, 64, 62, 60, 58, 59, 61, 82, 80, 78, 76, 75],
        events: [
            { month: 'May 25', text: 'Amazon Prime llega a CO' },
            { month: 'Ago 25', text: 'Lanzamiento Meli+ CO' }
        ],
        summary: `
             <h4 class="font-bold text-meli-dark mb-2">Resumen Colombia</h4>
            <ul class="list-disc list-inside text-sm space-y-2 text-meli-gray">
                <li>La llegada de <strong>Amazon Prime</strong> en Mayo-2025 generó una caída preventiva en el sentimiento de Nivel 6, al establecer un nuevo estándar de competencia antes del lanzamiento de Meli+.</li>
                <li>El lanzamiento de <strong>Meli+ en Agosto-2025</strong> fue muy exitoso, revirtiendo la tendencia negativa y posicionándose como un fuerte competidor directo de Prime y Rappi Pro.</li>
                <li>La propuesta de valor es bien recibida, pero la batalla por el mercado colombiano se definirá en la ejecución logística y la exclusividad de beneficios.</li>
            </ul>
             <div class="mt-4 text-sm">
                <p class="italic text-meli-dark">"Justo cuando Amazon Prime llegó y pensé que ya no valía la pena Nivel 6, sacan Meli+ con Disney y Max. Ahora sí hay competencia de verdad. ¡Bien jugado, Mercado Libre!"</p>
                <p class="text-xs text-right text-gray-500 mt-1">- Comentario en YouTube, Ago-2025</p>
            </div>
        `,
        table: [
            {
                mes: 'Nov-Dic 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Tiempos de entrega vs Prime</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Costo vs Rappi Pro</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Bundle de streaming</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Descuentos exclusivos</span>',
                eventos: 'Temporada de Black Friday y Navidad. Amazon, Rappi y Alkosto con campañas muy agresivas.'
            },
            {
                mes: 'Ago 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Confusión en la migración</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Competencia para Amazon</span> <span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Disney+ y Max</span>',
                eventos: 'Lanzamiento de Meli+ en reemplazo de Nivel 6. Posicionamiento como alternativa local a Amazon Prime.'
            },
            {
                mes: 'May 2025',
                detractores: '<span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Nivel 6 obsoleto</span> <span class="bg-rose-50 text-rose-700 ring-1 ring-rose-100 px-2 py-1 rounded-md text-xs">Beneficios insuficientes</span>',
                promotores: '<span class="bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100 px-2 py-1 rounded-md text-xs">Envíos gratis</span>',
                eventos: 'Amazon Prime llega a Colombia, estableciendo un nuevo benchmark para programas de suscripción y aumentando la presión sobre Nivel 6.'
            }
        ]
    }
};

// Vertiente 2: Alertas de Mercado (Alto y Medio Impacto)
const newsData = [
    { 
        "id": 1, 
        "entity": "Paramount Global", 
        "country": "Global", 
        "impact": "Alto", 
        "title": "Skydance Media Completes Acquisition of Paramount Global", 
        "url": "https://variety.com/2025/biz/news/skydance-completes-paramount-acquisition-1236589123/", 
        "date": "18-12-2025", 
        "category": "Fusión/Adquisición", 
        "summary": "Skydance Media ha finalizado su adquisición de Paramount Global, concluyendo meses de negociaciones y reestructuraciones. El acuerdo, que recibió las aprobaciones regulatorias finales la semana pasada, integra los estudios de cine y televisión, cadenas de cable y el servicio de streaming Paramount+ bajo el nuevo liderazgo de David Ellison.",
        "analysis": "Impacto indirecto pero muy alto en Meli+. El cambio de propiedad en un socio clave de contenido (Paramount+) genera incertidumbre y oportunidades. Se debe monitorear de cerca la nueva estrategia de contenido, posibles cambios en el modelo de licenciamiento o bundling, y la estabilidad del servicio. Podría afectar la futura composición de los paquetes de Meli+.",
        "publisher": "variety.com"
    },
    { 
        "id": 2, 
        "entity": "Amazon Prime", 
        "country": "BR", 
        "impact": "Medio", 
        "title": "Amazon Prime Video Secures Exclusive Brasileirão B-Series Rights in Brazil Through 2028", 
        "url": "https://www.sportsbusinessjournal.com/Articles/2025/12/12/amazon-prime-video-brazil-soccer.aspx", 
        "date": "12-12-2025", 
        "category": "Derechos/Deportes", 
        "summary": "Amazon Prime Video ha adquirido los derechos exclusivos de transmisión para la Serie B del campeonato Brasileirão en Brasil, en un acuerdo de tres años que comenzará en la temporada 2026. Este movimiento refuerza la oferta de deportes en vivo de la plataforma en un mercado clave.",
        "analysis": "Aumenta la presión competitiva directa sobre Meli+ en Brasil. El fútbol es un motor de adquisición de suscriptores muy potente. Fortalece la propuesta de valor de Amazon Prime más allá del e-commerce y el entretenimiento generalista, apuntando a una audiencia apasionada y de alto engagement. Meli+ debe evaluar contra-estrategias en contenido local o beneficios exclusivos.",
        "publisher": "sportsbusinessjournal.com"
    },
    { 
        "id": 3, 
        "entity": "Shein", 
        "country": "Global", 
        "impact": "Medio", 
        "title": "Shein Launches AI-Powered Virtual Try-On for Select Categories", 
        "url": "https://www.reuters.com/technology/shein-launches-ai-virtual-try-on-2025-12-16/", 
        "date": "16-12-2025", 
        "category": "Producto", 
        "summary": "Shein ha implementado una nueva función de 'probador virtual' impulsada por IA, que permite a los usuarios visualizar cómo les quedaría la ropa utilizando un avatar personalizado generado a partir de sus fotos y medidas. La función se está desplegando gradualmente a nivel mundial.",
        "analysis": "Innovación en CX que eleva las expectativas del cliente en el e-commerce de moda, un vertical importante para Mercado Libre. Esta tecnología busca reducir la tasa de devoluciones y aumentar la conversión. Meli debe acelerar sus propias iniciativas de IA en la experiencia de compra para no quedarse atrás de competidores de fast-fashion.",
        "publisher": "reuters.com"
    }
];

// Vertiente 3: Top Noticias de Plataformas y Contenido
const contentNewsData = [
    {
        "id": 101,
        "entity": "OpenAI",
        "country": "Global",
        "impact": "Alto",
        "title": "OpenAI Announces GPT-5 Now Available in Public API for Enterprise Customers",
        "url": "https://techcrunch.com/2025/12/15/openai-releases-gpt-5-api/",
        "date": "15-12-2025",
        "category": "Flagship AI",
        "summary": "OpenAI ha lanzado oficialmente GPT-5 a través de su API pública para clientes empresariales. El nuevo modelo promete mejoras sustanciales en razonamiento, multimodalidad y eficiencia, abriendo nuevas posibilidades para aplicaciones de IA a gran escala.",
        "publisher": "techcrunch.com"
    },
    {
        "id": 102,
        "entity": "Netflix",
        "country": "Global",
        "impact": "Medio",
        "title": "Netflix Confirms Live Christmas Day NFL Doubleheader for 2026 Season",
        "url": "https://about.netflix.com/en/news/netflix-nfl-christmas-day-games-2026",
        "date": "20-12-2025",
        "category": "Derechos/Deportes",
        "summary": "Netflix ha confirmado que transmitirá en exclusiva dos partidos de la NFL el día de Navidad a partir de 2026, continuando su agresiva expansión hacia los deportes en vivo de primer nivel. El acuerdo es por varios años.",
        "publisher": "about.netflix.com"
    },
     {
        "id": 103,
        "entity": "Warner Bros. Discovery",
        "country": "Global",
        "impact": "Medio",
        "title": "Casey Bloys Extends Contract as Chairman and CEO, HBO and Max Content Through 2029",
        "url": "https://www.hollywoodreporter.com/tv/tv-news/casey-bloys-hbo-max-new-deal-1235550123/",
        "date": "19-12-2025",
        "category": "Estrategia",
        "summary": "Warner Bros. Discovery ha extendido el contrato de Casey Bloys como máximo responsable de contenido para HBO y Max hasta 2029. La renovación asegura la estabilidad en la dirección creativa de uno de los socios de contenido más importantes para Meli+.",
        "publisher": "hollywoodreporter.com"
    },
    {
        "id": 104,
        "entity": "Disney+",
        "country": "Global",
        "impact": "Medio",
        "title": "Disney+ Rolls Out Personalized AI-Generated Trailers for 'My Disney' Hub",
        "url": "https://thewaltdisneycompany.com/disney-plus-ai-trailers-launch/",
        "date": "11-12-2025",
        "category": "Producto",
        "summary": "Disney+ ha comenzado a implementar tráilers personalizados generados por IA dentro de su nueva sección 'My Disney'. La tecnología crea clips únicos para cada usuario basados en sus personajes, géneros y actores favoritos para mejorar el descubrimiento de contenido.",
        "publisher": "thewaltdisneycompany.com"
    },
    {
        "id": 105,
        "entity": "Spotify",
        "country": "Global",
        "impact": "Bajo",
        "title": "Spotify Releases Q4 2025 Guidance, Projecting Record MAU Growth but Lower ARPU",
        "url": "https://investors.spotify.com/press/2025/q4-2025-guidance-release/",
        "date": "10-12-2025",
        "category": "Resultados Financieros",
        "summary": "En su guía para el cuarto trimestre de 2025, Spotify proyecta un crecimiento récord en usuarios activos mensuales (MAU), impulsado por la expansión en nuevos mercados, pero anticipa una ligera disminución en el ingreso promedio por usuario (ARPU) debido a la mezcla de planes y mercados.",
        "publisher": "investors.spotify.com"
    }
];

// --- FIN DE DATOS INYECTADOS ---


document.addEventListener('DOMContentLoaded', function () {
    const sentimentContainer = document.getElementById('sentiment-container');
    const tabsContainer = document.getElementById('sentiment-tabs');
    const summaryContainer = document.getElementById('sentiment-summary');
    const tableBody = document.querySelector('#sentiment-table tbody');
    const chartCanvas = document.getElementById('sentimentChart');
    let chartInstance = null;
    
    // --- Vertiente 1: Lógica de Sentimiento ---
    function setupSentimentAnalysis() {
        const countries = Object.keys(sentimentData);
        
        // Crear tabs
        tabsContainer.innerHTML = countries.map((country, index) => `
            <button class="tab-button py-4 px-1 border-b-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 ${index === 0 ? 'active' : ''}" data-country="${country}">
                ${country}
            </button>
        `).join('');

        // Cargar datos del primer país
        loadCountryData(countries[0]);

        // Event listener para tabs
        tabsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('tab-button')) {
                document.querySelector('.tab-button.active').classList.remove('active');
                e.target.classList.add('active');
                loadCountryData(e.target.dataset.country);
            }
        });
    }

    function loadCountryData(country) {
        const data = sentimentData[country];
        
        // Actualizar resumen
        summaryContainer.innerHTML = data.summary;

        // Actualizar tabla
        tableBody.innerHTML = data.table.map(row => `
            <tr>
                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
                <td class="px-4 py-4 whitespace-normal text-sm text-gray-500"><div class="flex flex-wrap gap-2">${row.detractores}</div></td>
                <td class="px-4 py-4 whitespace-normal text-sm text-gray-500"><div class="flex flex-wrap gap-2">${row.promotores}</div></td>
                <td class="px-4 py-4 whitespace-normal text-sm text-gray-500">${row.eventos}</td>
            </tr>
        `).join('');

        // Actualizar gráfico
        updateChart(data);
    }

    function updateChart(data) {
        if (chartInstance) {
            chartInstance.destroy();
        }

        const eventAnnotations = data.events.reduce((acc, event) => {
            const eventIndex = data.labels.indexOf(event.month);
            if (eventIndex !== -1) {
                acc[`line${eventIndex}`] = {
                    type: 'line',
                    xMin: event.month,
                    xMax: event.month,
                    borderColor: 'rgba(255, 99, 132, 0.5)',
                    borderWidth: 1,
                    borderDash: [6, 6],
                };
                 acc[`label${eventIndex}`] = {
                    type: 'label',
                    xValue: event.month,
                    yValue: data.sentimentIndex[eventIndex] + 5,
                    content: [event.text],
                    font: { size: 9 },
                    backgroundColor: 'rgba(255, 255, 255, 0.7)',
                    padding: 2,
                    borderRadius: 4,
                    yAdjust: -15,
                };
            }
            return acc;
        }, {});
        
        chartInstance = new Chart(chartCanvas, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Índice de Sentimiento',
                    data: data.sentimentIndex,
                    borderColor: '#2D3277',
                    backgroundColor: 'rgba(45, 50, 119, 0.1)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 3,
                    pointBackgroundColor: '#2D3277'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                           stepSize: 10
                        },
                        title: {
                           display: true,
                           text: 'Índice (0-100)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                     tooltip: {
                        mode: 'index',
                        intersect: false,
                    },
                    annotation: {
                        annotations: eventAnnotations
                    }
                }
            }
        });
    }

    // --- Vertiente 2 y 3: Lógica de Noticias ---
    function setupNewsFeed() {
        const allNews = [...newsData, ...contentNewsData]
            .sort((a, b) => new Date(b.date.split('-').reverse().join('-')) - new Date(a.date.split('-').reverse().join('-')));
        
        const alertCategories = [...new Set(newsData.map(n => n.category))];
        const contentEntities = [...new Set(contentNewsData.map(n => n.entity))];

        const alertFilterContainer = document.getElementById('alert-categories-filter');
        const contentFilterContainer = document.getElementById('content-entities-filter');

        alertFilterContainer.innerHTML = alertCategories.map(cat => `
            <div class="flex items-center">
                <input id="filter-alert-${cat}" name="alert-category" type="checkbox" class="filter-checkbox h-4 w-4 rounded border-gray-300 text-meli-blue focus:ring-meli-blue" value="${cat}" checked>
                <label for="filter-alert-${cat}" class="ml-2 block text-sm text-gray-700">${cat}</label>
            </div>
        `).join('');
        
        contentFilterContainer.innerHTML = contentEntities.map(ent => `
            <div class="flex items-center">
                <input id="filter-content-${ent}" name="content-entity" type="checkbox" class="filter-checkbox h-4 w-4 rounded border-gray-300 text-meli-blue focus:ring-meli-blue" value="${ent}" checked>
                <label for="filter-content-${ent}" class="ml-2 block text-sm text-gray-700">${ent}</label>
            </div>
        `).join('');

        const filters = document.querySelectorAll('.filter-checkbox');
        filters.forEach(filter => filter.addEventListener('change', () => renderNews(allNews)));
        
        renderNews(allNews);
    }
    
    function renderNews(allNews) {
        const newsListContainer = document.getElementById('news-list');
        
        const selectedAlertCats = Array.from(document.querySelectorAll('input[name="alert-category"]:checked')).map(cb => cb.value);
        const selectedContentEnts = Array.from(document.querySelectorAll('input[name="content-entity"]:checked')).map(cb => cb.value);

        const filteredNews = allNews.filter(newsItem => {
            const isAlert = newsData.some(n => n.id === newsItem.id);
            const isContent = contentNewsData.some(n => n.id === newsItem.id);

            if (isAlert) {
                return selectedAlertCats.includes(newsItem.category);
            }
            if (isContent) {
                return selectedContentEnts.includes(newsItem.entity);
            }
            return false;
        });
        
        if (filteredNews.length === 0) {
            newsListContainer.innerHTML = `<div class="text-center py-10 px-4"><p class="text-gray-500">No hay noticias que coincidan con los filtros seleccionados.</p></div>`;
            return;
        }

        newsListContainer.innerHTML = filteredNews.map(news => {
            const isAlert = newsData.some(n => n.id === news.id);
            const impactColorClass = news.impact === 'Alto' ? 'border-red-500' : 'border-yellow-400';
            const countryBadge = news.country && news.country !== 'Global' ? `<span class="bg-gray-100 text-gray-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded">${news.country}</span>` : '';
            const entityName = news.entity === 'Warner Bros. Discovery' ? 'WBD (Max)' : news.entity;
            
            return `
            <div class="bg-white border-l-4 ${isAlert ? impactColorClass : 'border-gray-300'} rounded-r-lg shadow-sm overflow-hidden ring-1 ring-gray-200 ring-opacity-50">
                <div class="p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-xs font-semibold uppercase tracking-wider ${isAlert ? 'text-meli-blue' : 'text-gray-500'}">${entityName}</span>
                            <p class="text-sm font-bold text-meli-dark mt-1">${news.title}</p>
                        </div>
                    </div>
                    <div class="mt-3 flex justify-between items-center text-xs text-gray-500">
                        <div class="flex items-center gap-2">
                            <span class="bg-blue-50 text-blue-700 font-medium px-2 py-0.5 rounded">${news.category}</span>
                            ${countryBadge}
                        </div>
                        <div class="flex items-center">
                            <span>${news.date}</span>
                            <span class="mx-1.5">&bull;</span>
                            <span>${news.publisher}</span>
                        </div>
                    </div>
                </div>
            </div>
            `;
        }).join('');
    }

    // Inicializar ambas secciones
    setupSentimentAnalysis();
    setupNewsFeed();
});
</script>

</body>
</html>
