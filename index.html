<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      "Brasil": {
        sentimentIndex: [85, 88, 86, 84, 80, 72, 75, 78, 83, 76, 79, 81],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Beneficio 120% CDI' },
          { month: 'Jun 25', text: 'Cambio percepción envío gratis' },
          { month: 'Jul 25', text: 'Amazon Prime Day' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Estable', motivosDet: 'Disney+ con anuncios', promotores: 'Aumento', motivosPro: 'Rendimiento Cofrinhos 120%', eventos: '-', competencia: 'N/A' },
          { mes: 'Jul 25', detractores: 'Leve Aumento', motivosDet: 'Ofertas Prime Day', promotores: 'Estable', motivosPro: 'Envíos FULL', eventos: 'Amazon Prime Day', competencia: 'Prime Day muy agresivo' },
          { mes: 'Jun 25', detractores: 'Aumento', motivosDet: 'Envío ya no es diferencial', promotores: 'Baja', motivosPro: 'Acceso a Max', eventos: 'Envío gratis general ≥ R$19,90', competencia: 'Shopee mantiene agresividad' },
          { mes: 'May 25', detractores: 'Baja', motivosDet: 'Costo suscripción', promotores: 'Aumento', motivosPro: 'Rendimiento Cofrinhos 120%', eventos: 'Meli+ BR 120% CDI', competencia: 'N/A' },
          { mes: 'Feb 25', detractores: 'Aumento Fuerte', motivosDet: 'Cashback reducido', promotores: 'Baja Fuerte', motivosPro: 'Aún conviene por envíos', eventos: 'Cambio % cashback', competencia: 'Amazon sin cambios' }
        ],
        summary: `
          <p>El sentimiento en Brasil muestra una recuperación reciente gracias a la excelente recepción del rendimiento del 120% CDI en "Cofrinhos", que se ha convertido en un diferenciador clave. Sin embargo, persisten dos puntos de fricción:</p>
          <ul>
            <li><strong>Propuesta de valor de envíos:</strong> La percepción de que el envío gratis ya no es un beneficio exclusivo de Meli+ desde el cambio en junio sigue generando comentarios negativos. <em>"Pago Meli+ para tener envío gratis y ahora se lo dan a casi todos, ¿cuál es el chiste?"</em> (Comentario en Reclame Aqui).</li>
            <li><strong>Beneficios de streaming:</strong> La introducción de anuncios en el plan de Disney+ incluido ha sido una fuente de quejas significativa en agosto. <em>"Nos dieron el plan con anuncios sin avisar, se siente como un recorte al beneficio."</em> (Usuario en X).</li>
          </ul>
          <p>Como contrapunto, el beneficio financiero sigue siendo el ancla principal: <em>"Puse mi reserva en el cofrinho de Meli+ y rinde mucho más que cualquier otra cuenta. Solo por eso ya se paga la suscripción."</em> (Video en YouTube).</p>
        `
      },
      "México": {
        sentimentIndex: [82, 86, 85, 83, 80, 74, 76, 77, 81, 80, 78, 79],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Hot Sale / Lanzamiento NU+' },
          { month: 'Jul 25', text: 'Amazon Prime Day' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Estable', motivosDet: 'Disney+ con anuncios', promotores: 'Estable', motivosPro: 'Envíos FULL', eventos: '-', competencia: 'N/A' },
          { mes: 'Jul 25', detractores: 'Aumento', motivosDet: 'Prime Day mejores ofertas', promotores: 'Baja', motivosPro: 'Catálogo Max', eventos: 'Amazon Prime Day', competencia: 'Amazon agresivo con cupones' },
          { mes: 'Jun 25', detractores: 'Estable', motivosDet: 'Comparación con NU+', promotores: 'Estable', motivosPro: 'Descuentos Meli+', eventos: '-', competencia: 'Nubank publicita fuerte NU+' },
          { mes: 'May 25', detractores: 'Baja', motivosDet: 'Costo suscripción', promotores: 'Aumento Fuerte', motivosPro: 'Ofertas Hot Sale', eventos: 'Hot Sale MX', competencia: 'Nubank lanza NU+' },
          { mes: 'Feb 25', detractores: 'Aumento Fuerte', motivosDet: 'Cashback reducido', promotores: 'Baja Fuerte', motivosPro: 'Acceso a streaming', eventos: 'Cambio % cashback', competencia: 'N/A' }
        ],
        summary: `
          <p>El sentimiento en México, aunque estable, enfrenta una creciente presión competitiva. El lanzamiento de NU+ por parte de Nubank en mayo ha creado un nuevo punto de comparación en el terreno de los beneficios y el cashback.</p>
          <ul>
            <li><strong>Competencia Financiera:</strong> Los usuarios comparan activamente los beneficios de Meli+ con los ofrecidos por nuevas fintechs. <em>"Entre NU+ y Meli+, estoy evaluando cuál me da más por mi dinero. El cashback de Nu se siente más directo."</em> (Usuario en Reddit r/MexicoFinanciero).</li>
            <li><strong>Eventos de Venta:</strong> Hot Sale fue un éxito rotundo para Meli+, con una percepción muy positiva de los descuentos exclusivos. Sin embargo, la percepción durante Prime Day fue menos favorable, con muchos usuarios señalando que las ofertas de Amazon fueron superiores. <em>"En el Hot Sale Meli+ se lució, pero para Prime Day me cambié de bando, las ofertas eran mucho mejores."</em> (Comentario en Apestan.com).</li>
          </ul>
        `
      },
      "Chile": {
        sentimentIndex: [78, 80, 79, 81, 82, 83, 85, 88, 86, 85, 84, 85],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25'],
        events: [
          { month: 'Abr 25', text: 'Nuevos beneficios Meli+' },
          { month: 'Jul 25', text: 'Amazon Prime Day' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Estable', motivosDet: 'Demora envíos a regiones', promotores: 'Estable', motivosPro: 'Beneficios streaming', eventos: '-', competencia: 'Falabella con Cyber Day' },
          { mes: 'Jul 25', detractores: 'Leve Aumento', motivosDet: 'Pocas ofertas Prime Day', promotores: 'Estable', motivosPro: 'Universal+ incluido', eventos: 'Amazon Prime Day', competencia: 'Poca tracción de Amazon' },
          { mes: 'Abr 25', detractores: 'Baja', motivosDet: 'Costo', promotores: 'Aumento Fuerte', motivosPro: 'Nuevos descuentos y beneficios', eventos: 'Nuevos beneficios Meli+ CL', competencia: 'N/A' },
          { mes: 'Mar 25', detractores: 'Estable', motivosDet: 'Faltan beneficios', promotores: 'Estable', motivosPro: 'Envíos gratis', eventos: '-', competencia: 'Ripley con ofertas CMR' },
          { mes: 'Sep 24', detractores: 'Estable', motivosDet: 'Costo mensual', promotores: 'Estable', motivosPro: 'Envíos y Disney+', eventos: '-', competencia: 'N/A' }
        ],
        summary: `
          <p>Chile mantiene el índice de sentimiento más alto y estable de la región. La actualización de beneficios en abril fue un catalizador muy positivo que consolidó el valor percibido del programa.</p>
          <ul>
            <li><strong>Fortalezas Clave:</strong> La combinación de envíos gratis rápidos en la Región Metropolitana y el paquete de streaming (Disney+, Universal+) es consistentemente citada como la razón principal para mantener la suscripción. <em>"Pago feliz Meli+, solo con lo que me ahorro en envíos y lo que me costaría Disney+ y Universal+ por separado, ya estoy ganando."</em> (Usuario en X).</li>
            <li><strong>Área de Oportunidad:</strong> Las quejas recurrentes, aunque minoritarias, se centran en la logística. <em>"En Santiago todo llega al día siguiente, pero a mi ciudad en el sur a veces tarda una semana. Deberían mejorar eso para los que pagamos Meli+."</em> (Reclamo en SERNAC).</li>
          </ul>
        `
      },
      "Argentina": {
        sentimentIndex: [75, 76, 74, 72, 70, 71, 73, 75, 85, 82, 80, 78],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25'],
        events: [
          { month: 'May 25', text: 'Lanzamiento Meli+' },
          { month: 'Jul 25', text: 'Amazon Prime Day' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Aumento', motivosDet: 'Disney+ con anuncios', promotores: 'Baja', motivosPro: 'Sigue conviniendo', eventos: '-', competencia: 'N/A' },
          { mes: 'Jul 25', detractores: 'Estable', motivosDet: 'Pocas ofertas vs afuera', promotores: 'Estable', motivosPro: 'Envíos y cuotas', eventos: 'Amazon Prime Day', competencia: 'Amazon no es relevante' },
          { mes: 'May 25', detractores: 'Baja Fuerte', motivosDet: 'Confusión inicial', promotores: 'Aumento Fuerte', motivosPro: '¡Más beneficios que Nivel 6!', eventos: 'Lanzamiento Meli+ AR', competencia: 'N/A' },
          { mes: 'Abr 25', detractores: 'Aumento', motivosDet: 'Nivel 6 vale poco', promotores: 'Baja', motivosPro: 'Envíos', eventos: 'Expectativa por Meli+', competencia: 'N/A' }
        ],
        summary: `
          <p>La transición de Nivel 6 a Meli+ en mayo generó una ola de sentimiento positivo sin precedentes, posicionando al programa como un estándar de alto valor. Sin embargo, el "efecto luna de miel" ha comenzado a moderarse.</p>
          <ul>
            <li><strong>Principal Detractor Reciente:</strong> Al igual que en Brasil, la inclusión de anuncios en Disney+ fue la principal fuente de quejas en agosto, percibido como una reducción de un beneficio clave. <em>"Che, me pasaron a Meli+ con bombos y platillos, y a los 3 meses me bajan la calidad de Disney. No da."</em> (Usuario en tuquejasuma.com).</li>
            <li><strong>Valor Fundamental Persistente:</strong> A pesar de las quejas, el core de la propuesta (envíos gratis, descuentos y acceso a streaming) sigue siendo muy valorado en el contexto local. <em>"Aunque me moleste lo de los anuncios, la verdad es que Meli+ sigue siendo un golazo. Entre los envíos y las promos, se paga solo."</em> (Comentario en Instagram).</li>
          </ul>
        `
      },
      "Colombia": {
        sentimentIndex: [76, 77, 75, 74, 73, 72, 70, 68, 67, 69, 72, 84],
        labels: ['Sep 24','Oct 24','Nov 24','Dic 24','Ene 25','Feb 25','Mar 25','Abr 25','May 25','Jun 25','Jul 25','Ago 25'],
        events: [
          { month: 'May 25', text: 'Llegada de Amazon Prime' },
          { month: 'Aug 25', text: 'Lanzamiento Meli+' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Baja Fuerte', motivosDet: 'Confusión inicial', promotores: 'Aumento Fuerte', motivosPro: '¡Al fin Meli+!', eventos: 'Lanzamiento Meli+ CO', competencia: 'N/A' },
          { mes: 'Jul 25', detractores: 'Estable', motivosDet: 'Nivel 6 no compite', promotores: 'Leve Aumento', motivosPro: 'Expectativa por Meli+', eventos: 'Anuncio Meli+ para Agosto', competencia: 'Rappi Pro con descuentos' },
          { mes: 'May 25', detractores: 'Aumento Fuerte', motivosDet: 'Nivel 6 vs Prime', promotores: 'Baja Fuerte', motivosPro: 'Envíos', eventos: 'Amazon Prime llega a CO', competencia: 'Lanzamiento fuerte de Amazon' },
          { mes: 'Abr 25', detractores: 'Estable', motivosDet: 'Pocos beneficios', promotores: 'Estable', motivosPro: 'Envíos', eventos: '-', competencia: 'Alkosto con ofertas online' }
        ],
        summary: `
          <p>El lanzamiento de Meli+ en agosto ha sido un éxito rotundo, revirtiendo completamente la tendencia negativa que se había instalado desde la llegada de Amazon Prime en mayo.</p>
          <ul>
            <li><strong>Recepción del Lanzamiento:</strong> La percepción de valor es altísima, con usuarios celebrando la llegada de un paquete de beneficios comparable al de otros países de la región. El sentimiento es abrumadoramente positivo. <em>"¡Por fin! Estábamos esperando Meli+ en Colombia. Ahora sí vale la pena pagar, el Nivel 6 se había quedado corto."</em> (Usuario en X).</li>
            <li><strong>Contexto Competitivo:</strong> El programa Nivel 6 sufría en la comparación directa con Amazon Prime. El nuevo Meli+ ahora se percibe como un competidor fuerte y, para muchos, superior. <em>"Amazon Prime llegó y le pegó duro a Mercado Libre, pero con esto de Meli+ se pusieron las pilas y ahora la pelea está buena."</em> (Comentario en video de YouTube).</li>
          </ul>
        `
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      {
        "id": 1,
        "entity": "OpenAI (ChatGPT Premium)",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "OpenAI Announces General Availability of GPT-5 API, Ushering in New Era of AI Capabilities",
        "url": "https://openai.com/blog/gpt-5-api-general-availability",
        "date": "02-09-2025",
        "category": "Flagship AI",
        "summary": "OpenAI officially launched its next-generation flagship model, GPT-5, making it available to all paying API customers. The new model boasts significant improvements in reasoning, multimodality, and reduced hallucinations.",
        "publisher": "openai.com",
        "url_raw": "https://openai.com/blog/gpt-5-api-general-availability",
        "url_canonical": "https://openai.com/blog/gpt-5-api-general-availability",
        "http_status": "200",
        "archived_url": "",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 2,
        "entity": "Amazon Prime",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "Amazon to Increase Prime Subscription Price Across Latin America by 15% Starting in October",
        "url": "https://www.reuters.com/technology/amazon-prime-price-hike-latin-america-2025-08-28/",
        "date": "28-08-2025",
        "category": "Cambio de Precio",
        "summary": "Amazon announced a price increase for its Prime service in Brazil, Mexico, and Chile, citing rising operational and content costs. The new pricing will take effect for existing members on their next billing cycle after October 1st.",
        "publisher": "reuters.com",
        "url_raw": "https://www.reuters.com/technology/amazon-prime-price-hike-latin-america-2025-08-28/",
        "url_canonical": "https://www.reuters.com/technology/amazon-prime-price-hike-latin-america-2025-08-28/",
        "http_status": "200",
        "archived_url": "",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 3,
        "entity": "Rappi Pro",
        "country": "Brasil",
        "impact": "Medio",
        "title": "Rappi e Nubank Anunciam Parceria Estratégica para Clientes Rappi Pro e Ultravioleta",
        "url": "https://blog.nubank.com.br/parceria-rappi-pro-ultravioleta/",
        "date": "26-08-2025",
        "category": "Estrategia",
        "summary": "Rappi Brazil and Nubank have formed a partnership offering exclusive benefits. Rappi Pro members will get an increased cashback rate when paying with their Nubank card, and Nubank Ultravioleta clients will receive 3 months of Rappi Pro for free.",
        "publisher": "blog.nubank.com.br",
        "url_raw": "https://blog.nubank.com.br/parceria-rappi-pro-ultravioleta/",
        "url_canonical": "https://blog.nubank.com.br/parceria-rappi-pro-ultravioleta/",
        "http_status": "200",
        "archived_url": "",
        "language": "pt",
        "out_of_window": false
      }
    ];
    const contentNewsData = [
      {
        "id": 101,
        "entity": "Paramount+",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "Skydance-Paramount Global Merger Clears Final Regulatory Hurdle; Deal Expected to Close in Q4",
        "url": "https://variety.com/2025/biz/news/skydance-paramount-merger-final-approval-1236015578/",
        "date": "03-09-2025",
        "category": "Fusión/Adquisición",
        "summary": "The proposed merger between Skydance Media and Paramount Global has received its final regulatory approval from all necessary bodies. The companies now expect the transaction to formally close by mid-November 2025.",
        "publisher": "variety.com",
        "url_raw": "https://variety.com/2025/biz/news/skydance-paramount-merger-final-approval-1236015578/",
        "url_canonical": "https://variety.com/2025/biz/news/skydance-paramount-merger-final-approval-1236015578/",
        "http_status": "200",
        "archived_url": "",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 102,
        "entity": "Max",
        "country": "Todos los Países",
        "impact": "Alto",
        "title": "WBD's Max Secures Exclusive Multi-Year Streaming Rights for Copa Libertadores in Brazil and Mexico",
        "url": "https://pressroom.wbd.com/us/media-release/max-secures-copa-libertadores-rights-latam",
        "date": "29-08-2025",
        "category": "Derechos/Deportes",
        "summary": "Warner Bros. Discovery has won the bidding for the exclusive streaming rights to the CONMEBOL Copa Libertadores for the 2026-2029 cycle in Brazil and Mexico. All matches will be streamed live on Max.",
        "publisher": "pressroom.wbd.com",
        "url_raw": "https://pressroom.wbd.com/us/media-release/max-secures-copa-libertadores-rights-latam",
        "url_canonical": "https://pressroom.wbd.com/us/media-release/max-secures-copa-libertadores-rights-latam",
        "http_status": "200",
        "archived_url": "",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 103,
        "entity": "Netflix",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Netflix Expands 'Standard with Ads' Plan to Chile and Peru",
        "url": "https://about.netflix.com/en/news/standard-with-ads-plan-expands-to-chile-peru",
        "date": "27-08-2025",
        "category": "Estrategia",
        "summary": "Netflix announced the expansion of its 'Standard with Ads' subscription tier to Chile and Peru, starting September 15. The plan offers a lower price point in exchange for viewing advertisements.",
        "publisher": "about.netflix.com",
        "url_raw": "https://about.netflix.com/en/news/standard-with-ads-plan-expands-to-chile-peru",
        "url_canonical": "https://about.netflix.com/en/news/standard-with-ads-plan-expands-to-chile-peru",
        "http_status": "200",
        "archived_url": "",
        "language": "en",
        "out_of_window": false
      },
      {
        "id": 104,
        "entity": "Disney+",
        "country": "Todos los Países",
        "impact": "Medio",
        "title": "Disney+ Unveils New Slate of Latin American Originals for 2026",
        "url": "https://www.thewaltdisneycompany.com/disney-plus-latam-originals-2026-slate/",
        "date": "25-08-2025",
        "category": "Producto",
        "summary": "During a regional press event, Disney+ announced over 10 new original series and films produced in Mexico, Brazil, Argentina, and Colombia, all slated for release throughout 2026.",
        "publisher": "thewaltdisneycompany.com",
        "url_raw": "https://www.thewaltdisneycompany.com/disney-plus-latam-originals-2026-slate/",
        "url_canonical": "https://www.thewaltdisneycompany.com/disney-plus-latam-originals-2026-slate/",
        "http_status": "200",
        "archived_url": "",
        "language": "en",
        "out_of_window": false
      }
    ];

    /* ===== LISTAS MAESTRAS ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach'
    ];
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ];
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ];

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-rose-100 bg-rose-50 text-rose-700">${row.motivosDet}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm"><span class="inline-block px-2 py-1 rounded-md ring-1 ring-emerald-100 bg-emerald-50 text-emerald-700">${row.motivosPro}</span></td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de fuente (host en texto plano, sin enlace) ==== */
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }

    /* ==== Render tarjetas (Vertiente 2) — sin enlaces ni badge de impacto ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const cm = newsFilters.country.length === 0 || newsFilters.country.includes('all') || newsFilters.country.includes(item.country);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes('all') || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes('all') || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Países' ? ` (${row.country})` : ''}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) — sin enlaces ni badge de impacto ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const cm = contentFilters.country.length === 0 || contentFilters.country.includes('all') || contentFilters.country.includes(item.country);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes('all') || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes('all') || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const host = sourceHost(row.url);
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              ${getCategoryTag(row.category)}
            </div>
            <p class="text-gray-700 mb-3">${row.title}</p>
            <p class="text-xs text-gray-500">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center">
            <span>${row.date || ''}</span>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros ==== */
    function populateCheckboxes(container, allItems, group) {
        const idBase = group + '-';
        let html = '';
        allItems.forEach(item => {
            const uniqueId = idBase + item.replace(/[^a-zA-Z0-9]/g, ''); // Create a safe ID
            html += `<div class="filter-checkbox-item"><input type="checkbox" id="${uniqueId}" value="${item}" class="mr-2"><label for="${uniqueId}">${item}</label></div>`;
        });
        container.innerHTML = html;
    }


    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES, 'news-country-');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company-');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category-');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES, 'content-country-');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company-');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category-');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }
    function normalizeSelectAll(container, selectedValues) {
        // Esta función no se usa con el nuevo populateCheckboxes pero se mantiene por si acaso
    }
    function filterNews() {
      newsFilters.country = getSelected(newsFilterCountryContainer);
      newsFilters.company = getSelected(newsFilterCompanyContainer);
      newsFilters.category = getSelected(newsFilterCategoryContainer);
      renderNewsCards();
    }
    function filterContentNews() {
      contentFilters.country = getSelected(contentFilterCountryContainer);
      contentFilters.company = getSelected(contentFilterCompanyContainer);
      contentFilters.category = getSelected(contentFilterCategoryContainer);
      renderContentNewsCards();
    }

    /* ==== Tabs & Boot ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    updateSentimentContent('Brasil');
    updateNewsFilters(); renderNewsCards();
    updateContentNewsFilters(); renderContentNewsCards();
  </script>
</body>
</html>
