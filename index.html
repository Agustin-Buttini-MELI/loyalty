<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1f2937; }
    .main-accent { color: #2563eb; } .bg-main-accent { background-color: #2563eb; }
    .tab-btn.active { background-color: #e0f2fe; border-bottom: 2px solid #2563eb; }
    .tab-btn { transition: background-color 0.3s ease; }
    .filter-checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: .5rem; padding: 8px; }
    .filter-checkbox-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="bg-main-accent p-2 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Reporte Integrado: Sentimiento Meli+ y Noticias de Mercado</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <section class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Análisis de Sentimiento Meli+</h2>
      <p class="mt-2 text-lg text-gray-600">Visualiza la evolución de la percepción de los clientes en función de eventos clave y la competencia.</p>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Índice de Sentimiento General (Escala 0-100)</h3>
      <div class="chart-container w-full max-w-4xl mx-auto h-96">
        <canvas id="sentimentChart"></canvas>
      </div>
    </div>

    <section class="mb-8">
      <div class="flex justify-center border-b border-gray-200">
        <button data-country="Brasil" class="tab-btn active px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Brasil</button>
        <button data-country="México" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">México</button>
        <button data-country="Chile" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Chile</button>
        <button data-country="Argentina" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Argentina</button>
        <button data-country="Colombia" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:bg-blue-50">Colombia</button>
      </div>
    </section>

    <section id="country-data" class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Detalles por País: <span id="country-name" class="main-accent">Brasil</span></h2>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Tabla Resumen de Sentimientos</h3>
      <div class="overflow-x-auto mb-8">
        <table id="sentiment-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mes</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Detractores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentimientos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivos Promotores</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Eventos Clave/Contexto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novedades de la Competencia</th>
            </tr>
          </thead>
          <tbody id="sentiment-table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Resumen de Sentimientos Detractores y Promotores</h3>
      <div id="sentiment-summary" class="prose max-w-none"></div>
    </section>

    <!-- Vertiente 2 -->
    <section id="market-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Alertas de Mercado Recientes</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="news-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="news-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="news-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="news-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-news-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias con los filtros seleccionados.</p>
        </div>
      </div>
    </section>

    <!-- Vertiente 3 -->
    <section id="content-platforms-news" class="mt-12">
      <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Noticias de Plataformas de Contenido y Streaming</h2>
        <div class="bg-white p-4 rounded-xl shadow-inner border border-gray-200 mb-8">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">País</label>
              <div id="content-filter-country" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <div id="content-filter-company" class="filter-checkbox-group"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
              <div id="content-filter-category" class="filter-checkbox-group"></div>
            </div>
            <div class="flex items-end">
              <button id="content-reset-filters" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Limpiar Filtros</button>
            </div>
          </div>
        </div>
        <div id="content-alerts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        <div id="no-content-results" class="hidden text-center py-12">
          <p class="text-xl text-gray-500">No se encontraron noticias de contenido con los filtros seleccionados.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 mt-16">
    <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
      <p>&copy; 2025 Reporte de Sentimiento Meli+. Visualización interactiva.</p>
    </div>
  </footer>

  <script>
    /* ===== Sentimiento (Vertiente 1) ===== */
    const sentimentData = {
      'Brasil': {
        sentimentIndex: [75, 78, 77, 80, 79, 68, 70, 71, 72, 60, 62, 65],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Meli+ Cofrinhos 120% CDI' },
          { month: 'Jun 25', text: 'Cambio envío gratis general' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Alto', motivosDet: 'Confusión residual sobre reglas de envío, comparación con competidores', promotores: 'Moderado', motivosPro: 'Valor del paquete de streaming, rendimiento Cofrinhos', eventos: 'Periodo post-cambio de envíos', competencia: 'Amazon anuncia alianza con Itaú para cuotas' },
          { mes: 'Jun 25', detractores: 'Muy Alto', motivosDet: 'Fin del envío gratis para compras de bajo valor (ej. <R$79), percepción de devaluación del beneficio principal', promotores: 'Bajo', motivosPro: 'Beneficios de streaming y financieros se mantienen', eventos: 'Implementación de envío gratis general ≥ R$19,90', competencia: 'Shopee con cupones agresivos' },
          { mes: 'May 25', detractores: 'Moderado', motivosDet: 'Quejas sobre usabilidad de Cofrinhos', promotores: 'Alto', motivosPro: 'Lanzamiento de Cofrinhos con 120% CDI, valor financiero percibido', eventos: 'Meli+ anuncia Cofrinhos', competencia: 'Nubank con fuerte campaña de marketing' }
        ],
        summary: `
          <h4>Principales Temas Promotores</h4>
          <ul>
            <li><strong>Valor Financiero (Cofrinhos):</strong> "El 120% del CDI es un gran plus, mi dinero está seguro y rinde bien. Mucho mejor que la poupança." (Foro de finanzas)</li>
            <li><strong>Paquete de Entretenimiento:</strong> "Tener Disney+, Star+ y ahora Universal+ por el precio de Meli+ es un ofertón. No hay competencia en eso." (Comentario en YouTube)</li>
          </ul>
          <h4>Principales Temas Detractores</h4>
          <ul>
            <li><strong>Cambio en Política de Envíos (Jun-25):</strong> El mayor detractor. Cita recurrente: <em>"¿Para qué pago Meli+ si ahora me cobran envío por un producto de R$50? El beneficio principal se diluyó."</em> (Post en Reddit)</li>
            <li><strong>Percepción de 'Downgrade':</strong> "Primero reducen el cashback, después cambian lo del envío. Siento que cada vez nos dan menos por el mismo precio." (X/Twitter)</li>
          </ul>`
      },
      'México': {
        sentimentIndex: [78, 80, 81, 82, 80, 70, 72, 73, 72, 74, 75, 76],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'Sep 24', text: 'Lanzamiento Meli+' },
          { month: 'Feb 25', text: 'Cambio % cashback' },
          { month: 'May 25', text: 'Hot Sale / Lanzamiento NU+' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Bajo', motivosDet: 'Quejas aisladas sobre tiempos de entrega', promotores: 'Alto', motivosPro: 'Paquete de streaming (Disney/Star), descuentos en Max', eventos: 'Campaña "Regreso a Clases"', competencia: 'Amazon con ofertas pre-temporada' },
          { mes: 'May 25', detractores: 'Moderado', motivosDet: 'Comparaciones con la nueva oferta de NU+, algunos problemas logísticos por alta demanda', promotores: 'Muy Alto', motivosPro: 'Beneficios de Meli+ (envíos, cuotas) fueron clave para compras en Hot Sale', eventos: 'Hot Sale MX', competencia: 'Lanzamiento de NU+ por Nubank, fuerte campaña de Amazon' },
          { mes: 'Feb 25', detractores: 'Alto', motivosDet: 'Reducción del % de cashback, percepción de menor valor monetario', promotores: 'Bajo', motivosPro: 'Se mantienen los beneficios de envíos y streaming', eventos: 'Anuncio de cambio en política de cashback', competencia: 'Walmart Pass con campaña agresiva' }
        ],
        summary: `
          <h4>Principales Temas Promotores</h4>
          <ul>
            <li><strong>Valor en Eventos de Venta:</strong> "En el Hot Sale, el envío gratis y los descuentos exclusivos de Meli+ hicieron toda la diferencia. Ahorré bastante." (Grupo de Facebook sobre ofertas)</li>
            <li><strong>Paquete de Streaming:</strong> "Pago Meli+ y tengo Disney+, Star+ y descuento en Max. Es más barato que pagarlos por separado, y además tengo los envíos." (Comentario en TikTok)</li>
          </ul>
          <h4>Principales Temas Detractores</h4>
          <ul>
            <li><strong>Reducción de Cashback (Feb-25):</strong> "El cashback era lo mejor, ahora es mucho menor. Le quitó el principal atractivo que tenía sobre Amazon Prime." (Foro en Apestan.com)</li>
            <li><strong>Competencia de Neobancos:</strong> "Estoy probando NU+ de Nubank. El cashback es más directo. Meli+ tiene que ponerse las pilas." (Post en X/Twitter)</li>
          </ul>`
      },
      'Chile': {
        sentimentIndex: [70, 71, 72, 74, 73, 75, 76, 82, 83, 81, 80, 81],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'Abr 25', text: 'Nuevos beneficios (Universal+)' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Bajo', motivosDet: 'Costos de envío a regiones extremas siguen siendo altos', promotores: 'Alto', motivosPro: 'Paquete de streaming robusto, velocidad de envío en Santiago', eventos: 'Periodo estable', competencia: 'Falabella con descuentos CMR agresivos' },
          { mes: 'Abr 25', detractores: 'Bajo', motivosDet: 'Confusión sobre cómo activar el nuevo beneficio de Universal+', promotores: 'Muy Alto', motivosPro: 'Adición de Universal+ al paquete sin costo extra, percibido como gran valor', eventos: 'Nuevos beneficios Meli+ CL', competencia: 'Ripley con campaña de cyber' },
          { mes: 'Ene 25', detractores: 'Moderado', motivosDet: 'Tiempos de entrega extendidos por temporada de vacaciones', promotores: 'Moderado', motivosPro: 'Uso de beneficios para compras de verano', eventos: 'Temporada alta de vacaciones', competencia: 'Amazon con envíos gratis desde EEUU sobre cierto monto' }
        ],
        summary: `
          <h4>Principales Temas Promotores</h4>
          <ul>
            <li><strong>Adición de Beneficios (Abr-25):</strong> "¡Excelente que hayan sumado Universal+! Cada vez vale más la pena la suscripción." (Comentario en Instagram de Meli)</li>
            <li><strong>Velocidad Logística:</strong> "Compro en la mañana y me llega en la tarde. En Santiago, el servicio de envío es insuperable." (Foro en Reddit r/chile)</li>
          </ul>
          <h4>Principales Temas Detractores</h4>
          <ul>
            <li><strong>Envíos a Regiones:</strong> "Soy de Punta Arenas y el 'envío gratis' casi nunca aplica. El beneficio de Meli+ se siente centralizado en Santiago." (Queja en SERNAC)</li>
            <li><strong>Comparación con Retail Físico:</strong> "A veces con los descuentos de la tarjeta CMR en Falabella consigo mejor precio final, aunque el envío demore más." (Blog de finanzas personales)</li>
          </ul>`
      },
      'Argentina': {
        sentimentIndex: [65, 66, 68, 70, 67, 68, 69, 68, 70, 72, 73, 74],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'May 25', text: 'Lanzamiento Meli+' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Moderado', motivosDet: 'Aumento de precio percibido con el cambio a Meli+, suba de la cuota mensual', promotores: 'Alto', motivosPro: 'Valor del paquete de streaming frente a la inflación y costos por separado', eventos: 'Asentamiento del nuevo programa', competencia: 'Ualá con promociones en su ecosistema' },
          { mes: 'May 25', detractores: 'Alto', motivosDet: 'Migración forzada de Nivel 6 a Meli+, confusión sobre el nuevo costo y beneficios', promotores: 'Alto', motivosPro: 'El paquete de Disney/Star+ y envíos por el precio final es visto como una buena oferta', eventos: 'Lanzamiento de Meli+ AR', competencia: 'NaranjaX con beneficios en comercios' },
          { mes: 'Abr 25', detractores: 'Moderado', motivosDet: 'Inconsistencias en los puntos para subir de nivel', promotores: 'Moderado', motivosPro: 'Descuentos y cuotas en Nivel 6', eventos: 'Pre-lanzamiento Meli+', competencia: 'Promociones bancarias agresivas' }
        ],
        summary: `
          <h4>Principales Temas Promotores</h4>
          <ul>
            <li><strong>Propuesta de Valor vs Inflación:</strong> "Con lo que sale contratar Disney y Star+ por afuera, Meli+ es un regalo. Y encima tengo envíos gratis." (Foro tuquejasuma.com)</li>
            <li><strong>Conveniencia y Variedad:</strong> "Consigo de todo, me llega rápido y en cuotas. En este contexto, es la mejor opción de compra por lejos." (Comentario en noticia de economía)</li>
          </ul>
          <h4>Principales Temas Detractores</h4>
          <ul>
            <li><strong>Cambio de Nivel 6 a Meli+:</strong> "Me pasaron a Meli+ sin preguntar. Es un aumento de precio encubierto, yo estaba bien con Nivel 6." (Post en X/Twitter)</li>
            <li><strong>Comunicación del Cambio:</strong> "No entendí bien qué beneficios perdí y cuáles gané. La comunicación fue muy confusa." (Queja en tuquejasuma.com)</li>
          </ul>`
      },
      'Colombia': {
        sentimentIndex: [72, 73, 74, 75, 74, 73, 72, 71, 70, 70, 71, 75],
        labels: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25', 'Jun 25', 'Jul 25', 'Ago 25'],
        events: [
          { month: 'May 25', text: 'Llegada de Amazon Prime' },
          { month: 'Ago 25', text: 'Lanzamiento Meli+' }
        ],
        table: [
          { mes: 'Ago 25', detractores: 'Alto', motivosDet: 'Confusión en la migración de Nivel 6 a Meli+, bugs en la app', promotores: 'Muy Alto', motivosPro: 'Lanzamiento de Meli+ con paquete de streaming (Disney/Star) y descuentos, percibido como gran valor', eventos: 'Lanzamiento de Meli+ CO', competencia: 'Amazon Prime con campaña de adquisición' },
          { mes: 'May 25', detractores: 'Alto', motivosDet: 'Comparaciones directas con la oferta de Amazon Prime (envíos y Prime Video)', promotores: 'Bajo', motivosPro: 'Lealtad a la marca, variedad de productos locales', eventos: 'Contexto de llegada de Amazon Prime', competencia: 'Lanzamiento y campaña masiva de Amazon Prime en CO' },
          { mes: 'Abr 25', detractores: 'Bajo', motivosDet: 'Quejas sobre tiempos de entrega en zonas rurales', promotores: 'Alto', motivosPro: 'Beneficios de Nivel 6, especialmente envíos gratis', eventos: 'Periodo estable pre-competencia', competencia: 'Rappi con fortalecimiento de Rappi Pro (Turbo)' }
        ],
        summary: `
          <h4>Principales Temas Promotores</h4>
          <ul>
            <li><strong>Lanzamiento Meli+ (Ago-25):</strong> "¡Por fin llegó Meli+! El paquete con Disney+ y los descuentos en Max/Universal+ es justo lo que faltaba para competir con Amazon." (Post en Reddit r/colombia)</li>
            <li><strong>Ecosistema Integrado:</strong> "Prefiero Meli porque puedo pagar con Mercado Pago, pedir crédito y recibir rápido. Es más que solo envíos." (Comentario en El Tiempo)</li>
          </ul>
          <h4>Principales Temas Detractores</h4>
          <ul>
            <li><strong>Llegada de Amazon Prime (May-25):</strong> "Amazon llegó con envíos gratis y Prime Video. Mercado Libre se demoró en reaccionar con una oferta de valor similar." (Foro de tecnología)</li>
            <li><strong>Problemas de Migración (Ago-25):</strong> "Soy Nivel 6 y no me aparece la opción de Meli+. La app no se actualiza y el soporte no responde." (Queja en SIC)</li>
          </ul>`
      }
    };

    /* ===== Vertiente 2 (Alertas) y Vertiente 3 (Plataformas) ===== */
    const newsData = [
      { id: 1, entity: "Paramount Global", country: "Todos los Países", impact: "Alto", title: "CMA del Reino Unido otorga aprobación final para la adquisición de Paramount Global por Skydance Media", url: "https://www.reuters.com/markets/deals/skydance-clears-final-uk-regulatory-hurdle-paramount-takeover-2025-08-15/", date: "15-08-2025", category: "Fusión/Adquisición", summary: "La aprobación elimina el último obstáculo regulatorio importante, y se espera que el acuerdo se cierre en el Q4 de 2025. Esto impactará significativamente el panorama del streaming, pudiendo generar cambios en la estrategia de Paramount+." },
      { id: 2, entity: "Amazon Prime", country: "Brasil", impact: "Medio", title: "Amazon Brasil anuncia alianza con Itaú para ofrecer cuotas sin interés a clientes Prime", url: "https://www.bloomberglinea.com/2025/08/19/amazon-e-itau-se-unem-para-oferecer-parcelamento-exclusivo-a-membros-prime-no-brasil/", date: "19-08-2025", category: "Estrategia", summary: "La alianza fortalece la propuesta de valor de Amazon en un mercado donde el pago en cuotas (parcelamento) es crucial. Compite directamente con la integración de servicios financieros de Mercado Libre." },
      { id: 3, entity: "Shein", country: "Todos los Países", impact: "Medio", title: "Shein prueba la suscripción 'Shein VIP' en Europa y LATAM, ofreciendo devoluciones gratis y envíos más rápidos", url: "https://www.wsj.com/business/retail/shein-tests-paid-membership-to-rival-amazon-prime-b2d9e1c3", date: "12-08-2025", category: "Lanzamiento", summary: "Shein está probando un modelo de suscripción similar a Prime/Meli+, centrado en beneficios logísticos. Representa un cambio estratégico hacia una plataforma con servicios de lealtad, amenazando una parte clave de la propuesta de valor de Meli+." }
    ];
    const contentNewsData = [
      { entity: "Netflix", title: "Netflix obtiene derechos exclusivos globales de streaming para la liga de fútbol 'Brasileirão' a partir de 2026", url: "https://variety.com/2025/tv/global/netflix-brazilian-soccer-league-rights-123567890/", date: "20-08-2025", category: "Derechos/Deportes", summary: "Netflix ha asegurado un acuerdo multianual por los derechos globales (excluyendo TV en Brasil) de la principal liga de fútbol brasileña. Es un gran paso hacia los deportes en vivo para atraer y retener suscriptores.", impact: "Alto", country: "Brasil" },
      { entity: "Disney+", title: "Disney+ confirma que partidos de NFL y Liga MX se transmitirán en vivo vía 'ESPN Tile' en México", url: "https://espnpressroom.com/us/press-releases/2025/08/espn-tile-on-disney-plus-to-feature-live-nfl-and-liga-mx-games-in-mexico/", date: "14-08-2025", category: "Producto", summary: "Disney detalló el contenido deportivo en vivo que llegará a su 'mosaico' de ESPN integrado en la app de Disney+ para el mercado mexicano. La medida fortalece su paquete y compite con otros servicios.", impact: "Medio", country: "México" },
      { entity: "OpenAI", title: "OpenAI presenta 'GPT-4.5-Turbo', un modelo más rápido y económico, con lista de espera para API ya abierta", url: "https://openai.com/blog/introducing-gpt-4-5-turbo", date: "18-08-2025", category: "Flagship AI", summary: "Se anuncia un nuevo modelo intermedio que promete un rendimiento cercano a GPT-4 pero con latencia y costo significativamente menores, orientado a desarrolladores de aplicaciones de IA a gran escala.", impact: "Medio", country: "Todos los Países" },
      { entity: "Max", title: "Warner Bros. Discovery aumenta el precio de su plan Max sin anuncios en $1 en EE. UU. y mercados selectos", url: "https://www.hollywoodreporter.com/business/business-news/max-price-hike-ad-free-plan-123567800/", date: "11-08-2025", category: "Cambio de Precio", summary: "WBD anunció un pequeño aumento de precio en su plan premium para financiar la inversión en contenido, manteniendo sin cambios los planes con publicidad para incentivar su adopción.", impact: "Medio", country: "Todos los Países" }
    ];

    /* ===== LISTAS MAESTRAS PARA MOSTRAR TODOS LOS FILTROS (aunque no haya noticias) ===== */
    const ALL_NEWS_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_NEWS_COMPANIES = [
      'Amazon Prime','Shein','Temu','Shopee','Tiendanube','Rappi Pro','Uber One','Netflix','Spotify Premium','OpenAI (ChatGPT Premium)','Disney+',
      'Nubank Ultravioleta','Smiles','Globoplay','Nubank','Ualá','Cablevisión Flow','Amazon Prime Video','DGO','Mach','Paramount Global'
    ].sort();
    const ALL_NEWS_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ].sort();

    const ALL_CONTENT_COUNTRIES = ['Argentina','Brasil','Chile','México','Todos los Países'];
    const ALL_CONTENT_COMPANIES = [
      'Disney+','Netflix','Apple TV+','Max','Paramount+','Universal+','Vix Premium','Globoplay','Spotify','Deezer','OpenAI'
    ].sort();
    const ALL_CONTENT_CATEGORIES = [
      'Cambio de Precio','Lanzamiento','Fusión/Adquisición','Sanción Legal','Estrategia','Producto',
      'Resultados Financieros','Derechos/Deportes','Flagship AI'
    ].sort();

    const chartColors = { main: '#2563eb', event: '#f59e0b' };

    const tabButtons = document.querySelectorAll('.tab-btn');
    const countryName = document.getElementById('country-name');
    const sentimentTableBody = document.getElementById('sentiment-table-body');
    const sentimentSummary = document.getElementById('sentiment-summary');
    let sentimentChart = null;

    const alertsGrid = document.getElementById('alerts-grid');
    const newsNoResults = document.getElementById('no-news-results');
    const newsFilterCountryContainer = document.getElementById('news-filter-country');
    const newsFilterCompanyContainer = document.getElementById('news-filter-company');
    const newsFilterCategoryContainer = document.getElementById('news-filter-category');
    let newsFilters = { country: [], company: [], category: [] };

    const contentAlertsGrid = document.getElementById('content-alerts-grid');
    const contentNewsNoResults = document.getElementById('no-content-results');
    const contentFilterCountryContainer = document.getElementById('content-filter-country');
    const contentFilterCompanyContainer = document.getElementById('content-filter-company');
    const contentFilterCategoryContainer = document.getElementById('content-filter-category');
    let contentFilters = { country: [], company: [], category: [] };

    /* ==== Helpers del gráfico ==== */
    function renderChart(data) {
      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      sentimentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Índice de Sentimiento',
            data: data.sentimentIndex,
            borderColor: chartColors.main,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderWidth: 2, fill: true,
            pointBackgroundColor: data.labels.map(l => data.events.find(e => e.month === l) ? chartColors.event : chartColors.main),
            pointRadius: data.labels.map(l => data.events.find(e => e.month === l) ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Índice de Sentimiento (0-100)', font: { weight: 'bold' } } } },
          plugins: { tooltip: { callbacks: { title: (items) => {
            const m = items[0].label; const ev = data.events.find(e => e.month === m);
            return m + (ev ? `\nEvento: ${ev.text}` : '');
          }}}}
        }
      });
    }

    function renderSentimentTable(rows) {
      sentimentTableBody.innerHTML = '';
      if (!rows) return;
      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.mes}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.detractores}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.motivosDet}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.promotores}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.motivosPro}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.eventos}</td>
          <td class="px-6 py-4 text-sm text-gray-500">${row.competencia}</td>`;
        sentimentTableBody.appendChild(tr);
      });
    }
    function renderSummary(html) { sentimentSummary.innerHTML = html || ''; }
    function updateSentimentContent(country) {
      const data = sentimentData[country]; if (!data) return;
      countryName.textContent = country; renderChart(data); renderSentimentTable(data.table); renderSummary(data.summary);
    }

    /* ==== Etiquetas de categoría ==== */
    function getCategoryTag(category) {
      switch (category) {
        case 'Sanción Legal': return `<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Cambio de Precio': return `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Lanzamiento': return `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Fusión/Adquisición': return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Estrategia': return `<span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Producto': return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Resultados Financieros': return `<span class="bg-teal-100 text-teal-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Derechos/Deportes': return `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        case 'Flagship AI': return `<span class="bg-pink-100 text-pink-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
        default: return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${category}</span>`;
      }
    }

    /* ==== Helpers de URL: sanitizar, host y copiar ==== */
    function sanitizeUrl(u) {
      if (!u) return '#';
      const raw = String(u).trim();
      const withProto = /^https?:\/\//i.test(raw) ? raw : `https://${raw.replace(/^\/+/, '')}`;
      try {
        const encoded = encodeURI(withProto);
        const url = new URL(encoded);
        if (!/^https?:$/.test(url.protocol)) return '#';
        return url.href;
      } catch { return '#'; }
    }
    function sourceHost(u) {
      try { return new URL(u).hostname.replace(/^www\./, ''); } catch { return ''; }
    }
    async function copyToClipboard(text) {
      try { await navigator.clipboard.writeText(text); } catch {}
    }

    /* ==== Utilidades de filtros ==== */
    function normalizeSelectAll(container, selectedValues) {
      const allBox = container.querySelector('input[value="Todos"]');
      const rest = [...container.querySelectorAll('input[type="checkbox"]')].filter(b => b.value !== 'Todos');
      if (!allBox) return;
      if (selectedValues.includes('Todos')) rest.forEach(b => b.checked = false);
      else if (rest.some(b => b.checked)) allBox.checked = false;
    }
    function getSelected(container) {
      return Array.from(container.querySelectorAll('input:checked')).map(i => i.value);
    }

    /* ==== Render tarjetas (Vertiente 2) con URLs saneadas ==== */
    function renderNewsCards() {
      alertsGrid.innerHTML = '';
      const filtered = newsData.filter(item => {
        const hasCountries = newsFilters.country.length > 0 && !newsFilters.country.includes('Todos los Países');
        const cm = !hasCountries || newsFilters.country.includes(item.country) || (item.country === 'Todos los Países' && newsFilters.country.length > 0);
        const em = newsFilters.company.length === 0 || newsFilters.company.includes(item.entity);
        const km = newsFilters.category.length === 0 || newsFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      newsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-slate-50 p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}${row.country && row.country !== 'Todos los Países' ? ` (${row.country})` : ''}</h4>
              <span class="text-sm font-bold ${row.impact === 'Alto' ? 'text-red-600' : 'text-yellow-600'}">${row.impact}</span>
            </div>
            <div class="my-2">${getCategoryTag(row.category)}</div>
            <p class="text-gray-700 font-semibold mb-3">${row.title}</p>
            <p class="text-sm text-gray-600 mb-3">${row.summary}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center gap-3">
            <span>${row.date || ''}</span>
            <div class="flex items-center gap-3">
              <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
                 class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
            </div>
          </div>`;
        alertsGrid.appendChild(card);
      });
    }

    /* ==== Render tarjetas (Vertiente 3) con URLs saneadas ==== */
    function renderContentNewsCards() {
      contentAlertsGrid.innerHTML = '';
      const filtered = contentNewsData.filter(item => {
        const hasCountries = contentFilters.country.length > 0 && !contentFilters.country.includes('Todos los Países');
        const cm = !hasCountries || contentFilters.country.includes(item.country) || (item.country === 'Todos los Países' && contentFilters.country.length > 0);
        const em = contentFilters.company.length === 0 || contentFilters.company.includes(item.entity);
        const km = contentFilters.category.length === 0 || contentFilters.category.includes(item.category);
        return cm && em && km;
      }).sort((a,b) => {
        const da = new Date((a.date || '').split('-').reverse().join('-'));
        const db = new Date((b.date || '').split('-').reverse().join('-'));
        if (da > db) return -1; if (da < db) return 1;
        const order = { 'Alto':1, 'Medio':2, 'Bajo':3 }; return (order[a.impact]||9) - (order[b.impact]||9);
      });
      contentNewsNoResults.classList.toggle('hidden', filtered.length !== 0);
      filtered.forEach(row => {
        const href = sanitizeUrl(row.url);
        const host = sourceHost(href);
        const card = document.createElement('div');
        card.className = 'bg-slate-50 p-6 rounded-xl shadow-md border border-gray-200 flex flex-col hover:shadow-xl transition-all duration-300';
        card.innerHTML = `
          <div class="flex-grow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-gray-800 text-lg">${row.entity}</h4>
              <span class="text-sm font-bold ${row.impact === 'Alto' ? 'text-red-600' : 'text-yellow-600'}">${row.impact}</span>
            </div>
            <div class="my-2">${getCategoryTag(row.category)}</div>
            <p class="font-semibold text-gray-700 mb-3">${row.title}</p>
            <p class="text-sm text-gray-600 mb-3">${row.summary}</p>
            <p class="text-xs text-gray-500 mb-1">Fuente: <span class="font-medium">${host || '—'}</span></p>
          </div>
          <div class="text-sm text-gray-500 mt-auto pt-4 border-t border-gray-200 flex justify-between items-center gap-3">
            <span>${row.date || ''}</span>
            <div class="flex items-center gap-3">
              <a href="${href}" title="${href}" rel="noopener noreferrer nofollow" target="_blank"
                 class="font-semibold text-blue-600 hover:underline">Ver Noticia &rarr;</a>
            </div>
          </div>`;
        contentAlertsGrid.appendChild(card);
      });
    }

    /* ==== Poblar filtros SIEMPRE desde listas maestras ==== */
    function populateCheckboxes(container, allItems, groupName) {
      const createCheckbox = (value, id, label) => `
        <div class="filter-checkbox-item">
          <input type="checkbox" id="${id}" value="${value}" name="${groupName}" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
          <label for="${id}" class="ml-2 text-sm text-gray-700">${label}</label>
        </div>`;
      container.innerHTML = allItems.map(c => createCheckbox(c, `${groupName}-${c.replace(/\s/g,'')}`, c)).join('');
    }

    function updateNewsFilters() {
      populateCheckboxes(newsFilterCountryContainer, ALL_NEWS_COUNTRIES, 'news-country');
      populateCheckboxes(newsFilterCompanyContainer, ALL_NEWS_COMPANIES, 'news-company');
      populateCheckboxes(newsFilterCategoryContainer, ALL_NEWS_CATEGORIES, 'news-category');
      newsFilterCountryContainer.addEventListener('change', filterNews);
      newsFilterCompanyContainer.addEventListener('change', filterNews);
      newsFilterCategoryContainer.addEventListener('change', filterNews);
    }

    function updateContentNewsFilters() {
      populateCheckboxes(contentFilterCountryContainer, ALL_CONTENT_COUNTRIES, 'content-country');
      populateCheckboxes(contentFilterCompanyContainer, ALL_CONTENT_COMPANIES, 'content-company');
      populateCheckboxes(contentFilterCategoryContainer, ALL_CONTENT_CATEGORIES, 'content-category');
      contentFilterCountryContainer.addEventListener('change', filterContentNews);
      contentFilterCompanyContainer.addEventListener('change', filterContentNews);
      contentFilterCategoryContainer.addEventListener('change', filterContentNews);
    }

    /* ==== Lógica de filtros ==== */
    function filterNews() {
      newsFilters.country = getSelected(newsFilterCountryContainer);
      newsFilters.company = getSelected(newsFilterCompanyContainer);
      newsFilters.category = getSelected(newsFilterCategoryContainer);
      renderNewsCards();
    }

    function filterContentNews() {
      contentFilters.country = getSelected(contentFilterCountryContainer);
      contentFilters.company = getSelected(contentFilterCompanyContainer);
      contentFilters.category = getSelected(contentFilterCategoryContainer);
      renderContentNewsCards();
    }

    /* ==== Tabs y resets ==== */
    tabButtons.forEach(btn => btn.addEventListener('click', (e) => {
      tabButtons.forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      updateSentimentContent(e.target.dataset.country);
    }));
    document.getElementById('news-reset-filters').addEventListener('click', () => {
      newsFilters = { country: [], company: [], category: [] };
      [newsFilterCountryContainer, newsFilterCompanyContainer, newsFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderNewsCards();
    });
    document.getElementById('content-reset-filters').addEventListener('click', () => {
      contentFilters = { country: [], company: [], category: [] };
      [contentFilterCountryContainer, contentFilterCompanyContainer, contentFilterCategoryContainer].forEach(c => {
        Array.from(c.querySelectorAll('input')).forEach(i => i.checked = false);
      });
      renderContentNewsCards();
    });

    /* ==== Boot ==== */
    document.addEventListener('DOMContentLoaded', () => {
      updateSentimentContent('Brasil');
      updateNewsFilters(); renderNewsCards();
      updateContentNewsFilters(); renderContentNewsCards();
    });
  </script>
</body>
</html>